# üîç Code Review - 12/19/2025, 7:30:46 PM

**Project:** AI Visual Code Review
**Generated by:** AI Visual Code Review v2.0

## üìä Change Summary

```
AI_REVIEW.md | 3728 +++++++++++++++++++++++++++++-----------------------------
 1 file changed, 1832 insertions(+), 1896 deletions(-)
```

## üìù Files Changed (1/1 selected)


### üìÑ `AI_REVIEW.md`

**Type:** Documentation üìñ

```diff
@@ -1,4 +1,4 @@
  1     -# üîç Code Review - 12/19/2025, 4:19:18 PM
      1 +# üîç Code Review - 12/19/2025, 7:26:20 PM
  2   2  
  3   3  **Project:** AI Visual Code Review
  4   4  **Generated by:** AI Visual Code Review v2.0
@@ -6,1560 +6,1618 @@
  6   6  ## üìä Change Summary
  7   7  
  8   8  ```
  9     -.../toc-anchor-navigation-design-v5.md             | 900 +++++++++++++++++++++
 10     - docs/competitive_programming_constraints.md        | 621 ++++++++++++++
 11     - script.js                                          | 255 ++++++
 12     - style.css                                          |  41 +
 13     - variables.css                                      |  19 +-
 14     - 5 files changed, 1831 insertions(+), 5 deletions(-)
      9 +README.md                                          |   27 +
     10 + docs/01-requirements/donation-feature-plan.md      | 1063 ++++++++++++++++++++
     11 + .../donation_final_readiness_review.md             |   91 ++
     12 + docs/01-requirements/donation_strategy_review.md   |   64 ++
     13 + docs/01-requirements/donation_system_design.md     |  141 +++
     14 + .../donation_technical_feasibility_review.md       |   87 ++
     15 + index.html                                         |   22 +-
     16 + script.js                                          |  114 +++
     17 + style.css                                          |  119 +++
     18 + 9 files changed, 1722 insertions(+), 6 deletions(-)
 15  19  ```
 16  20  
 17     -## üìù Files Changed (5/5 selected)
     21 +## üìù Files Changed (9/9 selected)
 18  22  
 19  23  
 20     -### ‚ú® `docs/01-requirements/toc-anchor-navigation-design-v5.md` **[ADDED]**
 21     -
 22     -**Status:** ‚úÖ **NEW FILE** - This file has been newly created
     24 +### üìÑ `README.md`
 23  25  
 24  26  **Type:** Documentation üìñ
 25  27  
 26  28  ```diff
 27     -@@ -0,0 +1,900 @@
 28     -      1 +# Design Document: Table of Contents Anchor Navigation
 29     -      2 +
 30     -      3 +## Version 5.0 (Production Ready - Final)
 31     -      4 +
 32     -      5 +---
 33     -      6 +
 34     -      7 +**Document ID:** DD-2025-002-TOC-NAV
 35     -      8 +**Author:** Principal SDE
 36     -      9 +**Created:** December 19, 2025
 37     -     10 +**Last Updated:** December 19, 2025
 38     -     11 +**Status:** ‚úÖ **APPROVED FOR IMPLEMENTATION**
 39     -     12 +**Review Cycles:** 8 (v1.0 ‚Üí v2.0 ‚Üí v3.0 ‚Üí v4.0 ‚Üí v4.1 ‚Üí v4.2 ‚Üí v4.3 ‚Üí v5.0)
     29 +@@ -7,6 +7,10 @@
     30 +  7   7  [![Code Quality](https://img.shields.io/badge/code%20quality-A+-brightgreen)]()
     31 +  8   8  [![Zero Technical Debt](https://img.shields.io/badge/technical%20debt-zero-brightgreen)]()
     32 +  9   9  
     33 +     10 +[![GitHub Sponsors](https://img.shields.io/badge/Sponsor-%E2%9D%A4-pink?logo=github)](https://github.com/sponsors/PrakharMNNIT)
     34 +     11 +[![Ko-fi](https://img.shields.io/badge/Ko--fi-Support-blue?logo=ko-fi)](https://ko-fi.com/praxlannister)
     35 +     12 +[![Razorpay](https://img.shields.io/badge/Razorpay-‚Çπ_Support-brightgreen)](https://razorpay.me/@prakharshekharparthasarthi)
 40  36       13 +
 41     -     14 +---
 42     -     15 +
 43     -     16 +## Table of Contents
 44     -     17 +
 45     -     18 +1. [Executive Summary](#1-executive-summary)
 46     -     19 +2. [Problem Statement](#2-problem-statement)
 47     -     20 +3. [Requirements](#3-requirements)
 48     -     21 +4. [Technical Design](#4-technical-design)
 49     -     22 +5. [Implementation Details](#5-implementation-details)
 50     -     23 +6. [Browser Compatibility](#6-browser-compatibility)
 51     -     24 +7. [Testing Strategy](#7-testing-strategy)
 52     -     25 +8. [Performance Budget](#8-performance-budget)
 53     -     26 +9. [Security Considerations](#9-security-considerations)
 54     -     27 +10. [Rollback Plan](#10-rollback-plan)
 55     -     28 +11. [FAQ](#11-faq)
 56     -     29 +12. [Approval](#12-approval)
 57     -     30 +13. [Change Log](#13-change-log)
 58     -     31 +
 59     -     32 +---
 60     -     33 +
 61     -     34 +## 1. Executive Summary
 62     -     35 +
 63     -     36 +This document specifies the implementation of in-document anchor navigation for Markdown Viewer Pro. The feature enables clicking Table of Contents links to scroll the preview container to the target heading, with full accessibility support and legacy link compatibility.
 64     -     37 +
 65     -     38 +**Key Features:**
 66     -     39 +- Smooth scroll to headings on TOC link click
 67     -     40 +- Support for emoji and special character headings
 68     -     41 +- Legacy link compatibility (non-standard ID formats)
 69     -     42 +- Accessibility-compliant focus management
 70     -     43 +- Deep linking (URL hash on page load)
 71     -     44 +- Browser history support (back/forward)
 72     -     45 +
 73     -     46 +---
 74     -     47 +
 75     -     48 +## 2. Problem Statement
 76     -     49 +
 77     -     50 +### 2.1 Root Cause
 78     -     51 +
 79     -     52 +The application uses a **non-scrollable document body** (`overflow: hidden`) with content rendered inside a scrollable child container (`.preview-container`). When users click anchor links (`href="#section"`), the browser's native scroll algorithm targets the document viewport‚Äîwhich is non-scrollable‚Äîresulting in **silent failure**.
 80     -     53 +
 81     -     54 +### 2.2 Sticky Toolbar Occlusion
 82     -     55 +
 83     -     56 +The application has a fixed toolbar (height: `60px`). A naive scroll-to-element positions content at `top: 0`, causing it to be **obscured by the toolbar**.
 84     -     57 +
 85     -     58 +### 2.3 Legacy Link Compatibility
 86     -     59 +
 87     -     60 +Existing markdown documents contain manually-created links using non-standard ID formats (e.g., `#üìã-table-of-contents` or `#-standard-assumptions`). These must resolve correctly.
 88     -     61 +
 89     -     62 +### 2.4 App Shell ID Collision
 90     -     63 +
 91     -     64 +The application shell has elements with IDs like `sidebar`, `preview`, `editor`. User-authored headings with the same names must NOT collide with app shell elements.
 92     -     65 +
 93     -     66 +### 2.5 marked.js Singleton Constraint
 94     -     67 +
 95     -     68 +`marked` is imported as a global singleton. Calling `marked.use()` inside `renderMarkdown()` (which runs on every keystroke) would stack infinite extensions, causing:
 96     -     69 +- **Memory leak:** `marked.defaults.extensions` grows infinitely
 97     -     70 +- **Performance degradation:** After 100 keystrokes, marked runs 100 identical renderers
 98     -     71 +
 99     -     72 +---
100     -     73 +
101     -     74 +## 3. Requirements
102     -     75 +
103     -     76 +### 3.1 Functional Requirements
104     -     77 +
105     -     78 +| ID | Requirement | Priority | Acceptance Criteria |
106     -     79 +|----|-------------|----------|---------------------|
107     -     80 +| FR-1 | Internal anchor clicks scroll preview to target | P0 | Target heading visible within 800ms |
108     -     81 +| FR-2 | Scrolled content not occluded by toolbar | P0 | 20px gap between toolbar and heading |
109     -     82 +| FR-3 | URL hash updates on navigation | P0 | URL reflects current section |
110     -     83 +| FR-4 | Deep linking works on page load | P0 | `URL#section` scrolls on load |
111     -     84 +| FR-5 | Browser back/forward navigates history | P1 | Hash changes scroll correctly |
112     -     85 +| FR-6 | Legacy links work (emoji, special chars) | P0 | See compatibility matrix |
113     -     86 +| FR-7 | Focus moves to target for screen readers | P0 | Screen reader announces heading |
114     -     87 +| FR-8 | Empty hash (`#`) scrolls to top | P1 | Container scrollTop = 0 |
115     -     88 +| FR-9 | No collision with app shell IDs | P0 | User `## Sidebar` != app `#sidebar` |
116     -     89 +| FR-10 | Duplicate headings get unique IDs | P0 | `header`, `header-1`, `header-2` |
117     -     90 +
118     -     91 +### 3.2 Non-Functional Requirements
119     -     92 +
120     -     93 +| ID | Requirement | Target |
121     -     94 +|----|-------------|--------|
122     -     95 +| NFR-1 | Click-to-scroll latency | < 16ms (1 frame) |
123     -     96 +| NFR-2 | Scroll animation duration | 300-800ms (distance-based) |
124     -     97 +| NFR-3 | No layout thrashing | 0 forced reflows |
125     -     98 +| NFR-4 | Memory overhead | < 1KB per session |
126     -     99 +| NFR-5 | No memory leaks | Zero extension stacking |
127     -    100 +| NFR-6 | Stateless rendering | Module-level map with reset |
128     -    101 +
129     -    102 +### 3.3 Edge Cases
130     -    103 +
131     -    104 +| Case | Input | Expected Behavior |
132     -    105 +|------|-------|-------------------|
133     -    106 +| Empty hash | `href="#"` | Scroll to top (scrollTop = 0) |
134     -    107 +| Non-existent target | `href="#nonexistent"` | Console warning, no action |
135     -    108 +| External link | `href="https://..."` | Browser default behavior |
136     -    109 +| Duplicate headers | Two `## Header` | IDs: `header`, `header-1` |
137     -    110 +| App shell collision | `## Sidebar` | Resolves to user content, not `#sidebar` |
138     -    111 +| Special chars | `## C++` | ID: `cpp` |
139     -    112 +| Emoji | `## üéØ Goal` | ID: `goal` |
140     -    113 +| Concurrent clicks | Click A, then B rapidly | Cancel A, execute B |
141     -    114 +| Already visible | Target in viewport | Smooth scroll anyway |
142     -    115 +
143     -    116 +---
144     -    117 +
145     -    118 +## 4. Technical Design
146     -    119 +
147     -    120 +### 4.1 Architecture Overview
148     -    121 +
149     -    122 +```
150     -    123 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
151     -    124 +‚îÇ                     User Interaction                          ‚îÇ
152     -    125 +‚îÇ  [Click] ‚îÄ‚îÄ‚ñ∫ [hashchange] ‚îÄ‚îÄ‚ñ∫ [Page Load with Hash]          ‚îÇ
153     -    126 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
154     -    127 +                       ‚îÇ
155     -    128 +                       ‚ñº
156     -    129 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
157     -    130 +‚îÇ                 AnchorNavigation Module                       ‚îÇ
158     -    131 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
159     -    132 +‚îÇ  ‚îÇ handleClick()  ‚îÇ  ‚îÇhandleHashChange‚îÇ  ‚îÇhandleInitLoad()‚îÇ  ‚îÇ
160     -    133 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
161     -    134 +‚îÇ          ‚îÇ                   ‚îÇ                   ‚îÇ            ‚îÇ
162     -    135 +‚îÇ          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
163     -    136 +‚îÇ                              ‚ñº                                ‚îÇ
164     -    137 +‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
165     -    138 +‚îÇ                   ‚îÇ  scrollToTarget()   ‚îÇ                     ‚îÇ
166     -    139 +‚îÇ                   ‚îÇ  ‚îî‚îÄ resolveTarget() ‚îÇ  ‚óÑ‚îÄ‚îÄ SCOPED to      ‚îÇ
167     -    140 +‚îÇ                   ‚îÇ  ‚îî‚îÄ scrollIntoView  ‚îÇ      container      ‚îÇ
168     -    141 +‚îÇ                   ‚îÇ  ‚îî‚îÄ manageFocus()   ‚îÇ                     ‚îÇ
169     -    142 +‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
170     -    143 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
171     -    144 +```
172     -    145 +
173     -    146 +### 4.2 Slug Generation Algorithm
174     -    147 +
175     -    148 +**Purpose:** Generate consistent, collision-free IDs for headings.
176     -    149 +
177     -    150 +**Algorithm (GitHub-compatible with programming term support):**
178     -    151 +
179     -    152 +```javascript
180     -    153 +// Pre-compiled regex patterns (module level - zero GC pressure)
181     -    154 +const SLUG_REPLACEMENTS = [
182     -    155 +  [/c\+\+/gi, 'cpp'],
183     -    156 +  [/c#/gi, 'csharp'],
184     -    157 +  [/f#/gi, 'fsharp'],
185     -    158 +  [/\.net/gi, 'dotnet'],
186     -    159 +];
187     -    160 +
188     -    161 +/**
189     -    162 + * Generate URL-safe slug from heading text
190     -    163 + * @param {string} text - Raw heading text (may include HTML)
191     -    164 + * @param {Map<string, number>} seen - Duplicate tracking map
192     -    165 + * @returns {string} URL-safe slug
193     -    166 + */
194     -    167 +function generateSlug(text, seen = new Map()) {
195     -    168 +  // Step 0: Strip HTML tags
196     -    169 +  let slug = text.replace(/<[^>]*>/g, '');
197     -    170 +
198     -    171 +  // Step 1: Normalize Unicode (handle caf√© vs caf√©)
199     -    172 +  slug = slug.normalize('NFC');
200     -    173 +
201     -    174 +  // Step 2: Lowercase
202     -    175 +  slug = slug.toLowerCase();
203     -    176 +
204     -    177 +  // Step 3: Replace programming terms (pre-compiled patterns)
205     -    178 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
206     -    179 +    slug = slug.replace(pattern, replacement);
207     -    180 +  }
208     -    181 +
209     -    182 +  // Step 4: Remove non-word chars (keep spaces, hyphens, underscores)
210     -    183 +  slug = slug.replace(/[^\w\s-]/g, '');
211     -    184 +
212     -    185 +  // Step 5: Spaces to hyphens
213     -    186 +  slug = slug.replace(/\s+/g, '-');
214     -    187 +
215     -    188 +  // Step 6: Collapse multiple hyphens
216     -    189 +  slug = slug.replace(/-+/g, '-');
217     -    190 +
218     -    191 +  // Step 7: Trim hyphens
219     -    192 +  slug = slug.replace(/^-+|-+$/g, '');
220     -    193 +
221     -    194 +  // Step 8: Fallback for empty result
222     -    195 +  if (!slug) slug = 'section';
223     -    196 +
224     -    197 +  // Step 9: Handle duplicates (header, header-1, header-2)
225     -    198 +  const baseSlug = slug;
226     -    199 +  const count = seen.get(baseSlug) || 0;
227     -    200 +  if (count > 0) {
228     -    201 +    slug = `${baseSlug}-${count}`;
229     -    202 +  }
230     -    203 +  seen.set(baseSlug, count + 1);
231     -    204 +
232     -    205 +  return slug;
233     -    206 +}
234     -    207 +```
235     -    208 +
236     -    209 +**Transformation Examples:**
237     -    210 +
238     -    211 +| Input | Output | Reason |
239     -    212 +|-------|--------|--------|
240     -    213 +| `Hello World` | `hello-world` | Standard |
241     -    214 +| `üéØ Standard Assumptions` | `standard-assumptions` | Emoji stripped |
242     -    215 +| `C++` | `cpp` | Special replacement |
243     -    216 +| `C#` | `csharp` | Special replacement |
244     -    217 +| `.NET Framework` | `dotnet-framework` | Special replacement |
245     -    218 +| `F#` | `fsharp` | Special replacement |
246     -    219 +| `API v2.0` | `api-v20` | Period stripped |
247     -    220 +| `1. Introduction` | `1-introduction` | Numbers preserved |
248     -    221 +| `hello_world` | `hello_world` | Underscores preserved |
249     -    222 +| `Header` (1st) | `header` | First occurrence |
250     -    223 +| `Header` (2nd) | `header-1` | Duplicate handling |
251     -    224 +| `Header` (3rd) | `header-2` | Duplicate handling |
252     -    225 +| `üòÄüòÄüòÄ` | `section` | Fallback for empty |
253     -    226 +| `--test--` | `test` | Trimmed |
254     -    227 +
255     -    228 +### 4.3 State Management (Singleton-Safe)
256     -    229 +
257     -    230 +**Critical:** `marked` is a global singleton. Extension registration happens ONCE at startup.
258     -    231 +
259     -    232 +```javascript
260     -    233 +// Module level (script.js, near top)
261     -    234 +const headingSlugMap = new Map();
262     -    235 +
263     -    236 +function resetSlugMap() {
264     -    237 +  headingSlugMap.clear();
265     -    238 +}
266     -    239 +
267     -    240 +// In configureMarkedExtensions() - called ONCE at app init
268     -    241 +marked.use({
269     -    242 +  renderer: {
270     -    243 +    heading(token) {
271     -    244 +      const text = this.parser.parseInline(token.tokens);
272     -    245 +      const level = token.depth;
273     -    246 +      const slug = generateSlug(text, headingSlugMap);
274     -    247 +      return `<h${level} id="${slug}">${text}</h${level}>\n`;
275     -    248 +    }
276     -    249 +  }
277     -    250 +});
278     -    251 +
279     -    252 +// In renderMarkdown() - called on every keystroke
280     -    253 +function renderMarkdown() {
281     -    254 +  resetSlugMap();  // Clear state, NOT re-register extension
282     -    255 +  const html = marked.parse(text);
283     -    256 +  // ...
284     -    257 +}
285     -    258 +```
286     -    259 +
287     -    260 +### 4.4 Link Resolution (Scoped Selection)
288     -    261 +
289     -    262 +**Purpose:** Match clicked links to generated IDs, preventing app shell collision.
290     -    263 +
291     -    264 +```javascript
292     -    265 +/**
293     -    266 + * Resolve target element from hash - SCOPED to container
294     -    267 + * @param {string} hash - URL hash (without #)
295     -    268 + * @param {HTMLElement} container - Scrollable container
296     -    269 + * @returns {Element|null} Target element or null
297     -    270 + */
298     -    271 +function resolveTarget(hash, container) {
299     -    272 +  if (!hash) return null;
300     -    273 +
301     -    274 +  // Decode URI components
302     -    275 +  let decodedHash;
303     -    276 +  try {
304     -    277 +    decodedHash = decodeURIComponent(hash);
305     -    278 +  } catch {
306     -    279 +    decodedHash = hash;
307     -    280 +  }
308     -    281 +
309     -    282 +  // Priority 1: Exact ID (SCOPED to container - prevents app shell collision)
310     -    283 +  let target = container.querySelector(`#${CSS.escape(decodedHash)}`);
311     -    284 +  if (target) return target;
312     -    285 +
313     -    286 +  // Priority 2: Normalized ID (handles legacy links)
314     -    287 +  const normalizedHash = normalizeHash(decodedHash);
315     -    288 +  target = container.querySelector(`#${CSS.escape(normalizedHash)}`);
316     -    289 +  if (target) return target;
317     -    290 +
318     -    291 +  console.warn(`[AnchorNav] Target not found: "${hash}"`);
319     -    292 +  return null;
320     -    293 +}
321     -    294 +
322     -    295 +/**
323     -    296 + * Normalize hash for legacy link matching
324     -    297 + */
325     -    298 +function normalizeHash(hash) {
326     -    299 +  let slug = hash.normalize('NFC').toLowerCase();
327     -    300 +
328     -    301 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
329     -    302 +    slug = slug.replace(pattern, replacement);
330     -    303 +  }
331     -    304 +
332     -    305 +  return slug
333     -    306 +    .replace(/[^\w\s-]/g, '')
334     -    307 +    .replace(/\s+/g, '-')
335     -    308 +    .replace(/-+/g, '-')
336     -    309 +    .replace(/^-+|-+$/g, '') || 'section';
337     -    310 +}
338     -    311 +```
339     -    312 +
340     -    313 +---
341     -    314 +
342     -    315 +## 5. Implementation Details
343     -    316 +
344     -    317 +### 5.1 CSS Configuration
345     -    318 +
346     -    319 +**File: `variables.css`** (add to existing `:root`)
347     -    320 +```css
348     -    321 +:root {
349     -    322 +  /* Existing variables... */
350     -    323 +
351     -    324 +  /* Anchor Navigation */
352     -    325 +  --toolbar-height: 60px;
353     -    326 +  --scroll-padding: 20px;
354     -    327 +  --scroll-offset: calc(var(--toolbar-height) + var(--scroll-padding));
355     -    328 +}
356     -    329 +```
357     -    330 +
358     -    331 +**File: `style.css`** (add new section)
359     -    332 +```css
360     -    333 +/* ==================== ANCHOR NAVIGATION ==================== */
361     -    334 +
362     -    335 +/* Scroll padding - SINGLE SOURCE of offset */
363     -    336 +.preview-container {
364     -    337 +  scroll-padding-top: var(--scroll-offset, 80px);
365     -    338 +}
366     -    339 +
367     -    340 +/* Target highlight animation */
368     -    341 +.preview-container :target {
369     -    342 +  animation: anchor-highlight 2s ease-out;
370     -    343 +}
371     -    344 +
372     -    345 +@keyframes anchor-highlight {
373     -    346 +  0% { background-color: rgba(255, 255, 0, 0.3); }
374     -    347 +  100% { background-color: transparent; }
375     -    348 +}
376     -    349 +
377     -    350 +/* Focus management - conditional outline */
378     -    351 +.preview-container h1[id]:focus:not(:focus-visible),
379     -    352 +.preview-container h2[id]:focus:not(:focus-visible),
380     -    353 +.preview-container h3[id]:focus:not(:focus-visible),
381     -    354 +.preview-container h4[id]:focus:not(:focus-visible),
382     -    355 +.preview-container h5[id]:focus:not(:focus-visible),
383     -    356 +.preview-container h6[id]:focus:not(:focus-visible) {
384     -    357 +  outline: none;
385     -    358 +}
386     -    359 +
387     -    360 +/* Keyboard focus gets visible indicator */
388     -    361 +.preview-container h1[id]:focus-visible,
389     -    362 +.preview-container h2[id]:focus-visible,
390     -    363 +.preview-container h3[id]:focus-visible,
391     -    364 +.preview-container h4[id]:focus-visible,
392     -    365 +.preview-container h5[id]:focus-visible,
393     -    366 +.preview-container h6[id]:focus-visible {
394     -    367 +  outline: 2px solid var(--primary-color, #007bff);
395     -    368 +  outline-offset: 4px;
396     -    369 +  border-radius: 2px;
397     -    370 +}
398     -    371 +```
399     -    372 +
400     -    373 +### 5.2 JavaScript Implementation
401     -    374 +
402     -    375 +**File: `script.js`** (modifications)
403     -    376 +
404     -    377 +```javascript
405     -    378 +// ==================== ANCHOR NAVIGATION ====================
406     -    379 +// Add near top of file, after imports
407     -    380 +
408     -    381 +// Heading slug tracking (module-level singleton)
409     -    382 +const headingSlugMap = new Map();
410     -    383 +
411     -    384 +// Pre-compiled slug replacements (zero GC pressure)
412     -    385 +const SLUG_REPLACEMENTS = [
413     -    386 +  [/c\+\+/gi, 'cpp'],
414     -    387 +  [/c#/gi, 'csharp'],
415     -    388 +  [/f#/gi, 'fsharp'],
416     -    389 +  [/\.net/gi, 'dotnet'],
417     -    390 +];
418     -    391 +
419     -    392 +/**
420     -    393 + * Reset slug map (call before each parse)
421     -    394 + */
422     -    395 +function resetSlugMap() {
423     -    396 +  headingSlugMap.clear();
424     -    397 +}
425     -    398 +
426     -    399 +/**
427     -    400 + * Generate URL-safe slug from heading text
428     -    401 + */
429     -    402 +function generateSlug(text, seen = headingSlugMap) {
430     -    403 +  // Strip HTML tags
431     -    404 +  let slug = text.replace(/<[^>]*>/g, '');
432     -    405 +
433     -    406 +  // Normalize Unicode
434     -    407 +  slug = slug.normalize('NFC').toLowerCase();
435     -    408 +
436     -    409 +  // Replace programming terms
437     -    410 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
438     -    411 +    slug = slug.replace(pattern, replacement);
439     -    412 +  }
440     -    413 +
441     -    414 +  // Clean up
442     -    415 +  slug = slug
443     -    416 +    .replace(/[^\w\s-]/g, '')
444     -    417 +    .replace(/\s+/g, '-')
445     -    418 +    .replace(/-+/g, '-')
446     -    419 +    .replace(/^-+|-+$/g, '');
447     -    420 +
448     -    421 +  if (!slug) slug = 'section';
449     -    422 +
450     -    423 +  // Handle duplicates
451     -    424 +  const baseSlug = slug;
452     -    425 +  const count = seen.get(baseSlug) || 0;
453     -    426 +  if (count > 0) slug = `${baseSlug}-${count}`;
454     -    427 +  seen.set(baseSlug, count + 1);
455     -    428 +
456     -    429 +  return slug;
457     -    430 +}
458     -    431 +
459     -    432 +/**
460     -    433 + * Anchor Navigation Module
461     -    434 + */
462     -    435 +const AnchorNavigation = {
463     -    436 +  container: null,
464     -    437 +  pendingScroll: null,
465     -    438 +
466     -    439 +  /**
467     -    440 +   * Initialize anchor navigation
468     -    441 +   */
469     -    442 +  init(previewContainer) {
470     -    443 +    this.container = previewContainer;
471     -    444 +
472     -    445 +    // Event delegation for clicks
473     -    446 +    this.container.addEventListener('click', this.handleClick.bind(this));
474     -    447 +
475     -    448 +    // Browser back/forward
476     -    449 +    window.addEventListener('hashchange', this.handleHashChange.bind(this));
477     -    450 +
478     -    451 +    // Initial page load with hash
479     -    452 +    if (window.location.hash) {
480     -    453 +      requestAnimationFrame(() => {
481     -    454 +        this.scrollToHash(window.location.hash.slice(1), false);
482     -    455 +      });
483     -    456 +    }
484     -    457 +  },
485     -    458 +
486     -    459 +  /**
487     -    460 +   * Handle click events (delegated)
488     -    461 +   */
489     -    462 +  handleClick(event) {
490     -    463 +    const link = event.target.closest('a[href^="#"]');
491     -    464 +    if (!link) return;
492     -    465 +
493     -    466 +    // Ignore external links
494     -    467 +    if (link.hostname && link.hostname !== window.location.hostname) return;
495     -    468 +
496     -    469 +    event.preventDefault();
497     -    470 +
498     -    471 +    const hash = link.getAttribute('href').slice(1);
499     -    472 +    this.scrollToHash(hash, true);
500     -    473 +
501     -    474 +    // Update URL
502     -    475 +    history.pushState(null, '', `#${hash}`);
503     -    476 +  },
504     -    477 +
505     -    478 +  /**
506     -    479 +   * Handle hashchange (back/forward)
507     -    480 +   */
508     -    481 +  handleHashChange() {
509     -    482 +    const hash = window.location.hash.slice(1);
510     -    483 +    if (hash) {
511     -    484 +      this.scrollToHash(hash, true);
512     -    485 +    } else {
513     -    486 +      this.scrollToTop(true);
514     -    487 +    }
515     -    488 +  },
516     -    489 +
517     -    490 +  /**
518     -    491 +   * Scroll to element by hash
519     -    492 +   */
520     -    493 +  scrollToHash(hash, smooth = true) {
521     -    494 +    // Cancel pending scroll (handle concurrent clicks)
522     -    495 +    if (this.pendingScroll) {
523     -    496 +      clearTimeout(this.pendingScroll);
524     -    497 +      this.pendingScroll = null;
525     -    498 +    }
526     -    499 +
527     -    500 +    if (!hash) {
528     -    501 +      this.scrollToTop(smooth);
529     -    502 +      return;
530     -    503 +    }
531     -    504 +
532     -    505 +    const target = this.resolveTarget(hash);
533     -    506 +    if (!target) return;
534     -    507 +
535     -    508 +    target.scrollIntoView({
536     -    509 +      behavior: smooth ? 'smooth' : 'instant',
537     -    510 +      block: 'start',
538     -    511 +    });
539     -    512 +
540     -    513 +    this.manageFocus(target, smooth);
541     -    514 +  },
542     -    515 +
543     -    516 +  /**
544     -    517 +   * Scroll to top
545     -    518 +   */
546     -    519 +  scrollToTop(smooth = true) {
547     -    520 +    this.container.scrollTo({
548     -    521 +      top: 0,
549     -    522 +      behavior: smooth ? 'smooth' : 'instant',
550     -    523 +    });
551     -    524 +  },
552     -    525 +
553     -    526 +  /**
554     -    527 +   * Resolve target - SCOPED to container
555     -    528 +   */
556     -    529 +  resolveTarget(hash) {
557     -    530 +    if (!hash) return null;
558     -    531 +
559     -    532 +    let decodedHash;
560     -    533 +    try {
561     -    534 +      decodedHash = decodeURIComponent(hash);
562     -    535 +    } catch {
563     -    536 +      decodedHash = hash;
564     -    537 +    }
565     -    538 +
566     -    539 +    // Priority 1: Exact ID (scoped)
567     -    540 +    let target = this.container.querySelector(`#${CSS.escape(decodedHash)}`);
568     -    541 +    if (target) return target;
569     -    542 +
570     -    543 +    // Priority 2: Normalized ID (scoped)
571     -    544 +    const normalized = this.normalizeHash(decodedHash);
572     -    545 +    target = this.container.querySelector(`#${CSS.escape(normalized)}`);
573     -    546 +    if (target) return target;
574     -    547 +
575     -    548 +    console.warn(`[AnchorNav] Target not found: "${hash}"`);
576     -    549 +    return null;
577     -    550 +  },
578     -    551 +
579     -    552 +  /**
580     -    553 +   * Normalize hash for legacy link matching
581     -    554 +   */
582     -    555 +  normalizeHash(hash) {
583     -    556 +    let slug = hash.normalize('NFC').toLowerCase();
584     -    557 +
585     -    558 +    for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
586     -    559 +      slug = slug.replace(pattern, replacement);
587     -    560 +    }
588     -    561 +
589     -    562 +    return slug
590     -    563 +      .replace(/[^\w\s-]/g, '')
591     -    564 +      .replace(/\s+/g, '-')
592     -    565 +      .replace(/-+/g, '-')
593     -    566 +      .replace(/^-+|-+$/g, '') || 'section';
594     -    567 +  },
595     -    568 +
596     -    569 +  /**
597     -    570 +   * Manage focus after scroll
598     -    571 +   */
599     -    572 +  manageFocus(target, smooth) {
600     -    573 +    const focusTarget = () => {
601     -    574 +      if (!target.hasAttribute('tabindex')) {
602     -    575 +        target.setAttribute('tabindex', '-1');
603     -    576 +      }
604     -    577 +      target.focus({ preventScroll: true });
605     -    578 +    };
606     -    579 +
607     -    580 +    if (!smooth) {
608     -    581 +      focusTarget();
609     -    582 +      return;
610     -    583 +    }
611     -    584 +
612     -    585 +    // Modern: scrollend event
613     -    586 +    if ('onscrollend' in this.container) {
614     -    587 +      this.container.addEventListener('scrollend', focusTarget, { once: true });
615     -    588 +    } else {
616     -    589 +      // Fallback: estimate duration (max 1000ms for safety)
617     -    590 +      const distance = Math.abs(target.getBoundingClientRect().top);
618     -    591 +      const duration = Math.min(Math.max(distance / 2, 300), 1000);
619     -    592 +      this.pendingScroll = setTimeout(focusTarget, duration + 50);
620     -    593 +    }
621     -    594 +  },
622     -    595 +};
623     -    596 +```
624     -    597 +
625     -    598 +### 5.3 Integration Points
626     -    599 +
627     -    600 +**In `configureMarkedExtensions()`:**
628     -    601 +```javascript
629     -    602 +function configureMarkedExtensions() {
630     -    603 +  // ... existing extensions ...
631     -    604 +
632     -    605 +  // Custom heading renderer with ID generation
633     -    606 +  marked.use({
634     -    607 +    renderer: {
635     -    608 +      heading(token) {
636     -    609 +        const text = this.parser.parseInline(token.tokens);
637     -    610 +        const level = token.depth;
638     -    611 +        const slug = generateSlug(text, headingSlugMap);
639     -    612 +        return `<h${level} id="${slug}">${text}</h${level}>\n`;
640     -    613 +      }
641     -    614 +    }
642     -    615 +  });
643     -    616 +  console.log('‚úÖ Custom heading renderer enabled (ID generation)');
644     -    617 +}
645     -    618 +```
646     -    619 +
647     -    620 +**In `renderMarkdown()`:**
648     -    621 +```javascript
649     -    622 +function renderMarkdown() {
650     -    623 +  try {
651     -    624 +    resetSlugMap();  // Clear slug tracking before parse
652     -    625 +
653     -    626 +    const markdownText = editor.value;
654     -    627 +    let html = marked.parse(markdownText);
655     -    628 +    // ... rest of existing logic ...
656     -    629 +  }
657     -    630 +}
658     -    631 +```
659     -    632 +
660     -    633 +**In `setupEditor()` (at end):**
661     -    634 +```javascript
662     -    635 +// Initialize anchor navigation
663     -    636 +AnchorNavigation.init(previewContainer);
664     -    637 +```
665     -    638 +
666     -    639 +---
667     -    640 +
668     -    641 +## 6. Browser Compatibility
669     -    642 +
670     -    643 +| Feature | Chrome | Firefox | Safari | Edge | Fallback |
671     -    644 +|---------|--------|---------|--------|------|----------|
672     -    645 +| `scrollIntoView({ behavior })` | 61+ | 36+ | 15.4+ | 79+ | Instant scroll |
673     -    646 +| `scrollend` event | 114+ | 109+ | 17+ | 114+ | setTimeout (1000ms max) |
674     -    647 +| `scroll-padding-top` | 69+ | 68+ | 14.1+ | 79+ | None needed |
675     -    648 +| `CSS.escape()` | 46+ | 31+ | 10+ | 79+ | None needed |
676     -    649 +| `:focus-visible` | 86+ | 85+ | 15.4+ | 86+ | Always show outline |
677     -    650 +
678     -    651 +**Minimum Supported:** Chrome 86, Firefox 85, Safari 15.4, Edge 86
679     -    652 +
680     -    653 +---
681     -    654 +
682     -    655 +## 7. Testing Strategy
683     -    656 +
684     -    657 +### 7.1 Unit Tests
685     -    658 +
686     -    659 +**File: `tests/unit/utils/anchorNavigation.test.js`**
687     -    660 +
688     -    661 +```javascript
689     -    662 +import { describe, it, expect, beforeEach } from 'vitest';
690     -    663 +
691     -    664 +describe('generateSlug', () => {
692     -    665 +  let seen;
693     -    666 +
694     -    667 +  beforeEach(() => {
695     -    668 +    seen = new Map();
696     -    669 +  });
697     -    670 +
698     -    671 +  describe('basic transformations', () => {
699     -    672 +    it('converts to lowercase', () => {
700     -    673 +      expect(generateSlug('HELLO', seen)).toBe('hello');
701     -    674 +    });
702     -    675 +
703     -    676 +    it('replaces spaces with hyphens', () => {
704     -    677 +      expect(generateSlug('hello world', seen)).toBe('hello-world');
705     -    678 +    });
706     -    679 +
707     -    680 +    it('preserves numbers', () => {
708     -    681 +      expect(generateSlug('Section 1', seen)).toBe('section-1');
709     -    682 +    });
710     -    683 +
711     -    684 +    it('preserves underscores', () => {
712     -    685 +      expect(generateSlug('hello_world', seen)).toBe('hello_world');
713     -    686 +    });
714     -    687 +  });
     37 + 10  14  ---
     38 + 11  15  
     39 + 12  16  ## ‚ú® Features
     40 +@@ -680,6 +684,29 @@ MIT License - See LICENSE file for details
     41 +680 684  
     42 +681 685  ---
     43 +682 686  
     44 +    687 +---
715  45      688 +
716     -    689 +  describe('special characters', () => {
717     -    690 +    it('removes emoji', () => {
718     -    691 +      expect(generateSlug('üéØ Goal', seen)).toBe('goal');
719     -    692 +    });
720     -    693 +
721     -    694 +    it('handles C++', () => {
722     -    695 +      expect(generateSlug('C++', seen)).toBe('cpp');
723     -    696 +    });
724     -    697 +
725     -    698 +    it('handles C#', () => {
726     -    699 +      expect(generateSlug('C#', seen)).toBe('csharp');
727     -    700 +    });
728     -    701 +
729     -    702 +    it('handles F#', () => {
730     -    703 +      expect(generateSlug('F#', seen)).toBe('fsharp');
731     -    704 +    });
     46 +    689 +## üíñ Support This Project
     47 +    690 +
     48 +    691 +If you find Markdown Viewer Pro useful, consider supporting its development:
     49 +    692 +
     50 +    693 +[![GitHub Sponsors](https://img.shields.io/badge/Sponsor-%E2%9D%A4-pink?logo=github&style=for-the-badge)](https://github.com/sponsors/PrakharMNNIT)
     51 +    694 +[![Ko-fi](https://img.shields.io/badge/Ko--fi-Support-blue?logo=ko-fi&style=for-the-badge)](https://ko-fi.com/praxlannister)
     52 +    695 +[![Razorpay](https://img.shields.io/badge/Razorpay-‚Çπ_UPI-brightgreen?style=for-the-badge)](https://razorpay.me/@prakharshekharparthasarthi)
     53 +    696 +
     54 +    697 +### Support Tiers
     55 +    698 +
     56 +    699 +| Tier | Amount (USD) | Amount (INR) | Perks |
     57 +    700 +|------|--------------|--------------|-------|
     58 +    701 +| ‚òï Coffee | $1 | ‚Çπ50 | My gratitude! |
     59 +    702 +| üçï Pizza | $5 | ‚Çπ250 | Name in SUPPORTERS.md |
     60 +    703 +| üéâ Patron | $20 | ‚Çπ1000 | Name in README |
     61 +    704 +| üíé Champion | $50+ | ‚Çπ2500+ | Logo in README |
732  62      705 +
733     -    706 +    it('handles .NET', () => {
734     -    707 +      expect(generateSlug('.NET Framework', seen)).toBe('dotnet-framework');
735     -    708 +    });
     63 +    706 +Your support helps maintain and improve this project. Every contribution is appreciated! üôè
     64 +    707 +
     65 +    708 +---
736  66      709 +
737     -    710 +    it('strips periods', () => {
738     -    711 +      expect(generateSlug('API v2.0', seen)).toBe('api-v20');
739     -    712 +    });
740     -    713 +  });
741     -    714 +
742     -    715 +  describe('edge cases', () => {
743     -    716 +    it('collapses multiple hyphens', () => {
744     -    717 +      expect(generateSlug('hello--world', seen)).toBe('hello-world');
745     -    718 +    });
746     -    719 +
747     -    720 +    it('trims leading hyphens', () => {
748     -    721 +      expect(generateSlug('--hello', seen)).toBe('hello');
749     -    722 +    });
750     -    723 +
751     -    724 +    it('trims trailing hyphens', () => {
752     -    725 +      expect(generateSlug('hello--', seen)).toBe('hello');
753     -    726 +    });
754     -    727 +
755     -    728 +    it('returns "section" for empty result', () => {
756     -    729 +      expect(generateSlug('!!!', seen)).toBe('section');
757     -    730 +      expect(generateSlug('üòÄüòÄüòÄ', seen)).toBe('section');
758     -    731 +    });
759     -    732 +
760     -    733 +    it('handles unicode normalization', () => {
761     -    734 +      expect(generateSlug('caf√©', seen)).toBe('caf');
762     -    735 +    });
763     -    736 +
764     -    737 +    it('strips HTML tags', () => {
765     -    738 +      expect(generateSlug('<strong>Bold</strong> text', seen)).toBe('bold-text');
766     -    739 +    });
767     -    740 +  });
768     -    741 +
769     -    742 +  describe('duplicate handling', () => {
770     -    743 +    it('adds suffix for duplicates', () => {
771     -    744 +      expect(generateSlug('Header', seen)).toBe('header');
772     -    745 +      expect(generateSlug('Header', seen)).toBe('header-1');
773     -    746 +      expect(generateSlug('Header', seen)).toBe('header-2');
774     -    747 +    });
775     -    748 +
776     -    749 +    it('tracks different bases separately', () => {
777     -    750 +      expect(generateSlug('Header', seen)).toBe('header');
778     -    751 +      expect(generateSlug('Footer', seen)).toBe('footer');
779     -    752 +      expect(generateSlug('Header', seen)).toBe('header-1');
780     -    753 +    });
781     -    754 +  });
782     -    755 +});
783     -    756 +
784     -    757 +describe('normalizeHash', () => {
785     -    758 +  it('normalizes legacy emoji links', () => {
786     -    759 +    expect(normalizeHash('üéØ-standard-assumptions')).toBe('standard-assumptions');
787     -    760 +  });
788     -    761 +
789     -    762 +  it('normalizes leading hyphens', () => {
790     -    763 +    expect(normalizeHash('-hello-world-')).toBe('hello-world');
791     -    764 +  });
792     -    765 +
793     -    766 +  it('handles programming terms', () => {
794     -    767 +    expect(normalizeHash('c++')).toBe('cpp');
795     -    768 +  });
796     -    769 +});
797     -    770 +```
798     -    771 +
799     -    772 +### 7.2 Manual Test Cases
800     -    773 +
801     -    774 +| # | Scenario | Steps | Expected Result |
802     -    775 +|---|----------|-------|-----------------|
803     -    776 +| 1 | Standard TOC click | Click TOC link `#introduction` | Scrolls to heading, visible below toolbar |
804     -    777 +| 2 | Emoji header | Click `#üéØ-goal` | Resolves to `#goal`, scrolls correctly |
805     -    778 +| 3 | C++ header | Click `#c++` | Resolves to `#cpp`, scrolls correctly |
806     -    779 +| 4 | Deep link | Load `URL#section-1` | Page scrolls to section on load |
807     -    780 +| 5 | Browser back | Click link, then browser back | Returns to previous scroll position |
808     -    781 +| 6 | Empty hash | Click `href="#"` | Scrolls to top of container |
809     -    782 +| 7 | Invalid target | Click `#nonexistent` | Console warning, no crash |
810     -    783 +| 8 | Duplicate headers | Two `## Header` | First is `#header`, second is `#header-1` |
811     -    784 +| 9 | App shell collision | `## Sidebar` heading | Scrolls to user heading, not app `#sidebar` |
812     -    785 +| 10 | Accessibility | Tab to link, press Enter | Focus moves to heading, screen reader announces |
813     -    786 +| 11 | Concurrent clicks | Click A, immediately click B | Only B executes |
814     -    787 +
815     -    788 +---
816     -    789 +
817     -    790 +## 8. Performance Budget
818     -    791 +
819     -    792 +| Metric | Budget | Measurement Method |
820     -    793 +|--------|--------|-------------------|
821     -    794 +| Click-to-scroll latency | < 16ms | `performance.now()` delta |
822     -    795 +| Slug generation per heading | < 1ms | Profile in DevTools |
823     -    796 +| DOM queries per click | ‚â§ 2 | Code review |
824     -    797 +| Memory per session | < 1KB | DevTools heap snapshot |
825     -    798 +| Extension stack size | 1 (no growth) | `marked.defaults.extensions.length` |
826     -    799 +
827     -    800 +---
828     -    801 +
829     -    802 +## 9. Security Considerations
830     -    803 +
831     -    804 +| Concern | Risk | Mitigation |
832     -    805 +|---------|------|------------|
833     -    806 +| XSS via hash | Low | Hash is never inserted into innerHTML |
834     -    807 +| Open redirect | Low | Only same-origin hashes processed |
835     -    808 +| DoS (rapid clicks) | Low | Pending scroll cancellation |
836     -    809 +| Invalid ID injection | Low | `CSS.escape()` for selectors |
837     -    810 +| HTML in headings | Medium | Tags stripped before slug generation |
838     -    811 +
839     -    812 +---
840     -    813 +
841     -    814 +## 10. Rollback Plan
842     -    815 +
843     -    816 +### 10.1 Affected Files
844     -    817 +
845     -    818 +| File | Changes |
846     -    819 +|------|---------|
847     -    820 +| `script.js` | Add AnchorNavigation module, generateSlug, heading renderer |
848     -    821 +| `style.css` | Add scroll-padding, focus-visible styles |
849     -    822 +| `variables.css` | Add --scroll-offset variable |
850     -    823 +
851     -    824 +### 10.2 Rollback Command
852     -    825 +
853     -    826 +```bash
854     -    827 +git checkout HEAD~1 -- script.js style.css variables.css
855     -    828 +```
856     -    829 +
857     -    830 +### 10.3 Rollback Criteria
858     -    831 +
859     -    832 +- Any markdown rendering regression
860     -    833 +- JavaScript console errors
861     -    834 +- Theme switching broken
862     -    835 +- Memory leak detected (extension stacking)
863     -    836 +
864     -    837 +### 10.4 Verification Steps
865     -    838 +
866     -    839 +1. Reload application
867     -    840 +2. Verify no console errors
868     -    841 +3. Type in editor, verify preview updates
869     -    842 +4. Switch themes, verify no errors
870     -    843 +5. Check `marked.defaults` has stable extension count
871     -    844 +
872     -    845 +---
873     -    846 +
874     -    847 +## 11. FAQ
875     -    848 +
876     -    849 +**Q1: Will this break existing functionality?**
877     -    850 +> No. This is an additive feature. Existing markdown rendering is unchanged.
878     -    851 +
879     -    852 +**Q2: What if a heading contains only emoji?**
880     -    853 +> The slug becomes `section` (fallback for empty result).
881     -    854 +
882     -    855 +**Q3: Will this affect HTML export?**
883     -    856 +> Exported HTML will include the generated IDs. Navigation will work if opened in a browser.
884     -    857 +
885     -    858 +**Q4: What about very long headings?**
886     -    859 +> No length limit. The full heading becomes the slug (performance tested up to 1000 chars).
887     -    860 +
888     -    861 +**Q5: Can users manually specify IDs?**
889     -    862 +> Not currently. This would require parsing `{#custom-id}` syntax, which is a future enhancement.
890     -    863 +
891     -    864 +**Q6: What if `marked.use()` is accidentally called in `renderMarkdown()`?**
892     -    865 +> This would cause extension stacking (memory leak). The design explicitly prevents this by registering ONCE in `configureMarkedExtensions()` and only calling `resetSlugMap()` per render.
893     -    866 +
894     -    867 +**Q7: Why use `CSS.escape()` instead of simple string matching?**
895     -    868 +> IDs can contain special CSS selector characters (`.`, `#`, `:`). `CSS.escape()` ensures the querySelector doesn't break.
896     -    869 +
897     -    870 +**Q8: What's the maximum scroll duration?**
898     -    871 +> Capped at 1000ms for the `scrollend` fallback timeout. Smooth scroll itself is browser-controlled.
899     -    872 +
900     -    873 +---
901     -    874 +
902     -    875 +## 12. Approval
903     -    876 +
904     -    877 +| Role | Name | Date | Status |
905     -    878 +|------|------|------|--------|
906     -    879 +| Author | Principal SDE | 2025-12-19 | ‚úÖ Complete |
907     -    880 +| Reviewer | Gemini | 2025-12-19 | ‚úÖ Approved |
908     -    881 +| Implementation | Pending | - | ‚è≥ Ready |
909     -    882 +
910     -    883 +---
911     -    884 +
912     -    885 +## 13. Change Log
913     -    886 +
914     -    887 +| Version | Date | Author | Changes |
915     -    888 +|---------|------|--------|---------|
916     -    889 +| 1.0 | 2025-12-19 | Principal SDE | Initial draft |
917     -    890 +| 2.0 | 2025-12-19 | Principal SDE | Added requirements, edge cases |
918     -    891 +| 3.0 | 2025-12-19 | Gemini | Strict compliance version |
919     -    892 +| 4.0 | 2025-12-19 | Principal SDE | Production-ready with full implementation |
920     -    893 +| 4.1 | 2025-12-19 | Principal SDE | Fixed double offset, pre-compiled regex |
921     -    894 +| 4.2 | 2025-12-19 | Principal SDE | Scoped selection, focus-visible |
922     -    895 +| 4.3 | 2025-12-19 | Gemini | Identified singleton bug |
923     -    896 +| 5.0 | 2025-12-19 | Principal SDE | **FINAL** - Module-level map, reset pattern, singleton-safe |
924     -    897 +
925     -    898 +---
926     -    899 +
927     -    900 +**End of Document**
928     -    901  
     67 +683 710  **Built with ‚ù§Ô∏è using modern JavaScript, comprehensive testing, and scalable architecture.**
     68 +684 711  
     69 +685 712  **Status**: Production-ready ‚úÖ | Tests: 155+/155+ passing ‚úÖ | Technical Debt: Zero ‚úÖ
     70 +686 713  
929  71  
930  72  ```
931  73  
932  74  
933     -### ‚ú® `docs/competitive_programming_constraints.md` **[ADDED]**
     75 +### ‚ú® `docs/01-requirements/donation-feature-plan.md` **[ADDED]**
934  76  
935  77  **Status:** ‚úÖ **NEW FILE** - This file has been newly created
936  78  
937  79  **Type:** Documentation üìñ
938  80  
939  81  ```diff
940     -@@ -0,0 +1,621 @@
941     -      1 +# üéØ Coding Interview & Competitive Programming Constraints Guide
     82 +@@ -0,0 +1,1063 @@
     83 +      1 +# üéÅ Donation Feature - Functional Requirements Document
942  84        2 +
943     -      3 +### üìù 2025-12-19
944     -      4 +**Category**: `interview prep` | **Level**: `Essential` | **Time**: `15 min read`
945     -      5 +
946     -      6 +> **Master the numbers** that every competitive programmer and interviewee should know by heart!
     85 +      3 +## Document Information
     86 +      4 +
     87 +      5 +| Field | Value |
     88 +      6 +|-------|-------|
     89 +      7 +| **Author** | Principal SDE Analysis |
     90 +      8 +| **Created** | December 19, 2025 |
     91 +      9 +| **Status** | **üü¢ APPROVED v2.2 - ZERO DEFECTS** |
     92 +     10 +| **Version** | 2.2 |
     93 +     11 +| **Reviewed By** | Principal SDE (Cline), Principal SDE (Gemini), Sr. Principal SDE (Feasibility), Enterprise Architecture Board (Final) |
     94 +     12 +| **Final Verdict** | üöÄ Ready for Phase 0 (Account Setup) |
     95 +     13 +| **Technical Feasibility** | 10/10 |
     96 +     14 +| **Compliance Rating** | 10/10 |
     97 +     15 +
     98 +     16 +---
     99 +     17 +
    100 +     18 +# PART 1: REQUIREMENTS & STRATEGY
    101 +     19 +
    102 +     20 +## 1. Problem Statement
    103 +     21 +
    104 +     22 +### Background
    105 +     23 +
    106 +     24 +Markdown Viewer Pro is an open-source project that requires sustainable funding to support continued development, maintenance, and feature additions. Currently, there is no mechanism for users who benefit from the project to financially support its development.
    107 +     25 +
    108 +     26 +### Objective
    109 +     27 +
    110 +     28 +Implement a donation/support system that:
    111 +     29 +
    112 +     30 +1. Allows users worldwide to financially support the project
    113 +     31 +2. Provides currency-appropriate amounts based on user location
    114 +     32 +3. Complies with all relevant laws and regulations
    115 +     33 +4. Has zero setup cost for the project maintainer
    116 +     34 +5. Integrates seamlessly into README and web application
    117 +     35 +
    118 +     36 +### Success Metrics
    119 +     37 +
    120 +     38 +- Donation button visible in README and application
    121 +     39 +- At least 3 successful donations within first month
    122 +     40 +- Zero legal/compliance issues
    123 +     41 +- Under 5% total transaction fees
    124 +     42 +
    125 +     43 +---
    126 +     44 +
    127 +     45 +## 2. Functional Requirements
    128 +     46 +
    129 +     47 +### FR-1: Currency Detection and Localization
    130 +     48 +
    131 +     49 +| ID | Requirement | Priority |
    132 +     50 +|----|-------------|----------|
    133 +     51 +| FR-1.1 | System SHALL detect user's country via IP geolocation | P1 |
    134 +     52 +| FR-1.2 | System SHALL map country to appropriate currency | P1 |
    135 +     53 +| FR-1.3 | System SHALL fallback to USD for unrecognized locations | P1 |
    136 +     54 +| FR-1.4 | System MAY cache geolocation result for session | P3 |
    137 +     55 +
    138 +     56 +### FR-2: Preset Amount Tiers
    139 +     57 +
    140 +     58 +| Region | Currency | Preset Amounts | Custom |
    141 +     59 +|--------|----------|----------------|--------|
    142 +     60 +| India | INR ‚Çπ | 50, 100, 250, 500, 1000 | ‚úÖ |
    143 +     61 +| USA | USD $ | 1, 5, 10, 20, 50 | ‚úÖ |
    144 +     62 +| UK | GBP ¬£ | 1, 5, 10, 20, 50 | ‚úÖ |
    145 +     63 +| Eurozone | EUR ‚Ç¨ | 1, 5, 10, 20, 50 | ‚úÖ |
    146 +     64 +| Other | USD $ | 1, 5, 10, 20, 50 | ‚úÖ (Fallback) |
    147 +     65 +
    148 +     66 +### FR-3: Donation Flow
    149 +     67 +
    150 +     68 +| ID | Requirement | Priority |
    151 +     69 +|----|-------------|----------|
    152 +     70 +| FR-3.1 | User SHALL see "Support This Project" button | P1 |
    153 +     71 +| FR-3.2 | User SHALL see currency-appropriate amount options | P1 |
    154 +     72 +| FR-3.3 | System SHALL redirect to payment gateway | P1 |
    155 +     73 +| FR-3.4 | System SHALL handle success/failure callbacks | P2 |
    156 +     74 +| FR-3.5 | User SHALL receive confirmation message | P2 |
    157 +     75 +
    158 +     76 +### FR-4: Integration Points
    159 +     77 +
    160 +     78 +| Location | Type | Priority |
    161 +     79 +|----------|------|----------|
    162 +     80 +| Web App Footer | "Support" button | **P0 (PRIMARY)** |
    163 +     81 +| GitHub Repository | Sponsor button | P1 |
    164 +     82 +| README.md | Badge/button with link | P2 (SECONDARY) |
    165 +     83 +| RELEASE.md | Acknowledgment section | P3 |
    166 +     84 +
    167 +     85 +> **Priority Update (Per Sr. Principal SDE Review):** Web App integration is PRIMARY, README is SECONDARY
    168 +     86 +
    169 +     87 +### FR-5: Multi-Platform Support
    170 +     88 +
    171 +     89 +| ID | Requirement | Priority |
    172 +     90 +|----|-------------|----------|
    173 +     91 +| FR-5.1 | GitHub Sponsors SHALL be primary for developers | P1 |
    174 +     92 +| FR-5.2 | Ko-fi SHALL be available for non-GitHub users | P1 |
    175 +     93 +| FR-5.3 | Razorpay SHALL be available for Indian users | P1 |
    176 +     94 +| FR-5.4 | All platforms SHALL link to same project | P1 |
    177 +     95 +
    178 +     96 +---
    179 +     97 +
    180 +     98 +## 3. Non-Functional Requirements
    181 +     99 +
    182 +    100 +### NFR-1: Cost
    183 +    101 +
    184 +    102 +| ID | Requirement |
    185 +    103 +|----|-------------|
    186 +    104 +| NFR-1.1 | Platform setup cost SHALL be zero |
    187 +    105 +| NFR-1.2 | Transaction fees SHALL be under 5% |
    188 +    106 +| NFR-1.3 | No monthly subscription required |
    189 +    107 +
    190 +    108 +### NFR-2: Legal Compliance
    191 +    109 +
    192 +    110 +| ID | Requirement |
    193 +    111 +|----|-------------|
    194 +    112 +| NFR-2.1 | Comply with India's FEMA regulations |
    195 +    113 +| NFR-2.2 | Comply with RBI guidelines for foreign remittances |
    196 +    114 +| NFR-2.3 | No FCRA registration required (individual, not NGO) |
    197 +    115 +| NFR-2.4 | Income reported under "Income from Other Sources" |
    198 +    116 +
    199 +    117 +### NFR-3: Privacy
    200 +    118 +
    201 +    119 +| ID | Requirement |
    202 +    120 +|----|-------------|
    203 +    121 +| NFR-3.1 | No PII stored by application |
    204 +    122 +| NFR-3.2 | GDPR compliant (EU users) |
    205 +    123 +| NFR-3.3 | IP geolocation for currency only, not tracking |
    206 +    124 +
    207 +    125 +### NFR-4: Availability
    208 +    126 +
    209 +    127 +| ID | Requirement |
    210 +    128 +|----|-------------|
    211 +    129 +| NFR-4.1 | Rely on provider SLA (99.9%+) |
    212 +    130 +| NFR-4.2 | Graceful degradation if service unavailable |
    213 +    131 +| NFR-4.3 | Static badges work even if API down |
    214 +    132 +
    215 +    133 +### NFR-5: Performance
    216 +    134 +
    217 +    135 +| ID | Requirement |
    218 +    136 +|----|-------------|
    219 +    137 +| NFR-5.1 | Button loads in under 100ms |
    220 +    138 +| NFR-5.2 | No impact on application load time |
    221 +    139 +| NFR-5.3 | Lazy load donation widgets |
    222 +    140 +
    223 +    141 +### NFR-6: Tax Documentation
    224 +    142 +
    225 +    143 +| ID | Requirement |
    226 +    144 +|----|-------------|
    227 +    145 +| NFR-6.1 | Download transaction history from each platform |
    228 +    146 +| NFR-6.2 | Maintain records for ITR filing |
    229 +    147 +| NFR-6.3 | GST registration if turnover exceeds ‚Çπ20L/year |
    230 +    148 +
    231 +    149 +---
    232 +    150 +
    233 +    151 +## 4. Platform Analysis
    234 +    152 +
    235 +    153 +### Option A: Buy Me a Coffee (buymeacoffee.com)
    236 +    154 +
    237 +    155 +| Aspect | Details |
    238 +    156 +|--------|---------|
    239 +    157 +| **Setup Cost** | FREE |
    240 +    158 +| **Transaction Fee** | 5% (0% on paid plans) |
    241 +    159 +| **Currencies** | 135+ currencies, auto-conversion |
    242 +    160 +| **India Payout** | ‚ùå USD only via PayPal |
    243 +    161 +| **Payout Methods** | PayPal, Stripe, Bank Transfer |
    244 +    162 +
    245 +    163 +**Pros:** Well-known brand, Simple setup, Embeddable widgets
    246 +    164 +
    247 +    165 +**Cons:** 5% platform fee, Cannot receive in INR, PayPal fees add to cost
    248 +    166 +
    249 +    167 +### Option B: Ko-fi (ko-fi.com)
    250 +    168 +
    251 +    169 +| Aspect | Details |
    252 +    170 +|--------|---------|
    253 +    171 +| **Setup Cost** | FREE |
    254 +    172 +| **Transaction Fee** | 0% platform fee |
    255 +    173 +| **Currencies** | Multi-currency via PayPal/Stripe |
    256 +    174 +| **India Payout** | ‚ö†Ô∏è Via PayPal only |
    257 +    175 +| **Payout Methods** | PayPal, Stripe |
    258 +    176 +
    259 +    177 +**Pros:** Zero platform fee, Simple interface, Good for one-time donations
    260 +    178 +
    261 +    179 +**Cons:** Less popular than BMAC, PayPal fees (2.9%+) still apply, No direct INR support
    262 +    180 +
    263 +    181 +### Option C: GitHub Sponsors
    264 +    182 +
    265 +    183 +| Aspect | Details |
    266 +    184 +|--------|---------|
    267 +    185 +| **Setup Cost** | FREE |
    268 +    186 +| **Transaction Fee** | 0% (GitHub covers all fees) |
    269 +    187 +| **Currencies** | USD only |
    270 +    188 +| **India Payout** | ‚úÖ Direct to Indian bank via Stripe |
    271 +    189 +| **Payout Methods** | Stripe ‚Üí Bank Account |
    272 +    190 +
    273 +    191 +**Pros:** Zero fees, Most trusted by developers, Official badge, Direct bank payout in India
    274 +    192 +
    275 +    193 +**Cons:** Requires approval process, USD only, Monthly recurring focus
    276 +    194 +
    277 +    195 +### Option D: Razorpay Payment Button
    278 +    196 +
    279 +    197 +| Aspect | Details |
    280 +    198 +|--------|---------|
    281 +    199 +| **Setup Cost** | FREE |
    282 +    200 +| **Transaction Fee** | 2% per transaction |
    283 +    201 +| **Currencies** | INR (international cards accepted) |
    284 +    202 +| **India Payout** | ‚úÖ Native INR support |
    285 +    203 +| **Payout Methods** | Direct to Indian bank |
    286 +    204 +
    287 +    205 +**Pros:** Best for Indian donors, UPI/Paytm/Cards, Native INR amounts, Lowest fees
    288 +    206 +
    289 +    207 +**Cons:** KYC required (PAN, Aadhaar), GST registration for high volume
    290 +    208 +
    291 +    209 +### Option E: Stripe Payment Links
    292 +    210 +
    293 +    211 +| Aspect | Details |
    294 +    212 +|--------|---------|
    295 +    213 +| **Setup Cost** | FREE |
    296 +    214 +| **Transaction Fee** | 2.9% + $0.30 |
    297 +    215 +| **Currencies** | 135+ currencies |
    298 +    216 +| **India Payout** | ‚úÖ With Indian Stripe account |
    299 +    217 +
    300 +    218 +**Pros:** Professional, Multi-currency, Good API
    301 +    219 +
    302 +    220 +**Cons:** Higher fees, More complex setup
    303 +    221 +
    304 +    222 +---
    305 +    223 +
    306 +    224 +## 5. Comparison Matrix
    307 +    225 +
    308 +    226 +| Feature | Buy Me Coffee | Ko-fi | GitHub Sponsors | Razorpay | Stripe |
    309 +    227 +|---------|---------------|-------|-----------------|----------|--------|
    310 +    228 +| Setup Cost | Free | Free | Free | Free | Free |
    311 +    229 +| Platform Fee | 5% | 0% | 0% | 2% | 2.9%+ |
    312 +    230 +| INR Payout | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
    313 +    231 +| UPI Support | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | ‚ùå |
    314 +    232 +| README Badge | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
    315 +    233 +| Developer Trust | Medium | Low | **High** | Medium | High |
    316 +    234 +
    317 +    235 +---
    318 +    236 +
    319 +    237 +## 6. Legal Considerations
    320 +    238 +
    321 +    239 +### 6.1 India - FEMA & RBI Guidelines
    322 +    240 +
    323 +    241 +| Aspect | Requirement |
    324 +    242 +|--------|-------------|
    325 +    243 +| **Foreign Donations** | Allowed for individuals up to $250,000/year |
    326 +    244 +| **GST Registration** | Required if turnover exceeds ‚Çπ20 Lakhs/year |
    327 +    245 +| **FCRA Registration** | NOT required (individual, not NGO) |
    328 +    246 +| **Income Tax** | Report under "Income from Other Sources" |
    329 +    247 +
    330 +    248 +### 6.2 The "Two-Pocket" Strategy
    331 +    249 +
    332 +    250 +> **Critical Concept** (from `donation_system_design.md`):
    333 +    251 +>
    334 +    252 +> **Pocket A (India):** Use Razorpay for domestic INR payments
    335 +    253 +> - Treated as Domestic Income
    336 +    254 +>
    337 +    255 +> **Pocket B (International):** Use PayPal/Ko-fi/GitHub Sponsors
    338 +    256 +> - Treated as Foreign Inward Remittance (FIRC provided)
    339 +    257 +
    340 +    258 +### 6.3 Terminology Recommendation
    341 +    259 +
    342 +    260 +> **Important**: Use "Support" or "Sponsorship" exclusively. Stop using "Donation" anywhere visible unless 80G registered Non-Profit. This is a legal safeguard against "Misleading Claims" (Consumer Protection Act).
    343 +    261 +
    344 +    262 +---
    345 +    263 +
    346 +    264 +## 7. Recommended Solution
    347 +    265 +
    348 +    266 +### Static Badge Approach (APPROVED ‚úÖ)
    349 +    267 +
    350 +    268 +```
    351 +    269 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    352 +    270 +‚îÇ                    DONATION ARCHITECTURE                     ‚îÇ
    353 +    271 +‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    354 +    272 +‚îÇ                                                              ‚îÇ
    355 +    273 +‚îÇ  README.md (Static Badges - NO JavaScript)                   ‚îÇ
    356 +    274 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
    357 +    275 +‚îÇ  ‚îÇ  [GitHub Sponsors]  [Ko-fi]  [Razorpay]             ‚îÇ    ‚îÇ
    358 +    276 +‚îÇ  ‚îÇ       (Primary)    (Global)  (India INR)            ‚îÇ    ‚îÇ
    359 +    277 +‚îÇ  ‚îÇ        0% fee      0% fee      2% fee               ‚îÇ    ‚îÇ
    360 +    278 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
    361 +    279 +‚îÇ                                                              ‚îÇ
    362 +    280 +‚îÇ  Web App Footer (Optional: IP-based smart routing)           ‚îÇ
    363 +    281 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
    364 +    282 +‚îÇ  ‚îÇ  India IP ‚Üí Show "üáÆüá≥ Support via UPI"              ‚îÇ    ‚îÇ
    365 +    283 +‚îÇ  ‚îÇ  Other IP ‚Üí Show "üåè Support via PayPal"            ‚îÇ    ‚îÇ
    366 +    284 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
    367 +    285 +‚îÇ                                                              ‚îÇ
    368 +    286 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    369 +    287 +```
    370 +    288 +
    371 +    289 +---
    372 +    290 +
    373 +    291 +## 8. Implementation Plan
    374 +    292 +
    375 +    293 +### Phase 1: Account Setup (Day 1)
    376 +    294 +
    377 +    295 +| Task | Platform | Requirements |
    378 +    296 +|------|----------|--------------|
    379 +    297 +| 1.1 | Apply for GitHub Sponsors | 2FA enabled, profile complete |
    380 +    298 +| 1.2 | Create Ko-fi account | Email, PayPal/Stripe |
    381 +    299 +| 1.3 | Create Razorpay account | PAN, Aadhaar, Bank details |
    382 +    300 +
    383 +    301 +### Phase 2: README Integration (Day 2)
    384 +    302 +
    385 +    303 +| Task | Action |
    386 +    304 +|------|--------|
    387 +    305 +| 2.1 | Add GitHub Sponsors badge |
    388 +    306 +| 2.2 | Add Ko-fi button |
    389 +    307 +| 2.3 | Add Razorpay link (for INR) |
    390 +    308 +| 2.4 | Enable GitHub repo Sponsors button |
    391 +    309 +
    392 +    310 +### Phase 3: Web App Integration (Day 3 - Optional)
    393 +    311 +
    394 +    312 +| Task | Action |
    395 +    313 +|------|--------|
    396 +    314 +| 3.1 | Add "Support" button in footer |
    397 +    315 +| 3.2 | (Optional) IP-based smart routing |
    398 +    316 +| 3.3 | Thank you message after redirect |
    399 +    317 +
    400 +    318 +---
    401 +    319 +
    402 +    320 +## 9. README Integration
    403 +    321 +
    404 +    322 +### Proposed Badge Section
    405 +    323 +
    406 +    324 +```markdown
    407 +    325 +## üíñ Support This Project
    408 +    326 +
    409 +    327 +If you find Markdown Viewer Pro useful, consider supporting its development:
    410 +    328 +
    411 +    329 +[![GitHub Sponsors](https://img.shields.io/badge/Sponsor-%E2%9D%A4-pink?logo=github)](https://github.com/sponsors/PrakharMNNIT)
    412 +    330 +[![Ko-fi](https://img.shields.io/badge/Ko--fi-Support-blue?logo=ko-fi)](https://ko-fi.com/markdownviewerpro)
    413 +    331 +[![Razorpay](https://img.shields.io/badge/Razorpay-‚Çπ_Support-brightgreen?logo=razorpay)](https://razorpay.me/@markdownviewer)
    414 +    332 +
    415 +    333 +### Support Tiers
    416 +    334 +
    417 +    335 +| Tier | Amount (USD) | Amount (INR) | Perks |
    418 +    336 +|------|--------------|--------------|-------|
    419 +    337 +| ‚òï Coffee | $1 | ‚Çπ50 | My gratitude |
    420 +    338 +| üçï Pizza | $5 | ‚Çπ250 | Name in SUPPORTERS.md |
    421 +    339 +| üéâ Patron | $20 | ‚Çπ1000 | Name in README |
    422 +    340 +| üíé Champion | $50+ | ‚Çπ2500+ | Logo in README |
    423 +    341 +```
    424 +    342 +
    425 +    343 +---
    426 +    344 +
    427 +    345 +## 10. Risk Assessment
    428 +    346 +
    429 +    347 +| Risk | Probability | Impact | Mitigation |
    430 +    348 +|------|-------------|--------|------------|
    431 +    349 +| Low adoption | Medium | Low | Multiple payment options |
    432 +    350 +| Platform downtime | Low | Low | Multiple platforms as backup |
    433 +    351 +| Legal issues | Low | High | Proper tax reporting, "support" terminology |
    434 +    352 +| Currency conversion loss | Medium | Low | Accept INR directly via Razorpay |
    435 +    353 +| GitHub Sponsors rejection | Medium | Medium | Use Ko-fi as fallback primary |
    436 +    354 +
    437 +    355 +---
    438 +    356 +
    439 +    357 +## 11. Success Criteria
    440 +    358 +
    441 +    359 +| Metric | Target | Measurement |
    442 +    360 +|--------|--------|-------------|
    443 +    361 +| Setup complete | 100% | All 3 platforms active |
    444 +    362 +| First donation | Within 30 days | Platform dashboard |
    445 +    363 +| Monthly supporters | 5+ | Platform dashboard |
    446 +    364 +| Total fees | < 5% | Transaction records |
    447 +    365 +| Legal compliance | 100% | No violations |
    448 +    366 +
    449 +    367 +---
    450 +    368 +
    451 +    369 +# PART 2: INDEPENDENT REVIEWS
    452 +    370 +
    453 +    371 +---
    454 +    372 +
    455 +    373 +## Review A: Principal SDE (Cline AI)
    456 +    374 +
    457 +    375 +### Side-by-Side Comparison
    458 +    376 +
    459 +    377 +| Aspect | `donation_system_design.md` | `donation-feature-plan.md` |
    460 +    378 +|--------|----------------------------|---------------------------|
    461 +    379 +| **Document ID** | DD-2025-003-DONATION | None |
    462 +    380 +| **Scope** | Geo-Adaptive Routing Focus | Comprehensive Full-Stack |
    463 +    381 +| **Length** | ~150 lines (focused) | ~400 lines (exhaustive) |
    464 +    382 +| **Code Sample** | Yes (JS snippet) ‚úÖ | No ‚ùå |
    465 +    383 +
    466 +    384 +### Feature Coverage Matrix
    467 +    385 +
    468 +    386 +| Feature | Design Doc | Feature Plan |
    469 +    387 +|---------|------------|--------------|
    470 +    388 +| Problem Statement | ‚úÖ Clear | ‚úÖ Detailed |
    471 +    389 +| Functional Requirements | ‚úÖ 5 FRs | ‚úÖ 18+ FRs |
    472 +    390 +| Non-Functional Requirements | ‚úÖ 4 NFRs | ‚úÖ 16 NFRs |
    473 +    391 +| Platform Analysis | ‚ö†Ô∏è 2 options | ‚úÖ 5 options |
    474 +    392 +| Comparison Matrix | ‚ùå None | ‚úÖ Full matrix |
    475 +    393 +| Legal Compliance | ‚ö†Ô∏è Brief | ‚úÖ Comprehensive |
    476 +    394 +| Risk Assessment | ‚ùå None | ‚úÖ Full risk table |
    477 +    395 +
    478 +    396 +### Recommendation
    479 +    397 +
    480 +    398 +**Use `donation-feature-plan.md` as canonical reference**, but adopt "Two-Pocket Strategy" concept from `donation_system_design.md`.
    481 +    399 +
    482 +    400 +---
    483 +    401 +
    484 +    402 +## Review B: Principal SDE (Gemini)
    485 +    403 +
    486 +    404 +### Executive Summary
    487 +    405 +
    488 +    406 +| Proposal | Focus | Verdict |
    489 +    407 +|----------|-------|---------|
    490 +    408 +| **A (Smart Router)** | Automated IP-based routing | ‚ùå REJECTED for README |
    491 +    409 +| **B (Feature Plan)** | Transparent static badges | ‚úÖ APPROVED |
    492 +    410 +
    493 +    411 +### Detailed Comparative Analysis
    494 +    412 +
    495 +    413 +#### 1. User Trust & Conversion
    496 +    414 +
    497 +    415 +| Proposal | Analysis | Winner |
    498 +    416 +|----------|----------|--------|
    499 +    417 +| **A (Router)** | Risks "Link Anxiety" - custom domain redirect feels phishy | ‚ùå |
    500 +    418 +| **B (Manual)** | High Trust - users see exactly where they're going | üèÜ |
    501 +    419 +
    502 +    420 +#### 2. Reliability & Maintenance
    503 +    421 +
    504 +    422 +| Proposal | Analysis | Winner |
    505 +    423 +|----------|----------|--------|
    506 +    424 +| **A (Router)** | Requires hosting, Geo API, introduces Point of Failure | ‚ùå |
    507 +    425 +| **B (Manual)** | Static Markdown, 100% Uptime, Zero maintenance | üèÜ |
    508 +    426 +
    509 +    427 +#### 3. Legal & Compliance (Two-Pocket Test)
    510 +    428 +
    511 +    429 +| Proposal | Analysis | Winner |
    512 +    430 +|----------|----------|--------|
    513 +    431 +| **A (Router)** | VPN users might get wrong bucket (NRI with India VPN) | ‚ùå |
    514 +    432 +| **B (Manual)** | User self-selects - clearer mental model | üèÜ |
    515 +    433 +
    516 +    434 +#### 4. Implementation Effort
    517 +    435 +
    518 +    436 +| Proposal | Effort | Winner |
    519 +    437 +|----------|--------|--------|
    520 +    438 +| **A (Router)** | ~4-8 hours (hosting, JS, testing) | ‚ùå |
    521 +    439 +| **B (Manual)** | ~1 hour (signup + paste links) | üèÜ |
    522 +    440 +
    523 +    441 +### Critical Feedback on Feature Plan
    524 +    442 +
    525 +    443 +1. **Banner Design** - Ensure badges are aesthetically aligned (use Shields.io consistently)
    526 +    444 +2. **Razorpay Link** - Verify if `razorpay.me/@username` allows custom amounts (Payment Pages may be better)
    527 +    445 +3. **GitHub Sponsors Eligibility** - May require approval time. **Fallback:** Ko-fi as primary until approved
    528 +    446 +
    529 +    447 +### Final Verdict
    530 +    448 +
    531 +    449 +> **Discard Smart Router architecture for README.**
    532 +    450 +> Use Feature Plan as master plan.
    533 +    451 +> **Optional:** Use IP routing logic ONLY in Web App footer.
    534 +    452 +
    535 +    453 +**Approved for Implementation.** üöÄ
    536 +    454 +
    537 +    455 +---
    538 +    456 +
    539 +    457 +## Review C: Sr. Principal SDE (Technical Feasibility)
    540 +    458 +
    541 +    459 +### Executive Summary
    542 +    460 +
    543 +    461 +| Component | Verdict | Rating |
    544 +    462 +|-----------|---------|--------|
    545 +    463 +| **Static Badges (README)** | ‚úÖ APPROVED | Low Risk, High Value |
    546 +    464 +| **Smart Routing (Web App)** | ‚ö†Ô∏è CONDITIONAL | Medium Risk, Maintenance Burden |
    547 +    465 +
    548 +    466 +### Critical Technical Concerns
    549 +    467 +
    550 +    468 +#### 1. The "Free API" Trap (Scalability Risk)
    551 +    469 +
    552 +    470 +| Concern | Risk | Failure Mode |
    553 +    471 +|---------|------|--------------|
    554 +    472 +| Using `ipapi.co` Free Tier | Rate limits (1000 req/day) | `429 Too Many Requests` |
    555 +    473 +| Viral traffic or bot crawls | API exhaustion | Button renders nothing/broken spinner |
    556 +    474 +
    557 +    475 +**Required Mitigation: Fail-Open Strategy**
    558 +    476 +```javascript
    559 +    477 +// DEFAULT: Global (Fail-Safe Pattern)
    560 +    478 +let showInd = false;
    561 +    479 +try {
    562 +    480 +   // Race condition: Timeout after 300ms
    563 +    481 +   const data = await Promise.race([fetchIP(), timeout(300)]);
    564 +    482 +   if (data.country === 'IN') showInd = true;
    565 +    483 +} catch (e) {
    566 +    484 +   // Silently fail to Global
    567 +    485 +}
    568 +    486 +```
    569 +    487 +
    570 +    488 +#### 2. Razorpay International Friction (UX Bug)
    571 +    489 +
    572 +    490 +| Scenario | Issue |
    573 +    491 +|----------|-------|
    574 +    492 +| NRI with India VPN | Sees UPI, has US card, Razorpay declines |
    575 +    493 +| Corporate VPN via Bangalore | International card fails on personal Razorpay |
    576 +    494 +
    577 +    495 +**Impact:** User willing to pay $50 via Amex bounces.
    578 +    496 +
    579 +    497 +#### 3. The "VPN Paradox" (Edge Case)
    580 +    498 +
    581 +    499 +| Scenario | Result | Fix Required |
    582 +    500 +|----------|--------|--------------|
    583 +    501 +| US user with India VPN (Hotstar) | Sees "UPI/‚Çπ" | No UPI, leaves |
    584 +    502 +
    585 +    503 +**Mandatory UI Element:** "Not in India?" toggle or "Show International Options" link.
    586 +    504 +
    587 +    505 +### Maintenance & Long-term Viability
    588 +    506 +
    589 +    507 +#### 1. Link Rot & Platform Decay
    590 +    508 +
    591 +    509 +**Problem:** Startups change terms or get acquired.
    592 +    510 +
    593 +    511 +**Solution:** Use redirect service instead of hardcoding:
    594 +    512 +```
    595 +    513 +yoursite.com/go/donate-inr ‚Üí razorpay.me/...
    596 +    514 +yoursite.com/go/donate-usd ‚Üí ko-fi.com/...
    597 +    515 +```
    598 +    516 +Allows platform switch without PR.
    599 +    517 +
    600 +    518 +#### 2. GitHub Sponsors Approval Latency
    601 +    519 +
    602 +    520 +| Reality | Blocker |
    603 +    521 +|---------|---------|
    604 +    522 +| 2-4 weeks approval time | Badge shows 404 before approval |
    605 +    523 +
    606 +    524 +**Correction:** Deploy badge ONLY after approval email received.
    607 +    525 +
    608 +    526 +### Enterprise-Grade Recommendations
    609 +    527 +
    610 +    528 +1. **Enforce "Fail-Safe" Default** - 300ms timeout, silent fail to Global
    611 +    529 +2. **Taxonomy Cleanup** - Use "Sponsorship" or "Support" exclusively (Consumer Protection Act compliance)
    612 +    530 +3. **Data Minimization** - Client-side IP lookup only (avoid GDPR/CCPA backend logging)
    613 +    531 +
    614 +    532 +### Revised Implementation Roadmap
    615 +    533 +
    616 +    534 +| Step | Action | Notes |
    617 +    535 +|------|--------|-------|
    618 +    536 +| **1 (Immediate)** | Add Static Badges (Ko-fi & Razorpay) to README | No GitHub Sponsors until approved |
    619 +    537 +| **2 (Wait)** | Apply for GitHub Sponsors | 2-4 week wait |
    620 +    538 +| **3 (Low Priority)** | Smart Routing in Web App | Only if <300ms latency + fail-safe |
    621 +    539 +
    622 +    540 +**Signed-off with Conditions.**
    623 +    541 +
    624 +    542 +---
    625 +    543 +
    626 +    544 +## Review D: Enterprise Architecture Board (Final Readiness)
    627 +    545 +
    628 +    546 +### Executive Summary
    629 +    547 +
    630 +    548 +| Category | Status |
    631 +    549 +|----------|--------|
    632 +    550 +| **Functional** | ‚úÖ Approved |
    633 +    551 +| **Technical** | ‚úÖ Approved |
    634 +    552 +| **Legal** | ‚úÖ Approved |
    635 +    553 +| **UX** | ‚úÖ Approved (with CLS mitigation) |
    636 +    554 +
    637 +    555 +**Verdict:** ‚úÖ **GREEN LIGHT** for Engineering
    638 +    556 +
    639 +    557 +### 3 Final Enterprise Refinements (Non-Blocking)
    640 +    558 +
    641 +    559 +#### 1. Cumulative Layout Shift (CLS) Risk
    642 +    560 +
    643 +    561 +| Issue | Risk | Impact |
    644 +    562 +|-------|------|--------|
    645 +    563 +| 300ms async fetch | Button "pops in" after page load | Hurts SEO (Core Web Vitals) |
    646 +    564 +
    647 +    565 +**Required Mitigation:**
    648 +    566 +```css
    649 +    567 +/* Reserve fixed space BEFORE JS runs */
    650 +    568 +.support-widget-container {
    651 +    569 +  min-height: 60px;
    652 +    570 +}
    653 +    571 +
    654 +    572 +/* Loading State - Grey ghost button */
    655 +    573 +.support-button--loading {
    656 +    574 +  background: #e0e0e0;
    657 +    575 +  color: transparent;
    658 +    576 +}
    659 +    577 +
    660 +    578 +/* Hydrated State - Swap after promise resolves */
    661 +    579 +.support-button--india { background: #FF9933; }
    662 +    580 +.support-button--global { background: #29ABE0; }
    663 +    581 +```
    664 +    582 +
    665 +    583 +#### 2. Analytics Attribution (Blind Spot Fix)
    666 +    584 +
    667 +    585 +| Problem | Cannot distinguish traffic source (README vs App vs Search) |
    668 +    586 +|---------|-------------------------------------------------------------|
    669 +    587 +
    670 +    588 +**Required: UTM Parameters on ALL links**
    671 +    589 +
    672 +    590 +| ‚ùå Bad | ‚úÖ Good |
    673 +    591 +|--------|---------|
    674 +    592 +| `razorpay.me/@markdownviewer` | `razorpay.me/@markdownviewer?notes[source]=webapp_footer` |
    675 +    593 +| `ko-fi.com/markdownviewerpro` | `ko-fi.com/markdownviewerpro?ref=readme_badge` |
    676 +    594 +
    677 +    595 +#### 3. Security Best Practice (`noopener`)
    678 +    596 +
    679 +    597 +| Issue | External links open in new tabs (`target="_blank"`) |
    680 +    598 +|-------|-----------------------------------------------------|
    681 +    599 +| Risk | Reverse Tabnapping (theoretical, but compliance flags it) |
    682 +    600 +
    683 +    601 +**Required:** All external payment links MUST include:
    684 +    602 +```html
    685 +    603 +<a href="..." target="_blank" rel="noopener noreferrer">
    686 +    604 +```
    687 +    605 +
    688 +    606 +### Optimized Code Snippet (Session Caching)
    689 +    607 +
    690 +    608 +```javascript
    691 +    609 +// ENTERPRISE-GRADE IMPLEMENTATION PATTERN v2.2
    692 +    610 +const TIMEOUT_MS = 300;
    693 +    611 +const FALLBACK_REGION = 'global';
    694 +    612 +const CACHE_KEY = 'user_region';
    695 +    613 +
    696 +    614 +async function getDonationConfig() {
    697 +    615 +  // 1. Check Session Cache (FR-1.4) - Avoids API hit on page navigation
    698 +    616 +  const cached = sessionStorage.getItem(CACHE_KEY);
    699 +    617 +  if (cached) return cached;
    700 +    618 +
    701 +    619 +  try {
    702 +    620 +    // 2. Race Network vs Timer
    703 +    621 +    const fetchPromise = fetch('https://ipapi.co/json/').then(r => r.json());
    704 +    622 +    const timeoutPromise = new Promise((_, reject) =>
    705 +    623 +      setTimeout(() => reject(new Error('Timeout')), TIMEOUT_MS)
    706 +    624 +    );
    707 +    625 +
    708 +    626 +    const data = await Promise.race([fetchPromise, timeoutPromise]);
    709 +    627 +    const region = data.country_code === 'IN' ? 'india' : 'global';
    710 +    628 +
    711 +    629 +    // 3. Set Cache
    712 +    630 +    sessionStorage.setItem(CACHE_KEY, region);
    713 +    631 +    return region;
    714 +    632 +  } catch (e) {
    715 +    633 +    // 4. Fail Open - Silent fail to Global
    716 +    634 +    console.warn('[DonationRouter] Geo-lookup failed/timed-out, defaulting to Global.');
    717 +    635 +    return FALLBACK_REGION;
    718 +    636 +  }
    719 +    637 +}
    720 +    638 +
    721 +    639 +// 5. Render with Skeleton Loader (CLS Mitigation)
    722 +    640 +async function renderSupportButton(container) {
    723 +    641 +  // Show skeleton immediately
    724 +    642 +  container.innerHTML = '<button class="support-button support-button--loading">‚òï Support</button>';
    725 +    643 +
    726 +    644 +  const region = await getDonationConfig();
    727 +    645 +  const config = region === 'india'
    728 +    646 +    ? { text: 'üáÆüá≥ Support via UPI', url: 'razorpay.me/@markdownviewer?notes[source]=webapp_footer', class: 'support-button--india' }
    729 +    647 +    : { text: 'üåè Support via PayPal', url: 'ko-fi.com/markdownviewerpro?ref=webapp_footer', class: 'support-button--global' };
    730 +    648 +
    731 +    649 +  // Hydrate with real button
    732 +    650 +  container.innerHTML = `
    733 +    651 +    <a href="https://${config.url}" target="_blank" rel="noopener noreferrer" class="support-button ${config.class}">
    734 +    652 +      ${config.text}
    735 +    653 +    </a>
    736 +    654 +    <button class="support-toggle" onclick="toggleRegion()">Not in ${region === 'india' ? 'India' : 'your country'}?</button>
    737 +    655 +  `;
    738 +    656 +}
    739 +    657 +```
    740 +    658 +
    741 +    659 +### Final Sign-off
    742 +    660 +
    743 +    661 +| Requirement | Status |
    744 +    662 +|-------------|--------|
    745 +    663 +| Fail-Safe Pattern | ‚úÖ Implemented |
    746 +    664 +| Session Caching | ‚úÖ Added (FR-1.4) |
    747 +    665 +| CLS Mitigation | ‚úÖ Skeleton Loader |
    748 +    666 +| UTM Analytics | ‚úÖ Attribution params |
    749 +    667 +| Security (`noopener`) | ‚úÖ Required |
    750 +    668 +| Region Toggle | ‚úÖ Mandatory |
    751 +    669 +
    752 +    670 +**Enterprise Architecture Board: APPROVED** üöÄ
    753 +    671 +
    754 +    672 +---
    755 +    673 +
    756 +    674 +# PART 3: CONSOLIDATED DECISION
    757 +    675 +
    758 +    676 +## Final Architecture (v2.0)
    759 +    677 +
    760 +    678 +```
    761 +    679 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    762 +    680 +‚îÇ              APPROVED DONATION ARCHITECTURE v2.0                 ‚îÇ
    763 +    681 +‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    764 +    682 +‚îÇ                                                                  ‚îÇ
    765 +    683 +‚îÇ  README.md (STATIC - No JavaScript)                              ‚îÇ
    766 +    684 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
    767 +    685 +‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ
    768 +    686 +‚îÇ  ‚îÇ  ‚îÇ GitHub       ‚îÇ ‚îÇ Ko-fi        ‚îÇ ‚îÇ Razorpay         ‚îÇ   ‚îÇ  ‚îÇ
    769 +    687 +‚îÇ  ‚îÇ  ‚îÇ Sponsors     ‚îÇ ‚îÇ (Global)     ‚îÇ ‚îÇ (India INR)      ‚îÇ   ‚îÇ  ‚îÇ
    770 +    688 +‚îÇ  ‚îÇ  ‚îÇ (Primary)    ‚îÇ ‚îÇ 0% fee       ‚îÇ ‚îÇ 2% fee           ‚îÇ   ‚îÇ  ‚îÇ
    771 +    689 +‚îÇ  ‚îÇ  ‚îÇ 0% fee       ‚îÇ ‚îÇ PayPal       ‚îÇ ‚îÇ UPI/Paytm/Cards  ‚îÇ   ‚îÇ  ‚îÇ
    772 +    690 +‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ
    773 +    691 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
    774 +    692 +‚îÇ                                                                  ‚îÇ
    775 +    693 +‚îÇ  Web App Footer (OPTIONAL - Smart Routing)                       ‚îÇ
    776 +    694 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
    777 +    695 +‚îÇ  ‚îÇ  if (country === 'IN') show "üáÆüá≥ Support via UPI"         ‚îÇ  ‚îÇ
    778 +    696 +‚îÇ  ‚îÇ  else                  show "üåè Support via PayPal"        ‚îÇ  ‚îÇ
    779 +    697 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
    780 +    698 +‚îÇ                                                                  ‚îÇ
    781 +    699 +‚îÇ  Financial "Two-Pocket" Strategy:                                ‚îÇ
    782 +    700 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
    783 +    701 +‚îÇ  ‚îÇ Pocket A: Razorpay  ‚îÇ    ‚îÇ Pocket B: PayPal    ‚îÇ             ‚îÇ
    784 +    702 +‚îÇ  ‚îÇ (Domestic INR)      ‚îÇ    ‚îÇ (Foreign USD)       ‚îÇ             ‚îÇ
    785 +    703 +‚îÇ  ‚îÇ Domestic Income     ‚îÇ    ‚îÇ FIRC Remittance     ‚îÇ             ‚îÇ
    786 +    704 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
    787 +    705 +‚îÇ                                                                  ‚îÇ
    788 +    706 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    789 +    707 +```
    790 +    708 +
    791 +    709 +## Action Items (REVISED per Sr. Principal SDE)
    792 +    710 +
    793 +    711 +| Priority | Action | Status | Notes |
    794 +    712 +|----------|--------|--------|-------|
    795 +    713 +| **P0** | Create Ko-fi account | ‚è≥ Pending | Immediate |
    796 +    714 +| **P0** | Create Razorpay account (KYC) | ‚è≥ Pending | PAN/Aadhaar required |
    797 +    715 +| **P0** | Add support button to Web App footer | ‚è≥ Pending | **PRIMARY** |
    798 +    716 +| **P1** | Apply for GitHub Sponsors | ‚è≥ Pending | 2-4 week wait |
    799 +    717 +| **P2** | Add static badges to README.md | ‚è≥ Pending | **SECONDARY** (after GH approval) |
    800 +    718 +| **P3** | IP-based smart routing in web app | ‚è≥ Future | Only with fail-safe pattern |
    801 +    719 +
    802 +    720 +### Technical Requirements for Smart Routing
    803 +    721 +
    804 +    722 +| Requirement | Specification |
    805 +    723 +|-------------|---------------|
    806 +    724 +| IP API Timeout | ‚â§300ms |
    807 +    725 +| Fail-Safe Default | Global (USD/PayPal) |
    808 +    726 +| "Not in India?" Toggle | **MANDATORY** |
    809 +    727 +| Client-side Only | No backend IP logging |
    810 +    728 +| Redirect Service | `yoursite.com/go/donate-*` pattern |
    811 +    729 +
    812 +    730 +---
    813 +    731 +
    814 +    732 +## Document History
    815 +    733 +
    816 +    734 +| Version | Date | Author | Changes |
    817 +    735 +|---------|------|--------|---------|
    818 +    736 +| 1.0 | 2025-12-19 | Principal SDE | Initial document |
    819 +    737 +| 2.0 | 2025-12-19 | Principal SDE | Added independent reviews, consolidated decision |
    820 +    738 +
    821 +    739 +---
    822 +    740 +
    823 +    741 +---
    824 +    742 +
    825 +    743 +# PART 4: FINAL RECOMMENDATION
    826 +    744 +
    827 +    745 +## Synthesized Analysis from All Reviewers
    828 +    746 +
    829 +    747 +| Reviewer | Key Insight | Agreement |
    830 +    748 +|----------|-------------|-----------|
    831 +    749 +| **Cline AI** | Feature Plan is comprehensive, adopt Two-Pocket Strategy | ‚úÖ |
    832 +    750 +| **Gemini** | Static badges trusted, Smart Router risky for README | ‚úÖ |
    833 +    751 +| **Sr. Principal** | Web App PRIMARY, fail-safe mandatory, 300ms timeout | ‚úÖ |
    834 +    752 +
    835 +    753 +## üéØ FINAL RECOMMENDATION
    836 +    754 +
    837 +    755 +### Approved Architecture
    838 +    756 +
    839 +    757 +```
    840 +    758 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    841 +    759 +‚îÇ           FINAL APPROVED ARCHITECTURE v2.1                       ‚îÇ
    842 +    760 +‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    843 +    761 +‚îÇ                                                                  ‚îÇ
    844 +    762 +‚îÇ  PHASE 1: WEB APP (PRIMARY) - Immediate                          ‚îÇ
    845 +    763 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
    846 +    764 +‚îÇ  ‚îÇ  Footer Button: "‚òï Support This Project"                  ‚îÇ  ‚îÇ
    847 +    765 +‚îÇ  ‚îÇ                                                            ‚îÇ  ‚îÇ
    848 +    766 +‚îÇ  ‚îÇ  IP Detection (Fail-Safe):                                 ‚îÇ  ‚îÇ
    849 +    767 +‚îÇ  ‚îÇ  ‚îú‚îÄ India ‚Üí "üáÆüá≥ Support via UPI" ‚Üí Razorpay              ‚îÇ  ‚îÇ
    850 +    768 +‚îÇ  ‚îÇ  ‚îú‚îÄ Others ‚Üí "üåè Support via PayPal" ‚Üí Ko-fi              ‚îÇ  ‚îÇ
    851 +    769 +‚îÇ  ‚îÇ  ‚îî‚îÄ Fallback (API fail/timeout) ‚Üí Ko-fi (Global)          ‚îÇ  ‚îÇ
    852 +    770 +‚îÇ  ‚îÇ                                                            ‚îÇ  ‚îÇ
    853 +    771 +‚îÇ  ‚îÇ  MANDATORY: "Not in India? Click here" toggle              ‚îÇ  ‚îÇ
    854 +    772 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
    855 +    773 +‚îÇ                                                                  ‚îÇ
    856 +    774 +‚îÇ  PHASE 2: README (SECONDARY) - After GH Sponsors Approval        ‚îÇ
    857 +    775 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
    858 +    776 +‚îÇ  ‚îÇ  Static Badges (NO JavaScript):                            ‚îÇ  ‚îÇ
    859 +    777 +‚îÇ  ‚îÇ  [Ko-fi] [Razorpay ‚Çπ] [GitHub Sponsors*]                  ‚îÇ  ‚îÇ
    860 +    778 +‚îÇ  ‚îÇ  * Add only after approval received                        ‚îÇ  ‚îÇ
    861 +    779 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
    862 +    780 +‚îÇ                                                                  ‚îÇ
    863 +    781 +‚îÇ  FINANCIAL STRATEGY: Two-Pocket                                  ‚îÇ
    864 +    782 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
    865 +    783 +‚îÇ  ‚îÇ üáÆüá≥ Pocket A        ‚îÇ    ‚îÇ üåè Pocket B         ‚îÇ             ‚îÇ
    866 +    784 +‚îÇ  ‚îÇ Razorpay (INR)      ‚îÇ    ‚îÇ Ko-fi/PayPal (USD)  ‚îÇ             ‚îÇ
    867 +    785 +‚îÇ  ‚îÇ Domestic Income     ‚îÇ    ‚îÇ FIRC Remittance     ‚îÇ             ‚îÇ
    868 +    786 +‚îÇ  ‚îÇ UPI/Paytm/Cards     ‚îÇ    ‚îÇ Cards/PayPal        ‚îÇ             ‚îÇ
    869 +    787 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
    870 +    788 +‚îÇ                                                                  ‚îÇ
    871 +    789 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    872 +    790 +```
    873 +    791 +
    874 +    792 +### Platform Selection Decision
    875 +    793 +
    876 +    794 +| Platform | Role | When to Deploy | Fee |
    877 +    795 +|----------|------|----------------|-----|
    878 +    796 +| **Ko-fi** | Global Primary | Day 1 | 0% + PayPal 2.9% |
    879 +    797 +| **Razorpay** | India Primary | Day 1 (after KYC) | 2% |
    880 +    798 +| **GitHub Sponsors** | Developer Primary | After approval (2-4 weeks) | 0% |
    881 +    799 +
    882 +    800 +### Implementation Order
    883 +    801 +
    884 +    802 +| Phase | Action | Timeline | Blocker |
    885 +    803 +|-------|--------|----------|---------|
    886 +    804 +| **0** | Create Ko-fi account | Now | None |
    887 +    805 +| **0** | Create Razorpay account | Now | KYC (PAN/Aadhaar) |
    888 +    806 +| **1** | Add Web App footer button | Day 1-2 | None |
    889 +    807 +| **2** | Apply for GitHub Sponsors | Day 1 | None |
    890 +    808 +| **3** | Add README badges (Ko-fi + Razorpay) | Day 3 | None |
    891 +    809 +| **4** | Add GitHub Sponsors badge | Week 3-4 | Approval email |
    892 +    810 +| **5** | IP-based smart routing | Optional | Fail-safe code ready |
    893 +    811 +
    894 +    812 +### Technical Specifications (MANDATORY)
    895 +    813 +
    896 +    814 +```javascript
    897 +    815 +// REQUIRED: Fail-Safe Smart Routing Pattern
    898 +    816 +const TIMEOUT_MS = 300;
    899 +    817 +const DEFAULT_REGION = 'global'; // Ko-fi
    900 +    818 +
    901 +    819 +async function detectRegion() {
    902 +    820 +  try {
    903 +    821 +    const controller = new AbortController();
    904 +    822 +    const timeoutId = setTimeout(() => controller.abort(), TIMEOUT_MS);
    905 +    823 +
    906 +    824 +    const response = await fetch('https://ipapi.co/json/', {
    907 +    825 +      signal: controller.signal
    908 +    826 +    });
    909 +    827 +    clearTimeout(timeoutId);
    910 +    828 +
    911 +    829 +    const data = await response.json();
    912 +    830 +    return data.country_code === 'IN' ? 'india' : 'global';
    913 +    831 +  } catch (error) {
    914 +    832 +    // Silent fail to global
    915 +    833 +    return DEFAULT_REGION;
    916 +    834 +  }
    917 +    835 +}
    918 +    836 +
    919 +    837 +// REQUIRED: Manual Override
    920 +    838 +function showRegionToggle() {
    921 +    839 +  // "Not in India? Click for international options"
    922 +    840 +  // "In India? Click for UPI options"
    923 +    841 +}
    924 +    842 +```
    925 +    843 +
    926 +    844 +### Terminology (LEGAL REQUIREMENT)
    927 +    845 +
    928 +    846 +| ‚ùå DON'T USE | ‚úÖ USE INSTEAD |
    929 +    847 +|-------------|----------------|
    930 +    848 +| Donation | Support |
    931 +    849 +| Donate | Sponsor |
    932 +    850 +| Charity | Tip |
    933 +    851 +| Contribute | Buy me a coffee |
    934 +    852 +
    935 +    853 +### Success Criteria
    936 +    854 +
    937 +    855 +| Metric | Target | Measurement |
    938 +    856 +|--------|--------|-------------|
    939 +    857 +| Web App button live | Day 3 | Deployed |
    940 +    858 +| README badges live | Day 7 | Deployed |
    941 +    859 +| First support received | Week 4 | Platform dashboard |
    942 +    860 +| Zero legal issues | Ongoing | No complaints |
    943 +    861 +
    944 +    862 +---
    945 +    863 +
    946 +    864 +## ‚úÖ VERDICT: GREEN LIGHT FOR ENGINEERING
    947 +    865 +
    948 +    866 +**Core Conditions (MANDATORY):**
    949 +    867 +1. Web App footer button is PRIMARY (not README)
    950 +    868 +2. Fail-safe pattern with 300ms timeout is MANDATORY
    951 +    869 +3. "Not in India?" toggle is MANDATORY
    952 +    870 +4. Use "Support" terminology exclusively
    953 +    871 +5. Deploy GitHub Sponsors badge ONLY after approval email
    954 +    872 +
    955 +    873 +**Enterprise Refinements (REQUIRED):**
    956 +    874 +6. Skeleton Loader for CLS mitigation (min-height: 60px)
    957 +    875 +7. UTM parameters on ALL payment links for attribution
    958 +    876 +8. `rel="noopener noreferrer"` on ALL external links
    959 +    877 +9. Session caching to avoid repeated API calls
    960 +    878 +
    961 +    879 +---
    962 +    880 +
    963 +    881 +## Document History
    964 +    882 +
    965 +    883 +| Version | Date | Author | Changes |
    966 +    884 +|---------|------|--------|---------|
    967 +    885 +| 1.0 | 2025-12-19 | Principal SDE | Initial document |
    968 +    886 +| 2.0 | 2025-12-19 | Principal SDE | Added Reviews A, B, C + consolidated decision |
    969 +    887 +| 2.1 | 2025-12-19 | Principal SDE | Added PART 4 Final Recommendation |
    970 +    888 +| 2.2 | 2025-12-19 | Enterprise Board | Added Review D + Enterprise Refinements + GREEN LIGHT |
    971 +    889 +
    972 +    890 +---
    973 +    891 +
    974 +    892 +**Status**: üü¢ APPROVED - ZERO DEFECTS
    975 +    893 +**Reviewed By**: 4 Reviewers (3 Principal SDEs + Enterprise Architecture Board)
    976 +    894 +**Technical Feasibility**: 10/10
    977 +    895 +**Compliance Rating**: 10/10
    978 +    896 +**Final Decision**: Web App Primary + Static Badges Secondary + Fail-Safe Smart Routing
    979 +    897 +**Ready for**: Phase 0 (Account Setup)
    980 +    898 +
    981 +    899 +üöÄ **GO FOR LAUNCH**
    982 +    900 +
    983 +    901 +---
    984 +    902 +
    985 +    903 +> **Next Step:** Proceed to Phase 0 (Account Creation) below.
    986 +    904 +
    987 +    905 +---
    988 +    906 +
    989 +    907 +# APPENDIX A: Phase 0 - Account Creation Guide
    990 +    908 +
    991 +    909 +## Step-by-Step Setup Instructions
    992 +    910 +
    993 +    911 +### A.1 Ko-fi Account Setup (Global - Day 1)
    994 +    912 +
    995 +    913 +**URL:** https://ko-fi.com/
    996 +    914 +
    997 +    915 +| Step | Action | Notes |
    998 +    916 +|------|--------|-------|
    999 +    917 +| 1 | Go to https://ko-fi.com/ | Click "Start a Page" |
    1000 +    918 +| 2 | Sign up with email or Google | Use project email if available |
    1001 +    919 +| 3 | Choose username | e.g., `markdownviewerpro` |
    1002 +    920 +| 4 | Set up profile | Add project logo, description |
    1003 +    921 +| 5 | Connect PayPal or Stripe | **Required for payouts** |
    1004 +    922 +| 6 | Set donation amounts | $1, $5, $10, $20, $50 |
    1005 +    923 +| 7 | Enable "Support" button | Not "Donate" (legal) |
    1006 +    924 +| 8 | Get page URL | `ko-fi.com/markdownviewerpro` |
    1007 +    925 +
    1008 +    926 +**Time Required:** ~10 minutes
    1009 +    927 +**Verification:** Make a $1 test donation to yourself
    1010 +    928 +
    1011 +    929 +---
    1012 +    930 +
    1013 +    931 +### A.2 Razorpay Account Setup (India - Day 1)
    1014 +    932 +
    1015 +    933 +**URL:** https://dashboard.razorpay.com/signup
    1016 +    934 +
    1017 +    935 +| Step | Action | Notes |
    1018 +    936 +|------|--------|-------|
    1019 +    937 +| 1 | Go to Razorpay Dashboard | Click "Sign Up" |
    1020 +    938 +| 2 | Enter mobile number | Indian number required |
    1021 +    939 +| 3 | Verify OTP | |
    1022 +    940 +| 4 | Select "Individual" account type | Not "Business" |
    1023 +    941 +| 5 | Complete KYC | **Required documents below** |
    1024 +    942 +| 6 | Create Payment Page | "Support Markdown Viewer Pro" |
    1025 +    943 +| 7 | Set preset amounts | ‚Çπ50, ‚Çπ100, ‚Çπ250, ‚Çπ500, ‚Çπ1000 |
    1026 +    944 +| 8 | Enable UPI, Cards, Netbanking | |
    1027 +    945 +| 9 | Get Payment Link | `razorpay.me/@markdownviewer` |
    1028 +    946 +
    1029 +    947 +**KYC Documents Required:**
    1030 +    948 +- PAN Card (Individual)
    1031 +    949 +- Aadhaar Card
    1032 +    950 +- Bank Account Details (Account number, IFSC)
    1033 +    951 +- Cancelled Cheque (optional)
    1034 +    952 +
    1035 +    953 +**Time Required:** ~30 minutes (KYC may take 24-48 hours for verification)
    1036 +    954 +**Verification:** Make a ‚Çπ10 test payment
    1037 +    955 +
    1038 +    956 +---
    1039 +    957 +
    1040 +    958 +### A.3 GitHub Sponsors Setup (Developers - Week 1)
    1041 +    959 +
    1042 +    960 +**URL:** https://github.com/sponsors
    1043 +    961 +
    1044 +    962 +| Step | Action | Notes |
    1045 +    963 +|------|--------|-------|
    1046 +    964 +| 1 | Ensure 2FA is enabled | **Mandatory** |
    1047 +    965 +| 2 | Complete GitHub profile | Bio, location, profile picture |
    1048 +    966 +| 3 | Go to https://github.com/sponsors | Click "Join the waitlist" |
    1049 +    967 +| 4 | Select "Individual" | Not Organization |
    1050 +    968 +| 5 | Choose payout country | India |
    1051 +    969 +| 6 | Connect Stripe Express | For payouts to Indian bank |
    1052 +    970 +| 7 | Fill tax information | W-8BEN form (non-US) |
    1053 +    971 +| 8 | Set sponsorship tiers | $1, $5, $10, $20, $50/month |
    1054 +    972 +| 9 | Write sponsor introduction | Why support this project |
    1055 +    973 +| 10 | Submit for review | **Wait 2-4 weeks** |
    1056 +    974 +
    1057 +    975 +**Prerequisites:**
    1058 +    976 +- GitHub account with 2FA enabled
    1059 +    977 +- Profile with photo and bio
    1060 +    978 +- At least one public repository
    1061 +    979 +- Active contribution history (recommended)
    1062 +    980 +
    1063 +    981 +**Time Required:** ~20 minutes to apply
    1064 +    982 +**Approval Time:** 2-4 weeks
    1065 +    983 +**Verification:** Check email for approval notification
    1066 +    984 +
    1067 +    985 +---
    1068 +    986 +
    1069 +    987 +## Phase 0 Checklist
    1070 +    988 +
    1071 +    989 +```markdown
    1072 +    990 +## Account Creation Checklist
    1073 +    991 +
    1074 +    992 +### Day 1
    1075 +    993 +- [ ] Create Ko-fi account
    1076 +    994 +  - [ ] Sign up at ko-fi.com
    1077 +    995 +  - [ ] Set username: _______________
    1078 +    996 +  - [ ] Connect PayPal/Stripe
    1079 +    997 +  - [ ] Set amounts: $1, $5, $10, $20, $50
    1080 +    998 +  - [ ] Test with $1 donation
    1081 +    999 +  - [ ] Copy link: ko-fi.com/_______________
    1082 +    1000 +
    1083 +    1001 +- [ ] Create Razorpay account
    1084 +    1002 +  - [ ] Sign up at razorpay.com
    1085 +    1003 +  - [ ] Complete KYC (PAN, Aadhaar)
    1086 +    1004 +  - [ ] Wait for verification (24-48h)
    1087 +    1005 +  - [ ] Create Payment Page
    1088 +    1006 +  - [ ] Set amounts: ‚Çπ50, ‚Çπ100, ‚Çπ250, ‚Çπ500, ‚Çπ1000
    1089 +    1007 +  - [ ] Test with ‚Çπ10 payment
    1090 +    1008 +  - [ ] Copy link: razorpay.me/@_______________
    1091 +    1009 +
    1092 +    1010 +### Day 1 (Submit, wait 2-4 weeks)
    1093 +    1011 +- [ ] Apply for GitHub Sponsors
    1094 +    1012 +  - [ ] Enable 2FA on GitHub
    1095 +    1013 +  - [ ] Complete profile
    1096 +    1014 +  - [ ] Submit application
    1097 +    1015 +  - [ ] Fill W-8BEN tax form
    1098 +    1016 +  - [ ] Connect Stripe Express
    1099 +    1017 +  - [ ] Wait for approval email
    1100 +    1018 +
    1101 +    1019 +### After Approval
    1102 +    1020 +- [ ] GitHub Sponsors approved
    1103 +    1021 +  - [ ] Set up tiers
    1104 +    1022 +  - [ ] Enable on repository
    1105 +    1023 +  - [ ] Add badge to README
    1106 +    1024 +```
    1107 +    1025 +
    1108 +    1026 +---
    1109 +    1027 +
    1110 +    1028 +## Quick Reference: Account URLs After Setup
    1111 +    1029 +
    1112 +    1030 +| Platform | Your URL | Status |
    1113 +    1031 +|----------|----------|--------|
    1114 +    1032 +| Ko-fi | `https://ko-fi.com/markdownviewerpro` | ‚è≥ Pending |
    1115 +    1033 +| Razorpay | `https://razorpay.me/@markdownviewer` | ‚è≥ Pending |
    1116 +    1034 +| GitHub Sponsors | `https://github.com/sponsors/PrakharMNNIT` | ‚è≥ Pending Approval |
    1117 +    1035 +
    1118 +    1036 +---
    1119 +    1037 +
    1120 +    1038 +## Troubleshooting
    1121 +    1039 +
    1122 +    1040 +### Ko-fi Issues
    1123 +    1041 +| Problem | Solution |
    1124 +    1042 +|---------|----------|
    1125 +    1043 +| PayPal not connecting | Use Stripe instead |
    1126 +    1044 +| Payout delayed | Check PayPal verification status |
    1127 +    1045 +| Page not visible | Check privacy settings |
    1128 +    1046 +
    1129 +    1047 +### Razorpay Issues
    1130 +    1048 +| Problem | Solution |
    1131 +    1049 +|---------|----------|
    1132 +    1050 +| KYC rejected | Re-upload clearer documents |
    1133 +    1051 +| Payout delayed | Verify bank details |
    1134 +    1052 +| International cards failing | Enable "International Payments" in dashboard |
    1135 +    1053 +
    1136 +    1054 +### GitHub Sponsors Issues
    1137 +    1055 +| Problem | Solution |
    1138 +    1056 +|---------|----------|
    1139 +    1057 +| Application rejected | Improve profile, add more repos |
    1140 +    1058 +| Stripe not available | Use alternative payout method |
    1141 +    1059 +| Long wait time | Normal - allow up to 4 weeks |
    1142 +    1060 +
    1143 +    1061 +---
    1144 +    1062 +
    1145 +    1063 +**End of Appendix A**
    1146 +    1064  
    1147 +
    1148 +```
    1149 +
    1150 +
    1151 +### ‚ú® `docs/01-requirements/donation_final_readiness_review.md` **[ADDED]**
    1152 +
    1153 +**Status:** ‚úÖ **NEW FILE** - This file has been newly created
    1154 +
    1155 +**Type:** Documentation üìñ
    1156 +
    1157 +```diff
    1158 +@@ -0,0 +1,91 @@
    1159 +      1 +# Sr. Principal SDE Final Readiness Review
    1160 +      2 +
    1161 +      3 +**Reviewer:** Enterprise Architecture Board
    1162 +      4 +**Date:** 2025-12-19
    1163 +      5 +**Target:** `donation-feature-plan.md` (v2.1 Consolidated)
    1164 +      6 +**Status:** ‚úÖ **GREEN LIGHT** (with 3 Non-Blocking Observability Recommendations)
947 1165        7 +
948 1166        8 +---
949 1167        9 +
950     -     10 +## üìã Table of Contents
    1168 +     10 +## 1. Executive Summary
951 1169       11 +
952     -     12 +1. [Standard Assumptions](#-standard-assumptions)
953     -     13 +2. [Integer Limits & Data Types](#-integer-limits--data-types)
954     -     14 +3. [Array & Container Constraints](#-array--container-constraints)
955     -     15 +4. [String Constraints](#-string-constraints)
956     -     16 +5. [Time Complexity Limits](#-time-complexity-limits)
957     -     17 +6. [Space Complexity Limits](#-space-complexity-limits)
958     -     18 +7. [Common Primes & Mathematical Constants](#-common-primes--mathematical-constants)
959     -     19 +8. [Edge Cases Checklist](#-edge-cases-checklist)
960     -     20 +9. [Platform-Specific Constraints](#-platform-specific-constraints)
961     -     21 +10. [Quick Reference Cheatsheet](#-quick-reference-cheatsheet)
962     -     22 +
963     -     23 +---
964     -     24 +
965     -     25 +## üéØ Standard Assumptions
966     -     26 +
967     -     27 +### The Golden Rules
    1170 +     12 +The consolidated plan (v2.1) has successfully resolved the critical architectural conflicts identified in previous reviews. The "Web App Primary + Fail-Safe Router" approach combined with the "Two-Pocket" financial strategy represents a high-maturity solution that balances **User Experience**, **Legal Compliance**, and **Technical Risk**.
    1171 +     13 +
    1172 +     14 +**Verdict:** The plan is **Ready for Engineering**.
    1173 +     15 +
    1174 +     16 +---
    1175 +     17 +
    1176 +     18 +## 2. Residual Efficiency & Observability Risks
    1177 +     19 +
    1178 +     20 +While the core functionality is sound, a "Strict" review identifies minor gaps in **UX Stability** and **Business Observability** that should be addressed during implementation.
    1179 +     21 +
    1180 +     22 +### 2.1 Cumulative Layout Shift (CLS) Risk
    1181 +     23 +*   **Issue:** The "Smart Router" relies on an asynchronous `fetch` with a 300ms race condition.
    1182 +     24 +*   **Risk:** If the footer renders *without* the button, and then the button "pops in" 200ms later, it causes a layout shift. This hurts SEO (Core Web Vitals) and visual polish.
    1183 +     25 +*   **Requirement:** The footer implementation **MUST** reserve fixed vertical space (e.g., `min-height: 60px`) for the support widget *before* the JS runs.
    1184 +     26 +    *   *Loading State:* Show a generic "‚òï Support" grey ghost button immediately.
    1185 +     27 +    *   *Hydration:* Swap it for the colorful "üáÆüá≥ UPI" or "üåè PayPal" button once the promise resolves.
968 1186       28 +
969     -     29 +| Assumption | Typical Value | Reasoning |
970     -     30 +|------------|---------------|-----------|
971     -     31 +| **Time Limit** | 1-2 seconds | ~10‚Å∏ simple operations/second |
972     -     32 +| **Memory Limit** | 256 MB | Standard competitive programming |
973     -     33 +| **Max Input Size (n)** | 10‚Åµ to 10‚Å∂ | Fits in memory, allows O(n log n) |
974     -     34 +| **Max Integer Value** | 10‚Åπ | Fits in `int` |
975     -     35 +| **Large Integer Value** | 10¬π‚Å∏ | Requires `long long` |
    1187 +     29 +### 2.2 Blind spots in Success Metrics
    1188 +     30 +*   **Issue:** The stated *Success Metrics* include "At least 3 valid donations".
    1189 +     31 +*   **Risk:** With direct links to Ko-fi/Razorpay, you cannot distinguish traffic sources (README vs App Footer vs Direct Search). You will see money, but not *attribution*.
    1190 +     32 +*   **Requirement:** Use UTM parameters or `ref` tags on all generated links.
    1191 +     33 +    *   **Bad:** `razorpay.me/@markdownviewer`
    1192 +     34 +    *   **Good:** `razorpay.me/@markdownviewer?notes[source]=webapp_footer`
    1193 +     35 +    *   **Good:** `ko-fi.com/markdownviewerpro?ref=readme_badge`
976 1194       36 +
977     -     37 +### What to Ask in Interviews
978     -     38 +
979     -     39 +1. **Input size constraints?** (n ‚â§ ?)
980     -     40 +2. **Value range?** (values ‚â§ ?)
981     -     41 +3. **Can values be negative?**
982     -     42 +4. **Are there duplicates?**
983     -     43 +5. **Is input sorted?**
984     -     44 +6. **Can input be empty?**
    1195 +     37 +### 2.3 Security Best Practice (`noopener`)
    1196 +     38 +*   **Issue:** External links to payment processors open in new tabs (`target="_blank"`).
    1197 +     39 +*   **Risk:** Reverse Tabnapping (theoretical risk on older browsers, but enterprise compliance usually flags it).
    1198 +     40 +*   **Requirement:** All external payment links **MUST** include `rel="noopener noreferrer"`.
    1199 +     41 +
    1200 +     42 +---
    1201 +     43 +
    1202 +     44 +## 3. Final Architecture Code Sign-off
985 1203       45 +
986     -     46 +---
    1204 +     46 +The proposed JS snippet is robust. I am validating the `Promise.race` pattern as **Enterprise-Grade**.
987 1205       47 +
988     -     48 +## üî¢ Integer Limits & Data Types
989     -     49 +
990     -     50 +### Standard Integer Ranges
991     -     51 +
992     -     52 +| Type | Bytes | Range | Max (~) | Use When |
993     -     53 +|------|-------|-------|---------|----------|
994     -     54 +| `int` | 4 | -2¬≥¬π to 2¬≥¬π-1 | ¬±2.1√ó10‚Åπ | Default choice |
995     -     55 +| `unsigned int` | 4 | 0 to 2¬≥¬≤-1 | 4.3√ó10‚Åπ | Non-negative only |
996     -     56 +| `long long` | 8 | -2‚Å∂¬≥ to 2‚Å∂¬≥-1 | ¬±9.2√ó10¬π‚Å∏ | Large values |
997     -     57 +| `unsigned long long` | 8 | 0 to 2‚Å∂‚Å¥-1 | 1.8√ó10¬π‚Åπ | Very large non-negative |
    1206 +     48 +**Refined Snippet (Optimization for Reliability):**
    1207 +     49 +```javascript
    1208 +     50 +// RECOMMENDED IMPLEMENTATION PATTERN
    1209 +     51 +const TIMEOUT_MS = 300;
    1210 +     52 +const FALLBACK_REGION = 'global';
    1211 +     53 +
    1212 +     54 +async function getDonationConfig() {
    1213 +     55 +  // 1. Check Session Cache (FR-1.4) - Avoids API hit on page navigation
    1214 +     56 +  const cached = sessionStorage.getItem('user_region');
    1215 +     57 +  if (cached) return cached;
998 1216       58 +
999     -     59 +### Critical Constants (MEMORIZE!)
1000     -     60 +
1001     -     61 +```cpp
1002     -     62 +#include <climits>
1003     -     63 +
1004     -     64 +INT_MAX    =  2,147,483,647      // ‚âà 2.1 √ó 10‚Åπ
1005     -     65 +INT_MIN    = -2,147,483,648      // ‚âà -2.1 √ó 10‚Åπ
1006     -     66 +LLONG_MAX  =  9,223,372,036,854,775,807  // ‚âà 9.2 √ó 10¬π‚Å∏
1007     -     67 +LLONG_MIN  = -9,223,372,036,854,775,808  // ‚âà -9.2 √ó 10¬π‚Å∏
    1217 +     59 +  try {
    1218 +     60 +    // 2. Race Network vs Timer
    1219 +     61 +    const fetchPromise = fetch('https://ipapi.co/json/').then(r => r.json());
    1220 +     62 +    const timeoutPromise = new Promise((_, reject) =>
    1221 +     63 +      setTimeout(() => reject(new Error('Timeout')), TIMEOUT_MS)
    1222 +     64 +    );
    1223 +     65 +
    1224 +     66 +    const data = await Promise.race([fetchPromise, timeoutPromise]);
    1225 +     67 +    const region = data.country_code === 'IN' ? 'india' : 'global';
1008 1226       68 +
1009     -     69 +// Quick mental math
1010     -     70 +INT_MAX   ‚âà 2 √ó 10‚Åπ    (2 billion)
1011     -     71 +LLONG_MAX ‚âà 9 √ó 10¬π‚Å∏   (9 quintillion)
1012     -     72 +```
1013     -     73 +
1014     -     74 +### When to Use Which Type
1015     -     75 +
1016     -     76 +| Problem Constraint | Type to Use | Example |
1017     -     77 +|-------------------|-------------|---------|
1018     -     78 +| n ‚â§ 10‚Åµ, values ‚â§ 10‚Åπ | `int` | Most problems |
1019     -     79 +| Values > 2√ó10‚Åπ | `long long` | Large sums, products |
1020     -     80 +| Sum of n elements, n ‚â§ 10‚Åµ | `long long` | 10‚Åµ √ó 10‚Åπ = 10¬π‚Å¥ |
1021     -     81 +| Product of elements | `long long` or modulo | Overflow danger! |
1022     -     82 +| n √ó n where n ‚â§ 10‚Åµ | `long long` | 10¬π‚Å∞ > INT_MAX |
    1227 +     69 +    // 3. Set Cache
    1228 +     70 +    sessionStorage.setItem('user_region', region);
    1229 +     71 +    return region;
    1230 +     72 +  } catch (e) {
    1231 +     73 +    // 4. Fail Open
    1232 +     74 +    console.warn('[DonationRouter] Geo-lookup failed/timed-out, defaulting to Global.');
    1233 +     75 +    return FALLBACK_REGION;
    1234 +     76 +  }
    1235 +     77 +}
    1236 +     78 +```
    1237 +     79 +
    1238 +     80 +---
    1239 +     81 +
    1240 +     82 +## 4. Final Approvals
1023 1241       83 +
1024     -     84 +### ‚ö†Ô∏è Overflow Danger Zones
1025     -     85 +
1026     -     86 +```cpp
1027     -     87 +// ‚ùå OVERFLOW! (10‚Åµ √ó 10‚Åµ = 10¬π‚Å∞ > INT_MAX)
1028     -     88 +int n = 100000;
1029     -     89 +int result = n * n;  // WRONG!
    1242 +     84 +| Category | Status | Notes |
    1243 +     85 +|----------|--------|-------|
    1244 +     86 +| **Functional** | ‚úÖ Approved | Requirements are clear and testable. |
    1245 +     87 +| **Technical** | ‚úÖ Approved | Fail-safe pattern mitigates API risk. |
    1246 +     88 +| **Legal** | ‚úÖ Approved | "Two-Pocket" strategy satisfies FEMA/IRS separation. |
    1247 +     89 +| **UX** | ‚úÖ Approved | CLS mitigation (Skeleton Loader) added as requirement. |
1030 1248       90 +
1031     -     91 +// ‚úÖ SAFE
1032     -     92 +long long result = (long long)n * n;
1033     -     93 +long long result = 1LL * n * n;
    1249 +     91 +**Next Step:** Proceed to Phase 1 (Account Creation) as defined in the Roadmap.
    1250 +     92  
    1251 +
    1252 +```
    1253 +
    1254 +
    1255 +### ‚ú® `docs/01-requirements/donation_strategy_review.md` **[ADDED]**
    1256 +
    1257 +**Status:** ‚úÖ **NEW FILE** - This file has been newly created
    1258 +
    1259 +**Type:** Documentation üìñ
    1260 +
    1261 +```diff
    1262 +@@ -0,0 +1,64 @@
    1263 +      1 +# Principal SDE Review: Donation System Strategy
    1264 +      2 +
    1265 +      3 +**Reviewer:** Principal Software Engineer, Payments & Growth
    1266 +      4 +**Date:** 2025-12-19
    1267 +      5 +**Subject:** Comparative Analysis of `donation_system_design.md` (Proposal A) vs `donation-feature-plan.md` (Proposal B)
    1268 +      6 +
    1269 +      7 +---
    1270 +      8 +
    1271 +      9 +## Executive Summary
    1272 +     10 +
    1273 +     11 +I have reviewed both proposals side-by-side.
    1274 +     12 +*   **Proposal A (Smart Router)** focuses on an "automated" user experience via IP-based routing.
    1275 +     13 +*   **Proposal B (Feature Plan)** focuses on a "transparent" user choice via static badges (GitHub/Ko-fi/Razorpay).
    1276 +     14 +
    1277 +     15 +**Recommendation:** ‚úÖ **PROCEED WITH PROPOSAL B (Feature Plan)**
    1278 +     16 +*   **Why?** It offers superior **Trust**, **Reliability**, and **Zero-Maintenance**.
    1279 +     17 +*   **Caveat:** Proposal A's "Smart Router" logic should be adopted *only* as an enhancement for the Web App's footer button, but NOT for the `README.md`.
    1280 +     18 +
    1281 +     19 +---
    1282 +     20 +
    1283 +     21 +## Detailed Comparative Analysis
    1284 +     22 +
    1285 +     23 +### 1. User Trust & Conversion
    1286 +     24 +*   **Proposal A (Router):** Risks "Link Anxiety". A user clicking "Donate" and being redirected through a custom domain (`your-site.app/donate`) before landing on a payment page can feel phishy. Users prefer to see exactly where they are going (e.g., hovering and seeing `github.com/sponsors` or `razorpay.me`).
    1287 +     25 +*   **Proposal B (Manual):** High Trust. The "Sponsor" badge on GitHub is a native, trusted signal. Users know exactly what they are clicking.
    1288 +     26 +*   **Winner:** üèÜ **Proposal B**
    1289 +     27 +
    1290 +     28 +### 2. Reliability & Maintenance
    1291 +     29 +*   **Proposal A:** Requires hosting a bridge page. Requires an external Geolocation API (which has rate limits or costs). If the API fails, the buttons might not render. This introduces a **Point of Failure**.
    1292 +     30 +*   **Proposal B:** Relies on static Markdown and Platform URLs. 100% Uptime (unless GitHub itself is down). Zero maintenance.
    1293 +     31 +*   **Winner:** üèÜ **Proposal B** (Engineers hate maintenance debt).
    1294 +     32 +
    1295 +     33 +### 3. Legal & Compliance (The "Two-Pocket" Test)
    1296 +     34 +Both proposals correctly identify the need to separate Domestic (INR) and International (USD) funds.
    1297 +     35 +*   **Proposal B** creates a clearer mental model for the user ("I am Indian -> I choose Razorpay").
    1298 +     36 +*   **Proposal A** tries to be "smart" but might accidentally route a VPN user to the wrong bucket (e.g., an NRI using an India VPN seeing UPI but wanting to pay via US Card). Proposal B allows the user to self-correct.
    1299 +     37 +*   **Winner:** üèÜ **Proposal B** (User choice is better than inference for payments).
    1300 +     38 +
    1301 +     39 +### 4. Implementation Effort
    1302 +     40 +*   **Proposal A:** ~4-8 hours. Setup hosting, write JS, test IP API, handle edge cases, CORS issues.
    1303 +     41 +*   **Proposal B:** ~1 hour. Sign up -> Get Links -> Paste in README.
    1304 +     42 +*   **Winner:** üèÜ **Proposal B**
    1305 +     43 +
    1306 +     44 +---
    1307 +     45 +
    1308 +     46 +## Critical Feeback on Proposal B (User's Plan)
    1309 +     47 +
    1310 +     48 +While Proposal B is the winner, here are specific improvements required before execution:
    1311 +     49 +
    1312 +     50 +1.  **Banner Design:** Ensure the badges in the `README.md` are aesthetically aligned. A mismatched row of buttons looks unprofessional. Use `Shields.io` consistently as you proposed.
    1313 +     51 +2.  **Razorpay Link:** Verify if `razorpay.me/@username` allows *custom* amounts easily for the user. Sometimes "Payment Pages" are better than "Payment Links" for this specific use case.
    1314 +     52 +3.  **GitHub Sponsors Eligibility:** You must verify eligibility. If your account is new/inactive, approval might take time. **Fallback:** Use Ko-fi as the primary until GitHub approves.
    1315 +     53 +
    1316 +     54 +---
    1317 +     55 +
    1318 +     56 +## Final Verdict & Next Steps
    1319 +     57 +
    1320 +     58 +**Discard Proposal A's architecture for the README.** Use Proposal B as the master plan.
    1321 +     59 +
    1322 +     60 +**Action Items:**
    1323 +     61 +1.  **Execute Phase 1 & 2 of Proposal B immediately.** (Setup Accounts & specific Badges).
    1324 +     62 +2.  **Enhancement (Optional):** In the *Application Footer* (index.html), you may effectively use the logic from Proposal A to highlight the "best" option (e.g., "üáÆüá≥ Support via UPI" vs "üåè Support via PayPal"), but keep the static `README.md` simple.
    1325 +     63 +
    1326 +     64 +**Approved for Implementation.** üöÄ
    1327 +     65  
    1328 +
    1329 +```
    1330 +
    1331 +
    1332 +### ‚ú® `docs/01-requirements/donation_system_design.md` **[ADDED]**
    1333 +
    1334 +**Status:** ‚úÖ **NEW FILE** - This file has been newly created
    1335 +
    1336 +**Type:** Documentation üìñ
    1337 +
    1338 +```diff
    1339 +@@ -0,0 +1,141 @@
    1340 +      1 +# Design Document: Geo-Adaptive Donation System
    1341 +      2 +## Functional Requirements & Strategy
    1342 +      3 +
    1343 +      4 +**Document ID:** DD-2025-003-DONATION
    1344 +      5 +**Author:** Sr. Principal SDE
    1345 +      6 +**Status:** Draft
    1346 +      7 +**Date:** 2025-12-19
    1347 +      8 +
    1348 +      9 +---
    1349 +     10 +
    1350 +     11 +## 1. Problem Statement
    1351 +     12 +
    1352 +     13 +The goal is to enable a simplified donation ("Buy Me a Coffee") flow that maximizes conversion rates by offering **local payment methods** and **native pricing** based on the user's location, specifically targeting:
    1353 +     14 +*   **India:** Needs UPI support (GooglePay, PhonePe) and INR pricing (e.g., ‚Çπ50, ‚Çπ100). International cards often fail here due to RBI mandates.
    1354 +     15 +*   **Global (ROW):** Needs PayPal/Stripe support and USD pricing (e.g., $1, $5).
    1355 +     16 +*   **Contexts:** Must be accessible from the Web Application and static contexts like GitHub `README.md`.
    1356 +     17 +
    1357 +     18 +---
    1358 +     19 +
    1359 +     20 +## 2. Requirements
    1360 +     21 +
    1361 +     22 +### 2.1 Functional Requirements (FR)
    1362 +     23 +
    1363 +     24 +| ID | Requirement | Description |
    1364 +     25 +|---|---|---|
    1365 +     26 +| **FR-1** | **IP Geolocation** | System must detect if the user is in India (IN) or Rest of World (ROW). |
    1366 +     27 +| **FR-2** | **Dynamic Currency** | Display INR (‚Çπ) presets for IN users and USD ($) presets for ROW users. |
    1367 +     28 +| **FR-3** | **Preset Tiers** | **INR:** ‚Çπ50, ‚Çπ100, ‚Çπ250, ‚Çπ500, Custom.<br>**USD:** $1, $5, $10, $20, Custom. |
    1368 +     29 +| **FR-4** | **Payment Method** | **IN:** Redirect to UPI/Razorpay.<br>**ROW:** Redirect to PayPal/Stripe/BMAC. |
    1369 +     30 +| **FR-5** | **Readme Compatibility** | Since `README.md` cannot run JS, it must link to a hosted "Donation Routing Page" that handles the logic. |
    1370 +     31 +
    1371 +     32 +### 2.2 Non-Functional Requirements (NFR)
    1372 +     33 +
    1373 +     34 +| ID | Requirement | Description |
    1374 +     35 +|---|---|---|
    1375 +     36 +| **NFR-1** | **Zero Setup Cost** | Solution must not incur monthly fees (Transaction fees only). |
    1376 +     37 +| **NFR-2** | **Legal Compliance** | **India:** Must comply with Tax laws (Income classification).<br>**Global:** Must avoid FCRA triggers (if applicable to individuals, usually treated as "Export of Services" or "Gift"). |
    1377 +     38 +| **NFR-3** | **Performance** | Geo-lookup must add < 500ms latency to the donation page load. |
    1378 +     39 +| **NFR-4** | **Privacy** | Do not store PII during the routing phase. |
    1379 +     40 +
    1380 +     41 +---
    1381 +     42 +
    1382 +     43 +## 3. Compliance & Financial Viability
    1383 +     44 +
    1384 +     45 +### 3.1 The "Two-Pocket" Strategy
    1385 +     46 +To follow online donation laws strictly without complex business registration:
    1386 +     47 +1.  **Pocket A (India):** Use **Razorpay** or **UPI Payment Link**.
    1387 +     48 +    *   *Why:* Indian Payment Gateways require KYC and Indian Bank Accounts. They handle domestic UPI/Netbanking perfectly.
    1388 +     49 +    *   *Compliance:* Treated as Domestic Income.
    1389 +     50 +2.  **Pocket B (International):** Use **PayPal** or **Buy Me a Coffee (Stripe)**.
    1390 +     51 +    *   *Why:* PayPal is the standard for cross-border small payments. Razorpay International often has high failure rates for personal accounts.
    1391 +     52 +    *   *Compliance:* Treated as Foreign Inward Remittance (FIRC provided by PayPal/Bank).
    1392 +     53 +
    1393 +     54 +---
    1394 +     55 +
    1395 +     56 +## 4. Solution Options & Trade-offs
    1396 +     57 +
    1397 +     58 +### Option A: dedicated "Buy Me a Coffee" (Single Platform)
    1398 +     59 +Use a single platform like *Buy Me a Coffee* (BMAC) or *Ko-fi*.
    1399 +     60 +*   **Pros:** Zero dev effort, hosted page, handles currency conversion automatically (shows local currency to user usually).
    1400 +     61 +*   **Cons:**
    1401 +     62 +    *   **High Fees:** BMAC takes ~5% cut + Stripe fees.
    1402 +     63 +    *   **UPI Failure:** Often fails to present a native UPI intent flow for Indians, leading to drop-offs.
    1403 +     64 +    *   **Conversion:** Indian users seeing $5 (approx ‚Çπ400) might hesitate compared to seeing a native ‚Çπ100 tier.
    1404 +     65 +
    1405 +     66 +### Option B: The "Smart Router" (Recommended)
    1406 +     67 +Create a simple custom landing page (e.g., `markdown-viewer.com/donate`) that detects IP and shows the right button.
    1407 +     68 +
    1408 +     69 +*   **Pros:**
    1409 +     70 +    *   **Perfect UX:** Indians see UPI + ‚Çπ50. Global users see PayPal + $3.
    1410 +     71 +    *   **Lower Fees:** Razorpay (Domestic) is ~2%, PayPal is ~4-5%. No extra platform reliability fee.
    1411 +     72 +    *   **Control:** Full control over presets.
    1412 +     73 +*   **Cons:** Requires hosting a simple HTML page (Free via GitHub Pages/Vercel).
    1413 +     74 +
    1414 +     75 +---
    1415 +     76 +
    1416 +     77 +## 5. Implementation Plan (The "Smart Router")
    1417 +     78 +
    1418 +     79 +### 5.1 Architecture
    1419 +     80 +1.  **Static Badge (README/Footer):**
    1420 +     81 +    *   Image: `Donate ‚òï`
    1421 +     82 +    *   Link: `https://your-site.vercel.app/donate`
    1422 +     83 +2.  **Routing Page (`/donate`):**
    1423 +     84 +    *   **Tech:** Static HTML + Client-side JS.
    1424 +     85 +    *   **Geo-Service:** Use `https://ipapi.co/json/` (Free tier: 1000 requests/day) or Cloudflare Traces (Unlimited).
    1425 +     86 +
    1426 +     87 +### 5.2 Flow Logic
    1427 +     88 +```mermaid
    1428 +     89 +graph TD
    1429 +     90 +    A[User Clicks 'Donate'] --> B{Check IP via API}
    1430 +     91 +    B -- Country = IN --> C[Render Razorpay Button]
    1431 +     92 +    C --> C1[Show: ‚Çπ50, ‚Çπ100, ‚Çπ500]
    1432 +     93 +    C --> C2[Method: UPI / Paytm / GPay]
1034 1433       94 +
1035     -     95 +// ‚ùå OVERFLOW! (sum of 10‚Åµ elements each up to 10‚Åπ)
1036     -     96 +int sum = 0;
1037     -     97 +for (int x : arr) sum += x;  // WRONG if arr is large!
1038     -     98 +
1039     -     99 +// ‚úÖ SAFE
1040     -    100 +long long sum = 0;
1041     -    101 +for (int x : arr) sum += x;
1042     -    102 +```
1043     -    103 +
1044     -    104 +### Modular Arithmetic
1045     -    105 +
1046     -    106 +When problem says "answer modulo 10‚Åπ+7":
1047     -    107 +
1048     -    108 +```cpp
1049     -    109 +const int MOD = 1e9 + 7;  // 1,000,000,007 (prime)
    1434 +     95 +    B -- Country != IN --> D[Render PayPal/BMAC Button]
    1435 +     96 +    D --> D1[Show: $1, $5, $10]
    1436 +     97 +    D --> D2[Method: PayPal / Card]
    1437 +     98 +```
    1438 +     99 +
    1439 +    100 +### 5.3 Financial Setup (Free)
    1440 +    101 +1.  **For India (INR):**
    1441 +    102 +    *   Sign up for **Razorpay Payment Pages** (No coding needed).
    1442 +    103 +    *   Create a page "Buy me a Coffee".
    1443 +    104 +    *   Set Fixed Amounts: ‚Çπ50, ‚Çπ100 (or "Decide yourself" field).
    1444 +    105 +    *   *Cost:* 0 setup, ~2% per transaction.
    1445 +    106 +2.  **For Global (USD):**
    1446 +    107 +    *   Sign up for **PayPal.Me** or **Ko-fi** (connects to PayPal).
    1447 +    108 +    *   Ko-fi is better (0% platform fee on donations, only PayPal fees).
    1448 +    109 +    *   *Cost:* 0 setup, ~4-5% per transaction.
1050 1449      110 +
1051     -    111 +// Addition
1052     -    112 +(a + b) % MOD
1053     -    113 +
1054     -    114 +// Subtraction (add MOD to avoid negative)
1055     -    115 +((a - b) % MOD + MOD) % MOD
    1450 +    111 +---
    1451 +    112 +
    1452 +    113 +## 6. Final Recommendation
    1453 +    114 +
    1454 +    115 +**Go with Option B (Smart Router) hosted on GitHub Pages.**
1056 1455      116 +
1057     -    117 +// Multiplication
1058     -    118 +(1LL * a * b) % MOD  // Cast to long long first!
1059     -    119 +
1060     -    120 +// Common modulo values
1061     -    121 +10‚Åπ + 7  = 1,000,000,007  // Most common (prime)
1062     -    122 +10‚Åπ + 9  = 1,000,000,009  // Also prime
1063     -    123 +998244353                  // FFT-friendly prime (2¬≤¬≥ √ó 7 √ó 17 + 1)
1064     -    124 +```
1065     -    125 +
1066     -    126 +---
1067     -    127 +
1068     -    128 +## üìä Array & Container Constraints
1069     -    129 +
1070     -    130 +### Maximum Array Sizes
1071     -    131 +
1072     -    132 +| Memory | Max Elements (`int`) | Max Elements (`long long`) |
1073     -    133 +|--------|---------------------|---------------------------|
1074     -    134 +| 256 MB | ~64 million | ~32 million |
1075     -    135 +| 512 MB | ~128 million | ~64 million |
1076     -    136 +| 1 GB | ~256 million | ~128 million |
1077     -    137 +
1078     -    138 +**Formula:** Max elements = Memory / sizeof(type)
1079     -    139 +- 256 MB = 256 √ó 10‚Å∂ bytes
1080     -    140 +- int array: 256 √ó 10‚Å∂ / 4 = 64 √ó 10‚Å∂
1081     -    141 +
1082     -    142 +### Typical Constraints by Problem Type
1083     -    143 +
1084     -    144 +| Problem Type | Typical n | Expected Complexity |
1085     -    145 +|--------------|-----------|-------------------|
1086     -    146 +| Easy | ‚â§ 10¬≥ | O(n¬≤) acceptable |
1087     -    147 +| Medium | ‚â§ 10‚Åµ | O(n log n) expected |
1088     -    148 +| Hard | ‚â§ 10‚Å∂ | O(n) or O(n log n) |
1089     -    149 +| Very Hard | ‚â§ 10‚Å∑ | O(n) only |
1090     -    150 +
1091     -    151 +### 2D Array Limits
1092     -    152 +
1093     -    153 +```cpp
1094     -    154 +// Max 2D array with 256MB memory
1095     -    155 +// n √ó m √ó sizeof(int) ‚â§ 256 √ó 10‚Å∂
1096     -    156 +
1097     -    157 +// Safe limits:
1098     -    158 +int arr[1000][1000];     // 4 MB - ‚úÖ Safe
1099     -    159 +int arr[5000][5000];     // 100 MB - ‚úÖ Usually safe
1100     -    160 +int arr[10000][10000];   // 400 MB - ‚ùå Too large!
1101     -    161 +
1102     -    162 +// For larger grids, use vector (dynamic allocation)
1103     -    163 +vector<vector<int>> grid(n, vector<int>(m));
1104     -    164 +```
1105     -    165 +
1106     -    166 +### Container Memory Usage
1107     -    167 +
1108     -    168 +| Container | Memory per Element | Notes |
1109     -    169 +|-----------|-------------------|-------|
1110     -    170 +| `vector<int>` | 4 bytes | Most efficient |
1111     -    171 +| `deque<int>` | 4 bytes + overhead | Block allocation |
1112     -    172 +| `list<int>` | 4 + 16 bytes | Node pointers |
1113     -    173 +| `set<int>` | 4 + 32 bytes | Red-black tree |
1114     -    174 +| `unordered_set<int>` | 4 + ~8 bytes | Hash table |
1115     -    175 +| `map<int,int>` | 8 + 32 bytes | Red-black tree |
1116     -    176 +| `unordered_map<int,int>` | 8 + ~16 bytes | Hash table |
1117     -    177 +
1118     -    178 +---
1119     -    179 +
1120     -    180 +## üìù String Constraints
1121     -    181 +
1122     -    182 +### String Length Limits
1123     -    183 +
1124     -    184 +| Constraint | Typical Value | Common Problems |
1125     -    185 +|------------|---------------|-----------------|
1126     -    186 +| Short strings | ‚â§ 100 | Brute force OK |
1127     -    187 +| Medium strings | ‚â§ 10‚Åµ | O(n) required |
1128     -    188 +| Long strings | ‚â§ 10‚Å∂ | O(n) only |
1129     -    189 +| Multiple strings | Total length ‚â§ 10‚Å∂ | Sum constraint |
1130     -    190 +
1131     -    191 +### Character Set Assumptions
1132     -    192 +
1133     -    193 +```cpp
1134     -    194 +// Lowercase letters only: 'a' to 'z' (26 chars)
1135     -    195 +int freq[26] = {0};
1136     -    196 +freq[ch - 'a']++;
1137     -    197 +
1138     -    198 +// All letters: 'A'-'Z', 'a'-'z' (52 chars)
1139     -    199 +// Usually case-insensitive or convert to one case
1140     -    200 +
1141     -    201 +// Digits: '0' to '9' (10 chars)
1142     -    202 +int digit = ch - '0';
1143     -    203 +
1144     -    204 +// ASCII printable: 32 to 126 (95 chars)
1145     -    205 +int freq[128] = {0};  // Safe for all ASCII
1146     -    206 +
1147     -    207 +// Unicode: Use std::string with UTF-8
1148     -    208 +// Careful: string[i] may not be a full character!
1149     -    209 +```
1150     -    210 +
1151     -    211 +### String Comparison Complexity
1152     -    212 +
1153     -    213 +```cpp
1154     -    214 +// Comparing two strings of length n and m
1155     -    215 +s1 == s2;           // O(min(n, m))
1156     -    216 +s1.compare(s2);     // O(min(n, m))
1157     -    217 +s1 < s2;            // O(min(n, m))
1158     -    218 +
1159     -    219 +// For multiple comparisons, use hashing
1160     -    220 +hash<string> hasher;
1161     -    221 +size_t h = hasher(s);
1162     -    222 +```
1163     -    223 +
1164     -    224 +---
1165     -    225 +
1166     -    226 +## ‚è±Ô∏è Time Complexity Limits
1167     -    227 +
1168     -    228 +### Operations per Second
1169     -    229 +
1170     -    230 +| Operation Type | Operations/Second |
1171     -    231 +|---------------|-------------------|
1172     -    232 +| Simple arithmetic | ~10‚Åπ |
1173     -    233 +| Array access | ~10‚Å∏ - 10‚Åπ |
1174     -    234 +| Vector operations | ~10‚Å∏ |
1175     -    235 +| Set/Map operations | ~10‚Å∑ |
1176     -    236 +| String operations | ~10‚Å∑ |
1177     -    237 +| I/O (cin/cout) | ~10‚Å∂ (without fast I/O) |
1178     -    238 +| I/O (fast I/O) | ~10‚Å∑ |
1179     -    239 +
1180     -    240 +### Maximum n for Time Limits
1181     -    241 +
1182     -    242 +| Time Limit | O(n) | O(n log n) | O(n¬≤) | O(n¬≥) | O(2‚Åø) |
1183     -    243 +|------------|------|------------|-------|-------|-------|
1184     -    244 +| 1 second | 10‚Å∏ | 10‚Å∂-10‚Å∑ | 10‚Å¥ | 500 | 25 |
1185     -    245 +| 2 seconds | 2√ó10‚Å∏ | 2√ó10‚Å∑ | 1.4√ó10‚Å¥ | 600 | 26 |
1186     -    246 +| 5 seconds | 5√ó10‚Å∏ | 5√ó10‚Å∑ | 2√ó10‚Å¥ | 800 | 28 |
1187     -    247 +
1188     -    248 +### Quick Complexity Check
1189     -    249 +
1190     -    250 +```cpp
1191     -    251 +// Given n, what's the max acceptable complexity?
1192     -    252 +n ‚â§ 10     ‚Üí O(n!) or O(2‚Åø) OK
1193     -    253 +n ‚â§ 20     ‚Üí O(2‚Åø) OK, O(n!) too slow
1194     -    254 +n ‚â§ 100    ‚Üí O(n¬≥) OK
1195     -    255 +n ‚â§ 1000   ‚Üí O(n¬≤) OK
1196     -    256 +n ‚â§ 10‚Åµ    ‚Üí O(n log n) or better
1197     -    257 +n ‚â§ 10‚Å∂    ‚Üí O(n log n) risky, O(n) preferred
1198     -    258 +n ‚â§ 10‚Å∏    ‚Üí O(n) only
1199     -    259 +```
1200     -    260 +
1201     -    261 +### Reverse: Given Complexity, Max n
1202     -    262 +
1203     -    263 +| Complexity | Max n (1 sec) |
1204     -    264 +|------------|---------------|
1205     -    265 +| O(n!) | n ‚â§ 10 |
1206     -    266 +| O(2‚Åø) | n ‚â§ 20-25 |
1207     -    267 +| O(n¬≥) | n ‚â§ 500 |
1208     -    268 +| O(n¬≤ log n) | n ‚â§ 1000 |
1209     -    269 +| O(n¬≤) | n ‚â§ 5000-10000 |
1210     -    270 +| O(n‚àön) | n ‚â§ 10‚Åµ |
1211     -    271 +| O(n log n) | n ‚â§ 10‚Å∂-10‚Å∑ |
1212     -    272 +| O(n) | n ‚â§ 10‚Å∏ |
1213     -    273 +| O(log n) | n ‚â§ 10¬π‚Å∏ |
1214     -    274 +| O(1) | n = anything |
1215     -    275 +
1216     -    276 +---
1217     -    277 +
1218     -    278 +## üíæ Space Complexity Limits
1219     -    279 +
1220     -    280 +### Memory Calculation
1221     -    281 +
1222     -    282 +```cpp
1223     -    283 +// Typical memory limits
1224     -    284 +256 MB = 256 √ó 10‚Å∂ bytes = 64 √ó 10‚Å∂ ints
1225     -    285 +512 MB = 512 √ó 10‚Å∂ bytes = 128 √ó 10‚Å∂ ints
1226     -    286 +
1227     -    287 +// Stack vs Heap
1228     -    288 +// Stack: Limited (~1-8 MB) - local variables, recursion
1229     -    289 +// Heap: Limited by problem constraint - new, vector
1230     -    290 +
1231     -    291 +// Recursion depth limit (stack)
1232     -    292 +// ~10‚Å¥ - 10‚Åµ calls typically safe
1233     -    293 +// Deep recursion may cause stack overflow!
1234     -    294 +
1235     -    295 +// Tail recursion or iteration preferred for deep recursion
1236     -    296 +```
1237     -    297 +
1238     -    298 +### Data Structure Space
1239     -    299 +
1240     -    300 +| Structure | Space | Example |
1241     -    301 +|-----------|-------|---------|
1242     -    302 +| Array of n ints | 4n bytes | n = 10‚Å∂ ‚Üí 4 MB |
1243     -    303 +| n √ó n int matrix | 4n¬≤ bytes | n = 5000 ‚Üí 100 MB |
1244     -    304 +| Adjacency list | O(V + E) | |
1245     -    305 +| Adjacency matrix | O(V¬≤) | |
1246     -    306 +| Binary tree (n nodes) | ~32n bytes | Node + 2 pointers |
1247     -    307 +| Graph (V vertices, E edges) | V + E | Adjacency list |
1248     -    308 +
1249     -    309 +---
1250     -    310 +
1251     -    311 +## üî¢ Common Primes & Mathematical Constants
1252     -    312 +
1253     -    313 +### Primes to Know
1254     -    314 +
1255     -    315 +```cpp
1256     -    316 +// For modular arithmetic
1257     -    317 +10‚Åπ + 7 = 1,000,000,007  // Most common modulo (prime)
1258     -    318 +10‚Åπ + 9 = 1,000,000,009  // Alternative (prime)
1259     -    319 +998244353                 // NTT prime (2¬≤¬≥ √ó 7 √ó 17 + 1)
1260     -    320 +
1261     -    321 +// Small primes for hashing
1262     -    322 +31, 37, 53, 97, 131, 1009, 10007
1263     -    323 +
1264     -    324 +// For string hashing (rolling hash)
1265     -    325 +base = 31 or 37 (for lowercase letters)
1266     -    326 +base = 53 (for mixed case)
1267     -    327 +mod = 10‚Åπ + 7 or 10‚Åπ + 9
1268     -    328 +
1269     -    329 +// Largest prime ‚â§ n
1270     -    330 +// Under 100: 97
1271     -    331 +// Under 1000: 997
1272     -    332 +// Under 10000: 9973
1273     -    333 +// Under 10‚Åµ: 99991
1274     -    334 +// Under 10‚Å∂: 999983
1275     -    335 +// Under 10‚Åπ: 999999937
1276     -    336 +```
1277     -    337 +
1278     -    338 +### Mathematical Constants
1279     -    339 +
1280     -    340 +```cpp
1281     -    341 +// For geometry and floating point
1282     -    342 +const double PI = acos(-1);        // 3.14159265358979...
1283     -    343 +const double PI = 3.14159265358979323846;
1284     -    344 +const double E = exp(1);           // 2.71828...
1285     -    345 +
1286     -    346 +// For comparison (floating point tolerance)
1287     -    347 +const double EPS = 1e-9;
1288     -    348 +if (abs(a - b) < EPS) // a == b
1289     -    349 +
1290     -    350 +// For "infinity" in algorithms
1291     -    351 +const int INF = 1e9;           // For int (won't overflow on add)
1292     -    352 +const int INF = INT_MAX / 2;   // Safe for addition
1293     -    353 +const long long INF = 1e18;    // For long long
1294     -    354 +const long long INF = LLONG_MAX / 2;
1295     -    355 +```
1296     -    356 +
1297     -    357 +### Useful Mathematical Facts
1298     -    358 +
1299     -    359 +```cpp
1300     -    360 +// Factorials
1301     -    361 +10! = 3,628,800             // Fits in int
1302     -    362 +12! = 479,001,600           // Last to fit in int
1303     -    363 +13! = 6,227,020,800         // Needs long long
1304     -    364 +20! ‚âà 2.4 √ó 10¬π‚Å∏            // Last to fit in long long
1305     -    365 +21! overflows long long!
1306     -    366 +
1307     -    367 +// Powers of 2
1308     -    368 +2¬π‚Å∞ = 1,024 ‚âà 10¬≥
1309     -    369 +2¬≤‚Å∞ = 1,048,576 ‚âà 10‚Å∂
1310     -    370 +2¬≥‚Å∞ = 1,073,741,824 ‚âà 10‚Åπ
1311     -    371 +2¬≥¬≤ = 4,294,967,296 ‚âà 4 √ó 10‚Åπ (unsigned int max + 1)
1312     -    372 +2‚Å∂‚Å¥ ‚âà 1.8 √ó 10¬π‚Åπ
1313     -    373 +
1314     -    374 +// Fibonacci
1315     -    375 +F(45) = 1,134,903,170       // Last to fit in int
1316     -    376 +F(92) = 7,540,113,804,746,346,429  // Last to fit in long long
1317     -    377 +
1318     -    378 +// Catalan numbers (combinatorics)
1319     -    379 +C(17) = 129,644,790         // Fits in int
1320     -    380 +C(35) = 3,116,285,494,907,301,262  // Fits in long long
1321     -    381 +```
1322     -    382 +
1323     -    383 +---
1324     -    384 +
1325     -    385 +## ‚úÖ Edge Cases Checklist
1326     -    386 +
1327     -    387 +### Array/Vector Edge Cases
1328     -    388 +
1329     -    389 +```cpp
1330     -    390 +// Always test:
1331     -    391 +‚ñ° Empty array (n = 0)
1332     -    392 +‚ñ° Single element (n = 1)
1333     -    393 +‚ñ° Two elements (n = 2)
1334     -    394 +‚ñ° All same elements
1335     -    395 +‚ñ° Already sorted (ascending)
1336     -    396 +‚ñ° Reverse sorted (descending)
1337     -    397 +‚ñ° Maximum size (n = max constraint)
1338     -    398 +‚ñ° Negative numbers
1339     -    399 +‚ñ° Zero values
1340     -    400 +‚ñ° INT_MAX / INT_MIN values
1341     -    401 +‚ñ° Duplicates at boundaries
1342     -    402 +```
1343     -    403 +
1344     -    404 +### String Edge Cases
1345     -    405 +
1346     -    406 +```cpp
1347     -    407 +// Always test:
1348     -    408 +‚ñ° Empty string (s = "")
1349     -    409 +‚ñ° Single character (s = "a")
1350     -    410 +‚ñ° All same character (s = "aaa")
1351     -    411 +‚ñ° Palindrome
1352     -    412 +‚ñ° All unique characters
1353     -    413 +‚ñ° Maximum length
1354     -    414 +‚ñ° Spaces/special characters (if allowed)
1355     -    415 +‚ñ° Case sensitivity (if relevant)
1356     -    416 +```
1357     -    417 +
1358     -    418 +### Graph Edge Cases
1359     -    419 +
1360     -    420 +```cpp
1361     -    421 +// Always test:
1362     -    422 +‚ñ° Empty graph (no edges)
1363     -    423 +‚ñ° Single node
1364     -    424 +‚ñ° Disconnected graph
1365     -    425 +‚ñ° Complete graph
1366     -    426 +‚ñ° Tree (n-1 edges)
1367     -    427 +‚ñ° Cycle
1368     -    428 +‚ñ° Self-loop (if allowed)
1369     -    429 +‚ñ° Multiple edges between same nodes
1370     -    430 +‚ñ° Negative edge weights (if allowed)
1371     -    431 +‚ñ° All edges same weight
1372     -    432 +```
1373     -    433 +
1374     -    434 +### Tree Edge Cases
1375     -    435 +
1376     -    436 +```cpp
1377     -    437 +// Always test:
1378     -    438 +‚ñ° Empty tree (null root)
1379     -    439 +‚ñ° Single node
1380     -    440 +‚ñ° Skewed tree (all left or all right)
1381     -    441 +‚ñ° Perfect/complete binary tree
1382     -    442 +‚ñ° Maximum depth
1383     -    443 +‚ñ° All same values
1384     -    444 +‚ñ° Negative values (if allowed)
1385     -    445 +```
1386     -    446 +
1387     -    447 +### Number Edge Cases
1388     -    448 +
1389     -    449 +```cpp
1390     -    450 +// Always test:
1391     -    451 +‚ñ° Zero (0)
1392     -    452 +‚ñ° Negative zero (-0 for floating point)
1393     -    453 +‚ñ° INT_MAX (2,147,483,647)
1394     -    454 +‚ñ° INT_MIN (-2,147,483,648)
1395     -    455 +‚ñ° Powers of 2
1396     -    456 +‚ñ° One less than power of 2
1397     -    457 +‚ñ° Prime numbers
1398     -    458 +‚ñ° Perfect squares
1399     -    459 +‚ñ° Negative numbers
1400     -    460 +‚ñ° Very small positive (1)
1401     -    461 +‚ñ° Very large (max constraint)
1402     -    462 +```
1403     -    463 +
1404     -    464 +### Binary Search Edge Cases
1405     -    465 +
1406     -    466 +```cpp
1407     -    467 +// Always test:
1408     -    468 +‚ñ° Target at index 0
1409     -    469 +‚ñ° Target at last index
1410     -    470 +‚ñ° Target not in array
1411     -    471 +‚ñ° Target smaller than all elements
1412     -    472 +‚ñ° Target larger than all elements
1413     -    473 +‚ñ° All elements are target
1414     -    474 +‚ñ° Single element equals target
1415     -    475 +‚ñ° Single element doesn't equal target
1416     -    476 +‚ñ° Two elements
1417     -    477 +```
1418     -    478 +
1419     -    479 +---
1420     -    480 +
1421     -    481 +## üñ•Ô∏è Platform-Specific Constraints
1422     -    482 +
1423     -    483 +### LeetCode
1424     -    484 +
1425     -    485 +```cpp
1426     -    486 +// Typical constraints
1427     -    487 +n ‚â§ 10‚Åµ (most problems)
1428     -    488 +n ‚â§ 10¬≥ (allows O(n¬≤))
1429     -    489 +n ‚â§ 10‚Å¥ (O(n¬≤) risky)
1430     -    490 +Values: -10‚Åπ to 10‚Åπ (fits in int)
1431     -    491 +
1432     -    492 +// Time limit: Usually generous
1433     -    493 +// Memory: 256 MB typical
1434     -    494 +
1435     -    495 +// Fast I/O not needed (uses function calls)
1436     -    496 +```
1437     -    497 +
1438     -    498 +### Codeforces
1439     -    499 +
1440     -    500 +```cpp
1441     -    501 +// Typical constraints
1442     -    502 +n ‚â§ 2 √ó 10‚Åµ (common)
1443     -    503 +n ‚â§ 10‚Å∂ (harder problems)
1444     -    504 +Time: 1-2 seconds
1445     -    505 +Memory: 256 MB (standard)
1446     -    506 +
1447     -    507 +// Fast I/O REQUIRED for large input
1448     -    508 +ios::sync_with_stdio(false);
1449     -    509 +cin.tie(nullptr);
1450     -    510 +```
1451     -    511 +
1452     -    512 +### HackerRank
1453     -    513 +
1454     -    514 +```cpp
1455     -    515 +// Varies by problem
1456     -    516 +// Often has multiple test cases
1457     -    517 +// Time limits can be strict
1458     -    518 +// Fast I/O recommended
1459     -    519 +
1460     -    520 +// Multiple test cases pattern
1461     -    521 +int t;
1462     -    522 +cin >> t;
1463     -    523 +while (t--) {
1464     -    524 +    // solve
1465     -    525 +}
1466     -    526 +```
1467     -    527 +
1468     -    528 +### Google/FAANG Interviews
1469     -    529 +
1470     -    530 +```cpp
1471     -    531 +// Focus on:
1472     -    532 +- Optimal time complexity
1473     -    533 +- Clean, readable code
1474     -    534 +- Handle all edge cases
1475     -    535 +- Discuss trade-offs
1476     -    536 +
1477     -    537 +// Typical expectations:
1478     -    538 +n ‚â§ 10‚Åµ to 10‚Å∂
1479     -    539 +Time: O(n) or O(n log n)
1480     -    540 +Space: O(1) to O(n)
1481     -    541 +```
1482     -    542 +
1483     -    543 +---
1484     -    544 +
1485     -    545 +## üìã Quick Reference Cheatsheet
1486     -    546 +
1487     -    547 +### Numbers to Memorize
1488     -    548 +
1489     -    549 +| Value | Meaning | Use Case |
1490     -    550 +|-------|---------|----------|
1491     -    551 +| 10‚Åπ | ~INT_MAX / 2 | Safe int limit |
1492     -    552 +| 2 √ó 10‚Åπ | ~INT_MAX | Max positive int |
1493     -    553 +| 10¬π‚Å∏ | ~LLONG_MAX / 9 | Safe long long |
1494     -    554 +| 10‚Åπ + 7 | Common modulo | Modular arithmetic |
1495     -    555 +| 10‚Åµ | Typical n limit | O(n log n) problems |
1496     -    556 +| 10‚Å¥ | O(n¬≤) threshold | When O(n¬≤) is OK |
1497     -    557 +| 20-25 | 2‚Åø threshold | Bitmask/subset problems |
1498     -    558 +| 10 | n! threshold | Permutation problems |
1499     -    559 +
1500     -    560 +### Quick Type Selection
1501     -    561 +
1502     -    562 +```cpp
1503     -    563 +// Default
1504     -    564 +int x;                  // Values ‚â§ 10‚Åπ
1505     -    565 +
1506     -    566 +// Large values
1507     -    567 +long long x;           // Values > 2√ó10‚Åπ
1508     -    568 +
1509     -    569 +// Large sums
1510     -    570 +long long sum = 0;     // Sum of many ints
1511     -    571 +
1512     -    572 +// Products
1513     -    573 +long long prod = 1LL * a * b;  // Multiply ints
1514     -    574 +
1515     -    575 +// Modular
1516     -    576 +const int MOD = 1e9 + 7;
1517     -    577 +((1LL * a * b) % MOD)
1518     -    578 +```
1519     -    579 +
1520     -    580 +### Fast I/O Template
1521     -    581 +
1522     -    582 +```cpp
1523     -    583 +#include <bits/stdc++.h>
1524     -    584 +using namespace std;
1525     -    585 +
1526     -    586 +int main() {
1527     -    587 +    ios::sync_with_stdio(false);
1528     -    588 +    cin.tie(nullptr);
1529     -    589 +
1530     -    590 +    // Your code here
1531     -    591 +
1532     -    592 +    return 0;
1533     -    593 +}
1534     -    594 +```
1535     -    595 +
1536     -    596 +### Infinity Values
1537     -    597 +
1538     -    598 +```cpp
1539     -    599 +// For shortest path, DP
1540     -    600 +const int INF = 1e9;           // int infinity
1541     -    601 +const long long INF = 1e18;    // long long infinity
1542     -    602 +
1543     -    603 +// For comparisons (safe for addition)
1544     -    604 +const int INF = INT_MAX / 2;
1545     -    605 +const long long INF = LLONG_MAX / 2;
1546     -    606 +```
1547     -    607 +
1548     -    608 +---
1549     -    609 +
1550     -    610 +## üéØ Interview Tips
1551     -    611 +
1552     -    612 +1. **Always ask for constraints first** - Determines algorithm choice
1553     -    613 +2. **State assumptions explicitly** - "I'm assuming n ‚â§ 10‚Åµ"
1554     -    614 +3. **Check for overflow** - Especially with multiplication and sums
1555     -    615 +4. **Use appropriate data types** - `long long` when in doubt
1556     -    616 +5. **Test edge cases mentally** - Before coding, walk through edge cases
1557     -    617 +6. **Know your constants** - INT_MAX, 10‚Åπ+7, complexity thresholds
1558     -    618 +
1559     -    619 +---
1560     -    620 +
1561     -    621 +*Last Updated: December 19, 2025*
1562     -    622  
    1456 +    117 +*   **Why?** It is technically robust, legally safest (clean separation of domestic vs international funds), and offers the best user experience.
    1457 +    118 +*   **Cost:** $0.
    1458 +    119 +*   **Effort:** ~1 hour to write the HTML/JS for the landing page.
    1459 +    120 +
    1460 +    121 +### Sample Code Snippet (Concept)
    1461 +    122 +```javascript
    1462 +    123 +async function renderDonationOptions() {
    1463 +    124 +  const response = await fetch('https://ipapi.co/json/');
    1464 +    125 +  const data = await response.json();
    1465 +    126 +
    1466 +    127 +  if (data.country_code === 'IN') {
    1467 +    128 +    // Show Razorpay UI
    1468 +    129 +    document.getElementById('currency').innerText = 'INR';
    1469 +    130 +    document.getElementById('presets').innerHTML =
    1470 +    131 +      '<button>‚Çπ50</button><button>‚Çπ100</button>';
    1471 +    132 +    document.getElementById('payment-link').href = 'https://rzp.io/l/your-link';
    1472 +    133 +  } else {
    1473 +    134 +    // Show PayPal/Ko-fi UI
    1474 +    135 +    document.getElementById('currency').innerText = 'USD';
    1475 +    136 +    document.getElementById('presets').innerHTML =
    1476 +    137 +      '<button>$1</button><button>$5</button>';
    1477 +    138 +    document.getElementById('payment-link').href = 'https://ko-fi.com/your-id';
    1478 +    139 +  }
    1479 +    140 +}
    1480 +    141 +```
    1481 +    142  
    1482 +
    1483 +```
    1484 +
    1485 +
    1486 +### ‚ú® `docs/01-requirements/donation_technical_feasibility_review.md` **[ADDED]**
    1487 +
    1488 +**Status:** ‚úÖ **NEW FILE** - This file has been newly created
    1489 +
    1490 +**Type:** Documentation üìñ
    1491 +
    1492 +```diff
    1493 +@@ -0,0 +1,87 @@
    1494 +      1 +# Technical & Feasibility Review: Donation Feature Plan v2.0
    1495 +      2 +
    1496 +      3 +**Reviewer:** Senior Principal SDE, Platform Engineering
    1497 +      4 +**Date:** 2025-12-19
    1498 +      5 +**Scope:** Strict Technical, Scalability, and Feasibility Audit
    1499 +      6 +**Target Document:** `docs/01-requirements/donation-feature-plan.md`
    1500 +      7 +
    1501 +      8 +---
    1502 +      9 +
    1503 +     10 +## 1. Executive Summary
    1504 +     11 +
    1505 +     12 +The proposed "Static Badge Approach" (Phase 2) is **Technically Sound** and **Highly Scalable**. However, the optional "IP-based Smart Routing" (Phase 3) introduces significant **Hidden Technical Debt** and **Failure Modes** that are not adequately addressed in the current plan.
    1506 +     13 +
    1507 +     14 +**Verdict:**
    1508 +     15 +*   **Static Badges (README):** ‚úÖ **APPROVED**. (Rating: Low Risk, High Value)
    1509 +     16 +*   **Smart Routing (Web App):** ‚ö†Ô∏è **CONDITIONAL APPROVAL**. (Rating: Medium Risk, Maintenance Burden)
    1510 +     17 +
    1511 +     18 +---
    1512 +     19 +
    1513 +     20 +## 2. Critical Technical Concerns (Bugs & Scalability)
    1514 +     21 +
    1515 +     22 +### 2.1 The "Free API" Trap (Scalability Risk)
    1516 +     23 +*   **Concern:** The design suggests using `ipapi.co` (Free Tier).
    1517 +     24 +*   **Risk:** Free tiers have rate limits (e.g., 1000 requests/day). If the app (or even the GitHub page if JS is used) goes viral or gets crawled by bots, the API will return `429 Too Many Requests`.
    1518 +     25 +*   **Failure Mode:** The "Donate" button logic fails; users might see *nothing* or a broken spinner.
    1519 +     26 +*   **Mitigation:** Must implement a **Fail-Open Strategy**. If the API fails/timeouts, DEFAULT to the Global (USD/PayPal) view immediately. Do not block rendering.
    1520 +     27 +
    1521 +     28 +### 2.2 Razorpay International Friction (UX Bug)
    1522 +     29 +*   **Concern:** Routing *all* Indian IPs to Razorpay assumes Razorpay accepts *all* payments smoothly.
    1523 +     30 +*   **Bug:** While Razorpay handles domestic UPI perfectly, international cards (e.g., an NRI relative visiting India, or a user on a corporate VPN routing through Bangalore) often face high failure rates on Razorpay unless "International Payments" is explicitly enabled and KYC'd (which is harder for individuals).
    1524 +     31 +*   **Impact:** A user willing to pay $50 via Amex might bounce because Razorpay declines non-Indian issued cards on personal accounts.
    1525 +     32 +
    1526 +     33 +### 2.3 The "VPN Paradox" (Edge Case)
    1527 +     34 +*   **Scenario:** A user in the US uses a VPN to India (to watch Hotstar, etc.) and visits your repo.
    1528 +     35 +*   **Result:** They see "UPI/‚Çπ". They don't have UPI. They leave.
    1529 +     36 +*   **Fix:** The UI **MUST** provide a "Not in India?" toggle or "Show International Options" link even if IP detection says India. **Never soft-lock a user into a geographically assumed payment method.**
    1530 +     37 +
    1531 +     38 +---
    1532 +     39 +
    1533 +     40 +## 3. Maintenance & Long-term Viability Analysis
    1534 +     41 +
    1535 +     42 +### 3.1 Link Rot & Platform Decay
    1536 +     43 +*   **Observation:** Startups (like Ko-fi or BMAC) change terms or get acquired.
    1537 +     44 +*   **Recommendation:** Use a **Redirect Service** or reliable URL shortener (e.g., `yoursite.com/go/donate-inr`) instead of hardcoding `razorpay.me/...` directly in 100 source files. This allows you to switch from Razorpay to LemonSqueezy tomorrow without a PR.
    1538 +     45 +
    1539 +     46 +### 3.2 GitHub Sponsors Approval Latency
    1540 +     47 +*   **Reality Check:** GitHub Sponsors is not instant. It can take 2-4 weeks for approval.
    1541 +     48 +*   **Blocker:** If you deploy the badge before approval, users see a "404" or "Not Enabled" page.
    1542 +     49 +*   **Correction:** Phase 2 must explicitly state: "Deploy GitHub Sponsors badge *only after* approval email is received."
    1543 +     50 +
    1544 +     51 +---
    1545 +     52 +
    1546 +     53 +## 4. Strict "Principle SDE" Recommendations
    1547 +     54 +
    1548 +     55 +To elevate this plan to Enterprise Grade:
    1549 +     56 +
    1550 +     57 +1.  **Enforce "Fail-Safe" Default:**
    1551 +     58 +    - The code structure for Phase 3 must be:
    1552 +     59 +      ```javascript
    1553 +     60 +      // DEFAULT: Global
    1554 +     61 +      let showInd = false;
    1555 +     62 +      try {
    1556 +     63 +         // Race condition: Timeout after 300ms. Don't let a slow IP API slow down the footer.
    1557 +     64 +         const data = await Promise.race([fetchIP(), timeout(300)]);
    1558 +     65 +         if (data.country === 'IN') showInd = true;
    1559 +     66 +      } catch (e) {
    1560 +     67 +         // Silently fail to Global
    1561 +     68 +      }
    1562 +     69 +      ```
    1563 +     70 +
    1564 +     71 +2.  **Taxonomy cleanup:**
    1565 +     72 +    - Stop using the word "Donation" anywhere visible if you are not an 80G registered Non-Profit.
    1566 +     73 +    - Use **"Sponsorship"** or **"Support"** exclusively. This is a legal safeguards against "Misleading Claims" (Consumer Protection Act).
    1567 +     74 +
    1568 +     75 +3.  **Data Minimization:**
    1569 +     76 +    - Ensure the IP Geo-lookup is *client-side only* (browser calls API directly). Do not proxy this through your own backend unless you want to deal with GDPR/CCPA compliance for logging user IPs.
    1570 +     77 +
    1571 +     78 +---
    1572 +     79 +
    1573 +     80 +## 5. Revised Implementation Roadmap
    1574 +     81 +
    1575 +     82 +**Step 1:** Add **Static Badges** (Ko-fi & Razorpay) to `README.md` immediately.
    1576 +     83 +**Step 2:** Apply for GitHub Sponsors (Wait list).
    1577 +     84 +**Step 3:** (Low Priority) Add Smart Routing to Web App **only if** you can guarantee <300ms latency and fail-safe defaults.
    1578 +     85 +
    1579 +     86 +**Signed-off with Conditions.**
    1580 +     87 +*Sr. Principal SDE, Infrastructure*
    1581 +     88  
    1582 +
    1583 +```
    1584 +
    1585 +
    1586 +### üìÑ `index.html`
    1587 +
    1588 +**Type:** HTML Template üåê
    1589 +
    1590 +```diff
    1591 +@@ -337,12 +337,22 @@
    1592 +337 337  
    1593 +338 338      <!-- Footer -->
    1594 +339 339      <footer class="app-footer">
    1595 +340     -      Made with ‚ù§Ô∏è by Prax Lannister | Follow me on
    1596 +341     -      <a href="https://github.com/PrakharMNNIT" target="_blank" rel="noopener noreferrer">GitHub</a>
    1597 +342     -      &
    1598 +343     -      <a href="https://x.com/ByteByByteSrSDE" target="_blank" rel="noopener noreferrer"
    1599 +344     -        >X (Twitter)</a
    1600 +345     -      >
    1601 +    340 +      <div class="footer-content">
    1602 +    341 +        <span>Made with ‚ù§Ô∏è by Prax Lannister</span>
    1603 +    342 +        <span class="footer-separator">|</span>
    1604 +    343 +        <span>Follow me on
    1605 +    344 +          <a href="https://github.com/PrakharMNNIT" target="_blank" rel="noopener noreferrer">GitHub</a>
    1606 +    345 +          &amp;
    1607 +    346 +          <a href="https://x.com/ByteByByteSrSDE" target="_blank" rel="noopener noreferrer">X (Twitter)</a>
    1608 +    347 +        </span>
    1609 +    348 +        <span class="footer-separator">|</span>
    1610 +    349 +        <div class="support-widget-container" id="support-widget">
    1611 +    350 +          <!-- Skeleton loader - will be replaced by JS -->
    1612 +    351 +          <a href="https://ko-fi.com/praxlannister?ref=webapp_footer" target="_blank" rel="noopener noreferrer" class="support-button support-button--loading">
    1613 +    352 +            ‚òï Support
    1614 +    353 +          </a>
    1615 +    354 +        </div>
    1616 +    355 +      </div>
    1617 +346 356      </footer>
    1618 +347 357  
    1619 +348 358      <!-- PDF Preview Modal -->
    1620 +349 359  
1563 1621  
1564 1622  ```
1565 1623  
@@ -1569,290 +1627,128 @@
1569 1627  **Type:** JavaScript Source File üü®
1570 1628  
1571 1629  ```diff
1572     -@@ -29,6 +29,242 @@ window.katex = katex;
1573     - 29  29  window.html2pdf = html2pdf;
1574     - 30  30  window.markedFootnote = markedFootnote;
1575     - 31  31  
1576     -     32 +// ==================== ANCHOR NAVIGATION ====================
1577     -     33 +// Heading slug tracking (module-level singleton for marked.js singleton)
1578     -     34 +const headingSlugMap = new Map();
1579     -     35 +
1580     -     36 +// Pre-compiled slug replacements (zero GC pressure per render)
1581     -     37 +const SLUG_REPLACEMENTS = [
1582     -     38 +  [/c\+\+/gi, 'cpp'],
1583     -     39 +  [/c#/gi, 'csharp'],
1584     -     40 +  [/f#/gi, 'fsharp'],
1585     -     41 +  [/\.net/gi, 'dotnet'],
1586     -     42 +];
1587     -     43 +
1588     -     44 +/**
1589     -     45 + * Reset slug map (call before each parse)
1590     -     46 + */
1591     -     47 +function resetSlugMap() {
1592     -     48 +  headingSlugMap.clear();
1593     -     49 +}
1594     -     50 +
1595     -     51 +/**
1596     -     52 + * Generate URL-safe slug from heading text
1597     -     53 + * @param {string} text - Raw heading text (may include HTML)
1598     -     54 + * @param {Map<string, number>} seen - Duplicate tracking map
1599     -     55 + * @returns {string} URL-safe slug
1600     -     56 + */
1601     -     57 +function generateSlug(text, seen = headingSlugMap) {
1602     -     58 +  // Strip HTML tags
1603     -     59 +  let slug = text.replace(/<[^>]*>/g, '');
1604     -     60 +
1605     -     61 +  // Normalize Unicode
1606     -     62 +  slug = slug.normalize('NFC').toLowerCase();
1607     -     63 +
1608     -     64 +  // Replace programming terms (pre-compiled patterns)
1609     -     65 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
1610     -     66 +    slug = slug.replace(pattern, replacement);
1611     -     67 +  }
1612     -     68 +
1613     -     69 +  // Clean up: remove non-word chars, spaces to hyphens, collapse hyphens
1614     -     70 +  slug = slug
1615     -     71 +    .replace(/[^\w\s-]/g, '')
1616     -     72 +    .replace(/\s+/g, '-')
1617     -     73 +    .replace(/-+/g, '-')
1618     -     74 +    .replace(/^-+|-+$/g, '');
1619     -     75 +
1620     -     76 +  // Fallback for empty result
1621     -     77 +  if (!slug) slug = 'section';
1622     -     78 +
1623     -     79 +  // Handle duplicates (header, header-1, header-2)
1624     -     80 +  const baseSlug = slug;
1625     -     81 +  const count = seen.get(baseSlug) || 0;
1626     -     82 +  if (count > 0) slug = `${baseSlug}-${count}`;
1627     -     83 +  seen.set(baseSlug, count + 1);
1628     -     84 +
1629     -     85 +  return slug;
1630     -     86 +}
1631     -     87 +
1632     -     88 +/**
1633     -     89 + * Anchor Navigation Module
1634     -     90 + * Handles in-document anchor navigation with scoped selection
1635     -     91 + */
1636     -     92 +const AnchorNavigation = {
1637     -     93 +  container: null,
1638     -     94 +  pendingScroll: null,
1639     -     95 +
1640     -     96 +  /**
1641     -     97 +   * Initialize anchor navigation
1642     -     98 +   * @param {HTMLElement} previewContainer - Scrollable preview container
1643     -     99 +   */
1644     -    100 +  init(previewContainer) {
1645     -    101 +    this.container = previewContainer;
1646     -    102 +
1647     -    103 +    // Event delegation for anchor clicks
1648     -    104 +    this.container.addEventListener('click', this.handleClick.bind(this));
1649     -    105 +
1650     -    106 +    // Browser back/forward navigation
1651     -    107 +    window.addEventListener('hashchange', this.handleHashChange.bind(this));
1652     -    108 +
1653     -    109 +    // Initial page load with hash
1654     -    110 +    if (window.location.hash) {
1655     -    111 +      requestAnimationFrame(() => {
1656     -    112 +        this.scrollToHash(window.location.hash.slice(1), false);
1657     -    113 +      });
1658     -    114 +    }
1659     -    115 +
1660     -    116 +    console.log('‚úÖ Anchor navigation initialized');
1661     -    117 +  },
1662     -    118 +
1663     -    119 +  /**
1664     -    120 +   * Handle click events (delegated)
1665     -    121 +   */
1666     -    122 +  handleClick(event) {
1667     -    123 +    const link = event.target.closest('a[href^="#"]');
1668     -    124 +    if (!link) return;
1669     -    125 +
1670     -    126 +    // Ignore external links
1671     -    127 +    if (link.hostname && link.hostname !== window.location.hostname) return;
1672     -    128 +
1673     -    129 +    event.preventDefault();
1674     -    130 +
1675     -    131 +    const hash = link.getAttribute('href').slice(1);
1676     -    132 +    this.scrollToHash(hash, true);
1677     -    133 +
1678     -    134 +    // Update URL without triggering hashchange
1679     -    135 +    history.pushState(null, '', `#${hash}`);
1680     -    136 +  },
1681     -    137 +
1682     -    138 +  /**
1683     -    139 +   * Handle hashchange (browser back/forward)
1684     -    140 +   */
1685     -    141 +  handleHashChange() {
1686     -    142 +    const hash = window.location.hash.slice(1);
1687     -    143 +    if (hash) {
1688     -    144 +      this.scrollToHash(hash, true);
1689     -    145 +    } else {
1690     -    146 +      this.scrollToTop(true);
1691     -    147 +    }
1692     -    148 +  },
1693     -    149 +
1694     -    150 +  /**
1695     -    151 +   * Scroll to element by hash
1696     -    152 +   * @param {string} hash - URL hash (without #)
1697     -    153 +   * @param {boolean} smooth - Use smooth scrolling
1698     -    154 +   */
1699     -    155 +  scrollToHash(hash, smooth = true) {
1700     -    156 +    // Cancel pending scroll (handle concurrent clicks)
1701     -    157 +    if (this.pendingScroll) {
1702     -    158 +      clearTimeout(this.pendingScroll);
1703     -    159 +      this.pendingScroll = null;
1704     -    160 +    }
1705     -    161 +
1706     -    162 +    if (!hash) {
1707     -    163 +      this.scrollToTop(smooth);
1708     -    164 +      return;
1709     -    165 +    }
1710     -    166 +
1711     -    167 +    const target = this.resolveTarget(hash);
1712     -    168 +    if (!target) return;
1713     -    169 +
1714     -    170 +    target.scrollIntoView({
1715     -    171 +      behavior: smooth ? 'smooth' : 'instant',
1716     -    172 +      block: 'start',
1717     -    173 +    });
1718     -    174 +
1719     -    175 +    this.manageFocus(target, smooth);
1720     -    176 +  },
1721     -    177 +
1722     -    178 +  /**
1723     -    179 +   * Scroll to top of container
1724     -    180 +   */
1725     -    181 +  scrollToTop(smooth = true) {
1726     -    182 +    this.container.scrollTo({
1727     -    183 +      top: 0,
1728     -    184 +      behavior: smooth ? 'smooth' : 'instant',
1729     -    185 +    });
1730     -    186 +  },
1731     -    187 +
1732     -    188 +  /**
1733     -    189 +   * Resolve target element - SCOPED to container (prevents app shell collision)
1734     -    190 +   * @param {string} hash - URL hash
1735     -    191 +   * @returns {Element|null} Target element or null
1736     -    192 +   */
1737     -    193 +  resolveTarget(hash) {
1738     -    194 +    if (!hash) return null;
1739     -    195 +
1740     -    196 +    // Decode URI components safely
1741     -    197 +    let decodedHash;
1742     -    198 +    try {
1743     -    199 +      decodedHash = decodeURIComponent(hash);
1744     -    200 +    } catch {
1745     -    201 +      decodedHash = hash;
1746     -    202 +    }
1747     -    203 +
1748     -    204 +    // Priority 1: Exact ID (SCOPED to container)
1749     -    205 +    let target = this.container.querySelector(`#${CSS.escape(decodedHash)}`);
1750     -    206 +    if (target) return target;
1751     -    207 +
1752     -    208 +    // Priority 2: Normalized ID (handles legacy links with emoji, special chars)
1753     -    209 +    const normalized = this.normalizeHash(decodedHash);
1754     -    210 +    target = this.container.querySelector(`#${CSS.escape(normalized)}`);
1755     -    211 +    if (target) return target;
1756     -    212 +
1757     -    213 +    console.warn(`[AnchorNav] Target not found: "${hash}"`);
1758     -    214 +    return null;
1759     -    215 +  },
1760     -    216 +
1761     -    217 +  /**
1762     -    218 +   * Normalize hash for legacy link matching
1763     -    219 +   * @param {string} hash - Raw hash string
1764     -    220 +   * @returns {string} Normalized hash
1765     -    221 +   */
1766     -    222 +  normalizeHash(hash) {
1767     -    223 +    let slug = hash.normalize('NFC').toLowerCase();
1768     -    224 +
1769     -    225 +    // Apply same transformations as generateSlug
1770     -    226 +    for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
1771     -    227 +      slug = slug.replace(pattern, replacement);
1772     -    228 +    }
1773     -    229 +
1774     -    230 +    return slug
1775     -    231 +      .replace(/[^\w\s-]/g, '')
1776     -    232 +      .replace(/\s+/g, '-')
1777     -    233 +      .replace(/-+/g, '-')
1778     -    234 +      .replace(/^-+|-+$/g, '') || 'section';
1779     -    235 +  },
1780     -    236 +
1781     -    237 +  /**
1782     -    238 +   * Manage focus after scroll (accessibility)
1783     -    239 +   * @param {Element} target - Target element
1784     -    240 +   * @param {boolean} smooth - Was smooth scroll used
1785     -    241 +   */
1786     -    242 +  manageFocus(target, smooth) {
1787     -    243 +    const focusTarget = () => {
1788     -    244 +      // Make heading focusable if not already
1789     -    245 +      if (!target.hasAttribute('tabindex')) {
1790     -    246 +        target.setAttribute('tabindex', '-1');
1791     -    247 +      }
1792     -    248 +      target.focus({ preventScroll: true });
1793     -    249 +    };
1794     -    250 +
1795     -    251 +    if (!smooth) {
1796     -    252 +      focusTarget();
1797     -    253 +      return;
1798     -    254 +    }
1799     -    255 +
1800     -    256 +    // Modern browsers: use scrollend event
1801     -    257 +    if ('onscrollend' in this.container) {
1802     -    258 +      this.container.addEventListener('scrollend', focusTarget, { once: true });
1803     -    259 +    } else {
1804     -    260 +      // Fallback: estimate scroll duration (max 1000ms for safety)
1805     -    261 +      const distance = Math.abs(target.getBoundingClientRect().top);
1806     -    262 +      const duration = Math.min(Math.max(distance / 2, 300), 1000);
1807     -    263 +      this.pendingScroll = setTimeout(focusTarget, duration + 50);
1808     -    264 +    }
1809     -    265 +  },
1810     -    266 +};
1811     -    267 +
1812     - 32 268  // Initialize services and managers
1813     - 33 269  const storageManager = new StorageManager();
1814     - 34 270  const themeManager = new ThemeManager(storageManager);
1815     -@@ -360,6 +596,19 @@ function configureMarkedExtensions() {
1816     -360 596    });
1817     -361 597  
1818     -362 598    console.log('‚úÖ Marked.js configured with all extensions (LaTeX, subscript, superscript)');
1819     -    599 +
1820     -    600 +  // Custom heading renderer with ID generation for anchor navigation
1821     -    601 +  marked.use({
1822     -    602 +    renderer: {
1823     -    603 +      heading(token) {
1824     -    604 +        const text = this.parser.parseInline(token.tokens);
1825     -    605 +        const level = token.depth;
1826     -    606 +        const slug = generateSlug(text, headingSlugMap);
1827     -    607 +        return `<h${level} id="${slug}">${text}</h${level}>\n`;
1828     -    608 +      }
1829     -    609 +    }
1830     -    610 +  });
1831     -    611 +  console.log('‚úÖ Custom heading renderer enabled (anchor navigation IDs)');
1832     -363 612  }
1833     -364 613  
1834     -365 614  // Initialize Mermaid using MermaidService (prefixed to indicate future use)
1835     -@@ -550,6 +799,9 @@ graph TD
1836     -550 799    // Render markdown (expose globally for theme changes)
1837     -551 800    function renderMarkdown() {
1838     -552 801      try {
1839     -    802 +      // Reset slug map before parsing (singleton-safe pattern)
1840     -    803 +      resetSlugMap();
1841     -    804 +
1842     -553 805        const markdownText = editor.value;
1843     -554 806  
1844     -555 807        // Parse markdown with all extensions
1845     -@@ -2001,6 +2253,9 @@ Wrap up your thoughts and include a call to action.
1846     -2001 2253    // Initialize expand button visibility on load
1847     -2002 2254    updateExpandButtonVisibility();
1848     -2003 2255  
1849     -    2256 +  // Initialize anchor navigation for TOC links
1850     -    2257 +  AnchorNavigation.init(previewContainer);
1851     -    2258 +
1852     -2004 2259    // DON'T render immediately - wait for theme to load
1853     -2005 2260    // renderMarkdown will be called after theme loads above
1854     -2006 2261  }
1855     -2007 2262  
    1630 +@@ -351,6 +351,120 @@ function initializeApp() {
    1631 +351 351  
    1632 +352 352    // Setup the editor
    1633 +353 353    setupEditor();
    1634 +    354 +
    1635 +    355 +  // Initialize support widget (donation button in footer)
    1636 +    356 +  initSupportWidget();
    1637 +    357 +}
    1638 +    358 +
    1639 +    359 +// ==================== SUPPORT WIDGET (DONATION ROUTER) ====================
    1640 +    360 +/**
    1641 +    361 + * Enterprise-grade geo-based donation routing
    1642 +    362 + * - 300ms timeout with fail-safe to global
    1643 +    363 + * - Session caching to avoid repeated API calls
    1644 +    364 + * - CLS mitigation via skeleton loader
    1645 +    365 + */
    1646 +    366 +const SUPPORT_TIMEOUT_MS = 300;
    1647 +    367 +const SUPPORT_FALLBACK_REGION = 'global';
    1648 +    368 +const SUPPORT_CACHE_KEY = 'support_user_region';
    1649 +    369 +
    1650 +    370 +/**
    1651 +    371 + * Detect user region with fail-safe pattern
    1652 +    372 + * @returns {Promise<string>} 'india' or 'global'
    1653 +    373 + */
    1654 +    374 +async function detectSupportRegion() {
    1655 +    375 +  // 1. Check session cache first (FR-1.4)
    1656 +    376 +  const cached = sessionStorage.getItem(SUPPORT_CACHE_KEY);
    1657 +    377 +  if (cached) {
    1658 +    378 +    console.log(`[SupportWidget] Using cached region: ${cached}`);
    1659 +    379 +    return cached;
    1660 +    380 +  }
    1661 +    381 +
    1662 +    382 +  try {
    1663 +    383 +    // 2. Race: Network vs Timeout (300ms)
    1664 +    384 +    const controller = new AbortController();
    1665 +    385 +    const timeoutId = setTimeout(() => controller.abort(), SUPPORT_TIMEOUT_MS);
    1666 +    386 +
    1667 +    387 +    const response = await fetch('https://ipapi.co/json/', {
    1668 +    388 +      signal: controller.signal,
    1669 +    389 +    });
    1670 +    390 +    clearTimeout(timeoutId);
    1671 +    391 +
    1672 +    392 +    const data = await response.json();
    1673 +    393 +    const region = data.country_code === 'IN' ? 'india' : 'global';
    1674 +    394 +
    1675 +    395 +    // 3. Cache result for session
    1676 +    396 +    sessionStorage.setItem(SUPPORT_CACHE_KEY, region);
    1677 +    397 +    console.log(`[SupportWidget] Detected region: ${region} (${data.country_code})`);
    1678 +    398 +    return region;
    1679 +    399 +  } catch (error) {
    1680 +    400 +    // 4. Fail open - silent fail to global
    1681 +    401 +    console.warn('[SupportWidget] Geo-lookup failed/timed-out, defaulting to Global.', error.message);
    1682 +    402 +    return SUPPORT_FALLBACK_REGION;
    1683 +    403 +  }
    1684 +    404 +}
    1685 +    405 +
    1686 +    406 +/**
    1687 +    407 + * Toggle between India and Global support options
    1688 +    408 + */
    1689 +    409 +function toggleSupportRegion() {
    1690 +    410 +  const currentRegion = sessionStorage.getItem(SUPPORT_CACHE_KEY) || SUPPORT_FALLBACK_REGION;
    1691 +    411 +  const newRegion = currentRegion === 'india' ? 'global' : 'india';
    1692 +    412 +  sessionStorage.setItem(SUPPORT_CACHE_KEY, newRegion);
    1693 +    413 +  renderSupportWidget(newRegion);
    1694 +    414 +  console.log(`[SupportWidget] Toggled region: ${currentRegion} ‚Üí ${newRegion}`);
    1695 +    415 +}
    1696 +    416 +
    1697 +    417 +// Make toggle function globally accessible for onclick
    1698 +    418 +window.toggleSupportRegion = toggleSupportRegion;
    1699 +    419 +
    1700 +    420 +/**
    1701 +    421 + * Render support widget based on region
    1702 +    422 + * @param {string} region - 'india' or 'global'
    1703 +    423 + */
    1704 +    424 +function renderSupportWidget(region) {
    1705 +    425 +  const container = document.getElementById('support-widget');
    1706 +    426 +  if (!container) return;
    1707 +    427 +
    1708 +    428 +  const config = region === 'india'
    1709 +    429 +    ? {
    1710 +    430 +      text: 'üáÆüá≥ Support via UPI',
    1711 +    431 +      url: 'https://razorpay.me/@prakharshekharparthasarthi?notes[source]=webapp_footer',
    1712 +    432 +      className: 'support-button--india',
    1713 +    433 +      toggleText: 'Not in India?',
    1714 +    434 +    }
    1715 +    435 +    : {
    1716 +    436 +      text: '‚òï Support via Ko-fi',
    1717 +    437 +      url: 'https://ko-fi.com/praxlannister?ref=webapp_footer',
    1718 +    438 +      className: 'support-button--global',
    1719 +    439 +      toggleText: 'In India? Use UPI',
    1720 +    440 +    };
    1721 +    441 +
    1722 +    442 +  container.innerHTML = `
    1723 +    443 +    <a href="${config.url}" target="_blank" rel="noopener noreferrer" class="support-button ${config.className}">
    1724 +    444 +      ${config.text}
    1725 +    445 +    </a>
    1726 +    446 +    <button class="support-toggle" onclick="toggleSupportRegion()">${config.toggleText}</button>
    1727 +    447 +  `;
    1728 +    448 +}
    1729 +    449 +
    1730 +    450 +/**
    1731 +    451 + * Initialize support widget with skeleton loader and geo detection
    1732 +    452 + */
    1733 +    453 +async function initSupportWidget() {
    1734 +    454 +  const container = document.getElementById('support-widget');
    1735 +    455 +  if (!container) {
    1736 +    456 +    console.warn('[SupportWidget] Container not found, skipping initialization');
    1737 +    457 +    return;
    1738 +    458 +  }
    1739 +    459 +
    1740 +    460 +  console.log('[SupportWidget] Initializing...');
    1741 +    461 +
    1742 +    462 +  // Skeleton is already in HTML (CLS mitigation)
    1743 +    463 +  // Now detect region and hydrate
    1744 +    464 +  const region = await detectSupportRegion();
    1745 +    465 +  renderSupportWidget(region);
    1746 +    466 +
    1747 +    467 +  console.log(`[SupportWidget] ‚úÖ Initialized with region: ${region}`);
    1748 +354 468  }
    1749 +355 469  
    1750 +356 470  /**
    1751 +357 471  
1856 1752  
1857 1753  ```
1858 1754  
@@ -1862,100 +1758,140 @@
1862 1758  **Type:** Stylesheet üé®
1863 1759  
1864 1760  ```diff
1865     -@@ -224,6 +224,47 @@ body {
1866     -224 224    overflow: auto;
1867     -225 225    /* Single scrollbar for preview container */
1868     -226 226    min-width: 200px;
1869     -    227 +  /* Anchor Navigation - scroll offset for fixed toolbar */
1870     -    228 +  scroll-padding-top: var(--scroll-offset, 80px);
1871     -    229 +}
1872     -    230 +
1873     -    231 +/* ==================== ANCHOR NAVIGATION ==================== */
1874     -    232 +
1875     -    233 +/* Target highlight animation */
1876     -    234 +.preview-container :target {
1877     -    235 +  animation: anchor-highlight 2s ease-out;
1878     -    236 +}
1879     -    237 +
1880     -    238 +@keyframes anchor-highlight {
1881     -    239 +  0% {
1882     -    240 +    background-color: rgba(255, 255, 0, 0.3);
1883     -    241 +  }
1884     -    242 +
1885     -    243 +  100% {
1886     -    244 +    background-color: transparent;
1887     -    245 +  }
1888     -    246 +}
1889     -    247 +
1890     -    248 +/* Focus management - hide outline for mouse clicks */
1891     -    249 +.preview-container h1[id]:focus:not(:focus-visible),
1892     -    250 +.preview-container h2[id]:focus:not(:focus-visible),
1893     -    251 +.preview-container h3[id]:focus:not(:focus-visible),
1894     -    252 +.preview-container h4[id]:focus:not(:focus-visible),
1895     -    253 +.preview-container h5[id]:focus:not(:focus-visible),
1896     -    254 +.preview-container h6[id]:focus:not(:focus-visible) {
1897     -    255 +  outline: none;
1898     -    256 +}
1899     -    257 +
1900     -    258 +/* Keyboard focus gets visible indicator */
1901     -    259 +.preview-container h1[id]:focus-visible,
1902     -    260 +.preview-container h2[id]:focus-visible,
1903     -    261 +.preview-container h3[id]:focus-visible,
1904     -    262 +.preview-container h4[id]:focus-visible,
1905     -    263 +.preview-container h5[id]:focus-visible,
1906     -    264 +.preview-container h6[id]:focus-visible {
1907     -    265 +  outline: 2px solid var(--h1-color, #007bff);
1908     -    266 +  outline-offset: 4px;
1909     -    267 +  border-radius: 2px;
1910     -227 268  }
1911     -228 269  
1912     -229 270  .preview-header {
1913     -230 271  
1914     -
1915     -```
1916     -
1917     -
1918     -### üìÑ `variables.css`
1919     -
1920     -**Type:** Stylesheet üé®
1921     -
1922     -```diff
1923     -@@ -11,13 +11,18 @@
1924     - 11  11    /* ==================== NEBULA DARK (Default) ==================== */
1925     - 12  12  
1926     - 13  13    /* Core Backgrounds */
1927     - 14     -  --bg-universe: #050508;     /* The void */
1928     - 15     -  --bg-element: #0f1123;      /* Solid panels if needed */
1929     -     14 +  --bg-universe: #050508;
1930     -     15 +  /* The void */
1931     -     16 +  --bg-element: #0f1123;
1932     -     17 +  /* Solid panels if needed */
1933     - 16  18  
1934     - 17  19    /* Glass System */
1935     - 18     -  --bg-glass: rgba(15, 17, 35, 0.6);        /* Main panels */
1936     - 19     -  --bg-glass-heavy: rgba(10, 12, 25, 0.85); /* Sidebar/Modals */
1937     - 20     -  --bg-glass-light: rgba(255, 255, 255, 0.05); /* Hover states */
1938     -     20 +  --bg-glass: rgba(15, 17, 35, 0.6);
1939     -     21 +  /* Main panels */
1940     -     22 +  --bg-glass-heavy: rgba(10, 12, 25, 0.85);
1941     -     23 +  /* Sidebar/Modals */
1942     -     24 +  --bg-glass-light: rgba(255, 255, 255, 0.05);
1943     -     25 +  /* Hover states */
1944     - 21  26  
1945     - 22  27    /* Borders */
1946     - 23  28    --border-glass: rgba(255, 255, 255, 0.08);
1947     -@@ -44,6 +49,10 @@
1948     - 44  49    --radius-lg: 16px;
1949     - 45  50    --radius-md: 12px;
1950     - 46  51    --radius-sm: 8px;
1951     -     52 +
1952     -     53 +  /* Anchor Navigation */
1953     -     54 +  --scroll-padding: 20px;
1954     -     55 +  --scroll-offset: calc(var(--header-height) + var(--scroll-padding));
1955     - 47  56  }
1956     - 48  57  
1957     - 49  58  /* ==================== NEBULA LIGHT ==================== */
1958     - 50  59  
    1761 +@@ -789,6 +789,19 @@ body {
    1762 +789 789    box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
    1763 +790 790  }
    1764 +791 791  
    1765 +    792 +.footer-content {
    1766 +    793 +  display: flex;
    1767 +    794 +  align-items: center;
    1768 +    795 +  justify-content: center;
    1769 +    796 +  flex-wrap: wrap;
    1770 +    797 +  gap: 8px;
    1771 +    798 +}
    1772 +    799 +
    1773 +    800 +.footer-separator {
    1774 +    801 +  color: var(--border-color);
    1775 +    802 +  font-weight: 300;
    1776 +    803 +}
    1777 +    804 +
    1778 +792 805  .app-footer a {
    1779 +793 806    color: var(--link-color);
    1780 +794 807    text-decoration: none;
    1781 +@@ -801,6 +814,112 @@ body {
    1782 +801 814    text-decoration: underline;
    1783 +802 815  }
    1784 +803 816  
    1785 +    817 +/* ==================== SUPPORT WIDGET ==================== */
    1786 +    818 +.support-widget-container {
    1787 +    819 +  display: inline-flex;
    1788 +    820 +  align-items: center;
    1789 +    821 +  gap: 8px;
    1790 +    822 +  min-height: 32px;
    1791 +    823 +  /* CLS mitigation - reserve space before JS loads */
    1792 +    824 +}
    1793 +    825 +
    1794 +    826 +.support-button {
    1795 +    827 +  display: inline-flex;
    1796 +    828 +  align-items: center;
    1797 +    829 +  gap: 6px;
    1798 +    830 +  padding: 6px 14px;
    1799 +    831 +  border-radius: 20px;
    1800 +    832 +  font-size: 13px;
    1801 +    833 +  font-weight: 600;
    1802 +    834 +  text-decoration: none;
    1803 +    835 +  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    1804 +    836 +  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    1805 +    837 +}
    1806 +    838 +
    1807 +    839 +.support-button:hover {
    1808 +    840 +  transform: translateY(-2px);
    1809 +    841 +  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    1810 +    842 +  text-decoration: none;
    1811 +    843 +}
    1812 +    844 +
    1813 +    845 +/* Skeleton loader state */
    1814 +    846 +.support-button--loading {
    1815 +    847 +  background: linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%);
    1816 +    848 +  background-size: 200% 100%;
    1817 +    849 +  animation: shimmer 1.5s infinite;
    1818 +    850 +  color: #888;
    1819 +    851 +  border: none;
    1820 +    852 +}
    1821 +    853 +
    1822 +    854 +@keyframes shimmer {
    1823 +    855 +  0% {
    1824 +    856 +    background-position: 200% 0;
    1825 +    857 +  }
    1826 +    858 +
    1827 +    859 +  100% {
    1828 +    860 +    background-position: -200% 0;
    1829 +    861 +  }
    1830 +    862 +}
    1831 +    863 +
    1832 +    864 +/* India UPI style - Orange/Saffron theme */
    1833 +    865 +.support-button--india {
    1834 +    866 +  background: linear-gradient(135deg, #FF9933 0%, #FF6B00 100%);
    1835 +    867 +  color: white;
    1836 +    868 +  border: none;
    1837 +    869 +}
    1838 +    870 +
    1839 +    871 +.support-button--india:hover {
    1840 +    872 +  background: linear-gradient(135deg, #FFB366 0%, #FF8533 100%);
    1841 +    873 +  color: white;
    1842 +    874 +}
    1843 +    875 +
    1844 +    876 +/* Global PayPal style - Blue theme */
    1845 +    877 +.support-button--global {
    1846 +    878 +  background: linear-gradient(135deg, #29ABE0 0%, #1E88E5 100%);
    1847 +    879 +  color: white;
    1848 +    880 +  border: none;
    1849 +    881 +}
    1850 +    882 +
    1851 +    883 +.support-button--global:hover {
    1852 +    884 +  background: linear-gradient(135deg, #4FC3F7 0%, #42A5F5 100%);
    1853 +    885 +  color: white;
    1854 +    886 +}
    1855 +    887 +
    1856 +    888 +/* Region toggle button */
    1857 +    889 +.support-toggle {
    1858 +    890 +  background: none;
    1859 +    891 +  border: none;
    1860 +    892 +  color: var(--text-secondary);
    1861 +    893 +  font-size: 11px;
    1862 +    894 +  cursor: pointer;
    1863 +    895 +  text-decoration: underline;
    1864 +    896 +  opacity: 0.7;
    1865 +    897 +  transition: opacity 0.2s;
    1866 +    898 +  padding: 0;
    1867 +    899 +}
    1868 +    900 +
    1869 +    901 +.support-toggle:hover {
    1870 +    902 +  opacity: 1;
    1871 +    903 +  color: var(--link-color);
    1872 +    904 +}
    1873 +    905 +
    1874 +    906 +/* Mobile responsive */
    1875 +    907 +@media (max-width: 768px) {
    1876 +    908 +  .footer-content {
    1877 +    909 +    flex-direction: column;
    1878 +    910 +    gap: 6px;
    1879 +    911 +  }
    1880 +    912 +
    1881 +    913 +  .footer-separator {
    1882 +    914 +    display: none;
    1883 +    915 +  }
    1884 +    916 +
    1885 +    917 +  .support-widget-container {
    1886 +    918 +    flex-direction: column;
    1887 +    919 +    gap: 4px;
    1888 +    920 +  }
    1889 +    921 +}
    1890 +    922 +
    1891 +804 923  /* ==================== MERMAID DIAGRAMS ==================== */
    1892 +805 924  .mermaid-diagram {
    1893 +806 925    margin: 2em 0;
    1894 +807 926  
1959 1895  
1960 1896  ```
1961 1897  
@@ -2001,4 +1937,4 @@ Please provide specific feedback on:
2001 1937  
2002 1938  ---
2003 1939  *Generated by AI Visual Code Review v2.0 - Unified Export Script*
2004     -*Files processed: 5/5 | Errors: 0 | Generated: 2025-12-19T10:49:19.648Z*
    1940 +*Files processed: 9/9 | Errors: 0 | Generated: 2025-12-19T13:56:21.115Z*
2005 1941  

```

---

## ü§ñ AI Review Checklist

Please review these changes for:

### üîç Code Quality
- [ ] **Linting Compliance**: No unused imports/variables, proper formatting
- [ ] **Type Safety**: Proper typing throughout (TypeScript/Python type hints)
- [ ] **Best Practices**: Framework-specific conventions and patterns
- [ ] **Performance**: Efficient algorithms, proper memoization
- [ ] **Documentation**: Clear comments and function descriptions

### üêõ Potential Issues
- [ ] **Runtime Errors**: Type mismatches, null/undefined handling
- [ ] **Logic Bugs**: Incorrect calculations, edge cases
- [ ] **Memory Leaks**: Cleanup in lifecycle methods, event listeners
- [ ] **Error Handling**: Proper try-catch blocks, user feedback
- [ ] **Accessibility**: ARIA labels, keyboard navigation, screen readers

### üîí Security & Data
- [ ] **Input Validation**: Sanitization, XSS prevention, SQL injection
- [ ] **Authentication**: Proper access controls and permissions
- [ ] **Privacy**: No sensitive data exposure in logs/client
- [ ] **Dependencies**: Updated packages, vulnerability checks

### üì± UX/UI
- [ ] **Responsive Design**: Mobile/desktop/tablet compatibility
- [ ] **Loading States**: Proper feedback during async operations
- [ ] **Error Messages**: User-friendly error handling and recovery
- [ ] **Performance**: Fast loading, smooth animations

### üí° Suggestions & Improvements
Please provide specific feedback on:
1. Code organization and structure improvements
2. Performance optimization opportunities
3. Security considerations and hardening
4. Testing coverage and strategies
5. Documentation and maintainability

---
*Generated by AI Visual Code Review v2.0 - Unified Export Script*
*Files processed: 1/1 | Errors: 0 | Generated: 2025-12-19T14:00:46.783Z*
