# üîç Code Review - 1/19/2026, 7:38:48 PM

**Project:** AI Visual Code Review
**Generated by:** AI Visual Code Review v2.0

## üìä Change Summary

```
AI_REVIEW.md                             | 7070 ++++--------------------------
 script.js                                |  261 +-
 src/js/services/LinkNavigationService.js |  300 ++
 src/js/utils/pathHelpers.js              |  139 +
 4 files changed, 1530 insertions(+), 6240 deletions(-)
```

## üìù Files Changed (4/4 selected)


### üìÑ `AI_REVIEW.md`

**Type:** Documentation üìñ

```diff
@@ -1,4 +1,4 @@
  1     -# üîç Code Review - 12/19/2025, 7:43:35 PM
      1 +# üîç Code Review - 1/19/2026, 7:33:18 PM
  2   2  
  3   3  **Project:** AI Visual Code Review
  4   4  **Generated by:** AI Visual Code Review v2.0
@@ -6,5951 +6,13 @@
  6   6  ## üìä Change Summary
  7   7  
  8   8  ```
  9     -AI_REVIEW.md                                  | 5746 ++++++++++++++++---------
 10     - docs/01-requirements/donation-feature-plan.md |   68 +-
 11     - index.html                                    |   36 +
 12     - script.js                                     |   75 +
 13     - style.css                                     |  122 +
 14     - 5 files changed, 4093 insertions(+), 1954 deletions(-)
      9 +script.js                                | 241 +++++++++++++++++--------
     10 + src/js/services/LinkNavigationService.js | 300 +++++++++++++++++++++++++++++++
     11 + src/js/utils/pathHelpers.js              | 139 ++++++++++++++
     12 + 3 files changed, 602 insertions(+), 78 deletions(-)
 15  13  ```
 16  14  
 17     -## üìù Files Changed (5/5 selected)
 18     -
 19     -
 20     -### üìÑ `AI_REVIEW.md`
 21     -
 22     -**Type:** Documentation üìñ
 23     -
 24     -```diff
 25     -@@ -1,4 +1,4 @@
 26     -  1     -# üîç Code Review - 12/19/2025, 4:19:18 PM
 27     -      1 +# üîç Code Review - 12/19/2025, 7:30:46 PM
 28     -  2   2  
 29     -  3   3  **Project:** AI Visual Code Review
 30     -  4   4  **Generated by:** AI Visual Code Review v2.0
 31     -@@ -6,1956 +6,3814 @@
 32     -  6   6  ## üìä Change Summary
 33     -  7   7  
 34     -  8   8  ```
 35     -  9     -.../toc-anchor-navigation-design-v5.md             | 900 +++++++++++++++++++++
 36     - 10     - docs/competitive_programming_constraints.md        | 621 ++++++++++++++
 37     - 11     - script.js                                          | 255 ++++++
 38     - 12     - style.css                                          |  41 +
 39     - 13     - variables.css                                      |  19 +-
 40     - 14     - 5 files changed, 1831 insertions(+), 5 deletions(-)
 41     -      9 +AI_REVIEW.md | 3728 +++++++++++++++++++++++++++++-----------------------------
 42     -     10 + 1 file changed, 1832 insertions(+), 1896 deletions(-)
 43     - 15  11  ```
 44     - 16  12  
 45     - 17     -## üìù Files Changed (5/5 selected)
 46     -     13 +## üìù Files Changed (1/1 selected)
 47     - 18  14  
 48     - 19  15  
 49     - 20     -### ‚ú® `docs/01-requirements/toc-anchor-navigation-design-v5.md` **[ADDED]**
 50     - 21     -
 51     - 22     -**Status:** ‚úÖ **NEW FILE** - This file has been newly created
 52     -     16 +### üìÑ `AI_REVIEW.md`
 53     - 23  17  
 54     - 24  18  **Type:** Documentation üìñ
 55     - 25  19  
 56     - 26  20  ```diff
 57     - 27     -@@ -0,0 +1,900 @@
 58     - 28     -      1 +# Design Document: Table of Contents Anchor Navigation
 59     - 29     -      2 +
 60     - 30     -      3 +## Version 5.0 (Production Ready - Final)
 61     - 31     -      4 +
 62     - 32     -      5 +---
 63     - 33     -      6 +
 64     - 34     -      7 +**Document ID:** DD-2025-002-TOC-NAV
 65     - 35     -      8 +**Author:** Principal SDE
 66     - 36     -      9 +**Created:** December 19, 2025
 67     - 37     -     10 +**Last Updated:** December 19, 2025
 68     - 38     -     11 +**Status:** ‚úÖ **APPROVED FOR IMPLEMENTATION**
 69     - 39     -     12 +**Review Cycles:** 8 (v1.0 ‚Üí v2.0 ‚Üí v3.0 ‚Üí v4.0 ‚Üí v4.1 ‚Üí v4.2 ‚Üí v4.3 ‚Üí v5.0)
 70     - 40     -     13 +
 71     - 41     -     14 +---
 72     - 42     -     15 +
 73     - 43     -     16 +## Table of Contents
 74     - 44     -     17 +
 75     - 45     -     18 +1. [Executive Summary](#1-executive-summary)
 76     - 46     -     19 +2. [Problem Statement](#2-problem-statement)
 77     - 47     -     20 +3. [Requirements](#3-requirements)
 78     - 48     -     21 +4. [Technical Design](#4-technical-design)
 79     - 49     -     22 +5. [Implementation Details](#5-implementation-details)
 80     - 50     -     23 +6. [Browser Compatibility](#6-browser-compatibility)
 81     - 51     -     24 +7. [Testing Strategy](#7-testing-strategy)
 82     - 52     -     25 +8. [Performance Budget](#8-performance-budget)
 83     - 53     -     26 +9. [Security Considerations](#9-security-considerations)
 84     - 54     -     27 +10. [Rollback Plan](#10-rollback-plan)
 85     - 55     -     28 +11. [FAQ](#11-faq)
 86     - 56     -     29 +12. [Approval](#12-approval)
 87     - 57     -     30 +13. [Change Log](#13-change-log)
 88     - 58     -     31 +
 89     - 59     -     32 +---
 90     - 60     -     33 +
 91     - 61     -     34 +## 1. Executive Summary
 92     - 62     -     35 +
 93     - 63     -     36 +This document specifies the implementation of in-document anchor navigation for Markdown Viewer Pro. The feature enables clicking Table of Contents links to scroll the preview container to the target heading, with full accessibility support and legacy link compatibility.
 94     - 64     -     37 +
 95     - 65     -     38 +**Key Features:**
 96     - 66     -     39 +- Smooth scroll to headings on TOC link click
 97     - 67     -     40 +- Support for emoji and special character headings
 98     - 68     -     41 +- Legacy link compatibility (non-standard ID formats)
 99     - 69     -     42 +- Accessibility-compliant focus management
100     - 70     -     43 +- Deep linking (URL hash on page load)
101     - 71     -     44 +- Browser history support (back/forward)
102     - 72     -     45 +
103     - 73     -     46 +---
104     - 74     -     47 +
105     - 75     -     48 +## 2. Problem Statement
106     - 76     -     49 +
107     - 77     -     50 +### 2.1 Root Cause
108     - 78     -     51 +
109     - 79     -     52 +The application uses a **non-scrollable document body** (`overflow: hidden`) with content rendered inside a scrollable child container (`.preview-container`). When users click anchor links (`href="#section"`), the browser's native scroll algorithm targets the document viewport‚Äîwhich is non-scrollable‚Äîresulting in **silent failure**.
110     - 80     -     53 +
111     - 81     -     54 +### 2.2 Sticky Toolbar Occlusion
112     - 82     -     55 +
113     - 83     -     56 +The application has a fixed toolbar (height: `60px`). A naive scroll-to-element positions content at `top: 0`, causing it to be **obscured by the toolbar**.
114     - 84     -     57 +
115     - 85     -     58 +### 2.3 Legacy Link Compatibility
116     - 86     -     59 +
117     - 87     -     60 +Existing markdown documents contain manually-created links using non-standard ID formats (e.g., `#üìã-table-of-contents` or `#-standard-assumptions`). These must resolve correctly.
118     - 88     -     61 +
119     - 89     -     62 +### 2.4 App Shell ID Collision
120     - 90     -     63 +
121     - 91     -     64 +The application shell has elements with IDs like `sidebar`, `preview`, `editor`. User-authored headings with the same names must NOT collide with app shell elements.
122     - 92     -     65 +
123     - 93     -     66 +### 2.5 marked.js Singleton Constraint
124     - 94     -     67 +
125     - 95     -     68 +`marked` is imported as a global singleton. Calling `marked.use()` inside `renderMarkdown()` (which runs on every keystroke) would stack infinite extensions, causing:
126     - 96     -     69 +- **Memory leak:** `marked.defaults.extensions` grows infinitely
127     - 97     -     70 +- **Performance degradation:** After 100 keystrokes, marked runs 100 identical renderers
128     - 98     -     71 +
129     - 99     -     72 +---
130     -100     -     73 +
131     -101     -     74 +## 3. Requirements
132     -102     -     75 +
133     -103     -     76 +### 3.1 Functional Requirements
134     -104     -     77 +
135     -105     -     78 +| ID | Requirement | Priority | Acceptance Criteria |
136     -106     -     79 +|----|-------------|----------|---------------------|
137     -107     -     80 +| FR-1 | Internal anchor clicks scroll preview to target | P0 | Target heading visible within 800ms |
138     -108     -     81 +| FR-2 | Scrolled content not occluded by toolbar | P0 | 20px gap between toolbar and heading |
139     -109     -     82 +| FR-3 | URL hash updates on navigation | P0 | URL reflects current section |
140     -110     -     83 +| FR-4 | Deep linking works on page load | P0 | `URL#section` scrolls on load |
141     -111     -     84 +| FR-5 | Browser back/forward navigates history | P1 | Hash changes scroll correctly |
142     -112     -     85 +| FR-6 | Legacy links work (emoji, special chars) | P0 | See compatibility matrix |
143     -113     -     86 +| FR-7 | Focus moves to target for screen readers | P0 | Screen reader announces heading |
144     -114     -     87 +| FR-8 | Empty hash (`#`) scrolls to top | P1 | Container scrollTop = 0 |
145     -115     -     88 +| FR-9 | No collision with app shell IDs | P0 | User `## Sidebar` != app `#sidebar` |
146     -116     -     89 +| FR-10 | Duplicate headings get unique IDs | P0 | `header`, `header-1`, `header-2` |
147     -117     -     90 +
148     -118     -     91 +### 3.2 Non-Functional Requirements
149     -119     -     92 +
150     -120     -     93 +| ID | Requirement | Target |
151     -121     -     94 +|----|-------------|--------|
152     -122     -     95 +| NFR-1 | Click-to-scroll latency | < 16ms (1 frame) |
153     -123     -     96 +| NFR-2 | Scroll animation duration | 300-800ms (distance-based) |
154     -124     -     97 +| NFR-3 | No layout thrashing | 0 forced reflows |
155     -125     -     98 +| NFR-4 | Memory overhead | < 1KB per session |
156     -126     -     99 +| NFR-5 | No memory leaks | Zero extension stacking |
157     -127     -    100 +| NFR-6 | Stateless rendering | Module-level map with reset |
158     -128     -    101 +
159     -129     -    102 +### 3.3 Edge Cases
160     -130     -    103 +
161     -131     -    104 +| Case | Input | Expected Behavior |
162     -132     -    105 +|------|-------|-------------------|
163     -133     -    106 +| Empty hash | `href="#"` | Scroll to top (scrollTop = 0) |
164     -134     -    107 +| Non-existent target | `href="#nonexistent"` | Console warning, no action |
165     -135     -    108 +| External link | `href="https://..."` | Browser default behavior |
166     -136     -    109 +| Duplicate headers | Two `## Header` | IDs: `header`, `header-1` |
167     -137     -    110 +| App shell collision | `## Sidebar` | Resolves to user content, not `#sidebar` |
168     -138     -    111 +| Special chars | `## C++` | ID: `cpp` |
169     -139     -    112 +| Emoji | `## üéØ Goal` | ID: `goal` |
170     -140     -    113 +| Concurrent clicks | Click A, then B rapidly | Cancel A, execute B |
171     -141     -    114 +| Already visible | Target in viewport | Smooth scroll anyway |
172     -142     -    115 +
173     -143     -    116 +---
174     -144     -    117 +
175     -145     -    118 +## 4. Technical Design
176     -146     -    119 +
177     -147     -    120 +### 4.1 Architecture Overview
178     -148     -    121 +
179     -149     -    122 +```
180     -150     -    123 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
181     -151     -    124 +‚îÇ                     User Interaction                          ‚îÇ
182     -152     -    125 +‚îÇ  [Click] ‚îÄ‚îÄ‚ñ∫ [hashchange] ‚îÄ‚îÄ‚ñ∫ [Page Load with Hash]          ‚îÇ
183     -153     -    126 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
184     -154     -    127 +                       ‚îÇ
185     -155     -    128 +                       ‚ñº
186     -156     -    129 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
187     -157     -    130 +‚îÇ                 AnchorNavigation Module                       ‚îÇ
188     -158     -    131 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
189     -159     -    132 +‚îÇ  ‚îÇ handleClick()  ‚îÇ  ‚îÇhandleHashChange‚îÇ  ‚îÇhandleInitLoad()‚îÇ  ‚îÇ
190     -160     -    133 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
191     -161     -    134 +‚îÇ          ‚îÇ                   ‚îÇ                   ‚îÇ            ‚îÇ
192     -162     -    135 +‚îÇ          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
193     -163     -    136 +‚îÇ                              ‚ñº                                ‚îÇ
194     -164     -    137 +‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
195     -165     -    138 +‚îÇ                   ‚îÇ  scrollToTarget()   ‚îÇ                     ‚îÇ
196     -166     -    139 +‚îÇ                   ‚îÇ  ‚îî‚îÄ resolveTarget() ‚îÇ  ‚óÑ‚îÄ‚îÄ SCOPED to      ‚îÇ
197     -167     -    140 +‚îÇ                   ‚îÇ  ‚îî‚îÄ scrollIntoView  ‚îÇ      container      ‚îÇ
198     -168     -    141 +‚îÇ                   ‚îÇ  ‚îî‚îÄ manageFocus()   ‚îÇ                     ‚îÇ
199     -169     -    142 +‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
200     -170     -    143 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
201     -171     -    144 +```
202     -172     -    145 +
203     -173     -    146 +### 4.2 Slug Generation Algorithm
204     -174     -    147 +
205     -175     -    148 +**Purpose:** Generate consistent, collision-free IDs for headings.
206     -176     -    149 +
207     -177     -    150 +**Algorithm (GitHub-compatible with programming term support):**
208     -178     -    151 +
209     -179     -    152 +```javascript
210     -180     -    153 +// Pre-compiled regex patterns (module level - zero GC pressure)
211     -181     -    154 +const SLUG_REPLACEMENTS = [
212     -182     -    155 +  [/c\+\+/gi, 'cpp'],
213     -183     -    156 +  [/c#/gi, 'csharp'],
214     -184     -    157 +  [/f#/gi, 'fsharp'],
215     -185     -    158 +  [/\.net/gi, 'dotnet'],
216     -186     -    159 +];
217     -187     -    160 +
218     -188     -    161 +/**
219     -189     -    162 + * Generate URL-safe slug from heading text
220     -190     -    163 + * @param {string} text - Raw heading text (may include HTML)
221     -191     -    164 + * @param {Map<string, number>} seen - Duplicate tracking map
222     -192     -    165 + * @returns {string} URL-safe slug
223     -193     -    166 + */
224     -194     -    167 +function generateSlug(text, seen = new Map()) {
225     -195     -    168 +  // Step 0: Strip HTML tags
226     -196     -    169 +  let slug = text.replace(/<[^>]*>/g, '');
227     -197     -    170 +
228     -198     -    171 +  // Step 1: Normalize Unicode (handle caf√© vs caf√©)
229     -199     -    172 +  slug = slug.normalize('NFC');
230     -200     -    173 +
231     -201     -    174 +  // Step 2: Lowercase
232     -202     -    175 +  slug = slug.toLowerCase();
233     -203     -    176 +
234     -204     -    177 +  // Step 3: Replace programming terms (pre-compiled patterns)
235     -205     -    178 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
236     -206     -    179 +    slug = slug.replace(pattern, replacement);
237     -207     -    180 +  }
238     -208     -    181 +
239     -209     -    182 +  // Step 4: Remove non-word chars (keep spaces, hyphens, underscores)
240     -210     -    183 +  slug = slug.replace(/[^\w\s-]/g, '');
241     -211     -    184 +
242     -212     -    185 +  // Step 5: Spaces to hyphens
243     -213     -    186 +  slug = slug.replace(/\s+/g, '-');
244     -214     -    187 +
245     -215     -    188 +  // Step 6: Collapse multiple hyphens
246     -216     -    189 +  slug = slug.replace(/-+/g, '-');
247     -217     -    190 +
248     -218     -    191 +  // Step 7: Trim hyphens
249     -219     -    192 +  slug = slug.replace(/^-+|-+$/g, '');
250     -220     -    193 +
251     -221     -    194 +  // Step 8: Fallback for empty result
252     -222     -    195 +  if (!slug) slug = 'section';
253     -223     -    196 +
254     -224     -    197 +  // Step 9: Handle duplicates (header, header-1, header-2)
255     -225     -    198 +  const baseSlug = slug;
256     -226     -    199 +  const count = seen.get(baseSlug) || 0;
257     -227     -    200 +  if (count > 0) {
258     -228     -    201 +    slug = `${baseSlug}-${count}`;
259     -229     -    202 +  }
260     -230     -    203 +  seen.set(baseSlug, count + 1);
261     -231     -    204 +
262     -232     -    205 +  return slug;
263     -233     -    206 +}
264     -234     -    207 +```
265     -235     -    208 +
266     -236     -    209 +**Transformation Examples:**
267     -237     -    210 +
268     -238     -    211 +| Input | Output | Reason |
269     -239     -    212 +|-------|--------|--------|
270     -240     -    213 +| `Hello World` | `hello-world` | Standard |
271     -241     -    214 +| `üéØ Standard Assumptions` | `standard-assumptions` | Emoji stripped |
272     -242     -    215 +| `C++` | `cpp` | Special replacement |
273     -243     -    216 +| `C#` | `csharp` | Special replacement |
274     -244     -    217 +| `.NET Framework` | `dotnet-framework` | Special replacement |
275     -245     -    218 +| `F#` | `fsharp` | Special replacement |
276     -246     -    219 +| `API v2.0` | `api-v20` | Period stripped |
277     -247     -    220 +| `1. Introduction` | `1-introduction` | Numbers preserved |
278     -248     -    221 +| `hello_world` | `hello_world` | Underscores preserved |
279     -249     -    222 +| `Header` (1st) | `header` | First occurrence |
280     -250     -    223 +| `Header` (2nd) | `header-1` | Duplicate handling |
281     -251     -    224 +| `Header` (3rd) | `header-2` | Duplicate handling |
282     -252     -    225 +| `üòÄüòÄüòÄ` | `section` | Fallback for empty |
283     -253     -    226 +| `--test--` | `test` | Trimmed |
284     -254     -    227 +
285     -255     -    228 +### 4.3 State Management (Singleton-Safe)
286     -256     -    229 +
287     -257     -    230 +**Critical:** `marked` is a global singleton. Extension registration happens ONCE at startup.
288     -258     -    231 +
289     -259     -    232 +```javascript
290     -260     -    233 +// Module level (script.js, near top)
291     -261     -    234 +const headingSlugMap = new Map();
292     -262     -    235 +
293     -263     -    236 +function resetSlugMap() {
294     -264     -    237 +  headingSlugMap.clear();
295     -265     -    238 +}
296     -266     -    239 +
297     -267     -    240 +// In configureMarkedExtensions() - called ONCE at app init
298     -268     -    241 +marked.use({
299     -269     -    242 +  renderer: {
300     -270     -    243 +    heading(token) {
301     -271     -    244 +      const text = this.parser.parseInline(token.tokens);
302     -272     -    245 +      const level = token.depth;
303     -273     -    246 +      const slug = generateSlug(text, headingSlugMap);
304     -274     -    247 +      return `<h${level} id="${slug}">${text}</h${level}>\n`;
305     -275     -    248 +    }
306     -276     -    249 +  }
307     -277     -    250 +});
308     -278     -    251 +
309     -279     -    252 +// In renderMarkdown() - called on every keystroke
310     -280     -    253 +function renderMarkdown() {
311     -281     -    254 +  resetSlugMap();  // Clear state, NOT re-register extension
312     -282     -    255 +  const html = marked.parse(text);
313     -283     -    256 +  // ...
314     -284     -    257 +}
315     -285     -    258 +```
316     -286     -    259 +
317     -287     -    260 +### 4.4 Link Resolution (Scoped Selection)
318     -288     -    261 +
319     -289     -    262 +**Purpose:** Match clicked links to generated IDs, preventing app shell collision.
320     -290     -    263 +
321     -291     -    264 +```javascript
322     -292     -    265 +/**
323     -293     -    266 + * Resolve target element from hash - SCOPED to container
324     -294     -    267 + * @param {string} hash - URL hash (without #)
325     -295     -    268 + * @param {HTMLElement} container - Scrollable container
326     -296     -    269 + * @returns {Element|null} Target element or null
327     -297     -    270 + */
328     -298     -    271 +function resolveTarget(hash, container) {
329     -299     -    272 +  if (!hash) return null;
330     -300     -    273 +
331     -301     -    274 +  // Decode URI components
332     -302     -    275 +  let decodedHash;
333     -303     -    276 +  try {
334     -304     -    277 +    decodedHash = decodeURIComponent(hash);
335     -305     -    278 +  } catch {
336     -306     -    279 +    decodedHash = hash;
337     -307     -    280 +  }
338     -308     -    281 +
339     -309     -    282 +  // Priority 1: Exact ID (SCOPED to container - prevents app shell collision)
340     -310     -    283 +  let target = container.querySelector(`#${CSS.escape(decodedHash)}`);
341     -311     -    284 +  if (target) return target;
342     -312     -    285 +
343     -313     -    286 +  // Priority 2: Normalized ID (handles legacy links)
344     -314     -    287 +  const normalizedHash = normalizeHash(decodedHash);
345     -315     -    288 +  target = container.querySelector(`#${CSS.escape(normalizedHash)}`);
346     -316     -    289 +  if (target) return target;
347     -317     -    290 +
348     -318     -    291 +  console.warn(`[AnchorNav] Target not found: "${hash}"`);
349     -319     -    292 +  return null;
350     -320     -    293 +}
351     -321     -    294 +
352     -322     -    295 +/**
353     -323     -    296 + * Normalize hash for legacy link matching
354     -324     -    297 + */
355     -325     -    298 +function normalizeHash(hash) {
356     -326     -    299 +  let slug = hash.normalize('NFC').toLowerCase();
357     -327     -    300 +
358     -328     -    301 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
359     -329     -    302 +    slug = slug.replace(pattern, replacement);
360     -330     -    303 +  }
361     -331     -    304 +
362     -332     -    305 +  return slug
363     -333     -    306 +    .replace(/[^\w\s-]/g, '')
364     -334     -    307 +    .replace(/\s+/g, '-')
365     -335     -    308 +    .replace(/-+/g, '-')
366     -336     -    309 +    .replace(/^-+|-+$/g, '') || 'section';
367     -337     -    310 +}
368     -338     -    311 +```
369     -339     -    312 +
370     -340     -    313 +---
371     -341     -    314 +
372     -342     -    315 +## 5. Implementation Details
373     -343     -    316 +
374     -344     -    317 +### 5.1 CSS Configuration
375     -345     -    318 +
376     -346     -    319 +**File: `variables.css`** (add to existing `:root`)
377     -347     -    320 +```css
378     -348     -    321 +:root {
379     -349     -    322 +  /* Existing variables... */
380     -350     -    323 +
381     -351     -    324 +  /* Anchor Navigation */
382     -352     -    325 +  --toolbar-height: 60px;
383     -353     -    326 +  --scroll-padding: 20px;
384     -354     -    327 +  --scroll-offset: calc(var(--toolbar-height) + var(--scroll-padding));
385     -355     -    328 +}
386     -356     -    329 +```
387     -357     -    330 +
388     -358     -    331 +**File: `style.css`** (add new section)
389     -359     -    332 +```css
390     -360     -    333 +/* ==================== ANCHOR NAVIGATION ==================== */
391     -361     -    334 +
392     -362     -    335 +/* Scroll padding - SINGLE SOURCE of offset */
393     -363     -    336 +.preview-container {
394     -364     -    337 +  scroll-padding-top: var(--scroll-offset, 80px);
395     -365     -    338 +}
396     -366     -    339 +
397     -367     -    340 +/* Target highlight animation */
398     -368     -    341 +.preview-container :target {
399     -369     -    342 +  animation: anchor-highlight 2s ease-out;
400     -370     -    343 +}
401     -371     -    344 +
402     -372     -    345 +@keyframes anchor-highlight {
403     -373     -    346 +  0% { background-color: rgba(255, 255, 0, 0.3); }
404     -374     -    347 +  100% { background-color: transparent; }
405     -375     -    348 +}
406     -376     -    349 +
407     -377     -    350 +/* Focus management - conditional outline */
408     -378     -    351 +.preview-container h1[id]:focus:not(:focus-visible),
409     -379     -    352 +.preview-container h2[id]:focus:not(:focus-visible),
410     -380     -    353 +.preview-container h3[id]:focus:not(:focus-visible),
411     -381     -    354 +.preview-container h4[id]:focus:not(:focus-visible),
412     -382     -    355 +.preview-container h5[id]:focus:not(:focus-visible),
413     -383     -    356 +.preview-container h6[id]:focus:not(:focus-visible) {
414     -384     -    357 +  outline: none;
415     -385     -    358 +}
416     -386     -    359 +
417     -387     -    360 +/* Keyboard focus gets visible indicator */
418     -388     -    361 +.preview-container h1[id]:focus-visible,
419     -389     -    362 +.preview-container h2[id]:focus-visible,
420     -390     -    363 +.preview-container h3[id]:focus-visible,
421     -391     -    364 +.preview-container h4[id]:focus-visible,
422     -392     -    365 +.preview-container h5[id]:focus-visible,
423     -393     -    366 +.preview-container h6[id]:focus-visible {
424     -394     -    367 +  outline: 2px solid var(--primary-color, #007bff);
425     -395     -    368 +  outline-offset: 4px;
426     -396     -    369 +  border-radius: 2px;
427     -397     -    370 +}
428     -398     -    371 +```
429     -399     -    372 +
430     -400     -    373 +### 5.2 JavaScript Implementation
431     -401     -    374 +
432     -402     -    375 +**File: `script.js`** (modifications)
433     -403     -    376 +
434     -404     -    377 +```javascript
435     -405     -    378 +// ==================== ANCHOR NAVIGATION ====================
436     -406     -    379 +// Add near top of file, after imports
437     -407     -    380 +
438     -408     -    381 +// Heading slug tracking (module-level singleton)
439     -409     -    382 +const headingSlugMap = new Map();
440     -410     -    383 +
441     -411     -    384 +// Pre-compiled slug replacements (zero GC pressure)
442     -412     -    385 +const SLUG_REPLACEMENTS = [
443     -413     -    386 +  [/c\+\+/gi, 'cpp'],
444     -414     -    387 +  [/c#/gi, 'csharp'],
445     -415     -    388 +  [/f#/gi, 'fsharp'],
446     -416     -    389 +  [/\.net/gi, 'dotnet'],
447     -417     -    390 +];
448     -418     -    391 +
449     -419     -    392 +/**
450     -420     -    393 + * Reset slug map (call before each parse)
451     -421     -    394 + */
452     -422     -    395 +function resetSlugMap() {
453     -423     -    396 +  headingSlugMap.clear();
454     -424     -    397 +}
455     -425     -    398 +
456     -426     -    399 +/**
457     -427     -    400 + * Generate URL-safe slug from heading text
458     -428     -    401 + */
459     -429     -    402 +function generateSlug(text, seen = headingSlugMap) {
460     -430     -    403 +  // Strip HTML tags
461     -431     -    404 +  let slug = text.replace(/<[^>]*>/g, '');
462     -432     -    405 +
463     -433     -    406 +  // Normalize Unicode
464     -434     -    407 +  slug = slug.normalize('NFC').toLowerCase();
465     -435     -    408 +
466     -436     -    409 +  // Replace programming terms
467     -437     -    410 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
468     -438     -    411 +    slug = slug.replace(pattern, replacement);
469     -439     -    412 +  }
470     -440     -    413 +
471     -441     -    414 +  // Clean up
472     -442     -    415 +  slug = slug
473     -443     -    416 +    .replace(/[^\w\s-]/g, '')
474     -444     -    417 +    .replace(/\s+/g, '-')
475     -445     -    418 +    .replace(/-+/g, '-')
476     -446     -    419 +    .replace(/^-+|-+$/g, '');
477     -447     -    420 +
478     -448     -    421 +  if (!slug) slug = 'section';
479     -449     -    422 +
480     -450     -    423 +  // Handle duplicates
481     -451     -    424 +  const baseSlug = slug;
482     -452     -    425 +  const count = seen.get(baseSlug) || 0;
483     -453     -    426 +  if (count > 0) slug = `${baseSlug}-${count}`;
484     -454     -    427 +  seen.set(baseSlug, count + 1);
485     -455     -    428 +
486     -456     -    429 +  return slug;
487     -457     -    430 +}
488     -458     -    431 +
489     -459     -    432 +/**
490     -460     -    433 + * Anchor Navigation Module
491     -461     -    434 + */
492     -462     -    435 +const AnchorNavigation = {
493     -463     -    436 +  container: null,
494     -464     -    437 +  pendingScroll: null,
495     -465     -    438 +
496     -466     -    439 +  /**
497     -467     -    440 +   * Initialize anchor navigation
498     -468     -    441 +   */
499     -469     -    442 +  init(previewContainer) {
500     -470     -    443 +    this.container = previewContainer;
501     -471     -    444 +
502     -472     -    445 +    // Event delegation for clicks
503     -473     -    446 +    this.container.addEventListener('click', this.handleClick.bind(this));
504     -474     -    447 +
505     -475     -    448 +    // Browser back/forward
506     -476     -    449 +    window.addEventListener('hashchange', this.handleHashChange.bind(this));
507     -477     -    450 +
508     -478     -    451 +    // Initial page load with hash
509     -479     -    452 +    if (window.location.hash) {
510     -480     -    453 +      requestAnimationFrame(() => {
511     -481     -    454 +        this.scrollToHash(window.location.hash.slice(1), false);
512     -482     -    455 +      });
513     -483     -    456 +    }
514     -484     -    457 +  },
515     -485     -    458 +
516     -486     -    459 +  /**
517     -487     -    460 +   * Handle click events (delegated)
518     -488     -    461 +   */
519     -489     -    462 +  handleClick(event) {
520     -490     -    463 +    const link = event.target.closest('a[href^="#"]');
521     -491     -    464 +    if (!link) return;
522     -492     -    465 +
523     -493     -    466 +    // Ignore external links
524     -494     -    467 +    if (link.hostname && link.hostname !== window.location.hostname) return;
525     -495     -    468 +
526     -496     -    469 +    event.preventDefault();
527     -497     -    470 +
528     -498     -    471 +    const hash = link.getAttribute('href').slice(1);
529     -499     -    472 +    this.scrollToHash(hash, true);
530     -500     -    473 +
531     -501     -    474 +    // Update URL
532     -502     -    475 +    history.pushState(null, '', `#${hash}`);
533     -503     -    476 +  },
534     -504     -    477 +
535     -505     -    478 +  /**
536     -506     -    479 +   * Handle hashchange (back/forward)
537     -507     -    480 +   */
538     -508     -    481 +  handleHashChange() {
539     -509     -    482 +    const hash = window.location.hash.slice(1);
540     -510     -    483 +    if (hash) {
541     -511     -    484 +      this.scrollToHash(hash, true);
542     -512     -    485 +    } else {
543     -513     -    486 +      this.scrollToTop(true);
544     -514     -    487 +    }
545     -515     -    488 +  },
546     -516     -    489 +
547     -517     -    490 +  /**
548     -518     -    491 +   * Scroll to element by hash
549     -519     -    492 +   */
550     -520     -    493 +  scrollToHash(hash, smooth = true) {
551     -521     -    494 +    // Cancel pending scroll (handle concurrent clicks)
552     -522     -    495 +    if (this.pendingScroll) {
553     -523     -    496 +      clearTimeout(this.pendingScroll);
554     -524     -    497 +      this.pendingScroll = null;
555     -525     -    498 +    }
556     -526     -    499 +
557     -527     -    500 +    if (!hash) {
558     -528     -    501 +      this.scrollToTop(smooth);
559     -529     -    502 +      return;
560     -530     -    503 +    }
561     -531     -    504 +
562     -532     -    505 +    const target = this.resolveTarget(hash);
563     -533     -    506 +    if (!target) return;
564     -534     -    507 +
565     -535     -    508 +    target.scrollIntoView({
566     -536     -    509 +      behavior: smooth ? 'smooth' : 'instant',
567     -537     -    510 +      block: 'start',
568     -538     -    511 +    });
569     -539     -    512 +
570     -540     -    513 +    this.manageFocus(target, smooth);
571     -541     -    514 +  },
572     -542     -    515 +
573     -543     -    516 +  /**
574     -544     -    517 +   * Scroll to top
575     -545     -    518 +   */
576     -546     -    519 +  scrollToTop(smooth = true) {
577     -547     -    520 +    this.container.scrollTo({
578     -548     -    521 +      top: 0,
579     -549     -    522 +      behavior: smooth ? 'smooth' : 'instant',
580     -550     -    523 +    });
581     -551     -    524 +  },
582     -552     -    525 +
583     -553     -    526 +  /**
584     -554     -    527 +   * Resolve target - SCOPED to container
585     -555     -    528 +   */
586     -556     -    529 +  resolveTarget(hash) {
587     -557     -    530 +    if (!hash) return null;
588     -558     -    531 +
589     -559     -    532 +    let decodedHash;
590     -560     -    533 +    try {
591     -561     -    534 +      decodedHash = decodeURIComponent(hash);
592     -562     -    535 +    } catch {
593     -563     -    536 +      decodedHash = hash;
594     -564     -    537 +    }
595     -565     -    538 +
596     -566     -    539 +    // Priority 1: Exact ID (scoped)
597     -567     -    540 +    let target = this.container.querySelector(`#${CSS.escape(decodedHash)}`);
598     -568     -    541 +    if (target) return target;
599     -569     -    542 +
600     -570     -    543 +    // Priority 2: Normalized ID (scoped)
601     -571     -    544 +    const normalized = this.normalizeHash(decodedHash);
602     -572     -    545 +    target = this.container.querySelector(`#${CSS.escape(normalized)}`);
603     -573     -    546 +    if (target) return target;
604     -574     -    547 +
605     -575     -    548 +    console.warn(`[AnchorNav] Target not found: "${hash}"`);
606     -576     -    549 +    return null;
607     -577     -    550 +  },
608     -578     -    551 +
609     -579     -    552 +  /**
610     -580     -    553 +   * Normalize hash for legacy link matching
611     -581     -    554 +   */
612     -582     -    555 +  normalizeHash(hash) {
613     -583     -    556 +    let slug = hash.normalize('NFC').toLowerCase();
614     -584     -    557 +
615     -585     -    558 +    for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
616     -586     -    559 +      slug = slug.replace(pattern, replacement);
617     -587     -    560 +    }
618     -588     -    561 +
619     -589     -    562 +    return slug
620     -590     -    563 +      .replace(/[^\w\s-]/g, '')
621     -591     -    564 +      .replace(/\s+/g, '-')
622     -592     -    565 +      .replace(/-+/g, '-')
623     -593     -    566 +      .replace(/^-+|-+$/g, '') || 'section';
624     -594     -    567 +  },
625     -595     -    568 +
626     -596     -    569 +  /**
627     -597     -    570 +   * Manage focus after scroll
628     -598     -    571 +   */
629     -599     -    572 +  manageFocus(target, smooth) {
630     -600     -    573 +    const focusTarget = () => {
631     -601     -    574 +      if (!target.hasAttribute('tabindex')) {
632     -602     -    575 +        target.setAttribute('tabindex', '-1');
633     -603     -    576 +      }
634     -604     -    577 +      target.focus({ preventScroll: true });
635     -605     -    578 +    };
636     -606     -    579 +
637     -607     -    580 +    if (!smooth) {
638     -608     -    581 +      focusTarget();
639     -609     -    582 +      return;
640     -610     -    583 +    }
641     -611     -    584 +
642     -612     -    585 +    // Modern: scrollend event
643     -613     -    586 +    if ('onscrollend' in this.container) {
644     -614     -    587 +      this.container.addEventListener('scrollend', focusTarget, { once: true });
645     -615     -    588 +    } else {
646     -616     -    589 +      // Fallback: estimate duration (max 1000ms for safety)
647     -617     -    590 +      const distance = Math.abs(target.getBoundingClientRect().top);
648     -618     -    591 +      const duration = Math.min(Math.max(distance / 2, 300), 1000);
649     -619     -    592 +      this.pendingScroll = setTimeout(focusTarget, duration + 50);
650     -620     -    593 +    }
651     -621     -    594 +  },
652     -622     -    595 +};
653     -623     -    596 +```
654     -624     -    597 +
655     -625     -    598 +### 5.3 Integration Points
656     -626     -    599 +
657     -627     -    600 +**In `configureMarkedExtensions()`:**
658     -628     -    601 +```javascript
659     -629     -    602 +function configureMarkedExtensions() {
660     -630     -    603 +  // ... existing extensions ...
661     -631     -    604 +
662     -632     -    605 +  // Custom heading renderer with ID generation
663     -633     -    606 +  marked.use({
664     -634     -    607 +    renderer: {
665     -635     -    608 +      heading(token) {
666     -636     -    609 +        const text = this.parser.parseInline(token.tokens);
667     -637     -    610 +        const level = token.depth;
668     -638     -    611 +        const slug = generateSlug(text, headingSlugMap);
669     -639     -    612 +        return `<h${level} id="${slug}">${text}</h${level}>\n`;
670     -640     -    613 +      }
671     -641     -    614 +    }
672     -642     -    615 +  });
673     -643     -    616 +  console.log('‚úÖ Custom heading renderer enabled (ID generation)');
674     -644     -    617 +}
675     -645     -    618 +```
676     -646     -    619 +
677     -647     -    620 +**In `renderMarkdown()`:**
678     -648     -    621 +```javascript
679     -649     -    622 +function renderMarkdown() {
680     -650     -    623 +  try {
681     -651     -    624 +    resetSlugMap();  // Clear slug tracking before parse
682     -652     -    625 +
683     -653     -    626 +    const markdownText = editor.value;
684     -654     -    627 +    let html = marked.parse(markdownText);
685     -655     -    628 +    // ... rest of existing logic ...
686     -656     -    629 +  }
687     -657     -    630 +}
688     -658     -    631 +```
689     -659     -    632 +
690     -660     -    633 +**In `setupEditor()` (at end):**
691     -661     -    634 +```javascript
692     -662     -    635 +// Initialize anchor navigation
693     -663     -    636 +AnchorNavigation.init(previewContainer);
694     -664     -    637 +```
695     -665     -    638 +
696     -666     -    639 +---
697     -667     -    640 +
698     -668     -    641 +## 6. Browser Compatibility
699     -669     -    642 +
700     -670     -    643 +| Feature | Chrome | Firefox | Safari | Edge | Fallback |
701     -671     -    644 +|---------|--------|---------|--------|------|----------|
702     -672     -    645 +| `scrollIntoView({ behavior })` | 61+ | 36+ | 15.4+ | 79+ | Instant scroll |
703     -673     -    646 +| `scrollend` event | 114+ | 109+ | 17+ | 114+ | setTimeout (1000ms max) |
704     -674     -    647 +| `scroll-padding-top` | 69+ | 68+ | 14.1+ | 79+ | None needed |
705     -675     -    648 +| `CSS.escape()` | 46+ | 31+ | 10+ | 79+ | None needed |
706     -676     -    649 +| `:focus-visible` | 86+ | 85+ | 15.4+ | 86+ | Always show outline |
707     -677     -    650 +
708     -678     -    651 +**Minimum Supported:** Chrome 86, Firefox 85, Safari 15.4, Edge 86
709     -679     -    652 +
710     -680     -    653 +---
711     -681     -    654 +
712     -682     -    655 +## 7. Testing Strategy
713     -683     -    656 +
714     -684     -    657 +### 7.1 Unit Tests
715     -685     -    658 +
716     -686     -    659 +**File: `tests/unit/utils/anchorNavigation.test.js`**
717     -687     -    660 +
718     -688     -    661 +```javascript
719     -689     -    662 +import { describe, it, expect, beforeEach } from 'vitest';
720     -690     -    663 +
721     -691     -    664 +describe('generateSlug', () => {
722     -692     -    665 +  let seen;
723     -693     -    666 +
724     -694     -    667 +  beforeEach(() => {
725     -695     -    668 +    seen = new Map();
726     -696     -    669 +  });
727     -697     -    670 +
728     -698     -    671 +  describe('basic transformations', () => {
729     -699     -    672 +    it('converts to lowercase', () => {
730     -700     -    673 +      expect(generateSlug('HELLO', seen)).toBe('hello');
731     -701     -    674 +    });
732     -702     -    675 +
733     -703     -    676 +    it('replaces spaces with hyphens', () => {
734     -704     -    677 +      expect(generateSlug('hello world', seen)).toBe('hello-world');
735     -705     -    678 +    });
736     -706     -    679 +
737     -707     -    680 +    it('preserves numbers', () => {
738     -708     -    681 +      expect(generateSlug('Section 1', seen)).toBe('section-1');
739     -709     -    682 +    });
740     -710     -    683 +
741     -711     -    684 +    it('preserves underscores', () => {
742     -712     -    685 +      expect(generateSlug('hello_world', seen)).toBe('hello_world');
743     -713     -    686 +    });
744     -714     -    687 +  });
745     -715     -    688 +
746     -716     -    689 +  describe('special characters', () => {
747     -717     -    690 +    it('removes emoji', () => {
748     -718     -    691 +      expect(generateSlug('üéØ Goal', seen)).toBe('goal');
749     -719     -    692 +    });
750     -720     -    693 +
751     -721     -    694 +    it('handles C++', () => {
752     -722     -    695 +      expect(generateSlug('C++', seen)).toBe('cpp');
753     -723     -    696 +    });
754     -724     -    697 +
755     -725     -    698 +    it('handles C#', () => {
756     -726     -    699 +      expect(generateSlug('C#', seen)).toBe('csharp');
757     -727     -    700 +    });
758     -728     -    701 +
759     -729     -    702 +    it('handles F#', () => {
760     -730     -    703 +      expect(generateSlug('F#', seen)).toBe('fsharp');
761     -731     -    704 +    });
762     -732     -    705 +
763     -733     -    706 +    it('handles .NET', () => {
764     -734     -    707 +      expect(generateSlug('.NET Framework', seen)).toBe('dotnet-framework');
765     -735     -    708 +    });
766     -736     -    709 +
767     -737     -    710 +    it('strips periods', () => {
768     -738     -    711 +      expect(generateSlug('API v2.0', seen)).toBe('api-v20');
769     -739     -    712 +    });
770     -740     -    713 +  });
771     -741     -    714 +
772     -742     -    715 +  describe('edge cases', () => {
773     -743     -    716 +    it('collapses multiple hyphens', () => {
774     -744     -    717 +      expect(generateSlug('hello--world', seen)).toBe('hello-world');
775     -745     -    718 +    });
776     -746     -    719 +
777     -747     -    720 +    it('trims leading hyphens', () => {
778     -748     -    721 +      expect(generateSlug('--hello', seen)).toBe('hello');
779     -749     -    722 +    });
780     -750     -    723 +
781     -751     -    724 +    it('trims trailing hyphens', () => {
782     -752     -    725 +      expect(generateSlug('hello--', seen)).toBe('hello');
783     -753     -    726 +    });
784     -754     -    727 +
785     -755     -    728 +    it('returns "section" for empty result', () => {
786     -756     -    729 +      expect(generateSlug('!!!', seen)).toBe('section');
787     -757     -    730 +      expect(generateSlug('üòÄüòÄüòÄ', seen)).toBe('section');
788     -758     -    731 +    });
789     -759     -    732 +
790     -760     -    733 +    it('handles unicode normalization', () => {
791     -761     -    734 +      expect(generateSlug('caf√©', seen)).toBe('caf');
792     -762     -    735 +    });
793     -763     -    736 +
794     -764     -    737 +    it('strips HTML tags', () => {
795     -765     -    738 +      expect(generateSlug('<strong>Bold</strong> text', seen)).toBe('bold-text');
796     -766     -    739 +    });
797     -767     -    740 +  });
798     -768     -    741 +
799     -769     -    742 +  describe('duplicate handling', () => {
800     -770     -    743 +    it('adds suffix for duplicates', () => {
801     -771     -    744 +      expect(generateSlug('Header', seen)).toBe('header');
802     -772     -    745 +      expect(generateSlug('Header', seen)).toBe('header-1');
803     -773     -    746 +      expect(generateSlug('Header', seen)).toBe('header-2');
804     -774     -    747 +    });
805     -775     -    748 +
806     -776     -    749 +    it('tracks different bases separately', () => {
807     -777     -    750 +      expect(generateSlug('Header', seen)).toBe('header');
808     -778     -    751 +      expect(generateSlug('Footer', seen)).toBe('footer');
809     -779     -    752 +      expect(generateSlug('Header', seen)).toBe('header-1');
810     -780     -    753 +    });
811     -781     -    754 +  });
812     -782     -    755 +});
813     -783     -    756 +
814     -784     -    757 +describe('normalizeHash', () => {
815     -785     -    758 +  it('normalizes legacy emoji links', () => {
816     -786     -    759 +    expect(normalizeHash('üéØ-standard-assumptions')).toBe('standard-assumptions');
817     -787     -    760 +  });
818     -788     -    761 +
819     -789     -    762 +  it('normalizes leading hyphens', () => {
820     -790     -    763 +    expect(normalizeHash('-hello-world-')).toBe('hello-world');
821     -791     -    764 +  });
822     -792     -    765 +
823     -793     -    766 +  it('handles programming terms', () => {
824     -794     -    767 +    expect(normalizeHash('c++')).toBe('cpp');
825     -795     -    768 +  });
826     -796     -    769 +});
827     -797     -    770 +```
828     -798     -    771 +
829     -799     -    772 +### 7.2 Manual Test Cases
830     -800     -    773 +
831     -801     -    774 +| # | Scenario | Steps | Expected Result |
832     -802     -    775 +|---|----------|-------|-----------------|
833     -803     -    776 +| 1 | Standard TOC click | Click TOC link `#introduction` | Scrolls to heading, visible below toolbar |
834     -804     -    777 +| 2 | Emoji header | Click `#üéØ-goal` | Resolves to `#goal`, scrolls correctly |
835     -805     -    778 +| 3 | C++ header | Click `#c++` | Resolves to `#cpp`, scrolls correctly |
836     -806     -    779 +| 4 | Deep link | Load `URL#section-1` | Page scrolls to section on load |
837     -807     -    780 +| 5 | Browser back | Click link, then browser back | Returns to previous scroll position |
838     -808     -    781 +| 6 | Empty hash | Click `href="#"` | Scrolls to top of container |
839     -809     -    782 +| 7 | Invalid target | Click `#nonexistent` | Console warning, no crash |
840     -810     -    783 +| 8 | Duplicate headers | Two `## Header` | First is `#header`, second is `#header-1` |
841     -811     -    784 +| 9 | App shell collision | `## Sidebar` heading | Scrolls to user heading, not app `#sidebar` |
842     -812     -    785 +| 10 | Accessibility | Tab to link, press Enter | Focus moves to heading, screen reader announces |
843     -813     -    786 +| 11 | Concurrent clicks | Click A, immediately click B | Only B executes |
844     -814     -    787 +
845     -815     -    788 +---
846     -816     -    789 +
847     -817     -    790 +## 8. Performance Budget
848     -818     -    791 +
849     -819     -    792 +| Metric | Budget | Measurement Method |
850     -820     -    793 +|--------|--------|-------------------|
851     -821     -    794 +| Click-to-scroll latency | < 16ms | `performance.now()` delta |
852     -822     -    795 +| Slug generation per heading | < 1ms | Profile in DevTools |
853     -823     -    796 +| DOM queries per click | ‚â§ 2 | Code review |
854     -824     -    797 +| Memory per session | < 1KB | DevTools heap snapshot |
855     -825     -    798 +| Extension stack size | 1 (no growth) | `marked.defaults.extensions.length` |
856     -826     -    799 +
857     -827     -    800 +---
858     -828     -    801 +
859     -829     -    802 +## 9. Security Considerations
860     -830     -    803 +
861     -831     -    804 +| Concern | Risk | Mitigation |
862     -832     -    805 +|---------|------|------------|
863     -833     -    806 +| XSS via hash | Low | Hash is never inserted into innerHTML |
864     -834     -    807 +| Open redirect | Low | Only same-origin hashes processed |
865     -835     -    808 +| DoS (rapid clicks) | Low | Pending scroll cancellation |
866     -836     -    809 +| Invalid ID injection | Low | `CSS.escape()` for selectors |
867     -837     -    810 +| HTML in headings | Medium | Tags stripped before slug generation |
868     -838     -    811 +
869     -839     -    812 +---
870     -840     -    813 +
871     -841     -    814 +## 10. Rollback Plan
872     -842     -    815 +
873     -843     -    816 +### 10.1 Affected Files
874     -844     -    817 +
875     -845     -    818 +| File | Changes |
876     -846     -    819 +|------|---------|
877     -847     -    820 +| `script.js` | Add AnchorNavigation module, generateSlug, heading renderer |
878     -848     -    821 +| `style.css` | Add scroll-padding, focus-visible styles |
879     -849     -    822 +| `variables.css` | Add --scroll-offset variable |
880     -850     -    823 +
881     -851     -    824 +### 10.2 Rollback Command
882     -852     -    825 +
883     -853     -    826 +```bash
884     -854     -    827 +git checkout HEAD~1 -- script.js style.css variables.css
885     -855     -    828 +```
886     -856     -    829 +
887     -857     -    830 +### 10.3 Rollback Criteria
888     -858     -    831 +
889     -859     -    832 +- Any markdown rendering regression
890     -860     -    833 +- JavaScript console errors
891     -861     -    834 +- Theme switching broken
892     -862     -    835 +- Memory leak detected (extension stacking)
893     -863     -    836 +
894     -864     -    837 +### 10.4 Verification Steps
895     -865     -    838 +
896     -866     -    839 +1. Reload application
897     -867     -    840 +2. Verify no console errors
898     -868     -    841 +3. Type in editor, verify preview updates
899     -869     -    842 +4. Switch themes, verify no errors
900     -870     -    843 +5. Check `marked.defaults` has stable extension count
901     -871     -    844 +
902     -872     -    845 +---
903     -873     -    846 +
904     -874     -    847 +## 11. FAQ
905     -875     -    848 +
906     -876     -    849 +**Q1: Will this break existing functionality?**
907     -877     -    850 +> No. This is an additive feature. Existing markdown rendering is unchanged.
908     -878     -    851 +
909     -879     -    852 +**Q2: What if a heading contains only emoji?**
910     -880     -    853 +> The slug becomes `section` (fallback for empty result).
911     -881     -    854 +
912     -882     -    855 +**Q3: Will this affect HTML export?**
913     -883     -    856 +> Exported HTML will include the generated IDs. Navigation will work if opened in a browser.
914     -884     -    857 +
915     -885     -    858 +**Q4: What about very long headings?**
916     -886     -    859 +> No length limit. The full heading becomes the slug (performance tested up to 1000 chars).
917     -887     -    860 +
918     -888     -    861 +**Q5: Can users manually specify IDs?**
919     -889     -    862 +> Not currently. This would require parsing `{#custom-id}` syntax, which is a future enhancement.
920     -890     -    863 +
921     -891     -    864 +**Q6: What if `marked.use()` is accidentally called in `renderMarkdown()`?**
922     -892     -    865 +> This would cause extension stacking (memory leak). The design explicitly prevents this by registering ONCE in `configureMarkedExtensions()` and only calling `resetSlugMap()` per render.
923     -893     -    866 +
924     -894     -    867 +**Q7: Why use `CSS.escape()` instead of simple string matching?**
925     -895     -    868 +> IDs can contain special CSS selector characters (`.`, `#`, `:`). `CSS.escape()` ensures the querySelector doesn't break.
926     -896     -    869 +
927     -897     -    870 +**Q8: What's the maximum scroll duration?**
928     -898     -    871 +> Capped at 1000ms for the `scrollend` fallback timeout. Smooth scroll itself is browser-controlled.
929     -899     -    872 +
930     -900     -    873 +---
931     -901     -    874 +
932     -902     -    875 +## 12. Approval
933     -903     -    876 +
934     -904     -    877 +| Role | Name | Date | Status |
935     -905     -    878 +|------|------|------|--------|
936     -906     -    879 +| Author | Principal SDE | 2025-12-19 | ‚úÖ Complete |
937     -907     -    880 +| Reviewer | Gemini | 2025-12-19 | ‚úÖ Approved |
938     -908     -    881 +| Implementation | Pending | - | ‚è≥ Ready |
939     -909     -    882 +
940     -910     -    883 +---
941     -911     -    884 +
942     -912     -    885 +## 13. Change Log
943     -913     -    886 +
944     -914     -    887 +| Version | Date | Author | Changes |
945     -915     -    888 +|---------|------|--------|---------|
946     -916     -    889 +| 1.0 | 2025-12-19 | Principal SDE | Initial draft |
947     -917     -    890 +| 2.0 | 2025-12-19 | Principal SDE | Added requirements, edge cases |
948     -918     -    891 +| 3.0 | 2025-12-19 | Gemini | Strict compliance version |
949     -919     -    892 +| 4.0 | 2025-12-19 | Principal SDE | Production-ready with full implementation |
950     -920     -    893 +| 4.1 | 2025-12-19 | Principal SDE | Fixed double offset, pre-compiled regex |
951     -921     -    894 +| 4.2 | 2025-12-19 | Principal SDE | Scoped selection, focus-visible |
952     -922     -    895 +| 4.3 | 2025-12-19 | Gemini | Identified singleton bug |
953     -923     -    896 +| 5.0 | 2025-12-19 | Principal SDE | **FINAL** - Module-level map, reset pattern, singleton-safe |
954     -924     -    897 +
955     -925     -    898 +---
956     -926     -    899 +
957     -927     -    900 +**End of Document**
958     -928     -    901  
959     -929     -
960     -930     -```
961     -931     -
962     -932     -
963     -933     -### ‚ú® `docs/competitive_programming_constraints.md` **[ADDED]**
964     -934     -
965     -935     -**Status:** ‚úÖ **NEW FILE** - This file has been newly created
966     -936     -
967     -937     -**Type:** Documentation üìñ
968     -938     -
969     -939     -```diff
970     -940     -@@ -0,0 +1,621 @@
971     -941     -      1 +# üéØ Coding Interview & Competitive Programming Constraints Guide
972     -942     -      2 +
973     -943     -      3 +### üìù 2025-12-19
974     -944     -      4 +**Category**: `interview prep` | **Level**: `Essential` | **Time**: `15 min read`
975     -945     -      5 +
976     -946     -      6 +> **Master the numbers** that every competitive programmer and interviewee should know by heart!
977     -947     -      7 +
978     -948     -      8 +---
979     -949     -      9 +
980     -950     -     10 +## üìã Table of Contents
981     -951     -     11 +
982     -952     -     12 +1. [Standard Assumptions](#-standard-assumptions)
983     -953     -     13 +2. [Integer Limits & Data Types](#-integer-limits--data-types)
984     -954     -     14 +3. [Array & Container Constraints](#-array--container-constraints)
985     -955     -     15 +4. [String Constraints](#-string-constraints)
986     -956     -     16 +5. [Time Complexity Limits](#-time-complexity-limits)
987     -957     -     17 +6. [Space Complexity Limits](#-space-complexity-limits)
988     -958     -     18 +7. [Common Primes & Mathematical Constants](#-common-primes--mathematical-constants)
989     -959     -     19 +8. [Edge Cases Checklist](#-edge-cases-checklist)
990     -960     -     20 +9. [Platform-Specific Constraints](#-platform-specific-constraints)
991     -961     -     21 +10. [Quick Reference Cheatsheet](#-quick-reference-cheatsheet)
992     -962     -     22 +
993     -963     -     23 +---
994     -964     -     24 +
995     -965     -     25 +## üéØ Standard Assumptions
996     -966     -     26 +
997     -967     -     27 +### The Golden Rules
998     -968     -     28 +
999     -969     -     29 +| Assumption | Typical Value | Reasoning |
1000     -970     -     30 +|------------|---------------|-----------|
1001     -971     -     31 +| **Time Limit** | 1-2 seconds | ~10‚Å∏ simple operations/second |
1002     -972     -     32 +| **Memory Limit** | 256 MB | Standard competitive programming |
1003     -973     -     33 +| **Max Input Size (n)** | 10‚Åµ to 10‚Å∂ | Fits in memory, allows O(n log n) |
1004     -974     -     34 +| **Max Integer Value** | 10‚Åπ | Fits in `int` |
1005     -975     -     35 +| **Large Integer Value** | 10¬π‚Å∏ | Requires `long long` |
1006     -976     -     36 +
1007     -977     -     37 +### What to Ask in Interviews
1008     -978     -     38 +
1009     -979     -     39 +1. **Input size constraints?** (n ‚â§ ?)
1010     -980     -     40 +2. **Value range?** (values ‚â§ ?)
1011     -981     -     41 +3. **Can values be negative?**
1012     -982     -     42 +4. **Are there duplicates?**
1013     -983     -     43 +5. **Is input sorted?**
1014     -984     -     44 +6. **Can input be empty?**
1015     -985     -     45 +
1016     -986     -     46 +---
1017     -987     -     47 +
1018     -988     -     48 +## üî¢ Integer Limits & Data Types
1019     -989     -     49 +
1020     -990     -     50 +### Standard Integer Ranges
1021     -991     -     51 +
1022     -992     -     52 +| Type | Bytes | Range | Max (~) | Use When |
1023     -993     -     53 +|------|-------|-------|---------|----------|
1024     -994     -     54 +| `int` | 4 | -2¬≥¬π to 2¬≥¬π-1 | ¬±2.1√ó10‚Åπ | Default choice |
1025     -995     -     55 +| `unsigned int` | 4 | 0 to 2¬≥¬≤-1 | 4.3√ó10‚Åπ | Non-negative only |
1026     -996     -     56 +| `long long` | 8 | -2‚Å∂¬≥ to 2‚Å∂¬≥-1 | ¬±9.2√ó10¬π‚Å∏ | Large values |
1027     -997     -     57 +| `unsigned long long` | 8 | 0 to 2‚Å∂‚Å¥-1 | 1.8√ó10¬π‚Åπ | Very large non-negative |
1028     -998     -     58 +
1029     -999     -     59 +### Critical Constants (MEMORIZE!)
1030     -1000     -     60 +
1031     -1001     -     61 +```cpp
1032     -1002     -     62 +#include <climits>
1033     -1003     -     63 +
1034     -1004     -     64 +INT_MAX    =  2,147,483,647      // ‚âà 2.1 √ó 10‚Åπ
1035     -1005     -     65 +INT_MIN    = -2,147,483,648      // ‚âà -2.1 √ó 10‚Åπ
1036     -1006     -     66 +LLONG_MAX  =  9,223,372,036,854,775,807  // ‚âà 9.2 √ó 10¬π‚Å∏
1037     -1007     -     67 +LLONG_MIN  = -9,223,372,036,854,775,808  // ‚âà -9.2 √ó 10¬π‚Å∏
1038     -1008     -     68 +
1039     -1009     -     69 +// Quick mental math
1040     -1010     -     70 +INT_MAX   ‚âà 2 √ó 10‚Åπ    (2 billion)
1041     -1011     -     71 +LLONG_MAX ‚âà 9 √ó 10¬π‚Å∏   (9 quintillion)
1042     -1012     -     72 +```
1043     -1013     -     73 +
1044     -1014     -     74 +### When to Use Which Type
1045     -1015     -     75 +
1046     -1016     -     76 +| Problem Constraint | Type to Use | Example |
1047     -1017     -     77 +|-------------------|-------------|---------|
1048     -1018     -     78 +| n ‚â§ 10‚Åµ, values ‚â§ 10‚Åπ | `int` | Most problems |
1049     -1019     -     79 +| Values > 2√ó10‚Åπ | `long long` | Large sums, products |
1050     -1020     -     80 +| Sum of n elements, n ‚â§ 10‚Åµ | `long long` | 10‚Åµ √ó 10‚Åπ = 10¬π‚Å¥ |
1051     -1021     -     81 +| Product of elements | `long long` or modulo | Overflow danger! |
1052     -1022     -     82 +| n √ó n where n ‚â§ 10‚Åµ | `long long` | 10¬π‚Å∞ > INT_MAX |
1053     -1023     -     83 +
1054     -1024     -     84 +### ‚ö†Ô∏è Overflow Danger Zones
1055     -1025     -     85 +
1056     -1026     -     86 +```cpp
1057     -1027     -     87 +// ‚ùå OVERFLOW! (10‚Åµ √ó 10‚Åµ = 10¬π‚Å∞ > INT_MAX)
1058     -1028     -     88 +int n = 100000;
1059     -1029     -     89 +int result = n * n;  // WRONG!
1060     -1030     -     90 +
1061     -1031     -     91 +// ‚úÖ SAFE
1062     -1032     -     92 +long long result = (long long)n * n;
1063     -1033     -     93 +long long result = 1LL * n * n;
1064     -1034     -     94 +
1065     -1035     -     95 +// ‚ùå OVERFLOW! (sum of 10‚Åµ elements each up to 10‚Åπ)
1066     -1036     -     96 +int sum = 0;
1067     -1037     -     97 +for (int x : arr) sum += x;  // WRONG if arr is large!
1068     -1038     -     98 +
1069     -1039     -     99 +// ‚úÖ SAFE
1070     -1040     -    100 +long long sum = 0;
1071     -1041     -    101 +for (int x : arr) sum += x;
1072     -1042     -    102 +```
1073     -1043     -    103 +
1074     -1044     -    104 +### Modular Arithmetic
1075     -1045     -    105 +
1076     -1046     -    106 +When problem says "answer modulo 10‚Åπ+7":
1077     -1047     -    107 +
1078     -1048     -    108 +```cpp
1079     -1049     -    109 +const int MOD = 1e9 + 7;  // 1,000,000,007 (prime)
1080     -1050     -    110 +
1081     -1051     -    111 +// Addition
1082     -1052     -    112 +(a + b) % MOD
1083     -1053     -    113 +
1084     -1054     -    114 +// Subtraction (add MOD to avoid negative)
1085     -1055     -    115 +((a - b) % MOD + MOD) % MOD
1086     -1056     -    116 +
1087     -1057     -    117 +// Multiplication
1088     -1058     -    118 +(1LL * a * b) % MOD  // Cast to long long first!
1089     -1059     -    119 +
1090     -1060     -    120 +// Common modulo values
1091     -1061     -    121 +10‚Åπ + 7  = 1,000,000,007  // Most common (prime)
1092     -1062     -    122 +10‚Åπ + 9  = 1,000,000,009  // Also prime
1093     -1063     -    123 +998244353                  // FFT-friendly prime (2¬≤¬≥ √ó 7 √ó 17 + 1)
1094     -1064     -    124 +```
1095     -1065     -    125 +
1096     -1066     -    126 +---
1097     -1067     -    127 +
1098     -1068     -    128 +## üìä Array & Container Constraints
1099     -1069     -    129 +
1100     -1070     -    130 +### Maximum Array Sizes
1101     -1071     -    131 +
1102     -1072     -    132 +| Memory | Max Elements (`int`) | Max Elements (`long long`) |
1103     -1073     -    133 +|--------|---------------------|---------------------------|
1104     -1074     -    134 +| 256 MB | ~64 million | ~32 million |
1105     -1075     -    135 +| 512 MB | ~128 million | ~64 million |
1106     -1076     -    136 +| 1 GB | ~256 million | ~128 million |
1107     -1077     -    137 +
1108     -1078     -    138 +**Formula:** Max elements = Memory / sizeof(type)
1109     -1079     -    139 +- 256 MB = 256 √ó 10‚Å∂ bytes
1110     -1080     -    140 +- int array: 256 √ó 10‚Å∂ / 4 = 64 √ó 10‚Å∂
1111     -1081     -    141 +
1112     -1082     -    142 +### Typical Constraints by Problem Type
1113     -1083     -    143 +
1114     -1084     -    144 +| Problem Type | Typical n | Expected Complexity |
1115     -1085     -    145 +|--------------|-----------|-------------------|
1116     -1086     -    146 +| Easy | ‚â§ 10¬≥ | O(n¬≤) acceptable |
1117     -1087     -    147 +| Medium | ‚â§ 10‚Åµ | O(n log n) expected |
1118     -1088     -    148 +| Hard | ‚â§ 10‚Å∂ | O(n) or O(n log n) |
1119     -1089     -    149 +| Very Hard | ‚â§ 10‚Å∑ | O(n) only |
1120     -1090     -    150 +
1121     -1091     -    151 +### 2D Array Limits
1122     -1092     -    152 +
1123     -1093     -    153 +```cpp
1124     -1094     -    154 +// Max 2D array with 256MB memory
1125     -1095     -    155 +// n √ó m √ó sizeof(int) ‚â§ 256 √ó 10‚Å∂
1126     -1096     -    156 +
1127     -1097     -    157 +// Safe limits:
1128     -1098     -    158 +int arr[1000][1000];     // 4 MB - ‚úÖ Safe
1129     -1099     -    159 +int arr[5000][5000];     // 100 MB - ‚úÖ Usually safe
1130     -1100     -    160 +int arr[10000][10000];   // 400 MB - ‚ùå Too large!
1131     -1101     -    161 +
1132     -1102     -    162 +// For larger grids, use vector (dynamic allocation)
1133     -1103     -    163 +vector<vector<int>> grid(n, vector<int>(m));
1134     -1104     -    164 +```
1135     -1105     -    165 +
1136     -1106     -    166 +### Container Memory Usage
1137     -1107     -    167 +
1138     -1108     -    168 +| Container | Memory per Element | Notes |
1139     -1109     -    169 +|-----------|-------------------|-------|
1140     -1110     -    170 +| `vector<int>` | 4 bytes | Most efficient |
1141     -1111     -    171 +| `deque<int>` | 4 bytes + overhead | Block allocation |
1142     -1112     -    172 +| `list<int>` | 4 + 16 bytes | Node pointers |
1143     -1113     -    173 +| `set<int>` | 4 + 32 bytes | Red-black tree |
1144     -1114     -    174 +| `unordered_set<int>` | 4 + ~8 bytes | Hash table |
1145     -1115     -    175 +| `map<int,int>` | 8 + 32 bytes | Red-black tree |
1146     -1116     -    176 +| `unordered_map<int,int>` | 8 + ~16 bytes | Hash table |
1147     -1117     -    177 +
1148     -1118     -    178 +---
1149     -1119     -    179 +
1150     -1120     -    180 +## üìù String Constraints
1151     -1121     -    181 +
1152     -1122     -    182 +### String Length Limits
1153     -1123     -    183 +
1154     -1124     -    184 +| Constraint | Typical Value | Common Problems |
1155     -1125     -    185 +|------------|---------------|-----------------|
1156     -1126     -    186 +| Short strings | ‚â§ 100 | Brute force OK |
1157     -1127     -    187 +| Medium strings | ‚â§ 10‚Åµ | O(n) required |
1158     -1128     -    188 +| Long strings | ‚â§ 10‚Å∂ | O(n) only |
1159     -1129     -    189 +| Multiple strings | Total length ‚â§ 10‚Å∂ | Sum constraint |
1160     -1130     -    190 +
1161     -1131     -    191 +### Character Set Assumptions
1162     -1132     -    192 +
1163     -1133     -    193 +```cpp
1164     -1134     -    194 +// Lowercase letters only: 'a' to 'z' (26 chars)
1165     -1135     -    195 +int freq[26] = {0};
1166     -1136     -    196 +freq[ch - 'a']++;
1167     -1137     -    197 +
1168     -1138     -    198 +// All letters: 'A'-'Z', 'a'-'z' (52 chars)
1169     -1139     -    199 +// Usually case-insensitive or convert to one case
1170     -1140     -    200 +
1171     -1141     -    201 +// Digits: '0' to '9' (10 chars)
1172     -1142     -    202 +int digit = ch - '0';
1173     -1143     -    203 +
1174     -1144     -    204 +// ASCII printable: 32 to 126 (95 chars)
1175     -1145     -    205 +int freq[128] = {0};  // Safe for all ASCII
1176     -1146     -    206 +
1177     -1147     -    207 +// Unicode: Use std::string with UTF-8
1178     -1148     -    208 +// Careful: string[i] may not be a full character!
1179     -1149     -    209 +```
1180     -1150     -    210 +
1181     -1151     -    211 +### String Comparison Complexity
1182     -1152     -    212 +
1183     -1153     -    213 +```cpp
1184     -1154     -    214 +// Comparing two strings of length n and m
1185     -1155     -    215 +s1 == s2;           // O(min(n, m))
1186     -1156     -    216 +s1.compare(s2);     // O(min(n, m))
1187     -1157     -    217 +s1 < s2;            // O(min(n, m))
1188     -1158     -    218 +
1189     -1159     -    219 +// For multiple comparisons, use hashing
1190     -1160     -    220 +hash<string> hasher;
1191     -1161     -    221 +size_t h = hasher(s);
1192     -1162     -    222 +```
1193     -1163     -    223 +
1194     -1164     -    224 +---
1195     -1165     -    225 +
1196     -1166     -    226 +## ‚è±Ô∏è Time Complexity Limits
1197     -1167     -    227 +
1198     -1168     -    228 +### Operations per Second
1199     -1169     -    229 +
1200     -1170     -    230 +| Operation Type | Operations/Second |
1201     -1171     -    231 +|---------------|-------------------|
1202     -1172     -    232 +| Simple arithmetic | ~10‚Åπ |
1203     -1173     -    233 +| Array access | ~10‚Å∏ - 10‚Åπ |
1204     -1174     -    234 +| Vector operations | ~10‚Å∏ |
1205     -1175     -    235 +| Set/Map operations | ~10‚Å∑ |
1206     -1176     -    236 +| String operations | ~10‚Å∑ |
1207     -1177     -    237 +| I/O (cin/cout) | ~10‚Å∂ (without fast I/O) |
1208     -1178     -    238 +| I/O (fast I/O) | ~10‚Å∑ |
1209     -1179     -    239 +
1210     -1180     -    240 +### Maximum n for Time Limits
1211     -1181     -    241 +
1212     -1182     -    242 +| Time Limit | O(n) | O(n log n) | O(n¬≤) | O(n¬≥) | O(2‚Åø) |
1213     -1183     -    243 +|------------|------|------------|-------|-------|-------|
1214     -1184     -    244 +| 1 second | 10‚Å∏ | 10‚Å∂-10‚Å∑ | 10‚Å¥ | 500 | 25 |
1215     -1185     -    245 +| 2 seconds | 2√ó10‚Å∏ | 2√ó10‚Å∑ | 1.4√ó10‚Å¥ | 600 | 26 |
1216     -1186     -    246 +| 5 seconds | 5√ó10‚Å∏ | 5√ó10‚Å∑ | 2√ó10‚Å¥ | 800 | 28 |
1217     -1187     -    247 +
1218     -1188     -    248 +### Quick Complexity Check
1219     -1189     -    249 +
1220     -1190     -    250 +```cpp
1221     -1191     -    251 +// Given n, what's the max acceptable complexity?
1222     -1192     -    252 +n ‚â§ 10     ‚Üí O(n!) or O(2‚Åø) OK
1223     -1193     -    253 +n ‚â§ 20     ‚Üí O(2‚Åø) OK, O(n!) too slow
1224     -1194     -    254 +n ‚â§ 100    ‚Üí O(n¬≥) OK
1225     -1195     -    255 +n ‚â§ 1000   ‚Üí O(n¬≤) OK
1226     -1196     -    256 +n ‚â§ 10‚Åµ    ‚Üí O(n log n) or better
1227     -1197     -    257 +n ‚â§ 10‚Å∂    ‚Üí O(n log n) risky, O(n) preferred
1228     -1198     -    258 +n ‚â§ 10‚Å∏    ‚Üí O(n) only
1229     -1199     -    259 +```
1230     -1200     -    260 +
1231     -1201     -    261 +### Reverse: Given Complexity, Max n
1232     -1202     -    262 +
1233     -1203     -    263 +| Complexity | Max n (1 sec) |
1234     -1204     -    264 +|------------|---------------|
1235     -1205     -    265 +| O(n!) | n ‚â§ 10 |
1236     -1206     -    266 +| O(2‚Åø) | n ‚â§ 20-25 |
1237     -1207     -    267 +| O(n¬≥) | n ‚â§ 500 |
1238     -1208     -    268 +| O(n¬≤ log n) | n ‚â§ 1000 |
1239     -1209     -    269 +| O(n¬≤) | n ‚â§ 5000-10000 |
1240     -1210     -    270 +| O(n‚àön) | n ‚â§ 10‚Åµ |
1241     -1211     -    271 +| O(n log n) | n ‚â§ 10‚Å∂-10‚Å∑ |
1242     -1212     -    272 +| O(n) | n ‚â§ 10‚Å∏ |
1243     -1213     -    273 +| O(log n) | n ‚â§ 10¬π‚Å∏ |
1244     -1214     -    274 +| O(1) | n = anything |
1245     -1215     -    275 +
1246     -1216     -    276 +---
1247     -1217     -    277 +
1248     -1218     -    278 +## üíæ Space Complexity Limits
1249     -1219     -    279 +
1250     -1220     -    280 +### Memory Calculation
1251     -1221     -    281 +
1252     -1222     -    282 +```cpp
1253     -1223     -    283 +// Typical memory limits
1254     -1224     -    284 +256 MB = 256 √ó 10‚Å∂ bytes = 64 √ó 10‚Å∂ ints
1255     -1225     -    285 +512 MB = 512 √ó 10‚Å∂ bytes = 128 √ó 10‚Å∂ ints
1256     -1226     -    286 +
1257     -1227     -    287 +// Stack vs Heap
1258     -1228     -    288 +// Stack: Limited (~1-8 MB) - local variables, recursion
1259     -1229     -    289 +// Heap: Limited by problem constraint - new, vector
1260     -1230     -    290 +
1261     -1231     -    291 +// Recursion depth limit (stack)
1262     -1232     -    292 +// ~10‚Å¥ - 10‚Åµ calls typically safe
1263     -1233     -    293 +// Deep recursion may cause stack overflow!
1264     -1234     -    294 +
1265     -1235     -    295 +// Tail recursion or iteration preferred for deep recursion
1266     -1236     -    296 +```
1267     -1237     -    297 +
1268     -1238     -    298 +### Data Structure Space
1269     -1239     -    299 +
1270     -1240     -    300 +| Structure | Space | Example |
1271     -1241     -    301 +|-----------|-------|---------|
1272     -1242     -    302 +| Array of n ints | 4n bytes | n = 10‚Å∂ ‚Üí 4 MB |
1273     -1243     -    303 +| n √ó n int matrix | 4n¬≤ bytes | n = 5000 ‚Üí 100 MB |
1274     -1244     -    304 +| Adjacency list | O(V + E) | |
1275     -1245     -    305 +| Adjacency matrix | O(V¬≤) | |
1276     -1246     -    306 +| Binary tree (n nodes) | ~32n bytes | Node + 2 pointers |
1277     -1247     -    307 +| Graph (V vertices, E edges) | V + E | Adjacency list |
1278     -1248     -    308 +
1279     -1249     -    309 +---
1280     -1250     -    310 +
1281     -1251     -    311 +## üî¢ Common Primes & Mathematical Constants
1282     -1252     -    312 +
1283     -1253     -    313 +### Primes to Know
1284     -1254     -    314 +
1285     -1255     -    315 +```cpp
1286     -1256     -    316 +// For modular arithmetic
1287     -1257     -    317 +10‚Åπ + 7 = 1,000,000,007  // Most common modulo (prime)
1288     -1258     -    318 +10‚Åπ + 9 = 1,000,000,009  // Alternative (prime)
1289     -1259     -    319 +998244353                 // NTT prime (2¬≤¬≥ √ó 7 √ó 17 + 1)
1290     -1260     -    320 +
1291     -1261     -    321 +// Small primes for hashing
1292     -1262     -    322 +31, 37, 53, 97, 131, 1009, 10007
1293     -1263     -    323 +
1294     -1264     -    324 +// For string hashing (rolling hash)
1295     -1265     -    325 +base = 31 or 37 (for lowercase letters)
1296     -1266     -    326 +base = 53 (for mixed case)
1297     -1267     -    327 +mod = 10‚Åπ + 7 or 10‚Åπ + 9
1298     -1268     -    328 +
1299     -1269     -    329 +// Largest prime ‚â§ n
1300     -1270     -    330 +// Under 100: 97
1301     -1271     -    331 +// Under 1000: 997
1302     -1272     -    332 +// Under 10000: 9973
1303     -1273     -    333 +// Under 10‚Åµ: 99991
1304     -1274     -    334 +// Under 10‚Å∂: 999983
1305     -1275     -    335 +// Under 10‚Åπ: 999999937
1306     -1276     -    336 +```
1307     -1277     -    337 +
1308     -1278     -    338 +### Mathematical Constants
1309     -1279     -    339 +
1310     -1280     -    340 +```cpp
1311     -1281     -    341 +// For geometry and floating point
1312     -1282     -    342 +const double PI = acos(-1);        // 3.14159265358979...
1313     -1283     -    343 +const double PI = 3.14159265358979323846;
1314     -1284     -    344 +const double E = exp(1);           // 2.71828...
1315     -1285     -    345 +
1316     -1286     -    346 +// For comparison (floating point tolerance)
1317     -1287     -    347 +const double EPS = 1e-9;
1318     -1288     -    348 +if (abs(a - b) < EPS) // a == b
1319     -1289     -    349 +
1320     -1290     -    350 +// For "infinity" in algorithms
1321     -1291     -    351 +const int INF = 1e9;           // For int (won't overflow on add)
1322     -1292     -    352 +const int INF = INT_MAX / 2;   // Safe for addition
1323     -1293     -    353 +const long long INF = 1e18;    // For long long
1324     -1294     -    354 +const long long INF = LLONG_MAX / 2;
1325     -1295     -    355 +```
1326     -1296     -    356 +
1327     -1297     -    357 +### Useful Mathematical Facts
1328     -1298     -    358 +
1329     -1299     -    359 +```cpp
1330     -1300     -    360 +// Factorials
1331     -1301     -    361 +10! = 3,628,800             // Fits in int
1332     -1302     -    362 +12! = 479,001,600           // Last to fit in int
1333     -1303     -    363 +13! = 6,227,020,800         // Needs long long
1334     -1304     -    364 +20! ‚âà 2.4 √ó 10¬π‚Å∏            // Last to fit in long long
1335     -1305     -    365 +21! overflows long long!
1336     -1306     -    366 +
1337     -1307     -    367 +// Powers of 2
1338     -1308     -    368 +2¬π‚Å∞ = 1,024 ‚âà 10¬≥
1339     -1309     -    369 +2¬≤‚Å∞ = 1,048,576 ‚âà 10‚Å∂
1340     -1310     -    370 +2¬≥‚Å∞ = 1,073,741,824 ‚âà 10‚Åπ
1341     -1311     -    371 +2¬≥¬≤ = 4,294,967,296 ‚âà 4 √ó 10‚Åπ (unsigned int max + 1)
1342     -1312     -    372 +2‚Å∂‚Å¥ ‚âà 1.8 √ó 10¬π‚Åπ
1343     -1313     -    373 +
1344     -1314     -    374 +// Fibonacci
1345     -1315     -    375 +F(45) = 1,134,903,170       // Last to fit in int
1346     -1316     -    376 +F(92) = 7,540,113,804,746,346,429  // Last to fit in long long
1347     -1317     -    377 +
1348     -1318     -    378 +// Catalan numbers (combinatorics)
1349     -1319     -    379 +C(17) = 129,644,790         // Fits in int
1350     -1320     -    380 +C(35) = 3,116,285,494,907,301,262  // Fits in long long
1351     -1321     -    381 +```
1352     -1322     -    382 +
1353     -1323     -    383 +---
1354     -1324     -    384 +
1355     -1325     -    385 +## ‚úÖ Edge Cases Checklist
1356     -1326     -    386 +
1357     -1327     -    387 +### Array/Vector Edge Cases
1358     -1328     -    388 +
1359     -1329     -    389 +```cpp
1360     -1330     -    390 +// Always test:
1361     -1331     -    391 +‚ñ° Empty array (n = 0)
1362     -1332     -    392 +‚ñ° Single element (n = 1)
1363     -1333     -    393 +‚ñ° Two elements (n = 2)
1364     -1334     -    394 +‚ñ° All same elements
1365     -1335     -    395 +‚ñ° Already sorted (ascending)
1366     -1336     -    396 +‚ñ° Reverse sorted (descending)
1367     -1337     -    397 +‚ñ° Maximum size (n = max constraint)
1368     -1338     -    398 +‚ñ° Negative numbers
1369     -1339     -    399 +‚ñ° Zero values
1370     -1340     -    400 +‚ñ° INT_MAX / INT_MIN values
1371     -1341     -    401 +‚ñ° Duplicates at boundaries
1372     -1342     -    402 +```
1373     -1343     -    403 +
1374     -1344     -    404 +### String Edge Cases
1375     -1345     -    405 +
1376     -1346     -    406 +```cpp
1377     -1347     -    407 +// Always test:
1378     -1348     -    408 +‚ñ° Empty string (s = "")
1379     -1349     -    409 +‚ñ° Single character (s = "a")
1380     -1350     -    410 +‚ñ° All same character (s = "aaa")
1381     -1351     -    411 +‚ñ° Palindrome
1382     -1352     -    412 +‚ñ° All unique characters
1383     -1353     -    413 +‚ñ° Maximum length
1384     -1354     -    414 +‚ñ° Spaces/special characters (if allowed)
1385     -1355     -    415 +‚ñ° Case sensitivity (if relevant)
1386     -1356     -    416 +```
1387     -1357     -    417 +
1388     -1358     -    418 +### Graph Edge Cases
1389     -1359     -    419 +
1390     -1360     -    420 +```cpp
1391     -1361     -    421 +// Always test:
1392     -1362     -    422 +‚ñ° Empty graph (no edges)
1393     -1363     -    423 +‚ñ° Single node
1394     -1364     -    424 +‚ñ° Disconnected graph
1395     -1365     -    425 +‚ñ° Complete graph
1396     -1366     -    426 +‚ñ° Tree (n-1 edges)
1397     -1367     -    427 +‚ñ° Cycle
1398     -1368     -    428 +‚ñ° Self-loop (if allowed)
1399     -1369     -    429 +‚ñ° Multiple edges between same nodes
1400     -1370     -    430 +‚ñ° Negative edge weights (if allowed)
1401     -1371     -    431 +‚ñ° All edges same weight
1402     -1372     -    432 +```
1403     -1373     -    433 +
1404     -1374     -    434 +### Tree Edge Cases
1405     -1375     -    435 +
1406     -1376     -    436 +```cpp
1407     -1377     -    437 +// Always test:
1408     -1378     -    438 +‚ñ° Empty tree (null root)
1409     -1379     -    439 +‚ñ° Single node
1410     -1380     -    440 +‚ñ° Skewed tree (all left or all right)
1411     -1381     -    441 +‚ñ° Perfect/complete binary tree
1412     -1382     -    442 +‚ñ° Maximum depth
1413     -1383     -    443 +‚ñ° All same values
1414     -1384     -    444 +‚ñ° Negative values (if allowed)
1415     -1385     -    445 +```
1416     -1386     -    446 +
1417     -1387     -    447 +### Number Edge Cases
1418     -1388     -    448 +
1419     -1389     -    449 +```cpp
1420     -1390     -    450 +// Always test:
1421     -1391     -    451 +‚ñ° Zero (0)
1422     -1392     -    452 +‚ñ° Negative zero (-0 for floating point)
1423     -1393     -    453 +‚ñ° INT_MAX (2,147,483,647)
1424     -1394     -    454 +‚ñ° INT_MIN (-2,147,483,648)
1425     -1395     -    455 +‚ñ° Powers of 2
1426     -1396     -    456 +‚ñ° One less than power of 2
1427     -1397     -    457 +‚ñ° Prime numbers
1428     -1398     -    458 +‚ñ° Perfect squares
1429     -1399     -    459 +‚ñ° Negative numbers
1430     -1400     -    460 +‚ñ° Very small positive (1)
1431     -1401     -    461 +‚ñ° Very large (max constraint)
1432     -1402     -    462 +```
1433     -1403     -    463 +
1434     -1404     -    464 +### Binary Search Edge Cases
1435     -1405     -    465 +
1436     -1406     -    466 +```cpp
1437     -1407     -    467 +// Always test:
1438     -1408     -    468 +‚ñ° Target at index 0
1439     -1409     -    469 +‚ñ° Target at last index
1440     -1410     -    470 +‚ñ° Target not in array
1441     -1411     -    471 +‚ñ° Target smaller than all elements
1442     -1412     -    472 +‚ñ° Target larger than all elements
1443     -1413     -    473 +‚ñ° All elements are target
1444     -1414     -    474 +‚ñ° Single element equals target
1445     -1415     -    475 +‚ñ° Single element doesn't equal target
1446     -1416     -    476 +‚ñ° Two elements
1447     -1417     -    477 +```
1448     -1418     -    478 +
1449     -1419     -    479 +---
1450     -1420     -    480 +
1451     -1421     -    481 +## üñ•Ô∏è Platform-Specific Constraints
1452     -1422     -    482 +
1453     -1423     -    483 +### LeetCode
1454     -1424     -    484 +
1455     -1425     -    485 +```cpp
1456     -1426     -    486 +// Typical constraints
1457     -1427     -    487 +n ‚â§ 10‚Åµ (most problems)
1458     -1428     -    488 +n ‚â§ 10¬≥ (allows O(n¬≤))
1459     -1429     -    489 +n ‚â§ 10‚Å¥ (O(n¬≤) risky)
1460     -1430     -    490 +Values: -10‚Åπ to 10‚Åπ (fits in int)
1461     -1431     -    491 +
1462     -1432     -    492 +// Time limit: Usually generous
1463     -1433     -    493 +// Memory: 256 MB typical
1464     -1434     -    494 +
1465     -1435     -    495 +// Fast I/O not needed (uses function calls)
1466     -1436     -    496 +```
1467     -1437     -    497 +
1468     -1438     -    498 +### Codeforces
1469     -1439     -    499 +
1470     -1440     -    500 +```cpp
1471     -1441     -    501 +// Typical constraints
1472     -1442     -    502 +n ‚â§ 2 √ó 10‚Åµ (common)
1473     -1443     -    503 +n ‚â§ 10‚Å∂ (harder problems)
1474     -1444     -    504 +Time: 1-2 seconds
1475     -1445     -    505 +Memory: 256 MB (standard)
1476     -1446     -    506 +
1477     -1447     -    507 +// Fast I/O REQUIRED for large input
1478     -1448     -    508 +ios::sync_with_stdio(false);
1479     -1449     -    509 +cin.tie(nullptr);
1480     -1450     -    510 +```
1481     -1451     -    511 +
1482     -1452     -    512 +### HackerRank
1483     -1453     -    513 +
1484     -1454     -    514 +```cpp
1485     -1455     -    515 +// Varies by problem
1486     -1456     -    516 +// Often has multiple test cases
1487     -1457     -    517 +// Time limits can be strict
1488     -1458     -    518 +// Fast I/O recommended
1489     -1459     -    519 +
1490     -1460     -    520 +// Multiple test cases pattern
1491     -1461     -    521 +int t;
1492     -1462     -    522 +cin >> t;
1493     -1463     -    523 +while (t--) {
1494     -1464     -    524 +    // solve
1495     -1465     -    525 +}
1496     -1466     -    526 +```
1497     -1467     -    527 +
1498     -1468     -    528 +### Google/FAANG Interviews
1499     -1469     -    529 +
1500     -1470     -    530 +```cpp
1501     -1471     -    531 +// Focus on:
1502     -1472     -    532 +- Optimal time complexity
1503     -1473     -    533 +- Clean, readable code
1504     -1474     -    534 +- Handle all edge cases
1505     -1475     -    535 +- Discuss trade-offs
1506     -1476     -    536 +
1507     -1477     -    537 +// Typical expectations:
1508     -1478     -    538 +n ‚â§ 10‚Åµ to 10‚Å∂
1509     -1479     -    539 +Time: O(n) or O(n log n)
1510     -1480     -    540 +Space: O(1) to O(n)
1511     -1481     -    541 +```
1512     -1482     -    542 +
1513     -1483     -    543 +---
1514     -1484     -    544 +
1515     -1485     -    545 +## üìã Quick Reference Cheatsheet
1516     -1486     -    546 +
1517     -1487     -    547 +### Numbers to Memorize
1518     -1488     -    548 +
1519     -1489     -    549 +| Value | Meaning | Use Case |
1520     -1490     -    550 +|-------|---------|----------|
1521     -1491     -    551 +| 10‚Åπ | ~INT_MAX / 2 | Safe int limit |
1522     -1492     -    552 +| 2 √ó 10‚Åπ | ~INT_MAX | Max positive int |
1523     -1493     -    553 +| 10¬π‚Å∏ | ~LLONG_MAX / 9 | Safe long long |
1524     -1494     -    554 +| 10‚Åπ + 7 | Common modulo | Modular arithmetic |
1525     -1495     -    555 +| 10‚Åµ | Typical n limit | O(n log n) problems |
1526     -1496     -    556 +| 10‚Å¥ | O(n¬≤) threshold | When O(n¬≤) is OK |
1527     -1497     -    557 +| 20-25 | 2‚Åø threshold | Bitmask/subset problems |
1528     -1498     -    558 +| 10 | n! threshold | Permutation problems |
1529     -1499     -    559 +
1530     -1500     -    560 +### Quick Type Selection
1531     -1501     -    561 +
1532     -1502     -    562 +```cpp
1533     -1503     -    563 +// Default
1534     -1504     -    564 +int x;                  // Values ‚â§ 10‚Åπ
1535     -1505     -    565 +
1536     -1506     -    566 +// Large values
1537     -1507     -    567 +long long x;           // Values > 2√ó10‚Åπ
1538     -1508     -    568 +
1539     -1509     -    569 +// Large sums
1540     -1510     -    570 +long long sum = 0;     // Sum of many ints
1541     -1511     -    571 +
1542     -1512     -    572 +// Products
1543     -1513     -    573 +long long prod = 1LL * a * b;  // Multiply ints
1544     -1514     -    574 +
1545     -1515     -    575 +// Modular
1546     -1516     -    576 +const int MOD = 1e9 + 7;
1547     -1517     -    577 +((1LL * a * b) % MOD)
1548     -1518     -    578 +```
1549     -1519     -    579 +
1550     -1520     -    580 +### Fast I/O Template
1551     -1521     -    581 +
1552     -1522     -    582 +```cpp
1553     -1523     -    583 +#include <bits/stdc++.h>
1554     -1524     -    584 +using namespace std;
1555     -1525     -    585 +
1556     -1526     -    586 +int main() {
1557     -1527     -    587 +    ios::sync_with_stdio(false);
1558     -1528     -    588 +    cin.tie(nullptr);
1559     -1529     -    589 +
1560     -1530     -    590 +    // Your code here
1561     -1531     -    591 +
1562     -1532     -    592 +    return 0;
1563     -1533     -    593 +}
1564     -1534     -    594 +```
1565     -1535     -    595 +
1566     -1536     -    596 +### Infinity Values
1567     -1537     -    597 +
1568     -1538     -    598 +```cpp
1569     -1539     -    599 +// For shortest path, DP
1570     -1540     -    600 +const int INF = 1e9;           // int infinity
1571     -1541     -    601 +const long long INF = 1e18;    // long long infinity
1572     -1542     -    602 +
1573     -1543     -    603 +// For comparisons (safe for addition)
1574     -1544     -    604 +const int INF = INT_MAX / 2;
1575     -1545     -    605 +const long long INF = LLONG_MAX / 2;
1576     -1546     -    606 +```
1577     -1547     -    607 +
1578     -1548     -    608 +---
1579     -1549     -    609 +
1580     -1550     -    610 +## üéØ Interview Tips
1581     -1551     -    611 +
1582     -1552     -    612 +1. **Always ask for constraints first** - Determines algorithm choice
1583     -1553     -    613 +2. **State assumptions explicitly** - "I'm assuming n ‚â§ 10‚Åµ"
1584     -1554     -    614 +3. **Check for overflow** - Especially with multiplication and sums
1585     -1555     -    615 +4. **Use appropriate data types** - `long long` when in doubt
1586     -1556     -    616 +5. **Test edge cases mentally** - Before coding, walk through edge cases
1587     -1557     -    617 +6. **Know your constants** - INT_MAX, 10‚Åπ+7, complexity thresholds
1588     -1558     -    618 +
1589     -1559     -    619 +---
1590     -1560     -    620 +
1591     -1561     -    621 +*Last Updated: December 19, 2025*
1592     -1562     -    622  
1593     -1563     -
1594     -1564     -```
1595     -1565     -
1596     -1566     -
1597     -1567     -### üìÑ `script.js`
1598     -1568     -
1599     -1569     -**Type:** JavaScript Source File üü®
1600     -1570     -
1601     -1571     -```diff
1602     -1572     -@@ -29,6 +29,242 @@ window.katex = katex;
1603     -1573     - 29  29  window.html2pdf = html2pdf;
1604     -1574     - 30  30  window.markedFootnote = markedFootnote;
1605     -1575     - 31  31  
1606     -1576     -     32 +// ==================== ANCHOR NAVIGATION ====================
1607     -1577     -     33 +// Heading slug tracking (module-level singleton for marked.js singleton)
1608     -1578     -     34 +const headingSlugMap = new Map();
1609     -1579     -     35 +
1610     -1580     -     36 +// Pre-compiled slug replacements (zero GC pressure per render)
1611     -1581     -     37 +const SLUG_REPLACEMENTS = [
1612     -1582     -     38 +  [/c\+\+/gi, 'cpp'],
1613     -1583     -     39 +  [/c#/gi, 'csharp'],
1614     -1584     -     40 +  [/f#/gi, 'fsharp'],
1615     -1585     -     41 +  [/\.net/gi, 'dotnet'],
1616     -1586     -     42 +];
1617     -1587     -     43 +
1618     -1588     -     44 +/**
1619     -1589     -     45 + * Reset slug map (call before each parse)
1620     -1590     -     46 + */
1621     -1591     -     47 +function resetSlugMap() {
1622     -1592     -     48 +  headingSlugMap.clear();
1623     -1593     -     49 +}
1624     -1594     -     50 +
1625     -1595     -     51 +/**
1626     -1596     -     52 + * Generate URL-safe slug from heading text
1627     -1597     -     53 + * @param {string} text - Raw heading text (may include HTML)
1628     -1598     -     54 + * @param {Map<string, number>} seen - Duplicate tracking map
1629     -1599     -     55 + * @returns {string} URL-safe slug
1630     -1600     -     56 + */
1631     -1601     -     57 +function generateSlug(text, seen = headingSlugMap) {
1632     -1602     -     58 +  // Strip HTML tags
1633     -1603     -     59 +  let slug = text.replace(/<[^>]*>/g, '');
1634     -1604     -     60 +
1635     -1605     -     61 +  // Normalize Unicode
1636     -1606     -     62 +  slug = slug.normalize('NFC').toLowerCase();
1637     -1607     -     63 +
1638     -1608     -     64 +  // Replace programming terms (pre-compiled patterns)
1639     -1609     -     65 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
1640     -1610     -     66 +    slug = slug.replace(pattern, replacement);
1641     -1611     -     67 +  }
1642     -1612     -     68 +
1643     -1613     -     69 +  // Clean up: remove non-word chars, spaces to hyphens, collapse hyphens
1644     -1614     -     70 +  slug = slug
1645     -1615     -     71 +    .replace(/[^\w\s-]/g, '')
1646     -1616     -     72 +    .replace(/\s+/g, '-')
1647     -1617     -     73 +    .replace(/-+/g, '-')
1648     -1618     -     74 +    .replace(/^-+|-+$/g, '');
1649     -1619     -     75 +
1650     -1620     -     76 +  // Fallback for empty result
1651     -1621     -     77 +  if (!slug) slug = 'section';
1652     -1622     -     78 +
1653     -1623     -     79 +  // Handle duplicates (header, header-1, header-2)
1654     -1624     -     80 +  const baseSlug = slug;
1655     -1625     -     81 +  const count = seen.get(baseSlug) || 0;
1656     -1626     -     82 +  if (count > 0) slug = `${baseSlug}-${count}`;
1657     -1627     -     83 +  seen.set(baseSlug, count + 1);
1658     -1628     -     84 +
1659     -1629     -     85 +  return slug;
1660     -1630     -     86 +}
1661     -1631     -     87 +
1662     -1632     -     88 +/**
1663     -1633     -     89 + * Anchor Navigation Module
1664     -1634     -     90 + * Handles in-document anchor navigation with scoped selection
1665     -1635     -     91 + */
1666     -1636     -     92 +const AnchorNavigation = {
1667     -1637     -     93 +  container: null,
1668     -1638     -     94 +  pendingScroll: null,
1669     -1639     -     95 +
1670     -1640     -     96 +  /**
1671     -1641     -     97 +   * Initialize anchor navigation
1672     -1642     -     98 +   * @param {HTMLElement} previewContainer - Scrollable preview container
1673     -1643     -     99 +   */
1674     -1644     -    100 +  init(previewContainer) {
1675     -1645     -    101 +    this.container = previewContainer;
1676     -1646     -    102 +
1677     -1647     -    103 +    // Event delegation for anchor clicks
1678     -1648     -    104 +    this.container.addEventListener('click', this.handleClick.bind(this));
1679     -1649     -    105 +
1680     -1650     -    106 +    // Browser back/forward navigation
1681     -1651     -    107 +    window.addEventListener('hashchange', this.handleHashChange.bind(this));
1682     -1652     -    108 +
1683     -1653     -    109 +    // Initial page load with hash
1684     -1654     -    110 +    if (window.location.hash) {
1685     -1655     -    111 +      requestAnimationFrame(() => {
1686     -1656     -    112 +        this.scrollToHash(window.location.hash.slice(1), false);
1687     -1657     -    113 +      });
1688     -1658     -    114 +    }
1689     -1659     -    115 +
1690     -1660     -    116 +    console.log('‚úÖ Anchor navigation initialized');
1691     -1661     -    117 +  },
1692     -1662     -    118 +
1693     -1663     -    119 +  /**
1694     -1664     -    120 +   * Handle click events (delegated)
1695     -1665     -    121 +   */
1696     -1666     -    122 +  handleClick(event) {
1697     -1667     -    123 +    const link = event.target.closest('a[href^="#"]');
1698     -1668     -    124 +    if (!link) return;
1699     -1669     -    125 +
1700     -1670     -    126 +    // Ignore external links
1701     -1671     -    127 +    if (link.hostname && link.hostname !== window.location.hostname) return;
1702     -1672     -    128 +
1703     -1673     -    129 +    event.preventDefault();
1704     -1674     -    130 +
1705     -1675     -    131 +    const hash = link.getAttribute('href').slice(1);
1706     -1676     -    132 +    this.scrollToHash(hash, true);
1707     -1677     -    133 +
1708     -1678     -    134 +    // Update URL without triggering hashchange
1709     -1679     -    135 +    history.pushState(null, '', `#${hash}`);
1710     -1680     -    136 +  },
1711     -1681     -    137 +
1712     -1682     -    138 +  /**
1713     -1683     -    139 +   * Handle hashchange (browser back/forward)
1714     -1684     -    140 +   */
1715     -1685     -    141 +  handleHashChange() {
1716     -1686     -    142 +    const hash = window.location.hash.slice(1);
1717     -1687     -    143 +    if (hash) {
1718     -1688     -    144 +      this.scrollToHash(hash, true);
1719     -1689     -    145 +    } else {
1720     -1690     -    146 +      this.scrollToTop(true);
1721     -1691     -    147 +    }
1722     -1692     -    148 +  },
1723     -1693     -    149 +
1724     -1694     -    150 +  /**
1725     -1695     -    151 +   * Scroll to element by hash
1726     -1696     -    152 +   * @param {string} hash - URL hash (without #)
1727     -1697     -    153 +   * @param {boolean} smooth - Use smooth scrolling
1728     -1698     -    154 +   */
1729     -1699     -    155 +  scrollToHash(hash, smooth = true) {
1730     -1700     -    156 +    // Cancel pending scroll (handle concurrent clicks)
1731     -1701     -    157 +    if (this.pendingScroll) {
1732     -1702     -    158 +      clearTimeout(this.pendingScroll);
1733     -1703     -    159 +      this.pendingScroll = null;
1734     -1704     -    160 +    }
1735     -1705     -    161 +
1736     -1706     -    162 +    if (!hash) {
1737     -1707     -    163 +      this.scrollToTop(smooth);
1738     -1708     -    164 +      return;
1739     -1709     -    165 +    }
1740     -1710     -    166 +
1741     -1711     -    167 +    const target = this.resolveTarget(hash);
1742     -1712     -    168 +    if (!target) return;
1743     -1713     -    169 +
1744     -1714     -    170 +    target.scrollIntoView({
1745     -1715     -    171 +      behavior: smooth ? 'smooth' : 'instant',
1746     -1716     -    172 +      block: 'start',
1747     -1717     -    173 +    });
1748     -1718     -    174 +
1749     -1719     -    175 +    this.manageFocus(target, smooth);
1750     -1720     -    176 +  },
1751     -1721     -    177 +
1752     -1722     -    178 +  /**
1753     -1723     -    179 +   * Scroll to top of container
1754     -1724     -    180 +   */
1755     -1725     -    181 +  scrollToTop(smooth = true) {
1756     -1726     -    182 +    this.container.scrollTo({
1757     -1727     -    183 +      top: 0,
1758     -1728     -    184 +      behavior: smooth ? 'smooth' : 'instant',
1759     -1729     -    185 +    });
1760     -1730     -    186 +  },
1761     -1731     -    187 +
1762     -1732     -    188 +  /**
1763     -1733     -    189 +   * Resolve target element - SCOPED to container (prevents app shell collision)
1764     -1734     -    190 +   * @param {string} hash - URL hash
1765     -1735     -    191 +   * @returns {Element|null} Target element or null
1766     -1736     -    192 +   */
1767     -1737     -    193 +  resolveTarget(hash) {
1768     -1738     -    194 +    if (!hash) return null;
1769     -1739     -    195 +
1770     -1740     -    196 +    // Decode URI components safely
1771     -1741     -    197 +    let decodedHash;
1772     -1742     -    198 +    try {
1773     -1743     -    199 +      decodedHash = decodeURIComponent(hash);
1774     -1744     -    200 +    } catch {
1775     -1745     -    201 +      decodedHash = hash;
1776     -1746     -    202 +    }
1777     -1747     -    203 +
1778     -1748     -    204 +    // Priority 1: Exact ID (SCOPED to container)
1779     -1749     -    205 +    let target = this.container.querySelector(`#${CSS.escape(decodedHash)}`);
1780     -1750     -    206 +    if (target) return target;
1781     -1751     -    207 +
1782     -1752     -    208 +    // Priority 2: Normalized ID (handles legacy links with emoji, special chars)
1783     -1753     -    209 +    const normalized = this.normalizeHash(decodedHash);
1784     -1754     -    210 +    target = this.container.querySelector(`#${CSS.escape(normalized)}`);
1785     -1755     -    211 +    if (target) return target;
1786     -1756     -    212 +
1787     -1757     -    213 +    console.warn(`[AnchorNav] Target not found: "${hash}"`);
1788     -1758     -    214 +    return null;
1789     -1759     -    215 +  },
1790     -1760     -    216 +
1791     -1761     -    217 +  /**
1792     -1762     -    218 +   * Normalize hash for legacy link matching
1793     -1763     -    219 +   * @param {string} hash - Raw hash string
1794     -1764     -    220 +   * @returns {string} Normalized hash
1795     -1765     -    221 +   */
1796     -1766     -    222 +  normalizeHash(hash) {
1797     -1767     -    223 +    let slug = hash.normalize('NFC').toLowerCase();
1798     -1768     -    224 +
1799     -1769     -    225 +    // Apply same transformations as generateSlug
1800     -1770     -    226 +    for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
1801     -1771     -    227 +      slug = slug.replace(pattern, replacement);
1802     -1772     -    228 +    }
1803     -1773     -    229 +
1804     -1774     -    230 +    return slug
1805     -1775     -    231 +      .replace(/[^\w\s-]/g, '')
1806     -1776     -    232 +      .replace(/\s+/g, '-')
1807     -1777     -    233 +      .replace(/-+/g, '-')
1808     -1778     -    234 +      .replace(/^-+|-+$/g, '') || 'section';
1809     -1779     -    235 +  },
1810     -1780     -    236 +
1811     -1781     -    237 +  /**
1812     -1782     -    238 +   * Manage focus after scroll (accessibility)
1813     -1783     -    239 +   * @param {Element} target - Target element
1814     -1784     -    240 +   * @param {boolean} smooth - Was smooth scroll used
1815     -1785     -    241 +   */
1816     -1786     -    242 +  manageFocus(target, smooth) {
1817     -1787     -    243 +    const focusTarget = () => {
1818     -1788     -    244 +      // Make heading focusable if not already
1819     -1789     -    245 +      if (!target.hasAttribute('tabindex')) {
1820     -1790     -    246 +        target.setAttribute('tabindex', '-1');
1821     -1791     -    247 +      }
1822     -1792     -    248 +      target.focus({ preventScroll: true });
1823     -1793     -    249 +    };
1824     -1794     -    250 +
1825     -1795     -    251 +    if (!smooth) {
1826     -1796     -    252 +      focusTarget();
1827     -1797     -    253 +      return;
1828     -1798     -    254 +    }
1829     -1799     -    255 +
1830     -1800     -    256 +    // Modern browsers: use scrollend event
1831     -1801     -    257 +    if ('onscrollend' in this.container) {
1832     -1802     -    258 +      this.container.addEventListener('scrollend', focusTarget, { once: true });
1833     -1803     -    259 +    } else {
1834     -1804     -    260 +      // Fallback: estimate scroll duration (max 1000ms for safety)
1835     -1805     -    261 +      const distance = Math.abs(target.getBoundingClientRect().top);
1836     -1806     -    262 +      const duration = Math.min(Math.max(distance / 2, 300), 1000);
1837     -1807     -    263 +      this.pendingScroll = setTimeout(focusTarget, duration + 50);
1838     -1808     -    264 +    }
1839     -1809     -    265 +  },
1840     -1810     -    266 +};
1841     -1811     -    267 +
1842     -1812     - 32 268  // Initialize services and managers
1843     -1813     - 33 269  const storageManager = new StorageManager();
1844     -1814     - 34 270  const themeManager = new ThemeManager(storageManager);
1845     -1815     -@@ -360,6 +596,19 @@ function configureMarkedExtensions() {
1846     -1816     -360 596    });
1847     -1817     -361 597  
1848     -1818     -362 598    console.log('‚úÖ Marked.js configured with all extensions (LaTeX, subscript, superscript)');
1849     -1819     -    599 +
1850     -1820     -    600 +  // Custom heading renderer with ID generation for anchor navigation
1851     -1821     -    601 +  marked.use({
1852     -1822     -    602 +    renderer: {
1853     -1823     -    603 +      heading(token) {
1854     -1824     -    604 +        const text = this.parser.parseInline(token.tokens);
1855     -1825     -    605 +        const level = token.depth;
1856     -1826     -    606 +        const slug = generateSlug(text, headingSlugMap);
1857     -1827     -    607 +        return `<h${level} id="${slug}">${text}</h${level}>\n`;
1858     -1828     -    608 +      }
1859     -1829     -    609 +    }
1860     -1830     -    610 +  });
1861     -1831     -    611 +  console.log('‚úÖ Custom heading renderer enabled (anchor navigation IDs)');
1862     -1832     -363 612  }
1863     -1833     -364 613  
1864     -1834     -365 614  // Initialize Mermaid using MermaidService (prefixed to indicate future use)
1865     -1835     -@@ -550,6 +799,9 @@ graph TD
1866     -1836     -550 799    // Render markdown (expose globally for theme changes)
1867     -1837     -551 800    function renderMarkdown() {
1868     -1838     -552 801      try {
1869     -1839     -    802 +      // Reset slug map before parsing (singleton-safe pattern)
1870     -1840     -    803 +      resetSlugMap();
1871     -1841     -    804 +
1872     -1842     -553 805        const markdownText = editor.value;
1873     -1843     -554 806  
1874     -1844     -555 807        // Parse markdown with all extensions
1875     -1845     -@@ -2001,6 +2253,9 @@ Wrap up your thoughts and include a call to action.
1876     -1846     -2001 2253    // Initialize expand button visibility on load
1877     -1847     -2002 2254    updateExpandButtonVisibility();
1878     -1848     -2003 2255  
1879     -1849     -    2256 +  // Initialize anchor navigation for TOC links
1880     -1850     -    2257 +  AnchorNavigation.init(previewContainer);
1881     -1851     -    2258 +
1882     -1852     -2004 2259    // DON'T render immediately - wait for theme to load
1883     -1853     -2005 2260    // renderMarkdown will be called after theme loads above
1884     -1854     -2006 2261  }
1885     -1855     -2007 2262  
1886     -1856     -
1887     -1857     -```
1888     -1858     -
1889     -1859     -
1890     -1860     -### üìÑ `style.css`
1891     -1861     -
1892     -1862     -**Type:** Stylesheet üé®
1893     -1863     -
1894     -1864     -```diff
1895     -1865     -@@ -224,6 +224,47 @@ body {
1896     -1866     -224 224    overflow: auto;
1897     -1867     -225 225    /* Single scrollbar for preview container */
1898     -1868     -226 226    min-width: 200px;
1899     -1869     -    227 +  /* Anchor Navigation - scroll offset for fixed toolbar */
1900     -1870     -    228 +  scroll-padding-top: var(--scroll-offset, 80px);
1901     -1871     -    229 +}
1902     -1872     -    230 +
1903     -1873     -    231 +/* ==================== ANCHOR NAVIGATION ==================== */
1904     -1874     -    232 +
1905     -1875     -    233 +/* Target highlight animation */
1906     -1876     -    234 +.preview-container :target {
1907     -1877     -    235 +  animation: anchor-highlight 2s ease-out;
1908     -1878     -    236 +}
1909     -1879     -    237 +
1910     -1880     -    238 +@keyframes anchor-highlight {
1911     -1881     -    239 +  0% {
1912     -1882     -    240 +    background-color: rgba(255, 255, 0, 0.3);
1913     -1883     -    241 +  }
1914     -1884     -    242 +
1915     -1885     -    243 +  100% {
1916     -1886     -    244 +    background-color: transparent;
1917     -1887     -    245 +  }
1918     -1888     -    246 +}
1919     -1889     -    247 +
1920     -1890     -    248 +/* Focus management - hide outline for mouse clicks */
1921     -1891     -    249 +.preview-container h1[id]:focus:not(:focus-visible),
1922     -1892     -    250 +.preview-container h2[id]:focus:not(:focus-visible),
1923     -1893     -    251 +.preview-container h3[id]:focus:not(:focus-visible),
1924     -1894     -    252 +.preview-container h4[id]:focus:not(:focus-visible),
1925     -1895     -    253 +.preview-container h5[id]:focus:not(:focus-visible),
1926     -1896     -    254 +.preview-container h6[id]:focus:not(:focus-visible) {
1927     -1897     -    255 +  outline: none;
1928     -1898     -    256 +}
1929     -1899     -    257 +
1930     -1900     -    258 +/* Keyboard focus gets visible indicator */
1931     -1901     -    259 +.preview-container h1[id]:focus-visible,
1932     -1902     -    260 +.preview-container h2[id]:focus-visible,
1933     -1903     -    261 +.preview-container h3[id]:focus-visible,
1934     -1904     -    262 +.preview-container h4[id]:focus-visible,
1935     -1905     -    263 +.preview-container h5[id]:focus-visible,
1936     -1906     -    264 +.preview-container h6[id]:focus-visible {
1937     -1907     -    265 +  outline: 2px solid var(--h1-color, #007bff);
1938     -1908     -    266 +  outline-offset: 4px;
1939     -1909     -    267 +  border-radius: 2px;
1940     -1910     -227 268  }
1941     -1911     -228 269  
1942     -1912     -229 270  .preview-header {
1943     -1913     -230 271  
1944     -1914     -
1945     -1915     -```
1946     -1916     -
1947     -1917     -
1948     -1918     -### üìÑ `variables.css`
1949     -1919     -
1950     -1920     -**Type:** Stylesheet üé®
1951     -1921     -
1952     -1922     -```diff
1953     -1923     -@@ -11,13 +11,18 @@
1954     -1924     - 11  11    /* ==================== NEBULA DARK (Default) ==================== */
1955     -1925     - 12  12  
1956     -1926     - 13  13    /* Core Backgrounds */
1957     -1927     - 14     -  --bg-universe: #050508;     /* The void */
1958     -1928     - 15     -  --bg-element: #0f1123;      /* Solid panels if needed */
1959     -1929     -     14 +  --bg-universe: #050508;
1960     -1930     -     15 +  /* The void */
1961     -1931     -     16 +  --bg-element: #0f1123;
1962     -1932     -     17 +  /* Solid panels if needed */
1963     -1933     - 16  18  
1964     -1934     - 17  19    /* Glass System */
1965     -1935     - 18     -  --bg-glass: rgba(15, 17, 35, 0.6);        /* Main panels */
1966     -1936     - 19     -  --bg-glass-heavy: rgba(10, 12, 25, 0.85); /* Sidebar/Modals */
1967     -1937     - 20     -  --bg-glass-light: rgba(255, 255, 255, 0.05); /* Hover states */
1968     -1938     -     20 +  --bg-glass: rgba(15, 17, 35, 0.6);
1969     -1939     -     21 +  /* Main panels */
1970     -1940     -     22 +  --bg-glass-heavy: rgba(10, 12, 25, 0.85);
1971     -1941     -     23 +  /* Sidebar/Modals */
1972     -1942     -     24 +  --bg-glass-light: rgba(255, 255, 255, 0.05);
1973     -1943     -     25 +  /* Hover states */
1974     -1944     - 21  26  
1975     -1945     - 22  27    /* Borders */
1976     -1946     - 23  28    --border-glass: rgba(255, 255, 255, 0.08);
1977     -1947     -@@ -44,6 +49,10 @@
1978     -1948     - 44  49    --radius-lg: 16px;
1979     -1949     - 45  50    --radius-md: 12px;
1980     -1950     - 46  51    --radius-sm: 8px;
1981     -1951     -     52 +
1982     -1952     -     53 +  /* Anchor Navigation */
1983     -1953     -     54 +  --scroll-padding: 20px;
1984     -1954     -     55 +  --scroll-offset: calc(var(--header-height) + var(--scroll-padding));
1985     -1955     - 47  56  }
1986     -1956     - 48  57  
1987     -1957     - 49  58  /* ==================== NEBULA LIGHT ==================== */
1988     -1958     - 50  59  
1989     -     21 +@@ -1,4 +1,4 @@
1990     -     22 +  1     -# üîç Code Review - 12/19/2025, 4:19:18 PM
1991     -     23 +      1 +# üîç Code Review - 12/19/2025, 7:26:20 PM
1992     -     24 +  2   2  
1993     -     25 +  3   3  **Project:** AI Visual Code Review
1994     -     26 +  4   4  **Generated by:** AI Visual Code Review v2.0
1995     -     27 +@@ -6,1560 +6,1618 @@
1996     -     28 +  6   6  ## üìä Change Summary
1997     -     29 +  7   7  
1998     -     30 +  8   8  ```
1999     -     31 +  9     -.../toc-anchor-navigation-design-v5.md             | 900 +++++++++++++++++++++
2000     -     32 + 10     - docs/competitive_programming_constraints.md        | 621 ++++++++++++++
2001     -     33 + 11     - script.js                                          | 255 ++++++
2002     -     34 + 12     - style.css                                          |  41 +
2003     -     35 + 13     - variables.css                                      |  19 +-
2004     -     36 + 14     - 5 files changed, 1831 insertions(+), 5 deletions(-)
2005     -     37 +      9 +README.md                                          |   27 +
2006     -     38 +     10 + docs/01-requirements/donation-feature-plan.md      | 1063 ++++++++++++++++++++
2007     -     39 +     11 + .../donation_final_readiness_review.md             |   91 ++
2008     -     40 +     12 + docs/01-requirements/donation_strategy_review.md   |   64 ++
2009     -     41 +     13 + docs/01-requirements/donation_system_design.md     |  141 +++
2010     -     42 +     14 + .../donation_technical_feasibility_review.md       |   87 ++
2011     -     43 +     15 + index.html                                         |   22 +-
2012     -     44 +     16 + script.js                                          |  114 +++
2013     -     45 +     17 + style.css                                          |  119 +++
2014     -     46 +     18 + 9 files changed, 1722 insertions(+), 6 deletions(-)
2015     -     47 + 15  19  ```
2016     -     48 + 16  20  
2017     -     49 + 17     -## üìù Files Changed (5/5 selected)
2018     -     50 +     21 +## üìù Files Changed (9/9 selected)
2019     -     51 + 18  22  
2020     -     52 + 19  23  
2021     -     53 + 20     -### ‚ú® `docs/01-requirements/toc-anchor-navigation-design-v5.md` **[ADDED]**
2022     -     54 + 21     -
2023     -     55 + 22     -**Status:** ‚úÖ **NEW FILE** - This file has been newly created
2024     -     56 +     24 +### üìÑ `README.md`
2025     -     57 + 23  25  
2026     -     58 + 24  26  **Type:** Documentation üìñ
2027     -     59 + 25  27  
2028     -     60 + 26  28  ```diff
2029     -     61 + 27     -@@ -0,0 +1,900 @@
2030     -     62 + 28     -      1 +# Design Document: Table of Contents Anchor Navigation
2031     -     63 + 29     -      2 +
2032     -     64 + 30     -      3 +## Version 5.0 (Production Ready - Final)
2033     -     65 + 31     -      4 +
2034     -     66 + 32     -      5 +---
2035     -     67 + 33     -      6 +
2036     -     68 + 34     -      7 +**Document ID:** DD-2025-002-TOC-NAV
2037     -     69 + 35     -      8 +**Author:** Principal SDE
2038     -     70 + 36     -      9 +**Created:** December 19, 2025
2039     -     71 + 37     -     10 +**Last Updated:** December 19, 2025
2040     -     72 + 38     -     11 +**Status:** ‚úÖ **APPROVED FOR IMPLEMENTATION**
2041     -     73 + 39     -     12 +**Review Cycles:** 8 (v1.0 ‚Üí v2.0 ‚Üí v3.0 ‚Üí v4.0 ‚Üí v4.1 ‚Üí v4.2 ‚Üí v4.3 ‚Üí v5.0)
2042     -     74 +     29 +@@ -7,6 +7,10 @@
2043     -     75 +     30 +  7   7  [![Code Quality](https://img.shields.io/badge/code%20quality-A+-brightgreen)]()
2044     -     76 +     31 +  8   8  [![Zero Technical Debt](https://img.shields.io/badge/technical%20debt-zero-brightgreen)]()
2045     -     77 +     32 +  9   9  
2046     -     78 +     33 +     10 +[![GitHub Sponsors](https://img.shields.io/badge/Sponsor-%E2%9D%A4-pink?logo=github)](https://github.com/sponsors/PrakharMNNIT)
2047     -     79 +     34 +     11 +[![Ko-fi](https://img.shields.io/badge/Ko--fi-Support-blue?logo=ko-fi)](https://ko-fi.com/praxlannister)
2048     -     80 +     35 +     12 +[![Razorpay](https://img.shields.io/badge/Razorpay-‚Çπ_Support-brightgreen)](https://razorpay.me/@prakharshekharparthasarthi)
2049     -     81 + 40  36       13 +
2050     -     82 + 41     -     14 +---
2051     -     83 + 42     -     15 +
2052     -     84 + 43     -     16 +## Table of Contents
2053     -     85 + 44     -     17 +
2054     -     86 + 45     -     18 +1. [Executive Summary](#1-executive-summary)
2055     -     87 + 46     -     19 +2. [Problem Statement](#2-problem-statement)
2056     -     88 + 47     -     20 +3. [Requirements](#3-requirements)
2057     -     89 + 48     -     21 +4. [Technical Design](#4-technical-design)
2058     -     90 + 49     -     22 +5. [Implementation Details](#5-implementation-details)
2059     -     91 + 50     -     23 +6. [Browser Compatibility](#6-browser-compatibility)
2060     -     92 + 51     -     24 +7. [Testing Strategy](#7-testing-strategy)
2061     -     93 + 52     -     25 +8. [Performance Budget](#8-performance-budget)
2062     -     94 + 53     -     26 +9. [Security Considerations](#9-security-considerations)
2063     -     95 + 54     -     27 +10. [Rollback Plan](#10-rollback-plan)
2064     -     96 + 55     -     28 +11. [FAQ](#11-faq)
2065     -     97 + 56     -     29 +12. [Approval](#12-approval)
2066     -     98 + 57     -     30 +13. [Change Log](#13-change-log)
2067     -     99 + 58     -     31 +
2068     -    100 + 59     -     32 +---
2069     -    101 + 60     -     33 +
2070     -    102 + 61     -     34 +## 1. Executive Summary
2071     -    103 + 62     -     35 +
2072     -    104 + 63     -     36 +This document specifies the implementation of in-document anchor navigation for Markdown Viewer Pro. The feature enables clicking Table of Contents links to scroll the preview container to the target heading, with full accessibility support and legacy link compatibility.
2073     -    105 + 64     -     37 +
2074     -    106 + 65     -     38 +**Key Features:**
2075     -    107 + 66     -     39 +- Smooth scroll to headings on TOC link click
2076     -    108 + 67     -     40 +- Support for emoji and special character headings
2077     -    109 + 68     -     41 +- Legacy link compatibility (non-standard ID formats)
2078     -    110 + 69     -     42 +- Accessibility-compliant focus management
2079     -    111 + 70     -     43 +- Deep linking (URL hash on page load)
2080     -    112 + 71     -     44 +- Browser history support (back/forward)
2081     -    113 + 72     -     45 +
2082     -    114 + 73     -     46 +---
2083     -    115 + 74     -     47 +
2084     -    116 + 75     -     48 +## 2. Problem Statement
2085     -    117 + 76     -     49 +
2086     -    118 + 77     -     50 +### 2.1 Root Cause
2087     -    119 + 78     -     51 +
2088     -    120 + 79     -     52 +The application uses a **non-scrollable document body** (`overflow: hidden`) with content rendered inside a scrollable child container (`.preview-container`). When users click anchor links (`href="#section"`), the browser's native scroll algorithm targets the document viewport‚Äîwhich is non-scrollable‚Äîresulting in **silent failure**.
2089     -    121 + 80     -     53 +
2090     -    122 + 81     -     54 +### 2.2 Sticky Toolbar Occlusion
2091     -    123 + 82     -     55 +
2092     -    124 + 83     -     56 +The application has a fixed toolbar (height: `60px`). A naive scroll-to-element positions content at `top: 0`, causing it to be **obscured by the toolbar**.
2093     -    125 + 84     -     57 +
2094     -    126 + 85     -     58 +### 2.3 Legacy Link Compatibility
2095     -    127 + 86     -     59 +
2096     -    128 + 87     -     60 +Existing markdown documents contain manually-created links using non-standard ID formats (e.g., `#üìã-table-of-contents` or `#-standard-assumptions`). These must resolve correctly.
2097     -    129 + 88     -     61 +
2098     -    130 + 89     -     62 +### 2.4 App Shell ID Collision
2099     -    131 + 90     -     63 +
2100     -    132 + 91     -     64 +The application shell has elements with IDs like `sidebar`, `preview`, `editor`. User-authored headings with the same names must NOT collide with app shell elements.
2101     -    133 + 92     -     65 +
2102     -    134 + 93     -     66 +### 2.5 marked.js Singleton Constraint
2103     -    135 + 94     -     67 +
2104     -    136 + 95     -     68 +`marked` is imported as a global singleton. Calling `marked.use()` inside `renderMarkdown()` (which runs on every keystroke) would stack infinite extensions, causing:
2105     -    137 + 96     -     69 +- **Memory leak:** `marked.defaults.extensions` grows infinitely
2106     -    138 + 97     -     70 +- **Performance degradation:** After 100 keystrokes, marked runs 100 identical renderers
2107     -    139 + 98     -     71 +
2108     -    140 + 99     -     72 +---
2109     -    141 +100     -     73 +
2110     -    142 +101     -     74 +## 3. Requirements
2111     -    143 +102     -     75 +
2112     -    144 +103     -     76 +### 3.1 Functional Requirements
2113     -    145 +104     -     77 +
2114     -    146 +105     -     78 +| ID | Requirement | Priority | Acceptance Criteria |
2115     -    147 +106     -     79 +|----|-------------|----------|---------------------|
2116     -    148 +107     -     80 +| FR-1 | Internal anchor clicks scroll preview to target | P0 | Target heading visible within 800ms |
2117     -    149 +108     -     81 +| FR-2 | Scrolled content not occluded by toolbar | P0 | 20px gap between toolbar and heading |
2118     -    150 +109     -     82 +| FR-3 | URL hash updates on navigation | P0 | URL reflects current section |
2119     -    151 +110     -     83 +| FR-4 | Deep linking works on page load | P0 | `URL#section` scrolls on load |
2120     -    152 +111     -     84 +| FR-5 | Browser back/forward navigates history | P1 | Hash changes scroll correctly |
2121     -    153 +112     -     85 +| FR-6 | Legacy links work (emoji, special chars) | P0 | See compatibility matrix |
2122     -    154 +113     -     86 +| FR-7 | Focus moves to target for screen readers | P0 | Screen reader announces heading |
2123     -    155 +114     -     87 +| FR-8 | Empty hash (`#`) scrolls to top | P1 | Container scrollTop = 0 |
2124     -    156 +115     -     88 +| FR-9 | No collision with app shell IDs | P0 | User `## Sidebar` != app `#sidebar` |
2125     -    157 +116     -     89 +| FR-10 | Duplicate headings get unique IDs | P0 | `header`, `header-1`, `header-2` |
2126     -    158 +117     -     90 +
2127     -    159 +118     -     91 +### 3.2 Non-Functional Requirements
2128     -    160 +119     -     92 +
2129     -    161 +120     -     93 +| ID | Requirement | Target |
2130     -    162 +121     -     94 +|----|-------------|--------|
2131     -    163 +122     -     95 +| NFR-1 | Click-to-scroll latency | < 16ms (1 frame) |
2132     -    164 +123     -     96 +| NFR-2 | Scroll animation duration | 300-800ms (distance-based) |
2133     -    165 +124     -     97 +| NFR-3 | No layout thrashing | 0 forced reflows |
2134     -    166 +125     -     98 +| NFR-4 | Memory overhead | < 1KB per session |
2135     -    167 +126     -     99 +| NFR-5 | No memory leaks | Zero extension stacking |
2136     -    168 +127     -    100 +| NFR-6 | Stateless rendering | Module-level map with reset |
2137     -    169 +128     -    101 +
2138     -    170 +129     -    102 +### 3.3 Edge Cases
2139     -    171 +130     -    103 +
2140     -    172 +131     -    104 +| Case | Input | Expected Behavior |
2141     -    173 +132     -    105 +|------|-------|-------------------|
2142     -    174 +133     -    106 +| Empty hash | `href="#"` | Scroll to top (scrollTop = 0) |
2143     -    175 +134     -    107 +| Non-existent target | `href="#nonexistent"` | Console warning, no action |
2144     -    176 +135     -    108 +| External link | `href="https://..."` | Browser default behavior |
2145     -    177 +136     -    109 +| Duplicate headers | Two `## Header` | IDs: `header`, `header-1` |
2146     -    178 +137     -    110 +| App shell collision | `## Sidebar` | Resolves to user content, not `#sidebar` |
2147     -    179 +138     -    111 +| Special chars | `## C++` | ID: `cpp` |
2148     -    180 +139     -    112 +| Emoji | `## üéØ Goal` | ID: `goal` |
2149     -    181 +140     -    113 +| Concurrent clicks | Click A, then B rapidly | Cancel A, execute B |
2150     -    182 +141     -    114 +| Already visible | Target in viewport | Smooth scroll anyway |
2151     -    183 +142     -    115 +
2152     -    184 +143     -    116 +---
2153     -    185 +144     -    117 +
2154     -    186 +145     -    118 +## 4. Technical Design
2155     -    187 +146     -    119 +
2156     -    188 +147     -    120 +### 4.1 Architecture Overview
2157     -    189 +148     -    121 +
2158     -    190 +149     -    122 +```
2159     -    191 +150     -    123 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
2160     -    192 +151     -    124 +‚îÇ                     User Interaction                          ‚îÇ
2161     -    193 +152     -    125 +‚îÇ  [Click] ‚îÄ‚îÄ‚ñ∫ [hashchange] ‚îÄ‚îÄ‚ñ∫ [Page Load with Hash]          ‚îÇ
2162     -    194 +153     -    126 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
2163     -    195 +154     -    127 +                       ‚îÇ
2164     -    196 +155     -    128 +                       ‚ñº
2165     -    197 +156     -    129 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
2166     -    198 +157     -    130 +‚îÇ                 AnchorNavigation Module                       ‚îÇ
2167     -    199 +158     -    131 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
2168     -    200 +159     -    132 +‚îÇ  ‚îÇ handleClick()  ‚îÇ  ‚îÇhandleHashChange‚îÇ  ‚îÇhandleInitLoad()‚îÇ  ‚îÇ
2169     -    201 +160     -    133 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
2170     -    202 +161     -    134 +‚îÇ          ‚îÇ                   ‚îÇ                   ‚îÇ            ‚îÇ
2171     -    203 +162     -    135 +‚îÇ          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
2172     -    204 +163     -    136 +‚îÇ                              ‚ñº                                ‚îÇ
2173     -    205 +164     -    137 +‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
2174     -    206 +165     -    138 +‚îÇ                   ‚îÇ  scrollToTarget()   ‚îÇ                     ‚îÇ
2175     -    207 +166     -    139 +‚îÇ                   ‚îÇ  ‚îî‚îÄ resolveTarget() ‚îÇ  ‚óÑ‚îÄ‚îÄ SCOPED to      ‚îÇ
2176     -    208 +167     -    140 +‚îÇ                   ‚îÇ  ‚îî‚îÄ scrollIntoView  ‚îÇ      container      ‚îÇ
2177     -    209 +168     -    141 +‚îÇ                   ‚îÇ  ‚îî‚îÄ manageFocus()   ‚îÇ                     ‚îÇ
2178     -    210 +169     -    142 +‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
2179     -    211 +170     -    143 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
2180     -    212 +171     -    144 +```
2181     -    213 +172     -    145 +
2182     -    214 +173     -    146 +### 4.2 Slug Generation Algorithm
2183     -    215 +174     -    147 +
2184     -    216 +175     -    148 +**Purpose:** Generate consistent, collision-free IDs for headings.
2185     -    217 +176     -    149 +
2186     -    218 +177     -    150 +**Algorithm (GitHub-compatible with programming term support):**
2187     -    219 +178     -    151 +
2188     -    220 +179     -    152 +```javascript
2189     -    221 +180     -    153 +// Pre-compiled regex patterns (module level - zero GC pressure)
2190     -    222 +181     -    154 +const SLUG_REPLACEMENTS = [
2191     -    223 +182     -    155 +  [/c\+\+/gi, 'cpp'],
2192     -    224 +183     -    156 +  [/c#/gi, 'csharp'],
2193     -    225 +184     -    157 +  [/f#/gi, 'fsharp'],
2194     -    226 +185     -    158 +  [/\.net/gi, 'dotnet'],
2195     -    227 +186     -    159 +];
2196     -    228 +187     -    160 +
2197     -    229 +188     -    161 +/**
2198     -    230 +189     -    162 + * Generate URL-safe slug from heading text
2199     -    231 +190     -    163 + * @param {string} text - Raw heading text (may include HTML)
2200     -    232 +191     -    164 + * @param {Map<string, number>} seen - Duplicate tracking map
2201     -    233 +192     -    165 + * @returns {string} URL-safe slug
2202     -    234 +193     -    166 + */
2203     -    235 +194     -    167 +function generateSlug(text, seen = new Map()) {
2204     -    236 +195     -    168 +  // Step 0: Strip HTML tags
2205     -    237 +196     -    169 +  let slug = text.replace(/<[^>]*>/g, '');
2206     -    238 +197     -    170 +
2207     -    239 +198     -    171 +  // Step 1: Normalize Unicode (handle caf√© vs caf√©)
2208     -    240 +199     -    172 +  slug = slug.normalize('NFC');
2209     -    241 +200     -    173 +
2210     -    242 +201     -    174 +  // Step 2: Lowercase
2211     -    243 +202     -    175 +  slug = slug.toLowerCase();
2212     -    244 +203     -    176 +
2213     -    245 +204     -    177 +  // Step 3: Replace programming terms (pre-compiled patterns)
2214     -    246 +205     -    178 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
2215     -    247 +206     -    179 +    slug = slug.replace(pattern, replacement);
2216     -    248 +207     -    180 +  }
2217     -    249 +208     -    181 +
2218     -    250 +209     -    182 +  // Step 4: Remove non-word chars (keep spaces, hyphens, underscores)
2219     -    251 +210     -    183 +  slug = slug.replace(/[^\w\s-]/g, '');
2220     -    252 +211     -    184 +
2221     -    253 +212     -    185 +  // Step 5: Spaces to hyphens
2222     -    254 +213     -    186 +  slug = slug.replace(/\s+/g, '-');
2223     -    255 +214     -    187 +
2224     -    256 +215     -    188 +  // Step 6: Collapse multiple hyphens
2225     -    257 +216     -    189 +  slug = slug.replace(/-+/g, '-');
2226     -    258 +217     -    190 +
2227     -    259 +218     -    191 +  // Step 7: Trim hyphens
2228     -    260 +219     -    192 +  slug = slug.replace(/^-+|-+$/g, '');
2229     -    261 +220     -    193 +
2230     -    262 +221     -    194 +  // Step 8: Fallback for empty result
2231     -    263 +222     -    195 +  if (!slug) slug = 'section';
2232     -    264 +223     -    196 +
2233     -    265 +224     -    197 +  // Step 9: Handle duplicates (header, header-1, header-2)
2234     -    266 +225     -    198 +  const baseSlug = slug;
2235     -    267 +226     -    199 +  const count = seen.get(baseSlug) || 0;
2236     -    268 +227     -    200 +  if (count > 0) {
2237     -    269 +228     -    201 +    slug = `${baseSlug}-${count}`;
2238     -    270 +229     -    202 +  }
2239     -    271 +230     -    203 +  seen.set(baseSlug, count + 1);
2240     -    272 +231     -    204 +
2241     -    273 +232     -    205 +  return slug;
2242     -    274 +233     -    206 +}
2243     -    275 +234     -    207 +```
2244     -    276 +235     -    208 +
2245     -    277 +236     -    209 +**Transformation Examples:**
2246     -    278 +237     -    210 +
2247     -    279 +238     -    211 +| Input | Output | Reason |
2248     -    280 +239     -    212 +|-------|--------|--------|
2249     -    281 +240     -    213 +| `Hello World` | `hello-world` | Standard |
2250     -    282 +241     -    214 +| `üéØ Standard Assumptions` | `standard-assumptions` | Emoji stripped |
2251     -    283 +242     -    215 +| `C++` | `cpp` | Special replacement |
2252     -    284 +243     -    216 +| `C#` | `csharp` | Special replacement |
2253     -    285 +244     -    217 +| `.NET Framework` | `dotnet-framework` | Special replacement |
2254     -    286 +245     -    218 +| `F#` | `fsharp` | Special replacement |
2255     -    287 +246     -    219 +| `API v2.0` | `api-v20` | Period stripped |
2256     -    288 +247     -    220 +| `1. Introduction` | `1-introduction` | Numbers preserved |
2257     -    289 +248     -    221 +| `hello_world` | `hello_world` | Underscores preserved |
2258     -    290 +249     -    222 +| `Header` (1st) | `header` | First occurrence |
2259     -    291 +250     -    223 +| `Header` (2nd) | `header-1` | Duplicate handling |
2260     -    292 +251     -    224 +| `Header` (3rd) | `header-2` | Duplicate handling |
2261     -    293 +252     -    225 +| `üòÄüòÄüòÄ` | `section` | Fallback for empty |
2262     -    294 +253     -    226 +| `--test--` | `test` | Trimmed |
2263     -    295 +254     -    227 +
2264     -    296 +255     -    228 +### 4.3 State Management (Singleton-Safe)
2265     -    297 +256     -    229 +
2266     -    298 +257     -    230 +**Critical:** `marked` is a global singleton. Extension registration happens ONCE at startup.
2267     -    299 +258     -    231 +
2268     -    300 +259     -    232 +```javascript
2269     -    301 +260     -    233 +// Module level (script.js, near top)
2270     -    302 +261     -    234 +const headingSlugMap = new Map();
2271     -    303 +262     -    235 +
2272     -    304 +263     -    236 +function resetSlugMap() {
2273     -    305 +264     -    237 +  headingSlugMap.clear();
2274     -    306 +265     -    238 +}
2275     -    307 +266     -    239 +
2276     -    308 +267     -    240 +// In configureMarkedExtensions() - called ONCE at app init
2277     -    309 +268     -    241 +marked.use({
2278     -    310 +269     -    242 +  renderer: {
2279     -    311 +270     -    243 +    heading(token) {
2280     -    312 +271     -    244 +      const text = this.parser.parseInline(token.tokens);
2281     -    313 +272     -    245 +      const level = token.depth;
2282     -    314 +273     -    246 +      const slug = generateSlug(text, headingSlugMap);
2283     -    315 +274     -    247 +      return `<h${level} id="${slug}">${text}</h${level}>\n`;
2284     -    316 +275     -    248 +    }
2285     -    317 +276     -    249 +  }
2286     -    318 +277     -    250 +});
2287     -    319 +278     -    251 +
2288     -    320 +279     -    252 +// In renderMarkdown() - called on every keystroke
2289     -    321 +280     -    253 +function renderMarkdown() {
2290     -    322 +281     -    254 +  resetSlugMap();  // Clear state, NOT re-register extension
2291     -    323 +282     -    255 +  const html = marked.parse(text);
2292     -    324 +283     -    256 +  // ...
2293     -    325 +284     -    257 +}
2294     -    326 +285     -    258 +```
2295     -    327 +286     -    259 +
2296     -    328 +287     -    260 +### 4.4 Link Resolution (Scoped Selection)
2297     -    329 +288     -    261 +
2298     -    330 +289     -    262 +**Purpose:** Match clicked links to generated IDs, preventing app shell collision.
2299     -    331 +290     -    263 +
2300     -    332 +291     -    264 +```javascript
2301     -    333 +292     -    265 +/**
2302     -    334 +293     -    266 + * Resolve target element from hash - SCOPED to container
2303     -    335 +294     -    267 + * @param {string} hash - URL hash (without #)
2304     -    336 +295     -    268 + * @param {HTMLElement} container - Scrollable container
2305     -    337 +296     -    269 + * @returns {Element|null} Target element or null
2306     -    338 +297     -    270 + */
2307     -    339 +298     -    271 +function resolveTarget(hash, container) {
2308     -    340 +299     -    272 +  if (!hash) return null;
2309     -    341 +300     -    273 +
2310     -    342 +301     -    274 +  // Decode URI components
2311     -    343 +302     -    275 +  let decodedHash;
2312     -    344 +303     -    276 +  try {
2313     -    345 +304     -    277 +    decodedHash = decodeURIComponent(hash);
2314     -    346 +305     -    278 +  } catch {
2315     -    347 +306     -    279 +    decodedHash = hash;
2316     -    348 +307     -    280 +  }
2317     -    349 +308     -    281 +
2318     -    350 +309     -    282 +  // Priority 1: Exact ID (SCOPED to container - prevents app shell collision)
2319     -    351 +310     -    283 +  let target = container.querySelector(`#${CSS.escape(decodedHash)}`);
2320     -    352 +311     -    284 +  if (target) return target;
2321     -    353 +312     -    285 +
2322     -    354 +313     -    286 +  // Priority 2: Normalized ID (handles legacy links)
2323     -    355 +314     -    287 +  const normalizedHash = normalizeHash(decodedHash);
2324     -    356 +315     -    288 +  target = container.querySelector(`#${CSS.escape(normalizedHash)}`);
2325     -    357 +316     -    289 +  if (target) return target;
2326     -    358 +317     -    290 +
2327     -    359 +318     -    291 +  console.warn(`[AnchorNav] Target not found: "${hash}"`);
2328     -    360 +319     -    292 +  return null;
2329     -    361 +320     -    293 +}
2330     -    362 +321     -    294 +
2331     -    363 +322     -    295 +/**
2332     -    364 +323     -    296 + * Normalize hash for legacy link matching
2333     -    365 +324     -    297 + */
2334     -    366 +325     -    298 +function normalizeHash(hash) {
2335     -    367 +326     -    299 +  let slug = hash.normalize('NFC').toLowerCase();
2336     -    368 +327     -    300 +
2337     -    369 +328     -    301 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
2338     -    370 +329     -    302 +    slug = slug.replace(pattern, replacement);
2339     -    371 +330     -    303 +  }
2340     -    372 +331     -    304 +
2341     -    373 +332     -    305 +  return slug
2342     -    374 +333     -    306 +    .replace(/[^\w\s-]/g, '')
2343     -    375 +334     -    307 +    .replace(/\s+/g, '-')
2344     -    376 +335     -    308 +    .replace(/-+/g, '-')
2345     -    377 +336     -    309 +    .replace(/^-+|-+$/g, '') || 'section';
2346     -    378 +337     -    310 +}
2347     -    379 +338     -    311 +```
2348     -    380 +339     -    312 +
2349     -    381 +340     -    313 +---
2350     -    382 +341     -    314 +
2351     -    383 +342     -    315 +## 5. Implementation Details
2352     -    384 +343     -    316 +
2353     -    385 +344     -    317 +### 5.1 CSS Configuration
2354     -    386 +345     -    318 +
2355     -    387 +346     -    319 +**File: `variables.css`** (add to existing `:root`)
2356     -    388 +347     -    320 +```css
2357     -    389 +348     -    321 +:root {
2358     -    390 +349     -    322 +  /* Existing variables... */
2359     -    391 +350     -    323 +
2360     -    392 +351     -    324 +  /* Anchor Navigation */
2361     -    393 +352     -    325 +  --toolbar-height: 60px;
2362     -    394 +353     -    326 +  --scroll-padding: 20px;
2363     -    395 +354     -    327 +  --scroll-offset: calc(var(--toolbar-height) + var(--scroll-padding));
2364     -    396 +355     -    328 +}
2365     -    397 +356     -    329 +```
2366     -    398 +357     -    330 +
2367     -    399 +358     -    331 +**File: `style.css`** (add new section)
2368     -    400 +359     -    332 +```css
2369     -    401 +360     -    333 +/* ==================== ANCHOR NAVIGATION ==================== */
2370     -    402 +361     -    334 +
2371     -    403 +362     -    335 +/* Scroll padding - SINGLE SOURCE of offset */
2372     -    404 +363     -    336 +.preview-container {
2373     -    405 +364     -    337 +  scroll-padding-top: var(--scroll-offset, 80px);
2374     -    406 +365     -    338 +}
2375     -    407 +366     -    339 +
2376     -    408 +367     -    340 +/* Target highlight animation */
2377     -    409 +368     -    341 +.preview-container :target {
2378     -    410 +369     -    342 +  animation: anchor-highlight 2s ease-out;
2379     -    411 +370     -    343 +}
2380     -    412 +371     -    344 +
2381     -    413 +372     -    345 +@keyframes anchor-highlight {
2382     -    414 +373     -    346 +  0% { background-color: rgba(255, 255, 0, 0.3); }
2383     -    415 +374     -    347 +  100% { background-color: transparent; }
2384     -    416 +375     -    348 +}
2385     -    417 +376     -    349 +
2386     -    418 +377     -    350 +/* Focus management - conditional outline */
2387     -    419 +378     -    351 +.preview-container h1[id]:focus:not(:focus-visible),
2388     -    420 +379     -    352 +.preview-container h2[id]:focus:not(:focus-visible),
2389     -    421 +380     -    353 +.preview-container h3[id]:focus:not(:focus-visible),
2390     -    422 +381     -    354 +.preview-container h4[id]:focus:not(:focus-visible),
2391     -    423 +382     -    355 +.preview-container h5[id]:focus:not(:focus-visible),
2392     -    424 +383     -    356 +.preview-container h6[id]:focus:not(:focus-visible) {
2393     -    425 +384     -    357 +  outline: none;
2394     -    426 +385     -    358 +}
2395     -    427 +386     -    359 +
2396     -    428 +387     -    360 +/* Keyboard focus gets visible indicator */
2397     -    429 +388     -    361 +.preview-container h1[id]:focus-visible,
2398     -    430 +389     -    362 +.preview-container h2[id]:focus-visible,
2399     -    431 +390     -    363 +.preview-container h3[id]:focus-visible,
2400     -    432 +391     -    364 +.preview-container h4[id]:focus-visible,
2401     -    433 +392     -    365 +.preview-container h5[id]:focus-visible,
2402     -    434 +393     -    366 +.preview-container h6[id]:focus-visible {
2403     -    435 +394     -    367 +  outline: 2px solid var(--primary-color, #007bff);
2404     -    436 +395     -    368 +  outline-offset: 4px;
2405     -    437 +396     -    369 +  border-radius: 2px;
2406     -    438 +397     -    370 +}
2407     -    439 +398     -    371 +```
2408     -    440 +399     -    372 +
2409     -    441 +400     -    373 +### 5.2 JavaScript Implementation
2410     -    442 +401     -    374 +
2411     -    443 +402     -    375 +**File: `script.js`** (modifications)
2412     -    444 +403     -    376 +
2413     -    445 +404     -    377 +```javascript
2414     -    446 +405     -    378 +// ==================== ANCHOR NAVIGATION ====================
2415     -    447 +406     -    379 +// Add near top of file, after imports
2416     -    448 +407     -    380 +
2417     -    449 +408     -    381 +// Heading slug tracking (module-level singleton)
2418     -    450 +409     -    382 +const headingSlugMap = new Map();
2419     -    451 +410     -    383 +
2420     -    452 +411     -    384 +// Pre-compiled slug replacements (zero GC pressure)
2421     -    453 +412     -    385 +const SLUG_REPLACEMENTS = [
2422     -    454 +413     -    386 +  [/c\+\+/gi, 'cpp'],
2423     -    455 +414     -    387 +  [/c#/gi, 'csharp'],
2424     -    456 +415     -    388 +  [/f#/gi, 'fsharp'],
2425     -    457 +416     -    389 +  [/\.net/gi, 'dotnet'],
2426     -    458 +417     -    390 +];
2427     -    459 +418     -    391 +
2428     -    460 +419     -    392 +/**
2429     -    461 +420     -    393 + * Reset slug map (call before each parse)
2430     -    462 +421     -    394 + */
2431     -    463 +422     -    395 +function resetSlugMap() {
2432     -    464 +423     -    396 +  headingSlugMap.clear();
2433     -    465 +424     -    397 +}
2434     -    466 +425     -    398 +
2435     -    467 +426     -    399 +/**
2436     -    468 +427     -    400 + * Generate URL-safe slug from heading text
2437     -    469 +428     -    401 + */
2438     -    470 +429     -    402 +function generateSlug(text, seen = headingSlugMap) {
2439     -    471 +430     -    403 +  // Strip HTML tags
2440     -    472 +431     -    404 +  let slug = text.replace(/<[^>]*>/g, '');
2441     -    473 +432     -    405 +
2442     -    474 +433     -    406 +  // Normalize Unicode
2443     -    475 +434     -    407 +  slug = slug.normalize('NFC').toLowerCase();
2444     -    476 +435     -    408 +
2445     -    477 +436     -    409 +  // Replace programming terms
2446     -    478 +437     -    410 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
2447     -    479 +438     -    411 +    slug = slug.replace(pattern, replacement);
2448     -    480 +439     -    412 +  }
2449     -    481 +440     -    413 +
2450     -    482 +441     -    414 +  // Clean up
2451     -    483 +442     -    415 +  slug = slug
2452     -    484 +443     -    416 +    .replace(/[^\w\s-]/g, '')
2453     -    485 +444     -    417 +    .replace(/\s+/g, '-')
2454     -    486 +445     -    418 +    .replace(/-+/g, '-')
2455     -    487 +446     -    419 +    .replace(/^-+|-+$/g, '');
2456     -    488 +447     -    420 +
2457     -    489 +448     -    421 +  if (!slug) slug = 'section';
2458     -    490 +449     -    422 +
2459     -    491 +450     -    423 +  // Handle duplicates
2460     -    492 +451     -    424 +  const baseSlug = slug;
2461     -    493 +452     -    425 +  const count = seen.get(baseSlug) || 0;
2462     -    494 +453     -    426 +  if (count > 0) slug = `${baseSlug}-${count}`;
2463     -    495 +454     -    427 +  seen.set(baseSlug, count + 1);
2464     -    496 +455     -    428 +
2465     -    497 +456     -    429 +  return slug;
2466     -    498 +457     -    430 +}
2467     -    499 +458     -    431 +
2468     -    500 +459     -    432 +/**
2469     -    501 +460     -    433 + * Anchor Navigation Module
2470     -    502 +461     -    434 + */
2471     -    503 +462     -    435 +const AnchorNavigation = {
2472     -    504 +463     -    436 +  container: null,
2473     -    505 +464     -    437 +  pendingScroll: null,
2474     -    506 +465     -    438 +
2475     -    507 +466     -    439 +  /**
2476     -    508 +467     -    440 +   * Initialize anchor navigation
2477     -    509 +468     -    441 +   */
2478     -    510 +469     -    442 +  init(previewContainer) {
2479     -    511 +470     -    443 +    this.container = previewContainer;
2480     -    512 +471     -    444 +
2481     -    513 +472     -    445 +    // Event delegation for clicks
2482     -    514 +473     -    446 +    this.container.addEventListener('click', this.handleClick.bind(this));
2483     -    515 +474     -    447 +
2484     -    516 +475     -    448 +    // Browser back/forward
2485     -    517 +476     -    449 +    window.addEventListener('hashchange', this.handleHashChange.bind(this));
2486     -    518 +477     -    450 +
2487     -    519 +478     -    451 +    // Initial page load with hash
2488     -    520 +479     -    452 +    if (window.location.hash) {
2489     -    521 +480     -    453 +      requestAnimationFrame(() => {
2490     -    522 +481     -    454 +        this.scrollToHash(window.location.hash.slice(1), false);
2491     -    523 +482     -    455 +      });
2492     -    524 +483     -    456 +    }
2493     -    525 +484     -    457 +  },
2494     -    526 +485     -    458 +
2495     -    527 +486     -    459 +  /**
2496     -    528 +487     -    460 +   * Handle click events (delegated)
2497     -    529 +488     -    461 +   */
2498     -    530 +489     -    462 +  handleClick(event) {
2499     -    531 +490     -    463 +    const link = event.target.closest('a[href^="#"]');
2500     -    532 +491     -    464 +    if (!link) return;
2501     -    533 +492     -    465 +
2502     -    534 +493     -    466 +    // Ignore external links
2503     -    535 +494     -    467 +    if (link.hostname && link.hostname !== window.location.hostname) return;
2504     -    536 +495     -    468 +
2505     -    537 +496     -    469 +    event.preventDefault();
2506     -    538 +497     -    470 +
2507     -    539 +498     -    471 +    const hash = link.getAttribute('href').slice(1);
2508     -    540 +499     -    472 +    this.scrollToHash(hash, true);
2509     -    541 +500     -    473 +
2510     -    542 +501     -    474 +    // Update URL
2511     -    543 +502     -    475 +    history.pushState(null, '', `#${hash}`);
2512     -    544 +503     -    476 +  },
2513     -    545 +504     -    477 +
2514     -    546 +505     -    478 +  /**
2515     -    547 +506     -    479 +   * Handle hashchange (back/forward)
2516     -    548 +507     -    480 +   */
2517     -    549 +508     -    481 +  handleHashChange() {
2518     -    550 +509     -    482 +    const hash = window.location.hash.slice(1);
2519     -    551 +510     -    483 +    if (hash) {
2520     -    552 +511     -    484 +      this.scrollToHash(hash, true);
2521     -    553 +512     -    485 +    } else {
2522     -    554 +513     -    486 +      this.scrollToTop(true);
2523     -    555 +514     -    487 +    }
2524     -    556 +515     -    488 +  },
2525     -    557 +516     -    489 +
2526     -    558 +517     -    490 +  /**
2527     -    559 +518     -    491 +   * Scroll to element by hash
2528     -    560 +519     -    492 +   */
2529     -    561 +520     -    493 +  scrollToHash(hash, smooth = true) {
2530     -    562 +521     -    494 +    // Cancel pending scroll (handle concurrent clicks)
2531     -    563 +522     -    495 +    if (this.pendingScroll) {
2532     -    564 +523     -    496 +      clearTimeout(this.pendingScroll);
2533     -    565 +524     -    497 +      this.pendingScroll = null;
2534     -    566 +525     -    498 +    }
2535     -    567 +526     -    499 +
2536     -    568 +527     -    500 +    if (!hash) {
2537     -    569 +528     -    501 +      this.scrollToTop(smooth);
2538     -    570 +529     -    502 +      return;
2539     -    571 +530     -    503 +    }
2540     -    572 +531     -    504 +
2541     -    573 +532     -    505 +    const target = this.resolveTarget(hash);
2542     -    574 +533     -    506 +    if (!target) return;
2543     -    575 +534     -    507 +
2544     -    576 +535     -    508 +    target.scrollIntoView({
2545     -    577 +536     -    509 +      behavior: smooth ? 'smooth' : 'instant',
2546     -    578 +537     -    510 +      block: 'start',
2547     -    579 +538     -    511 +    });
2548     -    580 +539     -    512 +
2549     -    581 +540     -    513 +    this.manageFocus(target, smooth);
2550     -    582 +541     -    514 +  },
2551     -    583 +542     -    515 +
2552     -    584 +543     -    516 +  /**
2553     -    585 +544     -    517 +   * Scroll to top
2554     -    586 +545     -    518 +   */
2555     -    587 +546     -    519 +  scrollToTop(smooth = true) {
2556     -    588 +547     -    520 +    this.container.scrollTo({
2557     -    589 +548     -    521 +      top: 0,
2558     -    590 +549     -    522 +      behavior: smooth ? 'smooth' : 'instant',
2559     -    591 +550     -    523 +    });
2560     -    592 +551     -    524 +  },
2561     -    593 +552     -    525 +
2562     -    594 +553     -    526 +  /**
2563     -    595 +554     -    527 +   * Resolve target - SCOPED to container
2564     -    596 +555     -    528 +   */
2565     -    597 +556     -    529 +  resolveTarget(hash) {
2566     -    598 +557     -    530 +    if (!hash) return null;
2567     -    599 +558     -    531 +
2568     -    600 +559     -    532 +    let decodedHash;
2569     -    601 +560     -    533 +    try {
2570     -    602 +561     -    534 +      decodedHash = decodeURIComponent(hash);
2571     -    603 +562     -    535 +    } catch {
2572     -    604 +563     -    536 +      decodedHash = hash;
2573     -    605 +564     -    537 +    }
2574     -    606 +565     -    538 +
2575     -    607 +566     -    539 +    // Priority 1: Exact ID (scoped)
2576     -    608 +567     -    540 +    let target = this.container.querySelector(`#${CSS.escape(decodedHash)}`);
2577     -    609 +568     -    541 +    if (target) return target;
2578     -    610 +569     -    542 +
2579     -    611 +570     -    543 +    // Priority 2: Normalized ID (scoped)
2580     -    612 +571     -    544 +    const normalized = this.normalizeHash(decodedHash);
2581     -    613 +572     -    545 +    target = this.container.querySelector(`#${CSS.escape(normalized)}`);
2582     -    614 +573     -    546 +    if (target) return target;
2583     -    615 +574     -    547 +
2584     -    616 +575     -    548 +    console.warn(`[AnchorNav] Target not found: "${hash}"`);
2585     -    617 +576     -    549 +    return null;
2586     -    618 +577     -    550 +  },
2587     -    619 +578     -    551 +
2588     -    620 +579     -    552 +  /**
2589     -    621 +580     -    553 +   * Normalize hash for legacy link matching
2590     -    622 +581     -    554 +   */
2591     -    623 +582     -    555 +  normalizeHash(hash) {
2592     -    624 +583     -    556 +    let slug = hash.normalize('NFC').toLowerCase();
2593     -    625 +584     -    557 +
2594     -    626 +585     -    558 +    for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
2595     -    627 +586     -    559 +      slug = slug.replace(pattern, replacement);
2596     -    628 +587     -    560 +    }
2597     -    629 +588     -    561 +
2598     -    630 +589     -    562 +    return slug
2599     -    631 +590     -    563 +      .replace(/[^\w\s-]/g, '')
2600     -    632 +591     -    564 +      .replace(/\s+/g, '-')
2601     -    633 +592     -    565 +      .replace(/-+/g, '-')
2602     -    634 +593     -    566 +      .replace(/^-+|-+$/g, '') || 'section';
2603     -    635 +594     -    567 +  },
2604     -    636 +595     -    568 +
2605     -    637 +596     -    569 +  /**
2606     -    638 +597     -    570 +   * Manage focus after scroll
2607     -    639 +598     -    571 +   */
2608     -    640 +599     -    572 +  manageFocus(target, smooth) {
2609     -    641 +600     -    573 +    const focusTarget = () => {
2610     -    642 +601     -    574 +      if (!target.hasAttribute('tabindex')) {
2611     -    643 +602     -    575 +        target.setAttribute('tabindex', '-1');
2612     -    644 +603     -    576 +      }
2613     -    645 +604     -    577 +      target.focus({ preventScroll: true });
2614     -    646 +605     -    578 +    };
2615     -    647 +606     -    579 +
2616     -    648 +607     -    580 +    if (!smooth) {
2617     -    649 +608     -    581 +      focusTarget();
2618     -    650 +609     -    582 +      return;
2619     -    651 +610     -    583 +    }
2620     -    652 +611     -    584 +
2621     -    653 +612     -    585 +    // Modern: scrollend event
2622     -    654 +613     -    586 +    if ('onscrollend' in this.container) {
2623     -    655 +614     -    587 +      this.container.addEventListener('scrollend', focusTarget, { once: true });
2624     -    656 +615     -    588 +    } else {
2625     -    657 +616     -    589 +      // Fallback: estimate duration (max 1000ms for safety)
2626     -    658 +617     -    590 +      const distance = Math.abs(target.getBoundingClientRect().top);
2627     -    659 +618     -    591 +      const duration = Math.min(Math.max(distance / 2, 300), 1000);
2628     -    660 +619     -    592 +      this.pendingScroll = setTimeout(focusTarget, duration + 50);
2629     -    661 +620     -    593 +    }
2630     -    662 +621     -    594 +  },
2631     -    663 +622     -    595 +};
2632     -    664 +623     -    596 +```
2633     -    665 +624     -    597 +
2634     -    666 +625     -    598 +### 5.3 Integration Points
2635     -    667 +626     -    599 +
2636     -    668 +627     -    600 +**In `configureMarkedExtensions()`:**
2637     -    669 +628     -    601 +```javascript
2638     -    670 +629     -    602 +function configureMarkedExtensions() {
2639     -    671 +630     -    603 +  // ... existing extensions ...
2640     -    672 +631     -    604 +
2641     -    673 +632     -    605 +  // Custom heading renderer with ID generation
2642     -    674 +633     -    606 +  marked.use({
2643     -    675 +634     -    607 +    renderer: {
2644     -    676 +635     -    608 +      heading(token) {
2645     -    677 +636     -    609 +        const text = this.parser.parseInline(token.tokens);
2646     -    678 +637     -    610 +        const level = token.depth;
2647     -    679 +638     -    611 +        const slug = generateSlug(text, headingSlugMap);
2648     -    680 +639     -    612 +        return `<h${level} id="${slug}">${text}</h${level}>\n`;
2649     -    681 +640     -    613 +      }
2650     -    682 +641     -    614 +    }
2651     -    683 +642     -    615 +  });
2652     -    684 +643     -    616 +  console.log('‚úÖ Custom heading renderer enabled (ID generation)');
2653     -    685 +644     -    617 +}
2654     -    686 +645     -    618 +```
2655     -    687 +646     -    619 +
2656     -    688 +647     -    620 +**In `renderMarkdown()`:**
2657     -    689 +648     -    621 +```javascript
2658     -    690 +649     -    622 +function renderMarkdown() {
2659     -    691 +650     -    623 +  try {
2660     -    692 +651     -    624 +    resetSlugMap();  // Clear slug tracking before parse
2661     -    693 +652     -    625 +
2662     -    694 +653     -    626 +    const markdownText = editor.value;
2663     -    695 +654     -    627 +    let html = marked.parse(markdownText);
2664     -    696 +655     -    628 +    // ... rest of existing logic ...
2665     -    697 +656     -    629 +  }
2666     -    698 +657     -    630 +}
2667     -    699 +658     -    631 +```
2668     -    700 +659     -    632 +
2669     -    701 +660     -    633 +**In `setupEditor()` (at end):**
2670     -    702 +661     -    634 +```javascript
2671     -    703 +662     -    635 +// Initialize anchor navigation
2672     -    704 +663     -    636 +AnchorNavigation.init(previewContainer);
2673     -    705 +664     -    637 +```
2674     -    706 +665     -    638 +
2675     -    707 +666     -    639 +---
2676     -    708 +667     -    640 +
2677     -    709 +668     -    641 +## 6. Browser Compatibility
2678     -    710 +669     -    642 +
2679     -    711 +670     -    643 +| Feature | Chrome | Firefox | Safari | Edge | Fallback |
2680     -    712 +671     -    644 +|---------|--------|---------|--------|------|----------|
2681     -    713 +672     -    645 +| `scrollIntoView({ behavior })` | 61+ | 36+ | 15.4+ | 79+ | Instant scroll |
2682     -    714 +673     -    646 +| `scrollend` event | 114+ | 109+ | 17+ | 114+ | setTimeout (1000ms max) |
2683     -    715 +674     -    647 +| `scroll-padding-top` | 69+ | 68+ | 14.1+ | 79+ | None needed |
2684     -    716 +675     -    648 +| `CSS.escape()` | 46+ | 31+ | 10+ | 79+ | None needed |
2685     -    717 +676     -    649 +| `:focus-visible` | 86+ | 85+ | 15.4+ | 86+ | Always show outline |
2686     -    718 +677     -    650 +
2687     -    719 +678     -    651 +**Minimum Supported:** Chrome 86, Firefox 85, Safari 15.4, Edge 86
2688     -    720 +679     -    652 +
2689     -    721 +680     -    653 +---
2690     -    722 +681     -    654 +
2691     -    723 +682     -    655 +## 7. Testing Strategy
2692     -    724 +683     -    656 +
2693     -    725 +684     -    657 +### 7.1 Unit Tests
2694     -    726 +685     -    658 +
2695     -    727 +686     -    659 +**File: `tests/unit/utils/anchorNavigation.test.js`**
2696     -    728 +687     -    660 +
2697     -    729 +688     -    661 +```javascript
2698     -    730 +689     -    662 +import { describe, it, expect, beforeEach } from 'vitest';
2699     -    731 +690     -    663 +
2700     -    732 +691     -    664 +describe('generateSlug', () => {
2701     -    733 +692     -    665 +  let seen;
2702     -    734 +693     -    666 +
2703     -    735 +694     -    667 +  beforeEach(() => {
2704     -    736 +695     -    668 +    seen = new Map();
2705     -    737 +696     -    669 +  });
2706     -    738 +697     -    670 +
2707     -    739 +698     -    671 +  describe('basic transformations', () => {
2708     -    740 +699     -    672 +    it('converts to lowercase', () => {
2709     -    741 +700     -    673 +      expect(generateSlug('HELLO', seen)).toBe('hello');
2710     -    742 +701     -    674 +    });
2711     -    743 +702     -    675 +
2712     -    744 +703     -    676 +    it('replaces spaces with hyphens', () => {
2713     -    745 +704     -    677 +      expect(generateSlug('hello world', seen)).toBe('hello-world');
2714     -    746 +705     -    678 +    });
2715     -    747 +706     -    679 +
2716     -    748 +707     -    680 +    it('preserves numbers', () => {
2717     -    749 +708     -    681 +      expect(generateSlug('Section 1', seen)).toBe('section-1');
2718     -    750 +709     -    682 +    });
2719     -    751 +710     -    683 +
2720     -    752 +711     -    684 +    it('preserves underscores', () => {
2721     -    753 +712     -    685 +      expect(generateSlug('hello_world', seen)).toBe('hello_world');
2722     -    754 +713     -    686 +    });
2723     -    755 +714     -    687 +  });
2724     -    756 +     37 + 10  14  ---
2725     -    757 +     38 + 11  15  
2726     -    758 +     39 + 12  16  ## ‚ú® Features
2727     -    759 +     40 +@@ -680,6 +684,29 @@ MIT License - See LICENSE file for details
2728     -    760 +     41 +680 684  
2729     -    761 +     42 +681 685  ---
2730     -    762 +     43 +682 686  
2731     -    763 +     44 +    687 +---
2732     -    764 +715  45      688 +
2733     -    765 +716     -    689 +  describe('special characters', () => {
2734     -    766 +717     -    690 +    it('removes emoji', () => {
2735     -    767 +718     -    691 +      expect(generateSlug('üéØ Goal', seen)).toBe('goal');
2736     -    768 +719     -    692 +    });
2737     -    769 +720     -    693 +
2738     -    770 +721     -    694 +    it('handles C++', () => {
2739     -    771 +722     -    695 +      expect(generateSlug('C++', seen)).toBe('cpp');
2740     -    772 +723     -    696 +    });
2741     -    773 +724     -    697 +
2742     -    774 +725     -    698 +    it('handles C#', () => {
2743     -    775 +726     -    699 +      expect(generateSlug('C#', seen)).toBe('csharp');
2744     -    776 +727     -    700 +    });
2745     -    777 +728     -    701 +
2746     -    778 +729     -    702 +    it('handles F#', () => {
2747     -    779 +730     -    703 +      expect(generateSlug('F#', seen)).toBe('fsharp');
2748     -    780 +731     -    704 +    });
2749     -    781 +     46 +    689 +## üíñ Support This Project
2750     -    782 +     47 +    690 +
2751     -    783 +     48 +    691 +If you find Markdown Viewer Pro useful, consider supporting its development:
2752     -    784 +     49 +    692 +
2753     -    785 +     50 +    693 +[![GitHub Sponsors](https://img.shields.io/badge/Sponsor-%E2%9D%A4-pink?logo=github&style=for-the-badge)](https://github.com/sponsors/PrakharMNNIT)
2754     -    786 +     51 +    694 +[![Ko-fi](https://img.shields.io/badge/Ko--fi-Support-blue?logo=ko-fi&style=for-the-badge)](https://ko-fi.com/praxlannister)
2755     -    787 +     52 +    695 +[![Razorpay](https://img.shields.io/badge/Razorpay-‚Çπ_UPI-brightgreen?style=for-the-badge)](https://razorpay.me/@prakharshekharparthasarthi)
2756     -    788 +     53 +    696 +
2757     -    789 +     54 +    697 +### Support Tiers
2758     -    790 +     55 +    698 +
2759     -    791 +     56 +    699 +| Tier | Amount (USD) | Amount (INR) | Perks |
2760     -    792 +     57 +    700 +|------|--------------|--------------|-------|
2761     -    793 +     58 +    701 +| ‚òï Coffee | $1 | ‚Çπ50 | My gratitude! |
2762     -    794 +     59 +    702 +| üçï Pizza | $5 | ‚Çπ250 | Name in SUPPORTERS.md |
2763     -    795 +     60 +    703 +| üéâ Patron | $20 | ‚Çπ1000 | Name in README |
2764     -    796 +     61 +    704 +| üíé Champion | $50+ | ‚Çπ2500+ | Logo in README |
2765     -    797 +732  62      705 +
2766     -    798 +733     -    706 +    it('handles .NET', () => {
2767     -    799 +734     -    707 +      expect(generateSlug('.NET Framework', seen)).toBe('dotnet-framework');
2768     -    800 +735     -    708 +    });
2769     -    801 +     63 +    706 +Your support helps maintain and improve this project. Every contribution is appreciated! üôè
2770     -    802 +     64 +    707 +
2771     -    803 +     65 +    708 +---
2772     -    804 +736  66      709 +
2773     -    805 +737     -    710 +    it('strips periods', () => {
2774     -    806 +738     -    711 +      expect(generateSlug('API v2.0', seen)).toBe('api-v20');
2775     -    807 +739     -    712 +    });
2776     -    808 +740     -    713 +  });
2777     -    809 +741     -    714 +
2778     -    810 +742     -    715 +  describe('edge cases', () => {
2779     -    811 +743     -    716 +    it('collapses multiple hyphens', () => {
2780     -    812 +744     -    717 +      expect(generateSlug('hello--world', seen)).toBe('hello-world');
2781     -    813 +745     -    718 +    });
2782     -    814 +746     -    719 +
2783     -    815 +747     -    720 +    it('trims leading hyphens', () => {
2784     -    816 +748     -    721 +      expect(generateSlug('--hello', seen)).toBe('hello');
2785     -    817 +749     -    722 +    });
2786     -    818 +750     -    723 +
2787     -    819 +751     -    724 +    it('trims trailing hyphens', () => {
2788     -    820 +752     -    725 +      expect(generateSlug('hello--', seen)).toBe('hello');
2789     -    821 +753     -    726 +    });
2790     -    822 +754     -    727 +
2791     -    823 +755     -    728 +    it('returns "section" for empty result', () => {
2792     -    824 +756     -    729 +      expect(generateSlug('!!!', seen)).toBe('section');
2793     -    825 +757     -    730 +      expect(generateSlug('üòÄüòÄüòÄ', seen)).toBe('section');
2794     -    826 +758     -    731 +    });
2795     -    827 +759     -    732 +
2796     -    828 +760     -    733 +    it('handles unicode normalization', () => {
2797     -    829 +761     -    734 +      expect(generateSlug('caf√©', seen)).toBe('caf');
2798     -    830 +762     -    735 +    });
2799     -    831 +763     -    736 +
2800     -    832 +764     -    737 +    it('strips HTML tags', () => {
2801     -    833 +765     -    738 +      expect(generateSlug('<strong>Bold</strong> text', seen)).toBe('bold-text');
2802     -    834 +766     -    739 +    });
2803     -    835 +767     -    740 +  });
2804     -    836 +768     -    741 +
2805     -    837 +769     -    742 +  describe('duplicate handling', () => {
2806     -    838 +770     -    743 +    it('adds suffix for duplicates', () => {
2807     -    839 +771     -    744 +      expect(generateSlug('Header', seen)).toBe('header');
2808     -    840 +772     -    745 +      expect(generateSlug('Header', seen)).toBe('header-1');
2809     -    841 +773     -    746 +      expect(generateSlug('Header', seen)).toBe('header-2');
2810     -    842 +774     -    747 +    });
2811     -    843 +775     -    748 +
2812     -    844 +776     -    749 +    it('tracks different bases separately', () => {
2813     -    845 +777     -    750 +      expect(generateSlug('Header', seen)).toBe('header');
2814     -    846 +778     -    751 +      expect(generateSlug('Footer', seen)).toBe('footer');
2815     -    847 +779     -    752 +      expect(generateSlug('Header', seen)).toBe('header-1');
2816     -    848 +780     -    753 +    });
2817     -    849 +781     -    754 +  });
2818     -    850 +782     -    755 +});
2819     -    851 +783     -    756 +
2820     -    852 +784     -    757 +describe('normalizeHash', () => {
2821     -    853 +785     -    758 +  it('normalizes legacy emoji links', () => {
2822     -    854 +786     -    759 +    expect(normalizeHash('üéØ-standard-assumptions')).toBe('standard-assumptions');
2823     -    855 +787     -    760 +  });
2824     -    856 +788     -    761 +
2825     -    857 +789     -    762 +  it('normalizes leading hyphens', () => {
2826     -    858 +790     -    763 +    expect(normalizeHash('-hello-world-')).toBe('hello-world');
2827     -    859 +791     -    764 +  });
2828     -    860 +792     -    765 +
2829     -    861 +793     -    766 +  it('handles programming terms', () => {
2830     -    862 +794     -    767 +    expect(normalizeHash('c++')).toBe('cpp');
2831     -    863 +795     -    768 +  });
2832     -    864 +796     -    769 +});
2833     -    865 +797     -    770 +```
2834     -    866 +798     -    771 +
2835     -    867 +799     -    772 +### 7.2 Manual Test Cases
2836     -    868 +800     -    773 +
2837     -    869 +801     -    774 +| # | Scenario | Steps | Expected Result |
2838     -    870 +802     -    775 +|---|----------|-------|-----------------|
2839     -    871 +803     -    776 +| 1 | Standard TOC click | Click TOC link `#introduction` | Scrolls to heading, visible below toolbar |
2840     -    872 +804     -    777 +| 2 | Emoji header | Click `#üéØ-goal` | Resolves to `#goal`, scrolls correctly |
2841     -    873 +805     -    778 +| 3 | C++ header | Click `#c++` | Resolves to `#cpp`, scrolls correctly |
2842     -    874 +806     -    779 +| 4 | Deep link | Load `URL#section-1` | Page scrolls to section on load |
2843     -    875 +807     -    780 +| 5 | Browser back | Click link, then browser back | Returns to previous scroll position |
2844     -    876 +808     -    781 +| 6 | Empty hash | Click `href="#"` | Scrolls to top of container |
2845     -    877 +809     -    782 +| 7 | Invalid target | Click `#nonexistent` | Console warning, no crash |
2846     -    878 +810     -    783 +| 8 | Duplicate headers | Two `## Header` | First is `#header`, second is `#header-1` |
2847     -    879 +811     -    784 +| 9 | App shell collision | `## Sidebar` heading | Scrolls to user heading, not app `#sidebar` |
2848     -    880 +812     -    785 +| 10 | Accessibility | Tab to link, press Enter | Focus moves to heading, screen reader announces |
2849     -    881 +813     -    786 +| 11 | Concurrent clicks | Click A, immediately click B | Only B executes |
2850     -    882 +814     -    787 +
2851     -    883 +815     -    788 +---
2852     -    884 +816     -    789 +
2853     -    885 +817     -    790 +## 8. Performance Budget
2854     -    886 +818     -    791 +
2855     -    887 +819     -    792 +| Metric | Budget | Measurement Method |
2856     -    888 +820     -    793 +|--------|--------|-------------------|
2857     -    889 +821     -    794 +| Click-to-scroll latency | < 16ms | `performance.now()` delta |
2858     -    890 +822     -    795 +| Slug generation per heading | < 1ms | Profile in DevTools |
2859     -    891 +823     -    796 +| DOM queries per click | ‚â§ 2 | Code review |
2860     -    892 +824     -    797 +| Memory per session | < 1KB | DevTools heap snapshot |
2861     -    893 +825     -    798 +| Extension stack size | 1 (no growth) | `marked.defaults.extensions.length` |
2862     -    894 +826     -    799 +
2863     -    895 +827     -    800 +---
2864     -    896 +828     -    801 +
2865     -    897 +829     -    802 +## 9. Security Considerations
2866     -    898 +830     -    803 +
2867     -    899 +831     -    804 +| Concern | Risk | Mitigation |
2868     -    900 +832     -    805 +|---------|------|------------|
2869     -    901 +833     -    806 +| XSS via hash | Low | Hash is never inserted into innerHTML |
2870     -    902 +834     -    807 +| Open redirect | Low | Only same-origin hashes processed |
2871     -    903 +835     -    808 +| DoS (rapid clicks) | Low | Pending scroll cancellation |
2872     -    904 +836     -    809 +| Invalid ID injection | Low | `CSS.escape()` for selectors |
2873     -    905 +837     -    810 +| HTML in headings | Medium | Tags stripped before slug generation |
2874     -    906 +838     -    811 +
2875     -    907 +839     -    812 +---
2876     -    908 +840     -    813 +
2877     -    909 +841     -    814 +## 10. Rollback Plan
2878     -    910 +842     -    815 +
2879     -    911 +843     -    816 +### 10.1 Affected Files
2880     -    912 +844     -    817 +
2881     -    913 +845     -    818 +| File | Changes |
2882     -    914 +846     -    819 +|------|---------|
2883     -    915 +847     -    820 +| `script.js` | Add AnchorNavigation module, generateSlug, heading renderer |
2884     -    916 +848     -    821 +| `style.css` | Add scroll-padding, focus-visible styles |
2885     -    917 +849     -    822 +| `variables.css` | Add --scroll-offset variable |
2886     -    918 +850     -    823 +
2887     -    919 +851     -    824 +### 10.2 Rollback Command
2888     -    920 +852     -    825 +
2889     -    921 +853     -    826 +```bash
2890     -    922 +854     -    827 +git checkout HEAD~1 -- script.js style.css variables.css
2891     -    923 +855     -    828 +```
2892     -    924 +856     -    829 +
2893     -    925 +857     -    830 +### 10.3 Rollback Criteria
2894     -    926 +858     -    831 +
2895     -    927 +859     -    832 +- Any markdown rendering regression
2896     -    928 +860     -    833 +- JavaScript console errors
2897     -    929 +861     -    834 +- Theme switching broken
2898     -    930 +862     -    835 +- Memory leak detected (extension stacking)
2899     -    931 +863     -    836 +
2900     -    932 +864     -    837 +### 10.4 Verification Steps
2901     -    933 +865     -    838 +
2902     -    934 +866     -    839 +1. Reload application
2903     -    935 +867     -    840 +2. Verify no console errors
2904     -    936 +868     -    841 +3. Type in editor, verify preview updates
2905     -    937 +869     -    842 +4. Switch themes, verify no errors
2906     -    938 +870     -    843 +5. Check `marked.defaults` has stable extension count
2907     -    939 +871     -    844 +
2908     -    940 +872     -    845 +---
2909     -    941 +873     -    846 +
2910     -    942 +874     -    847 +## 11. FAQ
2911     -    943 +875     -    848 +
2912     -    944 +876     -    849 +**Q1: Will this break existing functionality?**
2913     -    945 +877     -    850 +> No. This is an additive feature. Existing markdown rendering is unchanged.
2914     -    946 +878     -    851 +
2915     -    947 +879     -    852 +**Q2: What if a heading contains only emoji?**
2916     -    948 +880     -    853 +> The slug becomes `section` (fallback for empty result).
2917     -    949 +881     -    854 +
2918     -    950 +882     -    855 +**Q3: Will this affect HTML export?**
2919     -    951 +883     -    856 +> Exported HTML will include the generated IDs. Navigation will work if opened in a browser.
2920     -    952 +884     -    857 +
2921     -    953 +885     -    858 +**Q4: What about very long headings?**
2922     -    954 +886     -    859 +> No length limit. The full heading becomes the slug (performance tested up to 1000 chars).
2923     -    955 +887     -    860 +
2924     -    956 +888     -    861 +**Q5: Can users manually specify IDs?**
2925     -    957 +889     -    862 +> Not currently. This would require parsing `{#custom-id}` syntax, which is a future enhancement.
2926     -    958 +890     -    863 +
2927     -    959 +891     -    864 +**Q6: What if `marked.use()` is accidentally called in `renderMarkdown()`?**
2928     -    960 +892     -    865 +> This would cause extension stacking (memory leak). The design explicitly prevents this by registering ONCE in `configureMarkedExtensions()` and only calling `resetSlugMap()` per render.
2929     -    961 +893     -    866 +
2930     -    962 +894     -    867 +**Q7: Why use `CSS.escape()` instead of simple string matching?**
2931     -    963 +895     -    868 +> IDs can contain special CSS selector characters (`.`, `#`, `:`). `CSS.escape()` ensures the querySelector doesn't break.
2932     -    964 +896     -    869 +
2933     -    965 +897     -    870 +**Q8: What's the maximum scroll duration?**
2934     -    966 +898     -    871 +> Capped at 1000ms for the `scrollend` fallback timeout. Smooth scroll itself is browser-controlled.
2935     -    967 +899     -    872 +
2936     -    968 +900     -    873 +---
2937     -    969 +901     -    874 +
2938     -    970 +902     -    875 +## 12. Approval
2939     -    971 +903     -    876 +
2940     -    972 +904     -    877 +| Role | Name | Date | Status |
2941     -    973 +905     -    878 +|------|------|------|--------|
2942     -    974 +906     -    879 +| Author | Principal SDE | 2025-12-19 | ‚úÖ Complete |
2943     -    975 +907     -    880 +| Reviewer | Gemini | 2025-12-19 | ‚úÖ Approved |
2944     -    976 +908     -    881 +| Implementation | Pending | - | ‚è≥ Ready |
2945     -    977 +909     -    882 +
2946     -    978 +910     -    883 +---
2947     -    979 +911     -    884 +
2948     -    980 +912     -    885 +## 13. Change Log
2949     -    981 +913     -    886 +
2950     -    982 +914     -    887 +| Version | Date | Author | Changes |
2951     -    983 +915     -    888 +|---------|------|--------|---------|
2952     -    984 +916     -    889 +| 1.0 | 2025-12-19 | Principal SDE | Initial draft |
2953     -    985 +917     -    890 +| 2.0 | 2025-12-19 | Principal SDE | Added requirements, edge cases |
2954     -    986 +918     -    891 +| 3.0 | 2025-12-19 | Gemini | Strict compliance version |
2955     -    987 +919     -    892 +| 4.0 | 2025-12-19 | Principal SDE | Production-ready with full implementation |
2956     -    988 +920     -    893 +| 4.1 | 2025-12-19 | Principal SDE | Fixed double offset, pre-compiled regex |
2957     -    989 +921     -    894 +| 4.2 | 2025-12-19 | Principal SDE | Scoped selection, focus-visible |
2958     -    990 +922     -    895 +| 4.3 | 2025-12-19 | Gemini | Identified singleton bug |
2959     -    991 +923     -    896 +| 5.0 | 2025-12-19 | Principal SDE | **FINAL** - Module-level map, reset pattern, singleton-safe |
2960     -    992 +924     -    897 +
2961     -    993 +925     -    898 +---
2962     -    994 +926     -    899 +
2963     -    995 +927     -    900 +**End of Document**
2964     -    996 +928     -    901  
2965     -    997 +     67 +683 710  **Built with ‚ù§Ô∏è using modern JavaScript, comprehensive testing, and scalable architecture.**
2966     -    998 +     68 +684 711  
2967     -    999 +     69 +685 712  **Status**: Production-ready ‚úÖ | Tests: 155+/155+ passing ‚úÖ | Technical Debt: Zero ‚úÖ
2968     -    1000 +     70 +686 713  
2969     -    1001 +929  71  
2970     -    1002 +930  72  ```
2971     -    1003 +931  73  
2972     -    1004 +932  74  
2973     -    1005 +933     -### ‚ú® `docs/competitive_programming_constraints.md` **[ADDED]**
2974     -    1006 +     75 +### ‚ú® `docs/01-requirements/donation-feature-plan.md` **[ADDED]**
2975     -    1007 +934  76  
2976     -    1008 +935  77  **Status:** ‚úÖ **NEW FILE** - This file has been newly created
2977     -    1009 +936  78  
2978     -    1010 +937  79  **Type:** Documentation üìñ
2979     -    1011 +938  80  
2980     -    1012 +939  81  ```diff
2981     -    1013 +940     -@@ -0,0 +1,621 @@
2982     -    1014 +941     -      1 +# üéØ Coding Interview & Competitive Programming Constraints Guide
2983     -    1015 +     82 +@@ -0,0 +1,1063 @@
2984     -    1016 +     83 +      1 +# üéÅ Donation Feature - Functional Requirements Document
2985     -    1017 +942  84        2 +
2986     -    1018 +943     -      3 +### üìù 2025-12-19
2987     -    1019 +944     -      4 +**Category**: `interview prep` | **Level**: `Essential` | **Time**: `15 min read`
2988     -    1020 +945     -      5 +
2989     -    1021 +946     -      6 +> **Master the numbers** that every competitive programmer and interviewee should know by heart!
2990     -    1022 +     85 +      3 +## Document Information
2991     -    1023 +     86 +      4 +
2992     -    1024 +     87 +      5 +| Field | Value |
2993     -    1025 +     88 +      6 +|-------|-------|
2994     -    1026 +     89 +      7 +| **Author** | Principal SDE Analysis |
2995     -    1027 +     90 +      8 +| **Created** | December 19, 2025 |
2996     -    1028 +     91 +      9 +| **Status** | **üü¢ APPROVED v2.2 - ZERO DEFECTS** |
2997     -    1029 +     92 +     10 +| **Version** | 2.2 |
2998     -    1030 +     93 +     11 +| **Reviewed By** | Principal SDE (Cline), Principal SDE (Gemini), Sr. Principal SDE (Feasibility), Enterprise Architecture Board (Final) |
2999     -    1031 +     94 +     12 +| **Final Verdict** | üöÄ Ready for Phase 0 (Account Setup) |
3000     -    1032 +     95 +     13 +| **Technical Feasibility** | 10/10 |
3001     -    1033 +     96 +     14 +| **Compliance Rating** | 10/10 |
3002     -    1034 +     97 +     15 +
3003     -    1035 +     98 +     16 +---
3004     -    1036 +     99 +     17 +
3005     -    1037 +    100 +     18 +# PART 1: REQUIREMENTS & STRATEGY
3006     -    1038 +    101 +     19 +
3007     -    1039 +    102 +     20 +## 1. Problem Statement
3008     -    1040 +    103 +     21 +
3009     -    1041 +    104 +     22 +### Background
3010     -    1042 +    105 +     23 +
3011     -    1043 +    106 +     24 +Markdown Viewer Pro is an open-source project that requires sustainable funding to support continued development, maintenance, and feature additions. Currently, there is no mechanism for users who benefit from the project to financially support its development.
3012     -    1044 +    107 +     25 +
3013     -    1045 +    108 +     26 +### Objective
3014     -    1046 +    109 +     27 +
3015     -    1047 +    110 +     28 +Implement a donation/support system that:
3016     -    1048 +    111 +     29 +
3017     -    1049 +    112 +     30 +1. Allows users worldwide to financially support the project
3018     -    1050 +    113 +     31 +2. Provides currency-appropriate amounts based on user location
3019     -    1051 +    114 +     32 +3. Complies with all relevant laws and regulations
3020     -    1052 +    115 +     33 +4. Has zero setup cost for the project maintainer
3021     -    1053 +    116 +     34 +5. Integrates seamlessly into README and web application
3022     -    1054 +    117 +     35 +
3023     -    1055 +    118 +     36 +### Success Metrics
3024     -    1056 +    119 +     37 +
3025     -    1057 +    120 +     38 +- Donation button visible in README and application
3026     -    1058 +    121 +     39 +- At least 3 successful donations within first month
3027     -    1059 +    122 +     40 +- Zero legal/compliance issues
3028     -    1060 +    123 +     41 +- Under 5% total transaction fees
3029     -    1061 +    124 +     42 +
3030     -    1062 +    125 +     43 +---
3031     -    1063 +    126 +     44 +
3032     -    1064 +    127 +     45 +## 2. Functional Requirements
3033     -    1065 +    128 +     46 +
3034     -    1066 +    129 +     47 +### FR-1: Currency Detection and Localization
3035     -    1067 +    130 +     48 +
3036     -    1068 +    131 +     49 +| ID | Requirement | Priority |
3037     -    1069 +    132 +     50 +|----|-------------|----------|
3038     -    1070 +    133 +     51 +| FR-1.1 | System SHALL detect user's country via IP geolocation | P1 |
3039     -    1071 +    134 +     52 +| FR-1.2 | System SHALL map country to appropriate currency | P1 |
3040     -    1072 +    135 +     53 +| FR-1.3 | System SHALL fallback to USD for unrecognized locations | P1 |
3041     -    1073 +    136 +     54 +| FR-1.4 | System MAY cache geolocation result for session | P3 |
3042     -    1074 +    137 +     55 +
3043     -    1075 +    138 +     56 +### FR-2: Preset Amount Tiers
3044     -    1076 +    139 +     57 +
3045     -    1077 +    140 +     58 +| Region | Currency | Preset Amounts | Custom |
3046     -    1078 +    141 +     59 +|--------|----------|----------------|--------|
3047     -    1079 +    142 +     60 +| India | INR ‚Çπ | 50, 100, 250, 500, 1000 | ‚úÖ |
3048     -    1080 +    143 +     61 +| USA | USD $ | 1, 5, 10, 20, 50 | ‚úÖ |
3049     -    1081 +    144 +     62 +| UK | GBP ¬£ | 1, 5, 10, 20, 50 | ‚úÖ |
3050     -    1082 +    145 +     63 +| Eurozone | EUR ‚Ç¨ | 1, 5, 10, 20, 50 | ‚úÖ |
3051     -    1083 +    146 +     64 +| Other | USD $ | 1, 5, 10, 20, 50 | ‚úÖ (Fallback) |
3052     -    1084 +    147 +     65 +
3053     -    1085 +    148 +     66 +### FR-3: Donation Flow
3054     -    1086 +    149 +     67 +
3055     -    1087 +    150 +     68 +| ID | Requirement | Priority |
3056     -    1088 +    151 +     69 +|----|-------------|----------|
3057     -    1089 +    152 +     70 +| FR-3.1 | User SHALL see "Support This Project" button | P1 |
3058     -    1090 +    153 +     71 +| FR-3.2 | User SHALL see currency-appropriate amount options | P1 |
3059     -    1091 +    154 +     72 +| FR-3.3 | System SHALL redirect to payment gateway | P1 |
3060     -    1092 +    155 +     73 +| FR-3.4 | System SHALL handle success/failure callbacks | P2 |
3061     -    1093 +    156 +     74 +| FR-3.5 | User SHALL receive confirmation message | P2 |
3062     -    1094 +    157 +     75 +
3063     -    1095 +    158 +     76 +### FR-4: Integration Points
3064     -    1096 +    159 +     77 +
3065     -    1097 +    160 +     78 +| Location | Type | Priority |
3066     -    1098 +    161 +     79 +|----------|------|----------|
3067     -    1099 +    162 +     80 +| Web App Footer | "Support" button | **P0 (PRIMARY)** |
3068     -    1100 +    163 +     81 +| GitHub Repository | Sponsor button | P1 |
3069     -    1101 +    164 +     82 +| README.md | Badge/button with link | P2 (SECONDARY) |
3070     -    1102 +    165 +     83 +| RELEASE.md | Acknowledgment section | P3 |
3071     -    1103 +    166 +     84 +
3072     -    1104 +    167 +     85 +> **Priority Update (Per Sr. Principal SDE Review):** Web App integration is PRIMARY, README is SECONDARY
3073     -    1105 +    168 +     86 +
3074     -    1106 +    169 +     87 +### FR-5: Multi-Platform Support
3075     -    1107 +    170 +     88 +
3076     -    1108 +    171 +     89 +| ID | Requirement | Priority |
3077     -    1109 +    172 +     90 +|----|-------------|----------|
3078     -    1110 +    173 +     91 +| FR-5.1 | GitHub Sponsors SHALL be primary for developers | P1 |
3079     -    1111 +    174 +     92 +| FR-5.2 | Ko-fi SHALL be available for non-GitHub users | P1 |
3080     -    1112 +    175 +     93 +| FR-5.3 | Razorpay SHALL be available for Indian users | P1 |
3081     -    1113 +    176 +     94 +| FR-5.4 | All platforms SHALL link to same project | P1 |
3082     -    1114 +    177 +     95 +
3083     -    1115 +    178 +     96 +---
3084     -    1116 +    179 +     97 +
3085     -    1117 +    180 +     98 +## 3. Non-Functional Requirements
3086     -    1118 +    181 +     99 +
3087     -    1119 +    182 +    100 +### NFR-1: Cost
3088     -    1120 +    183 +    101 +
3089     -    1121 +    184 +    102 +| ID | Requirement |
3090     -    1122 +    185 +    103 +|----|-------------|
3091     -    1123 +    186 +    104 +| NFR-1.1 | Platform setup cost SHALL be zero |
3092     -    1124 +    187 +    105 +| NFR-1.2 | Transaction fees SHALL be under 5% |
3093     -    1125 +    188 +    106 +| NFR-1.3 | No monthly subscription required |
3094     -    1126 +    189 +    107 +
3095     -    1127 +    190 +    108 +### NFR-2: Legal Compliance
3096     -    1128 +    191 +    109 +
3097     -    1129 +    192 +    110 +| ID | Requirement |
3098     -    1130 +    193 +    111 +|----|-------------|
3099     -    1131 +    194 +    112 +| NFR-2.1 | Comply with India's FEMA regulations |
3100     -    1132 +    195 +    113 +| NFR-2.2 | Comply with RBI guidelines for foreign remittances |
3101     -    1133 +    196 +    114 +| NFR-2.3 | No FCRA registration required (individual, not NGO) |
3102     -    1134 +    197 +    115 +| NFR-2.4 | Income reported under "Income from Other Sources" |
3103     -    1135 +    198 +    116 +
3104     -    1136 +    199 +    117 +### NFR-3: Privacy
3105     -    1137 +    200 +    118 +
3106     -    1138 +    201 +    119 +| ID | Requirement |
3107     -    1139 +    202 +    120 +|----|-------------|
3108     -    1140 +    203 +    121 +| NFR-3.1 | No PII stored by application |
3109     -    1141 +    204 +    122 +| NFR-3.2 | GDPR compliant (EU users) |
3110     -    1142 +    205 +    123 +| NFR-3.3 | IP geolocation for currency only, not tracking |
3111     -    1143 +    206 +    124 +
3112     -    1144 +    207 +    125 +### NFR-4: Availability
3113     -    1145 +    208 +    126 +
3114     -    1146 +    209 +    127 +| ID | Requirement |
3115     -    1147 +    210 +    128 +|----|-------------|
3116     -    1148 +    211 +    129 +| NFR-4.1 | Rely on provider SLA (99.9%+) |
3117     -    1149 +    212 +    130 +| NFR-4.2 | Graceful degradation if service unavailable |
3118     -    1150 +    213 +    131 +| NFR-4.3 | Static badges work even if API down |
3119     -    1151 +    214 +    132 +
3120     -    1152 +    215 +    133 +### NFR-5: Performance
3121     -    1153 +    216 +    134 +
3122     -    1154 +    217 +    135 +| ID | Requirement |
3123     -    1155 +    218 +    136 +|----|-------------|
3124     -    1156 +    219 +    137 +| NFR-5.1 | Button loads in under 100ms |
3125     -    1157 +    220 +    138 +| NFR-5.2 | No impact on application load time |
3126     -    1158 +    221 +    139 +| NFR-5.3 | Lazy load donation widgets |
3127     -    1159 +    222 +    140 +
3128     -    1160 +    223 +    141 +### NFR-6: Tax Documentation
3129     -    1161 +    224 +    142 +
3130     -    1162 +    225 +    143 +| ID | Requirement |
3131     -    1163 +    226 +    144 +|----|-------------|
3132     -    1164 +    227 +    145 +| NFR-6.1 | Download transaction history from each platform |
3133     -    1165 +    228 +    146 +| NFR-6.2 | Maintain records for ITR filing |
3134     -    1166 +    229 +    147 +| NFR-6.3 | GST registration if turnover exceeds ‚Çπ20L/year |
3135     -    1167 +    230 +    148 +
3136     -    1168 +    231 +    149 +---
3137     -    1169 +    232 +    150 +
3138     -    1170 +    233 +    151 +## 4. Platform Analysis
3139     -    1171 +    234 +    152 +
3140     -    1172 +    235 +    153 +### Option A: Buy Me a Coffee (buymeacoffee.com)
3141     -    1173 +    236 +    154 +
3142     -    1174 +    237 +    155 +| Aspect | Details |
3143     -    1175 +    238 +    156 +|--------|---------|
3144     -    1176 +    239 +    157 +| **Setup Cost** | FREE |
3145     -    1177 +    240 +    158 +| **Transaction Fee** | 5% (0% on paid plans) |
3146     -    1178 +    241 +    159 +| **Currencies** | 135+ currencies, auto-conversion |
3147     -    1179 +    242 +    160 +| **India Payout** | ‚ùå USD only via PayPal |
3148     -    1180 +    243 +    161 +| **Payout Methods** | PayPal, Stripe, Bank Transfer |
3149     -    1181 +    244 +    162 +
3150     -    1182 +    245 +    163 +**Pros:** Well-known brand, Simple setup, Embeddable widgets
3151     -    1183 +    246 +    164 +
3152     -    1184 +    247 +    165 +**Cons:** 5% platform fee, Cannot receive in INR, PayPal fees add to cost
3153     -    1185 +    248 +    166 +
3154     -    1186 +    249 +    167 +### Option B: Ko-fi (ko-fi.com)
3155     -    1187 +    250 +    168 +
3156     -    1188 +    251 +    169 +| Aspect | Details |
3157     -    1189 +    252 +    170 +|--------|---------|
3158     -    1190 +    253 +    171 +| **Setup Cost** | FREE |
3159     -    1191 +    254 +    172 +| **Transaction Fee** | 0% platform fee |
3160     -    1192 +    255 +    173 +| **Currencies** | Multi-currency via PayPal/Stripe |
3161     -    1193 +    256 +    174 +| **India Payout** | ‚ö†Ô∏è Via PayPal only |
3162     -    1194 +    257 +    175 +| **Payout Methods** | PayPal, Stripe |
3163     -    1195 +    258 +    176 +
3164     -    1196 +    259 +    177 +**Pros:** Zero platform fee, Simple interface, Good for one-time donations
3165     -    1197 +    260 +    178 +
3166     -    1198 +    261 +    179 +**Cons:** Less popular than BMAC, PayPal fees (2.9%+) still apply, No direct INR support
3167     -    1199 +    262 +    180 +
3168     -    1200 +    263 +    181 +### Option C: GitHub Sponsors
3169     -    1201 +    264 +    182 +
3170     -    1202 +    265 +    183 +| Aspect | Details |
3171     -    1203 +    266 +    184 +|--------|---------|
3172     -    1204 +    267 +    185 +| **Setup Cost** | FREE |
3173     -    1205 +    268 +    186 +| **Transaction Fee** | 0% (GitHub covers all fees) |
3174     -    1206 +    269 +    187 +| **Currencies** | USD only |
3175     -    1207 +    270 +    188 +| **India Payout** | ‚úÖ Direct to Indian bank via Stripe |
3176     -    1208 +    271 +    189 +| **Payout Methods** | Stripe ‚Üí Bank Account |
3177     -    1209 +    272 +    190 +
3178     -    1210 +    273 +    191 +**Pros:** Zero fees, Most trusted by developers, Official badge, Direct bank payout in India
3179     -    1211 +    274 +    192 +
3180     -    1212 +    275 +    193 +**Cons:** Requires approval process, USD only, Monthly recurring focus
3181     -    1213 +    276 +    194 +
3182     -    1214 +    277 +    195 +### Option D: Razorpay Payment Button
3183     -    1215 +    278 +    196 +
3184     -    1216 +    279 +    197 +| Aspect | Details |
3185     -    1217 +    280 +    198 +|--------|---------|
3186     -    1218 +    281 +    199 +| **Setup Cost** | FREE |
3187     -    1219 +    282 +    200 +| **Transaction Fee** | 2% per transaction |
3188     -    1220 +    283 +    201 +| **Currencies** | INR (international cards accepted) |
3189     -    1221 +    284 +    202 +| **India Payout** | ‚úÖ Native INR support |
3190     -    1222 +    285 +    203 +| **Payout Methods** | Direct to Indian bank |
3191     -    1223 +    286 +    204 +
3192     -    1224 +    287 +    205 +**Pros:** Best for Indian donors, UPI/Paytm/Cards, Native INR amounts, Lowest fees
3193     -    1225 +    288 +    206 +
3194     -    1226 +    289 +    207 +**Cons:** KYC required (PAN, Aadhaar), GST registration for high volume
3195     -    1227 +    290 +    208 +
3196     -    1228 +    291 +    209 +### Option E: Stripe Payment Links
3197     -    1229 +    292 +    210 +
3198     -    1230 +    293 +    211 +| Aspect | Details |
3199     -    1231 +    294 +    212 +|--------|---------|
3200     -    1232 +    295 +    213 +| **Setup Cost** | FREE |
3201     -    1233 +    296 +    214 +| **Transaction Fee** | 2.9% + $0.30 |
3202     -    1234 +    297 +    215 +| **Currencies** | 135+ currencies |
3203     -    1235 +    298 +    216 +| **India Payout** | ‚úÖ With Indian Stripe account |
3204     -    1236 +    299 +    217 +
3205     -    1237 +    300 +    218 +**Pros:** Professional, Multi-currency, Good API
3206     -    1238 +    301 +    219 +
3207     -    1239 +    302 +    220 +**Cons:** Higher fees, More complex setup
3208     -    1240 +    303 +    221 +
3209     -    1241 +    304 +    222 +---
3210     -    1242 +    305 +    223 +
3211     -    1243 +    306 +    224 +## 5. Comparison Matrix
3212     -    1244 +    307 +    225 +
3213     -    1245 +    308 +    226 +| Feature | Buy Me Coffee | Ko-fi | GitHub Sponsors | Razorpay | Stripe |
3214     -    1246 +    309 +    227 +|---------|---------------|-------|-----------------|----------|--------|
3215     -    1247 +    310 +    228 +| Setup Cost | Free | Free | Free | Free | Free |
3216     -    1248 +    311 +    229 +| Platform Fee | 5% | 0% | 0% | 2% | 2.9%+ |
3217     -    1249 +    312 +    230 +| INR Payout | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
3218     -    1250 +    313 +    231 +| UPI Support | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | ‚ùå |
3219     -    1251 +    314 +    232 +| README Badge | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
3220     -    1252 +    315 +    233 +| Developer Trust | Medium | Low | **High** | Medium | High |
3221     -    1253 +    316 +    234 +
3222     -    1254 +    317 +    235 +---
3223     -    1255 +    318 +    236 +
3224     -    1256 +    319 +    237 +## 6. Legal Considerations
3225     -    1257 +    320 +    238 +
3226     -    1258 +    321 +    239 +### 6.1 India - FEMA & RBI Guidelines
3227     -    1259 +    322 +    240 +
3228     -    1260 +    323 +    241 +| Aspect | Requirement |
3229     -    1261 +    324 +    242 +|--------|-------------|
3230     -    1262 +    325 +    243 +| **Foreign Donations** | Allowed for individuals up to $250,000/year |
3231     -    1263 +    326 +    244 +| **GST Registration** | Required if turnover exceeds ‚Çπ20 Lakhs/year |
3232     -    1264 +    327 +    245 +| **FCRA Registration** | NOT required (individual, not NGO) |
3233     -    1265 +    328 +    246 +| **Income Tax** | Report under "Income from Other Sources" |
3234     -    1266 +    329 +    247 +
3235     -    1267 +    330 +    248 +### 6.2 The "Two-Pocket" Strategy
3236     -    1268 +    331 +    249 +
3237     -    1269 +    332 +    250 +> **Critical Concept** (from `donation_system_design.md`):
3238     -    1270 +    333 +    251 +>
3239     -    1271 +    334 +    252 +> **Pocket A (India):** Use Razorpay for domestic INR payments
3240     -    1272 +    335 +    253 +> - Treated as Domestic Income
3241     -    1273 +    336 +    254 +>
3242     -    1274 +    337 +    255 +> **Pocket B (International):** Use PayPal/Ko-fi/GitHub Sponsors
3243     -    1275 +    338 +    256 +> - Treated as Foreign Inward Remittance (FIRC provided)
3244     -    1276 +    339 +    257 +
3245     -    1277 +    340 +    258 +### 6.3 Terminology Recommendation
3246     -    1278 +    341 +    259 +
3247     -    1279 +    342 +    260 +> **Important**: Use "Support" or "Sponsorship" exclusively. Stop using "Donation" anywhere visible unless 80G registered Non-Profit. This is a legal safeguard against "Misleading Claims" (Consumer Protection Act).
3248     -    1280 +    343 +    261 +
3249     -    1281 +    344 +    262 +---
3250     -    1282 +    345 +    263 +
3251     -    1283 +    346 +    264 +## 7. Recommended Solution
3252     -    1284 +    347 +    265 +
3253     -    1285 +    348 +    266 +### Static Badge Approach (APPROVED ‚úÖ)
3254     -    1286 +    349 +    267 +
3255     -    1287 +    350 +    268 +```
3256     -    1288 +    351 +    269 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
3257     -    1289 +    352 +    270 +‚îÇ                    DONATION ARCHITECTURE                     ‚îÇ
3258     -    1290 +    353 +    271 +‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
3259     -    1291 +    354 +    272 +‚îÇ                                                              ‚îÇ
3260     -    1292 +    355 +    273 +‚îÇ  README.md (Static Badges - NO JavaScript)                   ‚îÇ
3261     -    1293 +    356 +    274 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
3262     -    1294 +    357 +    275 +‚îÇ  ‚îÇ  [GitHub Sponsors]  [Ko-fi]  [Razorpay]             ‚îÇ    ‚îÇ
3263     -    1295 +    358 +    276 +‚îÇ  ‚îÇ       (Primary)    (Global)  (India INR)            ‚îÇ    ‚îÇ
3264     -    1296 +    359 +    277 +‚îÇ  ‚îÇ        0% fee      0% fee      2% fee               ‚îÇ    ‚îÇ
3265     -    1297 +    360 +    278 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
3266     -    1298 +    361 +    279 +‚îÇ                                                              ‚îÇ
3267     -    1299 +    362 +    280 +‚îÇ  Web App Footer (Optional: IP-based smart routing)           ‚îÇ
3268     -    1300 +    363 +    281 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
3269     -    1301 +    364 +    282 +‚îÇ  ‚îÇ  India IP ‚Üí Show "üáÆüá≥ Support via UPI"              ‚îÇ    ‚îÇ
3270     -    1302 +    365 +    283 +‚îÇ  ‚îÇ  Other IP ‚Üí Show "üåè Support via PayPal"            ‚îÇ    ‚îÇ
3271     -    1303 +    366 +    284 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
3272     -    1304 +    367 +    285 +‚îÇ                                                              ‚îÇ
3273     -    1305 +    368 +    286 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
3274     -    1306 +    369 +    287 +```
3275     -    1307 +    370 +    288 +
3276     -    1308 +    371 +    289 +---
3277     -    1309 +    372 +    290 +
3278     -    1310 +    373 +    291 +## 8. Implementation Plan
3279     -    1311 +    374 +    292 +
3280     -    1312 +    375 +    293 +### Phase 1: Account Setup (Day 1)
3281     -    1313 +    376 +    294 +
3282     -    1314 +    377 +    295 +| Task | Platform | Requirements |
3283     -    1315 +    378 +    296 +|------|----------|--------------|
3284     -    1316 +    379 +    297 +| 1.1 | Apply for GitHub Sponsors | 2FA enabled, profile complete |
3285     -    1317 +    380 +    298 +| 1.2 | Create Ko-fi account | Email, PayPal/Stripe |
3286     -    1318 +    381 +    299 +| 1.3 | Create Razorpay account | PAN, Aadhaar, Bank details |
3287     -    1319 +    382 +    300 +
3288     -    1320 +    383 +    301 +### Phase 2: README Integration (Day 2)
3289     -    1321 +    384 +    302 +
3290     -    1322 +    385 +    303 +| Task | Action |
3291     -    1323 +    386 +    304 +|------|--------|
3292     -    1324 +    387 +    305 +| 2.1 | Add GitHub Sponsors badge |
3293     -    1325 +    388 +    306 +| 2.2 | Add Ko-fi button |
3294     -    1326 +    389 +    307 +| 2.3 | Add Razorpay link (for INR) |
3295     -    1327 +    390 +    308 +| 2.4 | Enable GitHub repo Sponsors button |
3296     -    1328 +    391 +    309 +
3297     -    1329 +    392 +    310 +### Phase 3: Web App Integration (Day 3 - Optional)
3298     -    1330 +    393 +    311 +
3299     -    1331 +    394 +    312 +| Task | Action |
3300     -    1332 +    395 +    313 +|------|--------|
3301     -    1333 +    396 +    314 +| 3.1 | Add "Support" button in footer |
3302     -    1334 +    397 +    315 +| 3.2 | (Optional) IP-based smart routing |
3303     -    1335 +    398 +    316 +| 3.3 | Thank you message after redirect |
3304     -    1336 +    399 +    317 +
3305     -    1337 +    400 +    318 +---
3306     -    1338 +    401 +    319 +
3307     -    1339 +    402 +    320 +## 9. README Integration
3308     -    1340 +    403 +    321 +
3309     -    1341 +    404 +    322 +### Proposed Badge Section
3310     -    1342 +    405 +    323 +
3311     -    1343 +    406 +    324 +```markdown
3312     -    1344 +    407 +    325 +## üíñ Support This Project
3313     -    1345 +    408 +    326 +
3314     -    1346 +    409 +    327 +If you find Markdown Viewer Pro useful, consider supporting its development:
3315     -    1347 +    410 +    328 +
3316     -    1348 +    411 +    329 +[![GitHub Sponsors](https://img.shields.io/badge/Sponsor-%E2%9D%A4-pink?logo=github)](https://github.com/sponsors/PrakharMNNIT)
3317     -    1349 +    412 +    330 +[![Ko-fi](https://img.shields.io/badge/Ko--fi-Support-blue?logo=ko-fi)](https://ko-fi.com/markdownviewerpro)
3318     -    1350 +    413 +    331 +[![Razorpay](https://img.shields.io/badge/Razorpay-‚Çπ_Support-brightgreen?logo=razorpay)](https://razorpay.me/@markdownviewer)
3319     -    1351 +    414 +    332 +
3320     -    1352 +    415 +    333 +### Support Tiers
3321     -    1353 +    416 +    334 +
3322     -    1354 +    417 +    335 +| Tier | Amount (USD) | Amount (INR) | Perks |
3323     -    1355 +    418 +    336 +|------|--------------|--------------|-------|
3324     -    1356 +    419 +    337 +| ‚òï Coffee | $1 | ‚Çπ50 | My gratitude |
3325     -    1357 +    420 +    338 +| üçï Pizza | $5 | ‚Çπ250 | Name in SUPPORTERS.md |
3326     -    1358 +    421 +    339 +| üéâ Patron | $20 | ‚Çπ1000 | Name in README |
3327     -    1359 +    422 +    340 +| üíé Champion | $50+ | ‚Çπ2500+ | Logo in README |
3328     -    1360 +    423 +    341 +```
3329     -    1361 +    424 +    342 +
3330     -    1362 +    425 +    343 +---
3331     -    1363 +    426 +    344 +
3332     -    1364 +    427 +    345 +## 10. Risk Assessment
3333     -    1365 +    428 +    346 +
3334     -    1366 +    429 +    347 +| Risk | Probability | Impact | Mitigation |
3335     -    1367 +    430 +    348 +|------|-------------|--------|------------|
3336     -    1368 +    431 +    349 +| Low adoption | Medium | Low | Multiple payment options |
3337     -    1369 +    432 +    350 +| Platform downtime | Low | Low | Multiple platforms as backup |
3338     -    1370 +    433 +    351 +| Legal issues | Low | High | Proper tax reporting, "support" terminology |
3339     -    1371 +    434 +    352 +| Currency conversion loss | Medium | Low | Accept INR directly via Razorpay |
3340     -    1372 +    435 +    353 +| GitHub Sponsors rejection | Medium | Medium | Use Ko-fi as fallback primary |
3341     -    1373 +    436 +    354 +
3342     -    1374 +    437 +    355 +---
3343     -    1375 +    438 +    356 +
3344     -    1376 +    439 +    357 +## 11. Success Criteria
3345     -    1377 +    440 +    358 +
3346     -    1378 +    441 +    359 +| Metric | Target | Measurement |
3347     -    1379 +    442 +    360 +|--------|--------|-------------|
3348     -    1380 +    443 +    361 +| Setup complete | 100% | All 3 platforms active |
3349     -    1381 +    444 +    362 +| First donation | Within 30 days | Platform dashboard |
3350     -    1382 +    445 +    363 +| Monthly supporters | 5+ | Platform dashboard |
3351     -    1383 +    446 +    364 +| Total fees | < 5% | Transaction records |
3352     -    1384 +    447 +    365 +| Legal compliance | 100% | No violations |
3353     -    1385 +    448 +    366 +
3354     -    1386 +    449 +    367 +---
3355     -    1387 +    450 +    368 +
3356     -    1388 +    451 +    369 +# PART 2: INDEPENDENT REVIEWS
3357     -    1389 +    452 +    370 +
3358     -    1390 +    453 +    371 +---
3359     -    1391 +    454 +    372 +
3360     -    1392 +    455 +    373 +## Review A: Principal SDE (Cline AI)
3361     -    1393 +    456 +    374 +
3362     -    1394 +    457 +    375 +### Side-by-Side Comparison
3363     -    1395 +    458 +    376 +
3364     -    1396 +    459 +    377 +| Aspect | `donation_system_design.md` | `donation-feature-plan.md` |
3365     -    1397 +    460 +    378 +|--------|----------------------------|---------------------------|
3366     -    1398 +    461 +    379 +| **Document ID** | DD-2025-003-DONATION | None |
3367     -    1399 +    462 +    380 +| **Scope** | Geo-Adaptive Routing Focus | Comprehensive Full-Stack |
3368     -    1400 +    463 +    381 +| **Length** | ~150 lines (focused) | ~400 lines (exhaustive) |
3369     -    1401 +    464 +    382 +| **Code Sample** | Yes (JS snippet) ‚úÖ | No ‚ùå |
3370     -    1402 +    465 +    383 +
3371     -    1403 +    466 +    384 +### Feature Coverage Matrix
3372     -    1404 +    467 +    385 +
3373     -    1405 +    468 +    386 +| Feature | Design Doc | Feature Plan |
3374     -    1406 +    469 +    387 +|---------|------------|--------------|
3375     -    1407 +    470 +    388 +| Problem Statement | ‚úÖ Clear | ‚úÖ Detailed |
3376     -    1408 +    471 +    389 +| Functional Requirements | ‚úÖ 5 FRs | ‚úÖ 18+ FRs |
3377     -    1409 +    472 +    390 +| Non-Functional Requirements | ‚úÖ 4 NFRs | ‚úÖ 16 NFRs |
3378     -    1410 +    473 +    391 +| Platform Analysis | ‚ö†Ô∏è 2 options | ‚úÖ 5 options |
3379     -    1411 +    474 +    392 +| Comparison Matrix | ‚ùå None | ‚úÖ Full matrix |
3380     -    1412 +    475 +    393 +| Legal Compliance | ‚ö†Ô∏è Brief | ‚úÖ Comprehensive |
3381     -    1413 +    476 +    394 +| Risk Assessment | ‚ùå None | ‚úÖ Full risk table |
3382     -    1414 +    477 +    395 +
3383     -    1415 +    478 +    396 +### Recommendation
3384     -    1416 +    479 +    397 +
3385     -    1417 +    480 +    398 +**Use `donation-feature-plan.md` as canonical reference**, but adopt "Two-Pocket Strategy" concept from `donation_system_design.md`.
3386     -    1418 +    481 +    399 +
3387     -    1419 +    482 +    400 +---
3388     -    1420 +    483 +    401 +
3389     -    1421 +    484 +    402 +## Review B: Principal SDE (Gemini)
3390     -    1422 +    485 +    403 +
3391     -    1423 +    486 +    404 +### Executive Summary
3392     -    1424 +    487 +    405 +
3393     -    1425 +    488 +    406 +| Proposal | Focus | Verdict |
3394     -    1426 +    489 +    407 +|----------|-------|---------|
3395     -    1427 +    490 +    408 +| **A (Smart Router)** | Automated IP-based routing | ‚ùå REJECTED for README |
3396     -    1428 +    491 +    409 +| **B (Feature Plan)** | Transparent static badges | ‚úÖ APPROVED |
3397     -    1429 +    492 +    410 +
3398     -    1430 +    493 +    411 +### Detailed Comparative Analysis
3399     -    1431 +    494 +    412 +
3400     -    1432 +    495 +    413 +#### 1. User Trust & Conversion
3401     -    1433 +    496 +    414 +
3402     -    1434 +    497 +    415 +| Proposal | Analysis | Winner |
3403     -    1435 +    498 +    416 +|----------|----------|--------|
3404     -    1436 +    499 +    417 +| **A (Router)** | Risks "Link Anxiety" - custom domain redirect feels phishy | ‚ùå |
3405     -    1437 +    500 +    418 +| **B (Manual)** | High Trust - users see exactly where they're going | üèÜ |
3406     -    1438 +    501 +    419 +
3407     -    1439 +    502 +    420 +#### 2. Reliability & Maintenance
3408     -    1440 +    503 +    421 +
3409     -    1441 +    504 +    422 +| Proposal | Analysis | Winner |
3410     -    1442 +    505 +    423 +|----------|----------|--------|
3411     -    1443 +    506 +    424 +| **A (Router)** | Requires hosting, Geo API, introduces Point of Failure | ‚ùå |
3412     -    1444 +    507 +    425 +| **B (Manual)** | Static Markdown, 100% Uptime, Zero maintenance | üèÜ |
3413     -    1445 +    508 +    426 +
3414     -    1446 +    509 +    427 +#### 3. Legal & Compliance (Two-Pocket Test)
3415     -    1447 +    510 +    428 +
3416     -    1448 +    511 +    429 +| Proposal | Analysis | Winner |
3417     -    1449 +    512 +    430 +|----------|----------|--------|
3418     -    1450 +    513 +    431 +| **A (Router)** | VPN users might get wrong bucket (NRI with India VPN) | ‚ùå |
3419     -    1451 +    514 +    432 +| **B (Manual)** | User self-selects - clearer mental model | üèÜ |
3420     -    1452 +    515 +    433 +
3421     -    1453 +    516 +    434 +#### 4. Implementation Effort
3422     -    1454 +    517 +    435 +
3423     -    1455 +    518 +    436 +| Proposal | Effort | Winner |
3424     -    1456 +    519 +    437 +|----------|--------|--------|
3425     -    1457 +    520 +    438 +| **A (Router)** | ~4-8 hours (hosting, JS, testing) | ‚ùå |
3426     -    1458 +    521 +    439 +| **B (Manual)** | ~1 hour (signup + paste links) | üèÜ |
3427     -    1459 +    522 +    440 +
3428     -    1460 +    523 +    441 +### Critical Feedback on Feature Plan
3429     -    1461 +    524 +    442 +
3430     -    1462 +    525 +    443 +1. **Banner Design** - Ensure badges are aesthetically aligned (use Shields.io consistently)
3431     -    1463 +    526 +    444 +2. **Razorpay Link** - Verify if `razorpay.me/@username` allows custom amounts (Payment Pages may be better)
3432     -    1464 +    527 +    445 +3. **GitHub Sponsors Eligibility** - May require approval time. **Fallback:** Ko-fi as primary until approved
3433     -    1465 +    528 +    446 +
3434     -    1466 +    529 +    447 +### Final Verdict
3435     -    1467 +    530 +    448 +
3436     -    1468 +    531 +    449 +> **Discard Smart Router architecture for README.**
3437     -    1469 +    532 +    450 +> Use Feature Plan as master plan.
3438     -    1470 +    533 +    451 +> **Optional:** Use IP routing logic ONLY in Web App footer.
3439     -    1471 +    534 +    452 +
3440     -    1472 +    535 +    453 +**Approved for Implementation.** üöÄ
3441     -    1473 +    536 +    454 +
3442     -    1474 +    537 +    455 +---
3443     -    1475 +    538 +    456 +
3444     -    1476 +    539 +    457 +## Review C: Sr. Principal SDE (Technical Feasibility)
3445     -    1477 +    540 +    458 +
3446     -    1478 +    541 +    459 +### Executive Summary
3447     -    1479 +    542 +    460 +
3448     -    1480 +    543 +    461 +| Component | Verdict | Rating |
3449     -    1481 +    544 +    462 +|-----------|---------|--------|
3450     -    1482 +    545 +    463 +| **Static Badges (README)** | ‚úÖ APPROVED | Low Risk, High Value |
3451     -    1483 +    546 +    464 +| **Smart Routing (Web App)** | ‚ö†Ô∏è CONDITIONAL | Medium Risk, Maintenance Burden |
3452     -    1484 +    547 +    465 +
3453     -    1485 +    548 +    466 +### Critical Technical Concerns
3454     -    1486 +    549 +    467 +
3455     -    1487 +    550 +    468 +#### 1. The "Free API" Trap (Scalability Risk)
3456     -    1488 +    551 +    469 +
3457     -    1489 +    552 +    470 +| Concern | Risk | Failure Mode |
3458     -    1490 +    553 +    471 +|---------|------|--------------|
3459     -    1491 +    554 +    472 +| Using `ipapi.co` Free Tier | Rate limits (1000 req/day) | `429 Too Many Requests` |
3460     -    1492 +    555 +    473 +| Viral traffic or bot crawls | API exhaustion | Button renders nothing/broken spinner |
3461     -    1493 +    556 +    474 +
3462     -    1494 +    557 +    475 +**Required Mitigation: Fail-Open Strategy**
3463     -    1495 +    558 +    476 +```javascript
3464     -    1496 +    559 +    477 +// DEFAULT: Global (Fail-Safe Pattern)
3465     -    1497 +    560 +    478 +let showInd = false;
3466     -    1498 +    561 +    479 +try {
3467     -    1499 +    562 +    480 +   // Race condition: Timeout after 300ms
3468     -    1500 +    563 +    481 +   const data = await Promise.race([fetchIP(), timeout(300)]);
3469     -    1501 +    564 +    482 +   if (data.country === 'IN') showInd = true;
3470     -    1502 +    565 +    483 +} catch (e) {
3471     -    1503 +    566 +    484 +   // Silently fail to Global
3472     -    1504 +    567 +    485 +}
3473     -    1505 +    568 +    486 +```
3474     -    1506 +    569 +    487 +
3475     -    1507 +    570 +    488 +#### 2. Razorpay International Friction (UX Bug)
3476     -    1508 +    571 +    489 +
3477     -    1509 +    572 +    490 +| Scenario | Issue |
3478     -    1510 +    573 +    491 +|----------|-------|
3479     -    1511 +    574 +    492 +| NRI with India VPN | Sees UPI, has US card, Razorpay declines |
3480     -    1512 +    575 +    493 +| Corporate VPN via Bangalore | International card fails on personal Razorpay |
3481     -    1513 +    576 +    494 +
3482     -    1514 +    577 +    495 +**Impact:** User willing to pay $50 via Amex bounces.
3483     -    1515 +    578 +    496 +
3484     -    1516 +    579 +    497 +#### 3. The "VPN Paradox" (Edge Case)
3485     -    1517 +    580 +    498 +
3486     -    1518 +    581 +    499 +| Scenario | Result | Fix Required |
3487     -    1519 +    582 +    500 +|----------|--------|--------------|
3488     -    1520 +    583 +    501 +| US user with India VPN (Hotstar) | Sees "UPI/‚Çπ" | No UPI, leaves |
3489     -    1521 +    584 +    502 +
3490     -    1522 +    585 +    503 +**Mandatory UI Element:** "Not in India?" toggle or "Show International Options" link.
3491     -    1523 +    586 +    504 +
3492     -    1524 +    587 +    505 +### Maintenance & Long-term Viability
3493     -    1525 +    588 +    506 +
3494     -    1526 +    589 +    507 +#### 1. Link Rot & Platform Decay
3495     -    1527 +    590 +    508 +
3496     -    1528 +    591 +    509 +**Problem:** Startups change terms or get acquired.
3497     -    1529 +    592 +    510 +
3498     -    1530 +    593 +    511 +**Solution:** Use redirect service instead of hardcoding:
3499     -    1531 +    594 +    512 +```
3500     -    1532 +    595 +    513 +yoursite.com/go/donate-inr ‚Üí razorpay.me/...
3501     -    1533 +    596 +    514 +yoursite.com/go/donate-usd ‚Üí ko-fi.com/...
3502     -    1534 +    597 +    515 +```
3503     -    1535 +    598 +    516 +Allows platform switch without PR.
3504     -    1536 +    599 +    517 +
3505     -    1537 +    600 +    518 +#### 2. GitHub Sponsors Approval Latency
3506     -    1538 +    601 +    519 +
3507     -    1539 +    602 +    520 +| Reality | Blocker |
3508     -    1540 +    603 +    521 +|---------|---------|
3509     -    1541 +    604 +    522 +| 2-4 weeks approval time | Badge shows 404 before approval |
3510     -    1542 +    605 +    523 +
3511     -    1543 +    606 +    524 +**Correction:** Deploy badge ONLY after approval email received.
3512     -    1544 +    607 +    525 +
3513     -    1545 +    608 +    526 +### Enterprise-Grade Recommendations
3514     -    1546 +    609 +    527 +
3515     -    1547 +    610 +    528 +1. **Enforce "Fail-Safe" Default** - 300ms timeout, silent fail to Global
3516     -    1548 +    611 +    529 +2. **Taxonomy Cleanup** - Use "Sponsorship" or "Support" exclusively (Consumer Protection Act compliance)
3517     -    1549 +    612 +    530 +3. **Data Minimization** - Client-side IP lookup only (avoid GDPR/CCPA backend logging)
3518     -    1550 +    613 +    531 +
3519     -    1551 +    614 +    532 +### Revised Implementation Roadmap
3520     -    1552 +    615 +    533 +
3521     -    1553 +    616 +    534 +| Step | Action | Notes |
3522     -    1554 +    617 +    535 +|------|--------|-------|
3523     -    1555 +    618 +    536 +| **1 (Immediate)** | Add Static Badges (Ko-fi & Razorpay) to README | No GitHub Sponsors until approved |
3524     -    1556 +    619 +    537 +| **2 (Wait)** | Apply for GitHub Sponsors | 2-4 week wait |
3525     -    1557 +    620 +    538 +| **3 (Low Priority)** | Smart Routing in Web App | Only if <300ms latency + fail-safe |
3526     -    1558 +    621 +    539 +
3527     -    1559 +    622 +    540 +**Signed-off with Conditions.**
3528     -    1560 +    623 +    541 +
3529     -    1561 +    624 +    542 +---
3530     -    1562 +    625 +    543 +
3531     -    1563 +    626 +    544 +## Review D: Enterprise Architecture Board (Final Readiness)
3532     -    1564 +    627 +    545 +
3533     -    1565 +    628 +    546 +### Executive Summary
3534     -    1566 +    629 +    547 +
3535     -    1567 +    630 +    548 +| Category | Status |
3536     -    1568 +    631 +    549 +|----------|--------|
3537     -    1569 +    632 +    550 +| **Functional** | ‚úÖ Approved |
3538     -    1570 +    633 +    551 +| **Technical** | ‚úÖ Approved |
3539     -    1571 +    634 +    552 +| **Legal** | ‚úÖ Approved |
3540     -    1572 +    635 +    553 +| **UX** | ‚úÖ Approved (with CLS mitigation) |
3541     -    1573 +    636 +    554 +
3542     -    1574 +    637 +    555 +**Verdict:** ‚úÖ **GREEN LIGHT** for Engineering
3543     -    1575 +    638 +    556 +
3544     -    1576 +    639 +    557 +### 3 Final Enterprise Refinements (Non-Blocking)
3545     -    1577 +    640 +    558 +
3546     -    1578 +    641 +    559 +#### 1. Cumulative Layout Shift (CLS) Risk
3547     -    1579 +    642 +    560 +
3548     -    1580 +    643 +    561 +| Issue | Risk | Impact |
3549     -    1581 +    644 +    562 +|-------|------|--------|
3550     -    1582 +    645 +    563 +| 300ms async fetch | Button "pops in" after page load | Hurts SEO (Core Web Vitals) |
3551     -    1583 +    646 +    564 +
3552     -    1584 +    647 +    565 +**Required Mitigation:**
3553     -    1585 +    648 +    566 +```css
3554     -    1586 +    649 +    567 +/* Reserve fixed space BEFORE JS runs */
3555     -    1587 +    650 +    568 +.support-widget-container {
3556     -    1588 +    651 +    569 +  min-height: 60px;
3557     -    1589 +    652 +    570 +}
3558     -    1590 +    653 +    571 +
3559     -    1591 +    654 +    572 +/* Loading State - Grey ghost button */
3560     -    1592 +    655 +    573 +.support-button--loading {
3561     -    1593 +    656 +    574 +  background: #e0e0e0;
3562     -    1594 +    657 +    575 +  color: transparent;
3563     -    1595 +    658 +    576 +}
3564     -    1596 +    659 +    577 +
3565     -    1597 +    660 +    578 +/* Hydrated State - Swap after promise resolves */
3566     -    1598 +    661 +    579 +.support-button--india { background: #FF9933; }
3567     -    1599 +    662 +    580 +.support-button--global { background: #29ABE0; }
3568     -    1600 +    663 +    581 +```
3569     -    1601 +    664 +    582 +
3570     -    1602 +    665 +    583 +#### 2. Analytics Attribution (Blind Spot Fix)
3571     -    1603 +    666 +    584 +
3572     -    1604 +    667 +    585 +| Problem | Cannot distinguish traffic source (README vs App vs Search) |
3573     -    1605 +    668 +    586 +|---------|-------------------------------------------------------------|
3574     -    1606 +    669 +    587 +
3575     -    1607 +    670 +    588 +**Required: UTM Parameters on ALL links**
3576     -    1608 +    671 +    589 +
3577     -    1609 +    672 +    590 +| ‚ùå Bad | ‚úÖ Good |
3578     -    1610 +    673 +    591 +|--------|---------|
3579     -    1611 +    674 +    592 +| `razorpay.me/@markdownviewer` | `razorpay.me/@markdownviewer?notes[source]=webapp_footer` |
3580     -    1612 +    675 +    593 +| `ko-fi.com/markdownviewerpro` | `ko-fi.com/markdownviewerpro?ref=readme_badge` |
3581     -    1613 +    676 +    594 +
3582     -    1614 +    677 +    595 +#### 3. Security Best Practice (`noopener`)
3583     -    1615 +    678 +    596 +
3584     -    1616 +    679 +    597 +| Issue | External links open in new tabs (`target="_blank"`) |
3585     -    1617 +    680 +    598 +|-------|-----------------------------------------------------|
3586     -    1618 +    681 +    599 +| Risk | Reverse Tabnapping (theoretical, but compliance flags it) |
3587     -    1619 +    682 +    600 +
3588     -    1620 +    683 +    601 +**Required:** All external payment links MUST include:
3589     -    1621 +    684 +    602 +```html
3590     -    1622 +    685 +    603 +<a href="..." target="_blank" rel="noopener noreferrer">
3591     -    1623 +    686 +    604 +```
3592     -    1624 +    687 +    605 +
3593     -    1625 +    688 +    606 +### Optimized Code Snippet (Session Caching)
3594     -    1626 +    689 +    607 +
3595     -    1627 +    690 +    608 +```javascript
3596     -    1628 +    691 +    609 +// ENTERPRISE-GRADE IMPLEMENTATION PATTERN v2.2
3597     -    1629 +    692 +    610 +const TIMEOUT_MS = 300;
3598     -    1630 +    693 +    611 +const FALLBACK_REGION = 'global';
3599     -    1631 +    694 +    612 +const CACHE_KEY = 'user_region';
3600     -    1632 +    695 +    613 +
3601     -    1633 +    696 +    614 +async function getDonationConfig() {
3602     -    1634 +    697 +    615 +  // 1. Check Session Cache (FR-1.4) - Avoids API hit on page navigation
3603     -    1635 +    698 +    616 +  const cached = sessionStorage.getItem(CACHE_KEY);
3604     -    1636 +    699 +    617 +  if (cached) return cached;
3605     -    1637 +    700 +    618 +
3606     -    1638 +    701 +    619 +  try {
3607     -    1639 +    702 +    620 +    // 2. Race Network vs Timer
3608     -    1640 +    703 +    621 +    const fetchPromise = fetch('https://ipapi.co/json/').then(r => r.json());
3609     -    1641 +    704 +    622 +    const timeoutPromise = new Promise((_, reject) =>
3610     -    1642 +    705 +    623 +      setTimeout(() => reject(new Error('Timeout')), TIMEOUT_MS)
3611     -    1643 +    706 +    624 +    );
3612     -    1644 +    707 +    625 +
3613     -    1645 +    708 +    626 +    const data = await Promise.race([fetchPromise, timeoutPromise]);
3614     -    1646 +    709 +    627 +    const region = data.country_code === 'IN' ? 'india' : 'global';
3615     -    1647 +    710 +    628 +
3616     -    1648 +    711 +    629 +    // 3. Set Cache
3617     -    1649 +    712 +    630 +    sessionStorage.setItem(CACHE_KEY, region);
3618     -    1650 +    713 +    631 +    return region;
3619     -    1651 +    714 +    632 +  } catch (e) {
3620     -    1652 +    715 +    633 +    // 4. Fail Open - Silent fail to Global
3621     -    1653 +    716 +    634 +    console.warn('[DonationRouter] Geo-lookup failed/timed-out, defaulting to Global.');
3622     -    1654 +    717 +    635 +    return FALLBACK_REGION;
3623     -    1655 +    718 +    636 +  }
3624     -    1656 +    719 +    637 +}
3625     -    1657 +    720 +    638 +
3626     -    1658 +    721 +    639 +// 5. Render with Skeleton Loader (CLS Mitigation)
3627     -    1659 +    722 +    640 +async function renderSupportButton(container) {
3628     -    1660 +    723 +    641 +  // Show skeleton immediately
3629     -    1661 +    724 +    642 +  container.innerHTML = '<button class="support-button support-button--loading">‚òï Support</button>';
3630     -    1662 +    725 +    643 +
3631     -    1663 +    726 +    644 +  const region = await getDonationConfig();
3632     -    1664 +    727 +    645 +  const config = region === 'india'
3633     -    1665 +    728 +    646 +    ? { text: 'üáÆüá≥ Support via UPI', url: 'razorpay.me/@markdownviewer?notes[source]=webapp_footer', class: 'support-button--india' }
3634     -    1666 +    729 +    647 +    : { text: 'üåè Support via PayPal', url: 'ko-fi.com/markdownviewerpro?ref=webapp_footer', class: 'support-button--global' };
3635     -    1667 +    730 +    648 +
3636     -    1668 +    731 +    649 +  // Hydrate with real button
3637     -    1669 +    732 +    650 +  container.innerHTML = `
3638     -    1670 +    733 +    651 +    <a href="https://${config.url}" target="_blank" rel="noopener noreferrer" class="support-button ${config.class}">
3639     -    1671 +    734 +    652 +      ${config.text}
3640     -    1672 +    735 +    653 +    </a>
3641     -    1673 +    736 +    654 +    <button class="support-toggle" onclick="toggleRegion()">Not in ${region === 'india' ? 'India' : 'your country'}?</button>
3642     -    1674 +    737 +    655 +  `;
3643     -    1675 +    738 +    656 +}
3644     -    1676 +    739 +    657 +```
3645     -    1677 +    740 +    658 +
3646     -    1678 +    741 +    659 +### Final Sign-off
3647     -    1679 +    742 +    660 +
3648     -    1680 +    743 +    661 +| Requirement | Status |
3649     -    1681 +    744 +    662 +|-------------|--------|
3650     -    1682 +    745 +    663 +| Fail-Safe Pattern | ‚úÖ Implemented |
3651     -    1683 +    746 +    664 +| Session Caching | ‚úÖ Added (FR-1.4) |
3652     -    1684 +    747 +    665 +| CLS Mitigation | ‚úÖ Skeleton Loader |
3653     -    1685 +    748 +    666 +| UTM Analytics | ‚úÖ Attribution params |
3654     -    1686 +    749 +    667 +| Security (`noopener`) | ‚úÖ Required |
3655     -    1687 +    750 +    668 +| Region Toggle | ‚úÖ Mandatory |
3656     -    1688 +    751 +    669 +
3657     -    1689 +    752 +    670 +**Enterprise Architecture Board: APPROVED** üöÄ
3658     -    1690 +    753 +    671 +
3659     -    1691 +    754 +    672 +---
3660     -    1692 +    755 +    673 +
3661     -    1693 +    756 +    674 +# PART 3: CONSOLIDATED DECISION
3662     -    1694 +    757 +    675 +
3663     -    1695 +    758 +    676 +## Final Architecture (v2.0)
3664     -    1696 +    759 +    677 +
3665     -    1697 +    760 +    678 +```
3666     -    1698 +    761 +    679 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
3667     -    1699 +    762 +    680 +‚îÇ              APPROVED DONATION ARCHITECTURE v2.0                 ‚îÇ
3668     -    1700 +    763 +    681 +‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
3669     -    1701 +    764 +    682 +‚îÇ                                                                  ‚îÇ
3670     -    1702 +    765 +    683 +‚îÇ  README.md (STATIC - No JavaScript)                              ‚îÇ
3671     -    1703 +    766 +    684 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
3672     -    1704 +    767 +    685 +‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ
3673     -    1705 +    768 +    686 +‚îÇ  ‚îÇ  ‚îÇ GitHub       ‚îÇ ‚îÇ Ko-fi        ‚îÇ ‚îÇ Razorpay         ‚îÇ   ‚îÇ  ‚îÇ
3674     -    1706 +    769 +    687 +‚îÇ  ‚îÇ  ‚îÇ Sponsors     ‚îÇ ‚îÇ (Global)     ‚îÇ ‚îÇ (India INR)      ‚îÇ   ‚îÇ  ‚îÇ
3675     -    1707 +    770 +    688 +‚îÇ  ‚îÇ  ‚îÇ (Primary)    ‚îÇ ‚îÇ 0% fee       ‚îÇ ‚îÇ 2% fee           ‚îÇ   ‚îÇ  ‚îÇ
3676     -    1708 +    771 +    689 +‚îÇ  ‚îÇ  ‚îÇ 0% fee       ‚îÇ ‚îÇ PayPal       ‚îÇ ‚îÇ UPI/Paytm/Cards  ‚îÇ   ‚îÇ  ‚îÇ
3677     -    1709 +    772 +    690 +‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ
3678     -    1710 +    773 +    691 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
3679     -    1711 +    774 +    692 +‚îÇ                                                                  ‚îÇ
3680     -    1712 +    775 +    693 +‚îÇ  Web App Footer (OPTIONAL - Smart Routing)                       ‚îÇ
3681     -    1713 +    776 +    694 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
3682     -    1714 +    777 +    695 +‚îÇ  ‚îÇ  if (country === 'IN') show "üáÆüá≥ Support via UPI"         ‚îÇ  ‚îÇ
3683     -    1715 +    778 +    696 +‚îÇ  ‚îÇ  else                  show "üåè Support via PayPal"        ‚îÇ  ‚îÇ
3684     -    1716 +    779 +    697 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
3685     -    1717 +    780 +    698 +‚îÇ                                                                  ‚îÇ
3686     -    1718 +    781 +    699 +‚îÇ  Financial "Two-Pocket" Strategy:                                ‚îÇ
3687     -    1719 +    782 +    700 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
3688     -    1720 +    783 +    701 +‚îÇ  ‚îÇ Pocket A: Razorpay  ‚îÇ    ‚îÇ Pocket B: PayPal    ‚îÇ             ‚îÇ
3689     -    1721 +    784 +    702 +‚îÇ  ‚îÇ (Domestic INR)      ‚îÇ    ‚îÇ (Foreign USD)       ‚îÇ             ‚îÇ
3690     -    1722 +    785 +    703 +‚îÇ  ‚îÇ Domestic Income     ‚îÇ    ‚îÇ FIRC Remittance     ‚îÇ             ‚îÇ
3691     -    1723 +    786 +    704 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
3692     -    1724 +    787 +    705 +‚îÇ                                                                  ‚îÇ
3693     -    1725 +    788 +    706 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
3694     -    1726 +    789 +    707 +```
3695     -    1727 +    790 +    708 +
3696     -    1728 +    791 +    709 +## Action Items (REVISED per Sr. Principal SDE)
3697     -    1729 +    792 +    710 +
3698     -    1730 +    793 +    711 +| Priority | Action | Status | Notes |
3699     -    1731 +    794 +    712 +|----------|--------|--------|-------|
3700     -    1732 +    795 +    713 +| **P0** | Create Ko-fi account | ‚è≥ Pending | Immediate |
3701     -    1733 +    796 +    714 +| **P0** | Create Razorpay account (KYC) | ‚è≥ Pending | PAN/Aadhaar required |
3702     -    1734 +    797 +    715 +| **P0** | Add support button to Web App footer | ‚è≥ Pending | **PRIMARY** |
3703     -    1735 +    798 +    716 +| **P1** | Apply for GitHub Sponsors | ‚è≥ Pending | 2-4 week wait |
3704     -    1736 +    799 +    717 +| **P2** | Add static badges to README.md | ‚è≥ Pending | **SECONDARY** (after GH approval) |
3705     -    1737 +    800 +    718 +| **P3** | IP-based smart routing in web app | ‚è≥ Future | Only with fail-safe pattern |
3706     -    1738 +    801 +    719 +
3707     -    1739 +    802 +    720 +### Technical Requirements for Smart Routing
3708     -    1740 +    803 +    721 +
3709     -    1741 +    804 +    722 +| Requirement | Specification |
3710     -    1742 +    805 +    723 +|-------------|---------------|
3711     -    1743 +    806 +    724 +| IP API Timeout | ‚â§300ms |
3712     -    1744 +    807 +    725 +| Fail-Safe Default | Global (USD/PayPal) |
3713     -    1745 +    808 +    726 +| "Not in India?" Toggle | **MANDATORY** |
3714     -    1746 +    809 +    727 +| Client-side Only | No backend IP logging |
3715     -    1747 +    810 +    728 +| Redirect Service | `yoursite.com/go/donate-*` pattern |
3716     -    1748 +    811 +    729 +
3717     -    1749 +    812 +    730 +---
3718     -    1750 +    813 +    731 +
3719     -    1751 +    814 +    732 +## Document History
3720     -    1752 +    815 +    733 +
3721     -    1753 +    816 +    734 +| Version | Date | Author | Changes |
3722     -    1754 +    817 +    735 +|---------|------|--------|---------|
3723     -    1755 +    818 +    736 +| 1.0 | 2025-12-19 | Principal SDE | Initial document |
3724     -    1756 +    819 +    737 +| 2.0 | 2025-12-19 | Principal SDE | Added independent reviews, consolidated decision |
3725     -    1757 +    820 +    738 +
3726     -    1758 +    821 +    739 +---
3727     -    1759 +    822 +    740 +
3728     -    1760 +    823 +    741 +---
3729     -    1761 +    824 +    742 +
3730     -    1762 +    825 +    743 +# PART 4: FINAL RECOMMENDATION
3731     -    1763 +    826 +    744 +
3732     -    1764 +    827 +    745 +## Synthesized Analysis from All Reviewers
3733     -    1765 +    828 +    746 +
3734     -    1766 +    829 +    747 +| Reviewer | Key Insight | Agreement |
3735     -    1767 +    830 +    748 +|----------|-------------|-----------|
3736     -    1768 +    831 +    749 +| **Cline AI** | Feature Plan is comprehensive, adopt Two-Pocket Strategy | ‚úÖ |
3737     -    1769 +    832 +    750 +| **Gemini** | Static badges trusted, Smart Router risky for README | ‚úÖ |
3738     -    1770 +    833 +    751 +| **Sr. Principal** | Web App PRIMARY, fail-safe mandatory, 300ms timeout | ‚úÖ |
3739     -    1771 +    834 +    752 +
3740     -    1772 +    835 +    753 +## üéØ FINAL RECOMMENDATION
3741     -    1773 +    836 +    754 +
3742     -    1774 +    837 +    755 +### Approved Architecture
3743     -    1775 +    838 +    756 +
3744     -    1776 +    839 +    757 +```
3745     -    1777 +    840 +    758 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
3746     -    1778 +    841 +    759 +‚îÇ           FINAL APPROVED ARCHITECTURE v2.1                       ‚îÇ
3747     -    1779 +    842 +    760 +‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
3748     -    1780 +    843 +    761 +‚îÇ                                                                  ‚îÇ
3749     -    1781 +    844 +    762 +‚îÇ  PHASE 1: WEB APP (PRIMARY) - Immediate                          ‚îÇ
3750     -    1782 +    845 +    763 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
3751     -    1783 +    846 +    764 +‚îÇ  ‚îÇ  Footer Button: "‚òï Support This Project"                  ‚îÇ  ‚îÇ
3752     -    1784 +    847 +    765 +‚îÇ  ‚îÇ                                                            ‚îÇ  ‚îÇ
3753     -    1785 +    848 +    766 +‚îÇ  ‚îÇ  IP Detection (Fail-Safe):                                 ‚îÇ  ‚îÇ
3754     -    1786 +    849 +    767 +‚îÇ  ‚îÇ  ‚îú‚îÄ India ‚Üí "üáÆüá≥ Support via UPI" ‚Üí Razorpay              ‚îÇ  ‚îÇ
3755     -    1787 +    850 +    768 +‚îÇ  ‚îÇ  ‚îú‚îÄ Others ‚Üí "üåè Support via PayPal" ‚Üí Ko-fi              ‚îÇ  ‚îÇ
3756     -    1788 +    851 +    769 +‚îÇ  ‚îÇ  ‚îî‚îÄ Fallback (API fail/timeout) ‚Üí Ko-fi (Global)          ‚îÇ  ‚îÇ
3757     -    1789 +    852 +    770 +‚îÇ  ‚îÇ                                                            ‚îÇ  ‚îÇ
3758     -    1790 +    853 +    771 +‚îÇ  ‚îÇ  MANDATORY: "Not in India? Click here" toggle              ‚îÇ  ‚îÇ
3759     -    1791 +    854 +    772 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
3760     -    1792 +    855 +    773 +‚îÇ                                                                  ‚îÇ
3761     -    1793 +    856 +    774 +‚îÇ  PHASE 2: README (SECONDARY) - After GH Sponsors Approval        ‚îÇ
3762     -    1794 +    857 +    775 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
3763     -    1795 +    858 +    776 +‚îÇ  ‚îÇ  Static Badges (NO JavaScript):                            ‚îÇ  ‚îÇ
3764     -    1796 +    859 +    777 +‚îÇ  ‚îÇ  [Ko-fi] [Razorpay ‚Çπ] [GitHub Sponsors*]                  ‚îÇ  ‚îÇ
3765     -    1797 +    860 +    778 +‚îÇ  ‚îÇ  * Add only after approval received                        ‚îÇ  ‚îÇ
3766     -    1798 +    861 +    779 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
3767     -    1799 +    862 +    780 +‚îÇ                                                                  ‚îÇ
3768     -    1800 +    863 +    781 +‚îÇ  FINANCIAL STRATEGY: Two-Pocket                                  ‚îÇ
3769     -    1801 +    864 +    782 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
3770     -    1802 +    865 +    783 +‚îÇ  ‚îÇ üáÆüá≥ Pocket A        ‚îÇ    ‚îÇ üåè Pocket B         ‚îÇ             ‚îÇ
3771     -    1803 +    866 +    784 +‚îÇ  ‚îÇ Razorpay (INR)      ‚îÇ    ‚îÇ Ko-fi/PayPal (USD)  ‚îÇ             ‚îÇ
3772     -    1804 +    867 +    785 +‚îÇ  ‚îÇ Domestic Income     ‚îÇ    ‚îÇ FIRC Remittance     ‚îÇ             ‚îÇ
3773     -    1805 +    868 +    786 +‚îÇ  ‚îÇ UPI/Paytm/Cards     ‚îÇ    ‚îÇ Cards/PayPal        ‚îÇ             ‚îÇ
3774     -    1806 +    869 +    787 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
3775     -    1807 +    870 +    788 +‚îÇ                                                                  ‚îÇ
3776     -    1808 +    871 +    789 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
3777     -    1809 +    872 +    790 +```
3778     -    1810 +    873 +    791 +
3779     -    1811 +    874 +    792 +### Platform Selection Decision
3780     -    1812 +    875 +    793 +
3781     -    1813 +    876 +    794 +| Platform | Role | When to Deploy | Fee |
3782     -    1814 +    877 +    795 +|----------|------|----------------|-----|
3783     -    1815 +    878 +    796 +| **Ko-fi** | Global Primary | Day 1 | 0% + PayPal 2.9% |
3784     -    1816 +    879 +    797 +| **Razorpay** | India Primary | Day 1 (after KYC) | 2% |
3785     -    1817 +    880 +    798 +| **GitHub Sponsors** | Developer Primary | After approval (2-4 weeks) | 0% |
3786     -    1818 +    881 +    799 +
3787     -    1819 +    882 +    800 +### Implementation Order
3788     -    1820 +    883 +    801 +
3789     -    1821 +    884 +    802 +| Phase | Action | Timeline | Blocker |
3790     -    1822 +    885 +    803 +|-------|--------|----------|---------|
3791     -    1823 +    886 +    804 +| **0** | Create Ko-fi account | Now | None |
3792     -    1824 +    887 +    805 +| **0** | Create Razorpay account | Now | KYC (PAN/Aadhaar) |
3793     -    1825 +    888 +    806 +| **1** | Add Web App footer button | Day 1-2 | None |
3794     -    1826 +    889 +    807 +| **2** | Apply for GitHub Sponsors | Day 1 | None |
3795     -    1827 +    890 +    808 +| **3** | Add README badges (Ko-fi + Razorpay) | Day 3 | None |
3796     -    1828 +    891 +    809 +| **4** | Add GitHub Sponsors badge | Week 3-4 | Approval email |
3797     -    1829 +    892 +    810 +| **5** | IP-based smart routing | Optional | Fail-safe code ready |
3798     -    1830 +    893 +    811 +
3799     -    1831 +    894 +    812 +### Technical Specifications (MANDATORY)
3800     -    1832 +    895 +    813 +
3801     -    1833 +    896 +    814 +```javascript
3802     -    1834 +    897 +    815 +// REQUIRED: Fail-Safe Smart Routing Pattern
3803     -    1835 +    898 +    816 +const TIMEOUT_MS = 300;
3804     -    1836 +    899 +    817 +const DEFAULT_REGION = 'global'; // Ko-fi
3805     -    1837 +    900 +    818 +
3806     -    1838 +    901 +    819 +async function detectRegion() {
3807     -    1839 +    902 +    820 +  try {
3808     -    1840 +    903 +    821 +    const controller = new AbortController();
3809     -    1841 +    904 +    822 +    const timeoutId = setTimeout(() => controller.abort(), TIMEOUT_MS);
3810     -    1842 +    905 +    823 +
3811     -    1843 +    906 +    824 +    const response = await fetch('https://ipapi.co/json/', {
3812     -    1844 +    907 +    825 +      signal: controller.signal
3813     -    1845 +    908 +    826 +    });
3814     -    1846 +    909 +    827 +    clearTimeout(timeoutId);
3815     -    1847 +    910 +    828 +
3816     -    1848 +    911 +    829 +    const data = await response.json();
3817     -    1849 +    912 +    830 +    return data.country_code === 'IN' ? 'india' : 'global';
3818     -    1850 +    913 +    831 +  } catch (error) {
3819     -    1851 +    914 +    832 +    // Silent fail to global
3820     -    1852 +    915 +    833 +    return DEFAULT_REGION;
3821     -    1853 +    916 +    834 +  }
3822     -    1854 +    917 +    835 +}
3823     -    1855 +    918 +    836 +
3824     -    1856 +    919 +    837 +// REQUIRED: Manual Override
3825     -    1857 +    920 +    838 +function showRegionToggle() {
3826     -    1858 +    921 +    839 +  // "Not in India? Click for international options"
3827     -    1859 +    922 +    840 +  // "In India? Click for UPI options"
3828     -    1860 +    923 +    841 +}
3829     -    1861 +    924 +    842 +```
3830     -    1862 +    925 +    843 +
3831     -    1863 +    926 +    844 +### Terminology (LEGAL REQUIREMENT)
3832     -    1864 +    927 +    845 +
3833     -    1865 +    928 +    846 +| ‚ùå DON'T USE | ‚úÖ USE INSTEAD |
3834     -    1866 +    929 +    847 +|-------------|----------------|
3835     -    1867 +    930 +    848 +| Donation | Support |
3836     -    1868 +    931 +    849 +| Donate | Sponsor |
3837     -    1869 +    932 +    850 +| Charity | Tip |
3838     -    1870 +    933 +    851 +| Contribute | Buy me a coffee |
3839     -    1871 +    934 +    852 +
3840     -    1872 +    935 +    853 +### Success Criteria
3841     -    1873 +    936 +    854 +
3842     -    1874 +    937 +    855 +| Metric | Target | Measurement |
3843     -    1875 +    938 +    856 +|--------|--------|-------------|
3844     -    1876 +    939 +    857 +| Web App button live | Day 3 | Deployed |
3845     -    1877 +    940 +    858 +| README badges live | Day 7 | Deployed |
3846     -    1878 +    941 +    859 +| First support received | Week 4 | Platform dashboard |
3847     -    1879 +    942 +    860 +| Zero legal issues | Ongoing | No complaints |
3848     -    1880 +    943 +    861 +
3849     -    1881 +    944 +    862 +---
3850     -    1882 +    945 +    863 +
3851     -    1883 +    946 +    864 +## ‚úÖ VERDICT: GREEN LIGHT FOR ENGINEERING
3852     -    1884 +    947 +    865 +
3853     -    1885 +    948 +    866 +**Core Conditions (MANDATORY):**
3854     -    1886 +    949 +    867 +1. Web App footer button is PRIMARY (not README)
3855     -    1887 +    950 +    868 +2. Fail-safe pattern with 300ms timeout is MANDATORY
3856     -    1888 +    951 +    869 +3. "Not in India?" toggle is MANDATORY
3857     -    1889 +    952 +    870 +4. Use "Support" terminology exclusively
3858     -    1890 +    953 +    871 +5. Deploy GitHub Sponsors badge ONLY after approval email
3859     -    1891 +    954 +    872 +
3860     -    1892 +    955 +    873 +**Enterprise Refinements (REQUIRED):**
3861     -    1893 +    956 +    874 +6. Skeleton Loader for CLS mitigation (min-height: 60px)
3862     -    1894 +    957 +    875 +7. UTM parameters on ALL payment links for attribution
3863     -    1895 +    958 +    876 +8. `rel="noopener noreferrer"` on ALL external links
3864     -    1896 +    959 +    877 +9. Session caching to avoid repeated API calls
3865     -    1897 +    960 +    878 +
3866     -    1898 +    961 +    879 +---
3867     -    1899 +    962 +    880 +
3868     -    1900 +    963 +    881 +## Document History
3869     -    1901 +    964 +    882 +
3870     -    1902 +    965 +    883 +| Version | Date | Author | Changes |
3871     -    1903 +    966 +    884 +|---------|------|--------|---------|
3872     -    1904 +    967 +    885 +| 1.0 | 2025-12-19 | Principal SDE | Initial document |
3873     -    1905 +    968 +    886 +| 2.0 | 2025-12-19 | Principal SDE | Added Reviews A, B, C + consolidated decision |
3874     -    1906 +    969 +    887 +| 2.1 | 2025-12-19 | Principal SDE | Added PART 4 Final Recommendation |
3875     -    1907 +    970 +    888 +| 2.2 | 2025-12-19 | Enterprise Board | Added Review D + Enterprise Refinements + GREEN LIGHT |
3876     -    1908 +    971 +    889 +
3877     -    1909 +    972 +    890 +---
3878     -    1910 +    973 +    891 +
3879     -    1911 +    974 +    892 +**Status**: üü¢ APPROVED - ZERO DEFECTS
3880     -    1912 +    975 +    893 +**Reviewed By**: 4 Reviewers (3 Principal SDEs + Enterprise Architecture Board)
3881     -    1913 +    976 +    894 +**Technical Feasibility**: 10/10
3882     -    1914 +    977 +    895 +**Compliance Rating**: 10/10
3883     -    1915 +    978 +    896 +**Final Decision**: Web App Primary + Static Badges Secondary + Fail-Safe Smart Routing
3884     -    1916 +    979 +    897 +**Ready for**: Phase 0 (Account Setup)
3885     -    1917 +    980 +    898 +
3886     -    1918 +    981 +    899 +üöÄ **GO FOR LAUNCH**
3887     -    1919 +    982 +    900 +
3888     -    1920 +    983 +    901 +---
3889     -    1921 +    984 +    902 +
3890     -    1922 +    985 +    903 +> **Next Step:** Proceed to Phase 0 (Account Creation) below.
3891     -    1923 +    986 +    904 +
3892     -    1924 +    987 +    905 +---
3893     -    1925 +    988 +    906 +
3894     -    1926 +    989 +    907 +# APPENDIX A: Phase 0 - Account Creation Guide
3895     -    1927 +    990 +    908 +
3896     -    1928 +    991 +    909 +## Step-by-Step Setup Instructions
3897     -    1929 +    992 +    910 +
3898     -    1930 +    993 +    911 +### A.1 Ko-fi Account Setup (Global - Day 1)
3899     -    1931 +    994 +    912 +
3900     -    1932 +    995 +    913 +**URL:** https://ko-fi.com/
3901     -    1933 +    996 +    914 +
3902     -    1934 +    997 +    915 +| Step | Action | Notes |
3903     -    1935 +    998 +    916 +|------|--------|-------|
3904     -    1936 +    999 +    917 +| 1 | Go to https://ko-fi.com/ | Click "Start a Page" |
3905     -    1937 +    1000 +    918 +| 2 | Sign up with email or Google | Use project email if available |
3906     -    1938 +    1001 +    919 +| 3 | Choose username | e.g., `markdownviewerpro` |
3907     -    1939 +    1002 +    920 +| 4 | Set up profile | Add project logo, description |
3908     -    1940 +    1003 +    921 +| 5 | Connect PayPal or Stripe | **Required for payouts** |
3909     -    1941 +    1004 +    922 +| 6 | Set donation amounts | $1, $5, $10, $20, $50 |
3910     -    1942 +    1005 +    923 +| 7 | Enable "Support" button | Not "Donate" (legal) |
3911     -    1943 +    1006 +    924 +| 8 | Get page URL | `ko-fi.com/markdownviewerpro` |
3912     -    1944 +    1007 +    925 +
3913     -    1945 +    1008 +    926 +**Time Required:** ~10 minutes
3914     -    1946 +    1009 +    927 +**Verification:** Make a $1 test donation to yourself
3915     -    1947 +    1010 +    928 +
3916     -    1948 +    1011 +    929 +---
3917     -    1949 +    1012 +    930 +
3918     -    1950 +    1013 +    931 +### A.2 Razorpay Account Setup (India - Day 1)
3919     -    1951 +    1014 +    932 +
3920     -    1952 +    1015 +    933 +**URL:** https://dashboard.razorpay.com/signup
3921     -    1953 +    1016 +    934 +
3922     -    1954 +    1017 +    935 +| Step | Action | Notes |
3923     -    1955 +    1018 +    936 +|------|--------|-------|
3924     -    1956 +    1019 +    937 +| 1 | Go to Razorpay Dashboard | Click "Sign Up" |
3925     -    1957 +    1020 +    938 +| 2 | Enter mobile number | Indian number required |
3926     -    1958 +    1021 +    939 +| 3 | Verify OTP | |
3927     -    1959 +    1022 +    940 +| 4 | Select "Individual" account type | Not "Business" |
3928     -    1960 +    1023 +    941 +| 5 | Complete KYC | **Required documents below** |
3929     -    1961 +    1024 +    942 +| 6 | Create Payment Page | "Support Markdown Viewer Pro" |
3930     -    1962 +    1025 +    943 +| 7 | Set preset amounts | ‚Çπ50, ‚Çπ100, ‚Çπ250, ‚Çπ500, ‚Çπ1000 |
3931     -    1963 +    1026 +    944 +| 8 | Enable UPI, Cards, Netbanking | |
3932     -    1964 +    1027 +    945 +| 9 | Get Payment Link | `razorpay.me/@markdownviewer` |
3933     -    1965 +    1028 +    946 +
3934     -    1966 +    1029 +    947 +**KYC Documents Required:**
3935     -    1967 +    1030 +    948 +- PAN Card (Individual)
3936     -    1968 +    1031 +    949 +- Aadhaar Card
3937     -    1969 +    1032 +    950 +- Bank Account Details (Account number, IFSC)
3938     -    1970 +    1033 +    951 +- Cancelled Cheque (optional)
3939     -    1971 +    1034 +    952 +
3940     -    1972 +    1035 +    953 +**Time Required:** ~30 minutes (KYC may take 24-48 hours for verification)
3941     -    1973 +    1036 +    954 +**Verification:** Make a ‚Çπ10 test payment
3942     -    1974 +    1037 +    955 +
3943     -    1975 +    1038 +    956 +---
3944     -    1976 +    1039 +    957 +
3945     -    1977 +    1040 +    958 +### A.3 GitHub Sponsors Setup (Developers - Week 1)
3946     -    1978 +    1041 +    959 +
3947     -    1979 +    1042 +    960 +**URL:** https://github.com/sponsors
3948     -    1980 +    1043 +    961 +
3949     -    1981 +    1044 +    962 +| Step | Action | Notes |
3950     -    1982 +    1045 +    963 +|------|--------|-------|
3951     -    1983 +    1046 +    964 +| 1 | Ensure 2FA is enabled | **Mandatory** |
3952     -    1984 +    1047 +    965 +| 2 | Complete GitHub profile | Bio, location, profile picture |
3953     -    1985 +    1048 +    966 +| 3 | Go to https://github.com/sponsors | Click "Join the waitlist" |
3954     -    1986 +    1049 +    967 +| 4 | Select "Individual" | Not Organization |
3955     -    1987 +    1050 +    968 +| 5 | Choose payout country | India |
3956     -    1988 +    1051 +    969 +| 6 | Connect Stripe Express | For payouts to Indian bank |
3957     -    1989 +    1052 +    970 +| 7 | Fill tax information | W-8BEN form (non-US) |
3958     -    1990 +    1053 +    971 +| 8 | Set sponsorship tiers | $1, $5, $10, $20, $50/month |
3959     -    1991 +    1054 +    972 +| 9 | Write sponsor introduction | Why support this project |
3960     -    1992 +    1055 +    973 +| 10 | Submit for review | **Wait 2-4 weeks** |
3961     -    1993 +    1056 +    974 +
3962     -    1994 +    1057 +    975 +**Prerequisites:**
3963     -    1995 +    1058 +    976 +- GitHub account with 2FA enabled
3964     -    1996 +    1059 +    977 +- Profile with photo and bio
3965     -    1997 +    1060 +    978 +- At least one public repository
3966     -    1998 +    1061 +    979 +- Active contribution history (recommended)
3967     -    1999 +    1062 +    980 +
3968     -    2000 +    1063 +    981 +**Time Required:** ~20 minutes to apply
3969     -    2001 +    1064 +    982 +**Approval Time:** 2-4 weeks
3970     -    2002 +    1065 +    983 +**Verification:** Check email for approval notification
3971     -    2003 +    1066 +    984 +
3972     -    2004 +    1067 +    985 +---
3973     -    2005 +    1068 +    986 +
3974     -    2006 +    1069 +    987 +## Phase 0 Checklist
3975     -    2007 +    1070 +    988 +
3976     -    2008 +    1071 +    989 +```markdown
3977     -    2009 +    1072 +    990 +## Account Creation Checklist
3978     -    2010 +    1073 +    991 +
3979     -    2011 +    1074 +    992 +### Day 1
3980     -    2012 +    1075 +    993 +- [ ] Create Ko-fi account
3981     -    2013 +    1076 +    994 +  - [ ] Sign up at ko-fi.com
3982     -    2014 +    1077 +    995 +  - [ ] Set username: _______________
3983     -    2015 +    1078 +    996 +  - [ ] Connect PayPal/Stripe
3984     -    2016 +    1079 +    997 +  - [ ] Set amounts: $1, $5, $10, $20, $50
3985     -    2017 +    1080 +    998 +  - [ ] Test with $1 donation
3986     -    2018 +    1081 +    999 +  - [ ] Copy link: ko-fi.com/_______________
3987     -    2019 +    1082 +    1000 +
3988     -    2020 +    1083 +    1001 +- [ ] Create Razorpay account
3989     -    2021 +    1084 +    1002 +  - [ ] Sign up at razorpay.com
3990     -    2022 +    1085 +    1003 +  - [ ] Complete KYC (PAN, Aadhaar)
3991     -    2023 +    1086 +    1004 +  - [ ] Wait for verification (24-48h)
3992     -    2024 +    1087 +    1005 +  - [ ] Create Payment Page
3993     -    2025 +    1088 +    1006 +  - [ ] Set amounts: ‚Çπ50, ‚Çπ100, ‚Çπ250, ‚Çπ500, ‚Çπ1000
3994     -    2026 +    1089 +    1007 +  - [ ] Test with ‚Çπ10 payment
3995     -    2027 +    1090 +    1008 +  - [ ] Copy link: razorpay.me/@_______________
3996     -    2028 +    1091 +    1009 +
3997     -    2029 +    1092 +    1010 +### Day 1 (Submit, wait 2-4 weeks)
3998     -    2030 +    1093 +    1011 +- [ ] Apply for GitHub Sponsors
3999     -    2031 +    1094 +    1012 +  - [ ] Enable 2FA on GitHub
4000     -    2032 +    1095 +    1013 +  - [ ] Complete profile
4001     -    2033 +    1096 +    1014 +  - [ ] Submit application
4002     -    2034 +    1097 +    1015 +  - [ ] Fill W-8BEN tax form
4003     -    2035 +    1098 +    1016 +  - [ ] Connect Stripe Express
4004     -    2036 +    1099 +    1017 +  - [ ] Wait for approval email
4005     -    2037 +    1100 +    1018 +
4006     -    2038 +    1101 +    1019 +### After Approval
4007     -    2039 +    1102 +    1020 +- [ ] GitHub Sponsors approved
4008     -    2040 +    1103 +    1021 +  - [ ] Set up tiers
4009     -    2041 +    1104 +    1022 +  - [ ] Enable on repository
4010     -    2042 +    1105 +    1023 +  - [ ] Add badge to README
4011     -    2043 +    1106 +    1024 +```
4012     -    2044 +    1107 +    1025 +
4013     -    2045 +    1108 +    1026 +---
4014     -    2046 +    1109 +    1027 +
4015     -    2047 +    1110 +    1028 +## Quick Reference: Account URLs After Setup
4016     -    2048 +    1111 +    1029 +
4017     -    2049 +    1112 +    1030 +| Platform | Your URL | Status |
4018     -    2050 +    1113 +    1031 +|----------|----------|--------|
4019     -    2051 +    1114 +    1032 +| Ko-fi | `https://ko-fi.com/markdownviewerpro` | ‚è≥ Pending |
4020     -    2052 +    1115 +    1033 +| Razorpay | `https://razorpay.me/@markdownviewer` | ‚è≥ Pending |
4021     -    2053 +    1116 +    1034 +| GitHub Sponsors | `https://github.com/sponsors/PrakharMNNIT` | ‚è≥ Pending Approval |
4022     -    2054 +    1117 +    1035 +
4023     -    2055 +    1118 +    1036 +---
4024     -    2056 +    1119 +    1037 +
4025     -    2057 +    1120 +    1038 +## Troubleshooting
4026     -    2058 +    1121 +    1039 +
4027     -    2059 +    1122 +    1040 +### Ko-fi Issues
4028     -    2060 +    1123 +    1041 +| Problem | Solution |
4029     -    2061 +    1124 +    1042 +|---------|----------|
4030     -    2062 +    1125 +    1043 +| PayPal not connecting | Use Stripe instead |
4031     -    2063 +    1126 +    1044 +| Payout delayed | Check PayPal verification status |
4032     -    2064 +    1127 +    1045 +| Page not visible | Check privacy settings |
4033     -    2065 +    1128 +    1046 +
4034     -    2066 +    1129 +    1047 +### Razorpay Issues
4035     -    2067 +    1130 +    1048 +| Problem | Solution |
4036     -    2068 +    1131 +    1049 +|---------|----------|
4037     -    2069 +    1132 +    1050 +| KYC rejected | Re-upload clearer documents |
4038     -    2070 +    1133 +    1051 +| Payout delayed | Verify bank details |
4039     -    2071 +    1134 +    1052 +| International cards failing | Enable "International Payments" in dashboard |
4040     -    2072 +    1135 +    1053 +
4041     -    2073 +    1136 +    1054 +### GitHub Sponsors Issues
4042     -    2074 +    1137 +    1055 +| Problem | Solution |
4043     -    2075 +    1138 +    1056 +|---------|----------|
4044     -    2076 +    1139 +    1057 +| Application rejected | Improve profile, add more repos |
4045     -    2077 +    1140 +    1058 +| Stripe not available | Use alternative payout method |
4046     -    2078 +    1141 +    1059 +| Long wait time | Normal - allow up to 4 weeks |
4047     -    2079 +    1142 +    1060 +
4048     -    2080 +    1143 +    1061 +---
4049     -    2081 +    1144 +    1062 +
4050     -    2082 +    1145 +    1063 +**End of Appendix A**
4051     -    2083 +    1146 +    1064  
4052     -    2084 +    1147 +
4053     -    2085 +    1148 +```
4054     -    2086 +    1149 +
4055     -    2087 +    1150 +
4056     -    2088 +    1151 +### ‚ú® `docs/01-requirements/donation_final_readiness_review.md` **[ADDED]**
4057     -    2089 +    1152 +
4058     -    2090 +    1153 +**Status:** ‚úÖ **NEW FILE** - This file has been newly created
4059     -    2091 +    1154 +
4060     -    2092 +    1155 +**Type:** Documentation üìñ
4061     -    2093 +    1156 +
4062     -    2094 +    1157 +```diff
4063     -    2095 +    1158 +@@ -0,0 +1,91 @@
4064     -    2096 +    1159 +      1 +# Sr. Principal SDE Final Readiness Review
4065     -    2097 +    1160 +      2 +
4066     -    2098 +    1161 +      3 +**Reviewer:** Enterprise Architecture Board
4067     -    2099 +    1162 +      4 +**Date:** 2025-12-19
4068     -    2100 +    1163 +      5 +**Target:** `donation-feature-plan.md` (v2.1 Consolidated)
4069     -    2101 +    1164 +      6 +**Status:** ‚úÖ **GREEN LIGHT** (with 3 Non-Blocking Observability Recommendations)
4070     -    2102 +947 1165        7 +
4071     -    2103 +948 1166        8 +---
4072     -    2104 +949 1167        9 +
4073     -    2105 +950     -     10 +## üìã Table of Contents
4074     -    2106 +    1168 +     10 +## 1. Executive Summary
4075     -    2107 +951 1169       11 +
4076     -    2108 +952     -     12 +1. [Standard Assumptions](#-standard-assumptions)
4077     -    2109 +953     -     13 +2. [Integer Limits & Data Types](#-integer-limits--data-types)
4078     -    2110 +954     -     14 +3. [Array & Container Constraints](#-array--container-constraints)
4079     -    2111 +955     -     15 +4. [String Constraints](#-string-constraints)
4080     -    2112 +956     -     16 +5. [Time Complexity Limits](#-time-complexity-limits)
4081     -    2113 +957     -     17 +6. [Space Complexity Limits](#-space-complexity-limits)
4082     -    2114 +958     -     18 +7. [Common Primes & Mathematical Constants](#-common-primes--mathematical-constants)
4083     -    2115 +959     -     19 +8. [Edge Cases Checklist](#-edge-cases-checklist)
4084     -    2116 +960     -     20 +9. [Platform-Specific Constraints](#-platform-specific-constraints)
4085     -    2117 +961     -     21 +10. [Quick Reference Cheatsheet](#-quick-reference-cheatsheet)
4086     -    2118 +962     -     22 +
4087     -    2119 +963     -     23 +---
4088     -    2120 +964     -     24 +
4089     -    2121 +965     -     25 +## üéØ Standard Assumptions
4090     -    2122 +966     -     26 +
4091     -    2123 +967     -     27 +### The Golden Rules
4092     -    2124 +    1170 +     12 +The consolidated plan (v2.1) has successfully resolved the critical architectural conflicts identified in previous reviews. The "Web App Primary + Fail-Safe Router" approach combined with the "Two-Pocket" financial strategy represents a high-maturity solution that balances **User Experience**, **Legal Compliance**, and **Technical Risk**.
4093     -    2125 +    1171 +     13 +
4094     -    2126 +    1172 +     14 +**Verdict:** The plan is **Ready for Engineering**.
4095     -    2127 +    1173 +     15 +
4096     -    2128 +    1174 +     16 +---
4097     -    2129 +    1175 +     17 +
4098     -    2130 +    1176 +     18 +## 2. Residual Efficiency & Observability Risks
4099     -    2131 +    1177 +     19 +
4100     -    2132 +    1178 +     20 +While the core functionality is sound, a "Strict" review identifies minor gaps in **UX Stability** and **Business Observability** that should be addressed during implementation.
4101     -    2133 +    1179 +     21 +
4102     -    2134 +    1180 +     22 +### 2.1 Cumulative Layout Shift (CLS) Risk
4103     -    2135 +    1181 +     23 +*   **Issue:** The "Smart Router" relies on an asynchronous `fetch` with a 300ms race condition.
4104     -    2136 +    1182 +     24 +*   **Risk:** If the footer renders *without* the button, and then the button "pops in" 200ms later, it causes a layout shift. This hurts SEO (Core Web Vitals) and visual polish.
4105     -    2137 +    1183 +     25 +*   **Requirement:** The footer implementation **MUST** reserve fixed vertical space (e.g., `min-height: 60px`) for the support widget *before* the JS runs.
4106     -    2138 +    1184 +     26 +    *   *Loading State:* Show a generic "‚òï Support" grey ghost button immediately.
4107     -    2139 +    1185 +     27 +    *   *Hydration:* Swap it for the colorful "üáÆüá≥ UPI" or "üåè PayPal" button once the promise resolves.
4108     -    2140 +968 1186       28 +
4109     -    2141 +969     -     29 +| Assumption | Typical Value | Reasoning |
4110     -    2142 +970     -     30 +|------------|---------------|-----------|
4111     -    2143 +971     -     31 +| **Time Limit** | 1-2 seconds | ~10‚Å∏ simple operations/second |
4112     -    2144 +972     -     32 +| **Memory Limit** | 256 MB | Standard competitive programming |
4113     -    2145 +973     -     33 +| **Max Input Size (n)** | 10‚Åµ to 10‚Å∂ | Fits in memory, allows O(n log n) |
4114     -    2146 +974     -     34 +| **Max Integer Value** | 10‚Åπ | Fits in `int` |
4115     -    2147 +975     -     35 +| **Large Integer Value** | 10¬π‚Å∏ | Requires `long long` |
4116     -    2148 +    1187 +     29 +### 2.2 Blind spots in Success Metrics
4117     -    2149 +    1188 +     30 +*   **Issue:** The stated *Success Metrics* include "At least 3 valid donations".
4118     -    2150 +    1189 +     31 +*   **Risk:** With direct links to Ko-fi/Razorpay, you cannot distinguish traffic sources (README vs App Footer vs Direct Search). You will see money, but not *attribution*.
4119     -    2151 +    1190 +     32 +*   **Requirement:** Use UTM parameters or `ref` tags on all generated links.
4120     -    2152 +    1191 +     33 +    *   **Bad:** `razorpay.me/@markdownviewer`
4121     -    2153 +    1192 +     34 +    *   **Good:** `razorpay.me/@markdownviewer?notes[source]=webapp_footer`
4122     -    2154 +    1193 +     35 +    *   **Good:** `ko-fi.com/markdownviewerpro?ref=readme_badge`
4123     -    2155 +976 1194       36 +
4124     -    2156 +977     -     37 +### What to Ask in Interviews
4125     -    2157 +978     -     38 +
4126     -    2158 +979     -     39 +1. **Input size constraints?** (n ‚â§ ?)
4127     -    2159 +980     -     40 +2. **Value range?** (values ‚â§ ?)
4128     -    2160 +981     -     41 +3. **Can values be negative?**
4129     -    2161 +982     -     42 +4. **Are there duplicates?**
4130     -    2162 +983     -     43 +5. **Is input sorted?**
4131     -    2163 +984     -     44 +6. **Can input be empty?**
4132     -    2164 +    1195 +     37 +### 2.3 Security Best Practice (`noopener`)
4133     -    2165 +    1196 +     38 +*   **Issue:** External links to payment processors open in new tabs (`target="_blank"`).
4134     -    2166 +    1197 +     39 +*   **Risk:** Reverse Tabnapping (theoretical risk on older browsers, but enterprise compliance usually flags it).
4135     -    2167 +    1198 +     40 +*   **Requirement:** All external payment links **MUST** include `rel="noopener noreferrer"`.
4136     -    2168 +    1199 +     41 +
4137     -    2169 +    1200 +     42 +---
4138     -    2170 +    1201 +     43 +
4139     -    2171 +    1202 +     44 +## 3. Final Architecture Code Sign-off
4140     -    2172 +985 1203       45 +
4141     -    2173 +986     -     46 +---
4142     -    2174 +    1204 +     46 +The proposed JS snippet is robust. I am validating the `Promise.race` pattern as **Enterprise-Grade**.
4143     -    2175 +987 1205       47 +
4144     -    2176 +988     -     48 +## üî¢ Integer Limits & Data Types
4145     -    2177 +989     -     49 +
4146     -    2178 +990     -     50 +### Standard Integer Ranges
4147     -    2179 +991     -     51 +
4148     -    2180 +992     -     52 +| Type | Bytes | Range | Max (~) | Use When |
4149     -    2181 +993     -     53 +|------|-------|-------|---------|----------|
4150     -    2182 +994     -     54 +| `int` | 4 | -2¬≥¬π to 2¬≥¬π-1 | ¬±2.1√ó10‚Åπ | Default choice |
4151     -    2183 +995     -     55 +| `unsigned int` | 4 | 0 to 2¬≥¬≤-1 | 4.3√ó10‚Åπ | Non-negative only |
4152     -    2184 +996     -     56 +| `long long` | 8 | -2‚Å∂¬≥ to 2‚Å∂¬≥-1 | ¬±9.2√ó10¬π‚Å∏ | Large values |
4153     -    2185 +997     -     57 +| `unsigned long long` | 8 | 0 to 2‚Å∂‚Å¥-1 | 1.8√ó10¬π‚Åπ | Very large non-negative |
4154     -    2186 +    1206 +     48 +**Refined Snippet (Optimization for Reliability):**
4155     -    2187 +    1207 +     49 +```javascript
4156     -    2188 +    1208 +     50 +// RECOMMENDED IMPLEMENTATION PATTERN
4157     -    2189 +    1209 +     51 +const TIMEOUT_MS = 300;
4158     -    2190 +    1210 +     52 +const FALLBACK_REGION = 'global';
4159     -    2191 +    1211 +     53 +
4160     -    2192 +    1212 +     54 +async function getDonationConfig() {
4161     -    2193 +    1213 +     55 +  // 1. Check Session Cache (FR-1.4) - Avoids API hit on page navigation
4162     -    2194 +    1214 +     56 +  const cached = sessionStorage.getItem('user_region');
4163     -    2195 +    1215 +     57 +  if (cached) return cached;
4164     -    2196 +998 1216       58 +
4165     -    2197 +999     -     59 +### Critical Constants (MEMORIZE!)
4166     -    2198 +1000     -     60 +
4167     -    2199 +1001     -     61 +```cpp
4168     -    2200 +1002     -     62 +#include <climits>
4169     -    2201 +1003     -     63 +
4170     -    2202 +1004     -     64 +INT_MAX    =  2,147,483,647      // ‚âà 2.1 √ó 10‚Åπ
4171     -    2203 +1005     -     65 +INT_MIN    = -2,147,483,648      // ‚âà -2.1 √ó 10‚Åπ
4172     -    2204 +1006     -     66 +LLONG_MAX  =  9,223,372,036,854,775,807  // ‚âà 9.2 √ó 10¬π‚Å∏
4173     -    2205 +1007     -     67 +LLONG_MIN  = -9,223,372,036,854,775,808  // ‚âà -9.2 √ó 10¬π‚Å∏
4174     -    2206 +    1217 +     59 +  try {
4175     -    2207 +    1218 +     60 +    // 2. Race Network vs Timer
4176     -    2208 +    1219 +     61 +    const fetchPromise = fetch('https://ipapi.co/json/').then(r => r.json());
4177     -    2209 +    1220 +     62 +    const timeoutPromise = new Promise((_, reject) =>
4178     -    2210 +    1221 +     63 +      setTimeout(() => reject(new Error('Timeout')), TIMEOUT_MS)
4179     -    2211 +    1222 +     64 +    );
4180     -    2212 +    1223 +     65 +
4181     -    2213 +    1224 +     66 +    const data = await Promise.race([fetchPromise, timeoutPromise]);
4182     -    2214 +    1225 +     67 +    const region = data.country_code === 'IN' ? 'india' : 'global';
4183     -    2215 +1008 1226       68 +
4184     -    2216 +1009     -     69 +// Quick mental math
4185     -    2217 +1010     -     70 +INT_MAX   ‚âà 2 √ó 10‚Åπ    (2 billion)
4186     -    2218 +1011     -     71 +LLONG_MAX ‚âà 9 √ó 10¬π‚Å∏   (9 quintillion)
4187     -    2219 +1012     -     72 +```
4188     -    2220 +1013     -     73 +
4189     -    2221 +1014     -     74 +### When to Use Which Type
4190     -    2222 +1015     -     75 +
4191     -    2223 +1016     -     76 +| Problem Constraint | Type to Use | Example |
4192     -    2224 +1017     -     77 +|-------------------|-------------|---------|
4193     -    2225 +1018     -     78 +| n ‚â§ 10‚Åµ, values ‚â§ 10‚Åπ | `int` | Most problems |
4194     -    2226 +1019     -     79 +| Values > 2√ó10‚Åπ | `long long` | Large sums, products |
4195     -    2227 +1020     -     80 +| Sum of n elements, n ‚â§ 10‚Åµ | `long long` | 10‚Åµ √ó 10‚Åπ = 10¬π‚Å¥ |
4196     -    2228 +1021     -     81 +| Product of elements | `long long` or modulo | Overflow danger! |
4197     -    2229 +1022     -     82 +| n √ó n where n ‚â§ 10‚Åµ | `long long` | 10¬π‚Å∞ > INT_MAX |
4198     -    2230 +    1227 +     69 +    // 3. Set Cache
4199     -    2231 +    1228 +     70 +    sessionStorage.setItem('user_region', region);
4200     -    2232 +    1229 +     71 +    return region;
4201     -    2233 +    1230 +     72 +  } catch (e) {
4202     -    2234 +    1231 +     73 +    // 4. Fail Open
4203     -    2235 +    1232 +     74 +    console.warn('[DonationRouter] Geo-lookup failed/timed-out, defaulting to Global.');
4204     -    2236 +    1233 +     75 +    return FALLBACK_REGION;
4205     -    2237 +    1234 +     76 +  }
4206     -    2238 +    1235 +     77 +}
4207     -    2239 +    1236 +     78 +```
4208     -    2240 +    1237 +     79 +
4209     -    2241 +    1238 +     80 +---
4210     -    2242 +    1239 +     81 +
4211     -    2243 +    1240 +     82 +## 4. Final Approvals
4212     -    2244 +1023 1241       83 +
4213     -    2245 +1024     -     84 +### ‚ö†Ô∏è Overflow Danger Zones
4214     -    2246 +1025     -     85 +
4215     -    2247 +1026     -     86 +```cpp
4216     -    2248 +1027     -     87 +// ‚ùå OVERFLOW! (10‚Åµ √ó 10‚Åµ = 10¬π‚Å∞ > INT_MAX)
4217     -    2249 +1028     -     88 +int n = 100000;
4218     -    2250 +1029     -     89 +int result = n * n;  // WRONG!
4219     -    2251 +    1242 +     84 +| Category | Status | Notes |
4220     -    2252 +    1243 +     85 +|----------|--------|-------|
4221     -    2253 +    1244 +     86 +| **Functional** | ‚úÖ Approved | Requirements are clear and testable. |
4222     -    2254 +    1245 +     87 +| **Technical** | ‚úÖ Approved | Fail-safe pattern mitigates API risk. |
4223     -    2255 +    1246 +     88 +| **Legal** | ‚úÖ Approved | "Two-Pocket" strategy satisfies FEMA/IRS separation. |
4224     -    2256 +    1247 +     89 +| **UX** | ‚úÖ Approved | CLS mitigation (Skeleton Loader) added as requirement. |
4225     -    2257 +1030 1248       90 +
4226     -    2258 +1031     -     91 +// ‚úÖ SAFE
4227     -    2259 +1032     -     92 +long long result = (long long)n * n;
4228     -    2260 +1033     -     93 +long long result = 1LL * n * n;
4229     -    2261 +    1249 +     91 +**Next Step:** Proceed to Phase 1 (Account Creation) as defined in the Roadmap.
4230     -    2262 +    1250 +     92  
4231     -    2263 +    1251 +
4232     -    2264 +    1252 +```
4233     -    2265 +    1253 +
4234     -    2266 +    1254 +
4235     -    2267 +    1255 +### ‚ú® `docs/01-requirements/donation_strategy_review.md` **[ADDED]**
4236     -    2268 +    1256 +
4237     -    2269 +    1257 +**Status:** ‚úÖ **NEW FILE** - This file has been newly created
4238     -    2270 +    1258 +
4239     -    2271 +    1259 +**Type:** Documentation üìñ
4240     -    2272 +    1260 +
4241     -    2273 +    1261 +```diff
4242     -    2274 +    1262 +@@ -0,0 +1,64 @@
4243     -    2275 +    1263 +      1 +# Principal SDE Review: Donation System Strategy
4244     -    2276 +    1264 +      2 +
4245     -    2277 +    1265 +      3 +**Reviewer:** Principal Software Engineer, Payments & Growth
4246     -    2278 +    1266 +      4 +**Date:** 2025-12-19
4247     -    2279 +    1267 +      5 +**Subject:** Comparative Analysis of `donation_system_design.md` (Proposal A) vs `donation-feature-plan.md` (Proposal B)
4248     -    2280 +    1268 +      6 +
4249     -    2281 +    1269 +      7 +---
4250     -    2282 +    1270 +      8 +
4251     -    2283 +    1271 +      9 +## Executive Summary
4252     -    2284 +    1272 +     10 +
4253     -    2285 +    1273 +     11 +I have reviewed both proposals side-by-side.
4254     -    2286 +    1274 +     12 +*   **Proposal A (Smart Router)** focuses on an "automated" user experience via IP-based routing.
4255     -    2287 +    1275 +     13 +*   **Proposal B (Feature Plan)** focuses on a "transparent" user choice via static badges (GitHub/Ko-fi/Razorpay).
4256     -    2288 +    1276 +     14 +
4257     -    2289 +    1277 +     15 +**Recommendation:** ‚úÖ **PROCEED WITH PROPOSAL B (Feature Plan)**
4258     -    2290 +    1278 +     16 +*   **Why?** It offers superior **Trust**, **Reliability**, and **Zero-Maintenance**.
4259     -    2291 +    1279 +     17 +*   **Caveat:** Proposal A's "Smart Router" logic should be adopted *only* as an enhancement for the Web App's footer button, but NOT for the `README.md`.
4260     -    2292 +    1280 +     18 +
4261     -    2293 +    1281 +     19 +---
4262     -    2294 +    1282 +     20 +
4263     -    2295 +    1283 +     21 +## Detailed Comparative Analysis
4264     -    2296 +    1284 +     22 +
4265     -    2297 +    1285 +     23 +### 1. User Trust & Conversion
4266     -    2298 +    1286 +     24 +*   **Proposal A (Router):** Risks "Link Anxiety". A user clicking "Donate" and being redirected through a custom domain (`your-site.app/donate`) before landing on a payment page can feel phishy. Users prefer to see exactly where they are going (e.g., hovering and seeing `github.com/sponsors` or `razorpay.me`).
4267     -    2299 +    1287 +     25 +*   **Proposal B (Manual):** High Trust. The "Sponsor" badge on GitHub is a native, trusted signal. Users know exactly what they are clicking.
4268     -    2300 +    1288 +     26 +*   **Winner:** üèÜ **Proposal B**
4269     -    2301 +    1289 +     27 +
4270     -    2302 +    1290 +     28 +### 2. Reliability & Maintenance
4271     -    2303 +    1291 +     29 +*   **Proposal A:** Requires hosting a bridge page. Requires an external Geolocation API (which has rate limits or costs). If the API fails, the buttons might not render. This introduces a **Point of Failure**.
4272     -    2304 +    1292 +     30 +*   **Proposal B:** Relies on static Markdown and Platform URLs. 100% Uptime (unless GitHub itself is down). Zero maintenance.
4273     -    2305 +    1293 +     31 +*   **Winner:** üèÜ **Proposal B** (Engineers hate maintenance debt).
4274     -    2306 +    1294 +     32 +
4275     -    2307 +    1295 +     33 +### 3. Legal & Compliance (The "Two-Pocket" Test)
4276     -    2308 +    1296 +     34 +Both proposals correctly identify the need to separate Domestic (INR) and International (USD) funds.
4277     -    2309 +    1297 +     35 +*   **Proposal B** creates a clearer mental model for the user ("I am Indian -> I choose Razorpay").
4278     -    2310 +    1298 +     36 +*   **Proposal A** tries to be "smart" but might accidentally route a VPN user to the wrong bucket (e.g., an NRI using an India VPN seeing UPI but wanting to pay via US Card). Proposal B allows the user to self-correct.
4279     -    2311 +    1299 +     37 +*   **Winner:** üèÜ **Proposal B** (User choice is better than inference for payments).
4280     -    2312 +    1300 +     38 +
4281     -    2313 +    1301 +     39 +### 4. Implementation Effort
4282     -    2314 +    1302 +     40 +*   **Proposal A:** ~4-8 hours. Setup hosting, write JS, test IP API, handle edge cases, CORS issues.
4283     -    2315 +    1303 +     41 +*   **Proposal B:** ~1 hour. Sign up -> Get Links -> Paste in README.
4284     -    2316 +    1304 +     42 +*   **Winner:** üèÜ **Proposal B**
4285     -    2317 +    1305 +     43 +
4286     -    2318 +    1306 +     44 +---
4287     -    2319 +    1307 +     45 +
4288     -    2320 +    1308 +     46 +## Critical Feeback on Proposal B (User's Plan)
4289     -    2321 +    1309 +     47 +
4290     -    2322 +    1310 +     48 +While Proposal B is the winner, here are specific improvements required before execution:
4291     -    2323 +    1311 +     49 +
4292     -    2324 +    1312 +     50 +1.  **Banner Design:** Ensure the badges in the `README.md` are aesthetically aligned. A mismatched row of buttons looks unprofessional. Use `Shields.io` consistently as you proposed.
4293     -    2325 +    1313 +     51 +2.  **Razorpay Link:** Verify if `razorpay.me/@username` allows *custom* amounts easily for the user. Sometimes "Payment Pages" are better than "Payment Links" for this specific use case.
4294     -    2326 +    1314 +     52 +3.  **GitHub Sponsors Eligibility:** You must verify eligibility. If your account is new/inactive, approval might take time. **Fallback:** Use Ko-fi as the primary until GitHub approves.
4295     -    2327 +    1315 +     53 +
4296     -    2328 +    1316 +     54 +---
4297     -    2329 +    1317 +     55 +
4298     -    2330 +    1318 +     56 +## Final Verdict & Next Steps
4299     -    2331 +    1319 +     57 +
4300     -    2332 +    1320 +     58 +**Discard Proposal A's architecture for the README.** Use Proposal B as the master plan.
4301     -    2333 +    1321 +     59 +
4302     -    2334 +    1322 +     60 +**Action Items:**
4303     -    2335 +    1323 +     61 +1.  **Execute Phase 1 & 2 of Proposal B immediately.** (Setup Accounts & specific Badges).
4304     -    2336 +    1324 +     62 +2.  **Enhancement (Optional):** In the *Application Footer* (index.html), you may effectively use the logic from Proposal A to highlight the "best" option (e.g., "üáÆüá≥ Support via UPI" vs "üåè Support via PayPal"), but keep the static `README.md` simple.
4305     -    2337 +    1325 +     63 +
4306     -    2338 +    1326 +     64 +**Approved for Implementation.** üöÄ
4307     -    2339 +    1327 +     65  
4308     -    2340 +    1328 +
4309     -    2341 +    1329 +```
4310     -    2342 +    1330 +
4311     -    2343 +    1331 +
4312     -    2344 +    1332 +### ‚ú® `docs/01-requirements/donation_system_design.md` **[ADDED]**
4313     -    2345 +    1333 +
4314     -    2346 +    1334 +**Status:** ‚úÖ **NEW FILE** - This file has been newly created
4315     -    2347 +    1335 +
4316     -    2348 +    1336 +**Type:** Documentation üìñ
4317     -    2349 +    1337 +
4318     -    2350 +    1338 +```diff
4319     -    2351 +    1339 +@@ -0,0 +1,141 @@
4320     -    2352 +    1340 +      1 +# Design Document: Geo-Adaptive Donation System
4321     -    2353 +    1341 +      2 +## Functional Requirements & Strategy
4322     -    2354 +    1342 +      3 +
4323     -    2355 +    1343 +      4 +**Document ID:** DD-2025-003-DONATION
4324     -    2356 +    1344 +      5 +**Author:** Sr. Principal SDE
4325     -    2357 +    1345 +      6 +**Status:** Draft
4326     -    2358 +    1346 +      7 +**Date:** 2025-12-19
4327     -    2359 +    1347 +      8 +
4328     -    2360 +    1348 +      9 +---
4329     -    2361 +    1349 +     10 +
4330     -    2362 +    1350 +     11 +## 1. Problem Statement
4331     -    2363 +    1351 +     12 +
4332     -    2364 +    1352 +     13 +The goal is to enable a simplified donation ("Buy Me a Coffee") flow that maximizes conversion rates by offering **local payment methods** and **native pricing** based on the user's location, specifically targeting:
4333     -    2365 +    1353 +     14 +*   **India:** Needs UPI support (GooglePay, PhonePe) and INR pricing (e.g., ‚Çπ50, ‚Çπ100). International cards often fail here due to RBI mandates.
4334     -    2366 +    1354 +     15 +*   **Global (ROW):** Needs PayPal/Stripe support and USD pricing (e.g., $1, $5).
4335     -    2367 +    1355 +     16 +*   **Contexts:** Must be accessible from the Web Application and static contexts like GitHub `README.md`.
4336     -    2368 +    1356 +     17 +
4337     -    2369 +    1357 +     18 +---
4338     -    2370 +    1358 +     19 +
4339     -    2371 +    1359 +     20 +## 2. Requirements
4340     -    2372 +    1360 +     21 +
4341     -    2373 +    1361 +     22 +### 2.1 Functional Requirements (FR)
4342     -    2374 +    1362 +     23 +
4343     -    2375 +    1363 +     24 +| ID | Requirement | Description |
4344     -    2376 +    1364 +     25 +|---|---|---|
4345     -    2377 +    1365 +     26 +| **FR-1** | **IP Geolocation** | System must detect if the user is in India (IN) or Rest of World (ROW). |
4346     -    2378 +    1366 +     27 +| **FR-2** | **Dynamic Currency** | Display INR (‚Çπ) presets for IN users and USD ($) presets for ROW users. |
4347     -    2379 +    1367 +     28 +| **FR-3** | **Preset Tiers** | **INR:** ‚Çπ50, ‚Çπ100, ‚Çπ250, ‚Çπ500, Custom.<br>**USD:** $1, $5, $10, $20, Custom. |
4348     -    2380 +    1368 +     29 +| **FR-4** | **Payment Method** | **IN:** Redirect to UPI/Razorpay.<br>**ROW:** Redirect to PayPal/Stripe/BMAC. |
4349     -    2381 +    1369 +     30 +| **FR-5** | **Readme Compatibility** | Since `README.md` cannot run JS, it must link to a hosted "Donation Routing Page" that handles the logic. |
4350     -    2382 +    1370 +     31 +
4351     -    2383 +    1371 +     32 +### 2.2 Non-Functional Requirements (NFR)
4352     -    2384 +    1372 +     33 +
4353     -    2385 +    1373 +     34 +| ID | Requirement | Description |
4354     -    2386 +    1374 +     35 +|---|---|---|
4355     -    2387 +    1375 +     36 +| **NFR-1** | **Zero Setup Cost** | Solution must not incur monthly fees (Transaction fees only). |
4356     -    2388 +    1376 +     37 +| **NFR-2** | **Legal Compliance** | **India:** Must comply with Tax laws (Income classification).<br>**Global:** Must avoid FCRA triggers (if applicable to individuals, usually treated as "Export of Services" or "Gift"). |
4357     -    2389 +    1377 +     38 +| **NFR-3** | **Performance** | Geo-lookup must add < 500ms latency to the donation page load. |
4358     -    2390 +    1378 +     39 +| **NFR-4** | **Privacy** | Do not store PII during the routing phase. |
4359     -    2391 +    1379 +     40 +
4360     -    2392 +    1380 +     41 +---
4361     -    2393 +    1381 +     42 +
4362     -    2394 +    1382 +     43 +## 3. Compliance & Financial Viability
4363     -    2395 +    1383 +     44 +
4364     -    2396 +    1384 +     45 +### 3.1 The "Two-Pocket" Strategy
4365     -    2397 +    1385 +     46 +To follow online donation laws strictly without complex business registration:
4366     -    2398 +    1386 +     47 +1.  **Pocket A (India):** Use **Razorpay** or **UPI Payment Link**.
4367     -    2399 +    1387 +     48 +    *   *Why:* Indian Payment Gateways require KYC and Indian Bank Accounts. They handle domestic UPI/Netbanking perfectly.
4368     -    2400 +    1388 +     49 +    *   *Compliance:* Treated as Domestic Income.
4369     -    2401 +    1389 +     50 +2.  **Pocket B (International):** Use **PayPal** or **Buy Me a Coffee (Stripe)**.
4370     -    2402 +    1390 +     51 +    *   *Why:* PayPal is the standard for cross-border small payments. Razorpay International often has high failure rates for personal accounts.
4371     -    2403 +    1391 +     52 +    *   *Compliance:* Treated as Foreign Inward Remittance (FIRC provided by PayPal/Bank).
4372     -    2404 +    1392 +     53 +
4373     -    2405 +    1393 +     54 +---
4374     -    2406 +    1394 +     55 +
4375     -    2407 +    1395 +     56 +## 4. Solution Options & Trade-offs
4376     -    2408 +    1396 +     57 +
4377     -    2409 +    1397 +     58 +### Option A: dedicated "Buy Me a Coffee" (Single Platform)
4378     -    2410 +    1398 +     59 +Use a single platform like *Buy Me a Coffee* (BMAC) or *Ko-fi*.
4379     -    2411 +    1399 +     60 +*   **Pros:** Zero dev effort, hosted page, handles currency conversion automatically (shows local currency to user usually).
4380     -    2412 +    1400 +     61 +*   **Cons:**
4381     -    2413 +    1401 +     62 +    *   **High Fees:** BMAC takes ~5% cut + Stripe fees.
4382     -    2414 +    1402 +     63 +    *   **UPI Failure:** Often fails to present a native UPI intent flow for Indians, leading to drop-offs.
4383     -    2415 +    1403 +     64 +    *   **Conversion:** Indian users seeing $5 (approx ‚Çπ400) might hesitate compared to seeing a native ‚Çπ100 tier.
4384     -    2416 +    1404 +     65 +
4385     -    2417 +    1405 +     66 +### Option B: The "Smart Router" (Recommended)
4386     -    2418 +    1406 +     67 +Create a simple custom landing page (e.g., `markdown-viewer.com/donate`) that detects IP and shows the right button.
4387     -    2419 +    1407 +     68 +
4388     -    2420 +    1408 +     69 +*   **Pros:**
4389     -    2421 +    1409 +     70 +    *   **Perfect UX:** Indians see UPI + ‚Çπ50. Global users see PayPal + $3.
4390     -    2422 +    1410 +     71 +    *   **Lower Fees:** Razorpay (Domestic) is ~2%, PayPal is ~4-5%. No extra platform reliability fee.
4391     -    2423 +    1411 +     72 +    *   **Control:** Full control over presets.
4392     -    2424 +    1412 +     73 +*   **Cons:** Requires hosting a simple HTML page (Free via GitHub Pages/Vercel).
4393     -    2425 +    1413 +     74 +
4394     -    2426 +    1414 +     75 +---
4395     -    2427 +    1415 +     76 +
4396     -    2428 +    1416 +     77 +## 5. Implementation Plan (The "Smart Router")
4397     -    2429 +    1417 +     78 +
4398     -    2430 +    1418 +     79 +### 5.1 Architecture
4399     -    2431 +    1419 +     80 +1.  **Static Badge (README/Footer):**
4400     -    2432 +    1420 +     81 +    *   Image: `Donate ‚òï`
4401     -    2433 +    1421 +     82 +    *   Link: `https://your-site.vercel.app/donate`
4402     -    2434 +    1422 +     83 +2.  **Routing Page (`/donate`):**
4403     -    2435 +    1423 +     84 +    *   **Tech:** Static HTML + Client-side JS.
4404     -    2436 +    1424 +     85 +    *   **Geo-Service:** Use `https://ipapi.co/json/` (Free tier: 1000 requests/day) or Cloudflare Traces (Unlimited).
4405     -    2437 +    1425 +     86 +
4406     -    2438 +    1426 +     87 +### 5.2 Flow Logic
4407     -    2439 +    1427 +     88 +```mermaid
4408     -    2440 +    1428 +     89 +graph TD
4409     -    2441 +    1429 +     90 +    A[User Clicks 'Donate'] --> B{Check IP via API}
4410     -    2442 +    1430 +     91 +    B -- Country = IN --> C[Render Razorpay Button]
4411     -    2443 +    1431 +     92 +    C --> C1[Show: ‚Çπ50, ‚Çπ100, ‚Çπ500]
4412     -    2444 +    1432 +     93 +    C --> C2[Method: UPI / Paytm / GPay]
4413     -    2445 +1034 1433       94 +
4414     -    2446 +1035     -     95 +// ‚ùå OVERFLOW! (sum of 10‚Åµ elements each up to 10‚Åπ)
4415     -    2447 +1036     -     96 +int sum = 0;
4416     -    2448 +1037     -     97 +for (int x : arr) sum += x;  // WRONG if arr is large!
4417     -    2449 +1038     -     98 +
4418     -    2450 +1039     -     99 +// ‚úÖ SAFE
4419     -    2451 +1040     -    100 +long long sum = 0;
4420     -    2452 +1041     -    101 +for (int x : arr) sum += x;
4421     -    2453 +1042     -    102 +```
4422     -    2454 +1043     -    103 +
4423     -    2455 +1044     -    104 +### Modular Arithmetic
4424     -    2456 +1045     -    105 +
4425     -    2457 +1046     -    106 +When problem says "answer modulo 10‚Åπ+7":
4426     -    2458 +1047     -    107 +
4427     -    2459 +1048     -    108 +```cpp
4428     -    2460 +1049     -    109 +const int MOD = 1e9 + 7;  // 1,000,000,007 (prime)
4429     -    2461 +    1434 +     95 +    B -- Country != IN --> D[Render PayPal/BMAC Button]
4430     -    2462 +    1435 +     96 +    D --> D1[Show: $1, $5, $10]
4431     -    2463 +    1436 +     97 +    D --> D2[Method: PayPal / Card]
4432     -    2464 +    1437 +     98 +```
4433     -    2465 +    1438 +     99 +
4434     -    2466 +    1439 +    100 +### 5.3 Financial Setup (Free)
4435     -    2467 +    1440 +    101 +1.  **For India (INR):**
4436     -    2468 +    1441 +    102 +    *   Sign up for **Razorpay Payment Pages** (No coding needed).
4437     -    2469 +    1442 +    103 +    *   Create a page "Buy me a Coffee".
4438     -    2470 +    1443 +    104 +    *   Set Fixed Amounts: ‚Çπ50, ‚Çπ100 (or "Decide yourself" field).
4439     -    2471 +    1444 +    105 +    *   *Cost:* 0 setup, ~2% per transaction.
4440     -    2472 +    1445 +    106 +2.  **For Global (USD):**
4441     -    2473 +    1446 +    107 +    *   Sign up for **PayPal.Me** or **Ko-fi** (connects to PayPal).
4442     -    2474 +    1447 +    108 +    *   Ko-fi is better (0% platform fee on donations, only PayPal fees).
4443     -    2475 +    1448 +    109 +    *   *Cost:* 0 setup, ~4-5% per transaction.
4444     -    2476 +1050 1449      110 +
4445     -    2477 +1051     -    111 +// Addition
4446     -    2478 +1052     -    112 +(a + b) % MOD
4447     -    2479 +1053     -    113 +
4448     -    2480 +1054     -    114 +// Subtraction (add MOD to avoid negative)
4449     -    2481 +1055     -    115 +((a - b) % MOD + MOD) % MOD
4450     -    2482 +    1450 +    111 +---
4451     -    2483 +    1451 +    112 +
4452     -    2484 +    1452 +    113 +## 6. Final Recommendation
4453     -    2485 +    1453 +    114 +
4454     -    2486 +    1454 +    115 +**Go with Option B (Smart Router) hosted on GitHub Pages.**
4455     -    2487 +1056 1455      116 +
4456     -    2488 +1057     -    117 +// Multiplication
4457     -    2489 +1058     -    118 +(1LL * a * b) % MOD  // Cast to long long first!
4458     -    2490 +1059     -    119 +
4459     -    2491 +1060     -    120 +// Common modulo values
4460     -    2492 +1061     -    121 +10‚Åπ + 7  = 1,000,000,007  // Most common (prime)
4461     -    2493 +1062     -    122 +10‚Åπ + 9  = 1,000,000,009  // Also prime
4462     -    2494 +1063     -    123 +998244353                  // FFT-friendly prime (2¬≤¬≥ √ó 7 √ó 17 + 1)
4463     -    2495 +1064     -    124 +```
4464     -    2496 +1065     -    125 +
4465     -    2497 +1066     -    126 +---
4466     -    2498 +1067     -    127 +
4467     -    2499 +1068     -    128 +## üìä Array & Container Constraints
4468     -    2500 +1069     -    129 +
4469     -    2501 +1070     -    130 +### Maximum Array Sizes
4470     -    2502 +1071     -    131 +
4471     -    2503 +1072     -    132 +| Memory | Max Elements (`int`) | Max Elements (`long long`) |
4472     -    2504 +1073     -    133 +|--------|---------------------|---------------------------|
4473     -    2505 +1074     -    134 +| 256 MB | ~64 million | ~32 million |
4474     -    2506 +1075     -    135 +| 512 MB | ~128 million | ~64 million |
4475     -    2507 +1076     -    136 +| 1 GB | ~256 million | ~128 million |
4476     -    2508 +1077     -    137 +
4477     -    2509 +1078     -    138 +**Formula:** Max elements = Memory / sizeof(type)
4478     -    2510 +1079     -    139 +- 256 MB = 256 √ó 10‚Å∂ bytes
4479     -    2511 +1080     -    140 +- int array: 256 √ó 10‚Å∂ / 4 = 64 √ó 10‚Å∂
4480     -    2512 +1081     -    141 +
4481     -    2513 +1082     -    142 +### Typical Constraints by Problem Type
4482     -    2514 +1083     -    143 +
4483     -    2515 +1084     -    144 +| Problem Type | Typical n | Expected Complexity |
4484     -    2516 +1085     -    145 +|--------------|-----------|-------------------|
4485     -    2517 +1086     -    146 +| Easy | ‚â§ 10¬≥ | O(n¬≤) acceptable |
4486     -    2518 +1087     -    147 +| Medium | ‚â§ 10‚Åµ | O(n log n) expected |
4487     -    2519 +1088     -    148 +| Hard | ‚â§ 10‚Å∂ | O(n) or O(n log n) |
4488     -    2520 +1089     -    149 +| Very Hard | ‚â§ 10‚Å∑ | O(n) only |
4489     -    2521 +1090     -    150 +
4490     -    2522 +1091     -    151 +### 2D Array Limits
4491     -    2523 +1092     -    152 +
4492     -    2524 +1093     -    153 +```cpp
4493     -    2525 +1094     -    154 +// Max 2D array with 256MB memory
4494     -    2526 +1095     -    155 +// n √ó m √ó sizeof(int) ‚â§ 256 √ó 10‚Å∂
4495     -    2527 +1096     -    156 +
4496     -    2528 +1097     -    157 +// Safe limits:
4497     -    2529 +1098     -    158 +int arr[1000][1000];     // 4 MB - ‚úÖ Safe
4498     -    2530 +1099     -    159 +int arr[5000][5000];     // 100 MB - ‚úÖ Usually safe
4499     -    2531 +1100     -    160 +int arr[10000][10000];   // 400 MB - ‚ùå Too large!
4500     -    2532 +1101     -    161 +
4501     -    2533 +1102     -    162 +// For larger grids, use vector (dynamic allocation)
4502     -    2534 +1103     -    163 +vector<vector<int>> grid(n, vector<int>(m));
4503     -    2535 +1104     -    164 +```
4504     -    2536 +1105     -    165 +
4505     -    2537 +1106     -    166 +### Container Memory Usage
4506     -    2538 +1107     -    167 +
4507     -    2539 +1108     -    168 +| Container | Memory per Element | Notes |
4508     -    2540 +1109     -    169 +|-----------|-------------------|-------|
4509     -    2541 +1110     -    170 +| `vector<int>` | 4 bytes | Most efficient |
4510     -    2542 +1111     -    171 +| `deque<int>` | 4 bytes + overhead | Block allocation |
4511     -    2543 +1112     -    172 +| `list<int>` | 4 + 16 bytes | Node pointers |
4512     -    2544 +1113     -    173 +| `set<int>` | 4 + 32 bytes | Red-black tree |
4513     -    2545 +1114     -    174 +| `unordered_set<int>` | 4 + ~8 bytes | Hash table |
4514     -    2546 +1115     -    175 +| `map<int,int>` | 8 + 32 bytes | Red-black tree |
4515     -    2547 +1116     -    176 +| `unordered_map<int,int>` | 8 + ~16 bytes | Hash table |
4516     -    2548 +1117     -    177 +
4517     -    2549 +1118     -    178 +---
4518     -    2550 +1119     -    179 +
4519     -    2551 +1120     -    180 +## üìù String Constraints
4520     -    2552 +1121     -    181 +
4521     -    2553 +1122     -    182 +### String Length Limits
4522     -    2554 +1123     -    183 +
4523     -    2555 +1124     -    184 +| Constraint | Typical Value | Common Problems |
4524     -    2556 +1125     -    185 +|------------|---------------|-----------------|
4525     -    2557 +1126     -    186 +| Short strings | ‚â§ 100 | Brute force OK |
4526     -    2558 +1127     -    187 +| Medium strings | ‚â§ 10‚Åµ | O(n) required |
4527     -    2559 +1128     -    188 +| Long strings | ‚â§ 10‚Å∂ | O(n) only |
4528     -    2560 +1129     -    189 +| Multiple strings | Total length ‚â§ 10‚Å∂ | Sum constraint |
4529     -    2561 +1130     -    190 +
4530     -    2562 +1131     -    191 +### Character Set Assumptions
4531     -    2563 +1132     -    192 +
4532     -    2564 +1133     -    193 +```cpp
4533     -    2565 +1134     -    194 +// Lowercase letters only: 'a' to 'z' (26 chars)
4534     -    2566 +1135     -    195 +int freq[26] = {0};
4535     -    2567 +1136     -    196 +freq[ch - 'a']++;
4536     -    2568 +1137     -    197 +
4537     -    2569 +1138     -    198 +// All letters: 'A'-'Z', 'a'-'z' (52 chars)
4538     -    2570 +1139     -    199 +// Usually case-insensitive or convert to one case
4539     -    2571 +1140     -    200 +
4540     -    2572 +1141     -    201 +// Digits: '0' to '9' (10 chars)
4541     -    2573 +1142     -    202 +int digit = ch - '0';
4542     -    2574 +1143     -    203 +
4543     -    2575 +1144     -    204 +// ASCII printable: 32 to 126 (95 chars)
4544     -    2576 +1145     -    205 +int freq[128] = {0};  // Safe for all ASCII
4545     -    2577 +1146     -    206 +
4546     -    2578 +1147     -    207 +// Unicode: Use std::string with UTF-8
4547     -    2579 +1148     -    208 +// Careful: string[i] may not be a full character!
4548     -    2580 +1149     -    209 +```
4549     -    2581 +1150     -    210 +
4550     -    2582 +1151     -    211 +### String Comparison Complexity
4551     -    2583 +1152     -    212 +
4552     -    2584 +1153     -    213 +```cpp
4553     -    2585 +1154     -    214 +// Comparing two strings of length n and m
4554     -    2586 +1155     -    215 +s1 == s2;           // O(min(n, m))
4555     -    2587 +1156     -    216 +s1.compare(s2);     // O(min(n, m))
4556     -    2588 +1157     -    217 +s1 < s2;            // O(min(n, m))
4557     -    2589 +1158     -    218 +
4558     -    2590 +1159     -    219 +// For multiple comparisons, use hashing
4559     -    2591 +1160     -    220 +hash<string> hasher;
4560     -    2592 +1161     -    221 +size_t h = hasher(s);
4561     -    2593 +1162     -    222 +```
4562     -    2594 +1163     -    223 +
4563     -    2595 +1164     -    224 +---
4564     -    2596 +1165     -    225 +
4565     -    2597 +1166     -    226 +## ‚è±Ô∏è Time Complexity Limits
4566     -    2598 +1167     -    227 +
4567     -    2599 +1168     -    228 +### Operations per Second
4568     -    2600 +1169     -    229 +
4569     -    2601 +1170     -    230 +| Operation Type | Operations/Second |
4570     -    2602 +1171     -    231 +|---------------|-------------------|
4571     -    2603 +1172     -    232 +| Simple arithmetic | ~10‚Åπ |
4572     -    2604 +1173     -    233 +| Array access | ~10‚Å∏ - 10‚Åπ |
4573     -    2605 +1174     -    234 +| Vector operations | ~10‚Å∏ |
4574     -    2606 +1175     -    235 +| Set/Map operations | ~10‚Å∑ |
4575     -    2607 +1176     -    236 +| String operations | ~10‚Å∑ |
4576     -    2608 +1177     -    237 +| I/O (cin/cout) | ~10‚Å∂ (without fast I/O) |
4577     -    2609 +1178     -    238 +| I/O (fast I/O) | ~10‚Å∑ |
4578     -    2610 +1179     -    239 +
4579     -    2611 +1180     -    240 +### Maximum n for Time Limits
4580     -    2612 +1181     -    241 +
4581     -    2613 +1182     -    242 +| Time Limit | O(n) | O(n log n) | O(n¬≤) | O(n¬≥) | O(2‚Åø) |
4582     -    2614 +1183     -    243 +|------------|------|------------|-------|-------|-------|
4583     -    2615 +1184     -    244 +| 1 second | 10‚Å∏ | 10‚Å∂-10‚Å∑ | 10‚Å¥ | 500 | 25 |
4584     -    2616 +1185     -    245 +| 2 seconds | 2√ó10‚Å∏ | 2√ó10‚Å∑ | 1.4√ó10‚Å¥ | 600 | 26 |
4585     -    2617 +1186     -    246 +| 5 seconds | 5√ó10‚Å∏ | 5√ó10‚Å∑ | 2√ó10‚Å¥ | 800 | 28 |
4586     -    2618 +1187     -    247 +
4587     -    2619 +1188     -    248 +### Quick Complexity Check
4588     -    2620 +1189     -    249 +
4589     -    2621 +1190     -    250 +```cpp
4590     -    2622 +1191     -    251 +// Given n, what's the max acceptable complexity?
4591     -    2623 +1192     -    252 +n ‚â§ 10     ‚Üí O(n!) or O(2‚Åø) OK
4592     -    2624 +1193     -    253 +n ‚â§ 20     ‚Üí O(2‚Åø) OK, O(n!) too slow
4593     -    2625 +1194     -    254 +n ‚â§ 100    ‚Üí O(n¬≥) OK
4594     -    2626 +1195     -    255 +n ‚â§ 1000   ‚Üí O(n¬≤) OK
4595     -    2627 +1196     -    256 +n ‚â§ 10‚Åµ    ‚Üí O(n log n) or better
4596     -    2628 +1197     -    257 +n ‚â§ 10‚Å∂    ‚Üí O(n log n) risky, O(n) preferred
4597     -    2629 +1198     -    258 +n ‚â§ 10‚Å∏    ‚Üí O(n) only
4598     -    2630 +1199     -    259 +```
4599     -    2631 +1200     -    260 +
4600     -    2632 +1201     -    261 +### Reverse: Given Complexity, Max n
4601     -    2633 +1202     -    262 +
4602     -    2634 +1203     -    263 +| Complexity | Max n (1 sec) |
4603     -    2635 +1204     -    264 +|------------|---------------|
4604     -    2636 +1205     -    265 +| O(n!) | n ‚â§ 10 |
4605     -    2637 +1206     -    266 +| O(2‚Åø) | n ‚â§ 20-25 |
4606     -    2638 +1207     -    267 +| O(n¬≥) | n ‚â§ 500 |
4607     -    2639 +1208     -    268 +| O(n¬≤ log n) | n ‚â§ 1000 |
4608     -    2640 +1209     -    269 +| O(n¬≤) | n ‚â§ 5000-10000 |
4609     -    2641 +1210     -    270 +| O(n‚àön) | n ‚â§ 10‚Åµ |
4610     -    2642 +1211     -    271 +| O(n log n) | n ‚â§ 10‚Å∂-10‚Å∑ |
4611     -    2643 +1212     -    272 +| O(n) | n ‚â§ 10‚Å∏ |
4612     -    2644 +1213     -    273 +| O(log n) | n ‚â§ 10¬π‚Å∏ |
4613     -    2645 +1214     -    274 +| O(1) | n = anything |
4614     -    2646 +1215     -    275 +
4615     -    2647 +1216     -    276 +---
4616     -    2648 +1217     -    277 +
4617     -    2649 +1218     -    278 +## üíæ Space Complexity Limits
4618     -    2650 +1219     -    279 +
4619     -    2651 +1220     -    280 +### Memory Calculation
4620     -    2652 +1221     -    281 +
4621     -    2653 +1222     -    282 +```cpp
4622     -    2654 +1223     -    283 +// Typical memory limits
4623     -    2655 +1224     -    284 +256 MB = 256 √ó 10‚Å∂ bytes = 64 √ó 10‚Å∂ ints
4624     -    2656 +1225     -    285 +512 MB = 512 √ó 10‚Å∂ bytes = 128 √ó 10‚Å∂ ints
4625     -    2657 +1226     -    286 +
4626     -    2658 +1227     -    287 +// Stack vs Heap
4627     -    2659 +1228     -    288 +// Stack: Limited (~1-8 MB) - local variables, recursion
4628     -    2660 +1229     -    289 +// Heap: Limited by problem constraint - new, vector
4629     -    2661 +1230     -    290 +
4630     -    2662 +1231     -    291 +// Recursion depth limit (stack)
4631     -    2663 +1232     -    292 +// ~10‚Å¥ - 10‚Åµ calls typically safe
4632     -    2664 +1233     -    293 +// Deep recursion may cause stack overflow!
4633     -    2665 +1234     -    294 +
4634     -    2666 +1235     -    295 +// Tail recursion or iteration preferred for deep recursion
4635     -    2667 +1236     -    296 +```
4636     -    2668 +1237     -    297 +
4637     -    2669 +1238     -    298 +### Data Structure Space
4638     -    2670 +1239     -    299 +
4639     -    2671 +1240     -    300 +| Structure | Space | Example |
4640     -    2672 +1241     -    301 +|-----------|-------|---------|
4641     -    2673 +1242     -    302 +| Array of n ints | 4n bytes | n = 10‚Å∂ ‚Üí 4 MB |
4642     -    2674 +1243     -    303 +| n √ó n int matrix | 4n¬≤ bytes | n = 5000 ‚Üí 100 MB |
4643     -    2675 +1244     -    304 +| Adjacency list | O(V + E) | |
4644     -    2676 +1245     -    305 +| Adjacency matrix | O(V¬≤) | |
4645     -    2677 +1246     -    306 +| Binary tree (n nodes) | ~32n bytes | Node + 2 pointers |
4646     -    2678 +1247     -    307 +| Graph (V vertices, E edges) | V + E | Adjacency list |
4647     -    2679 +1248     -    308 +
4648     -    2680 +1249     -    309 +---
4649     -    2681 +1250     -    310 +
4650     -    2682 +1251     -    311 +## üî¢ Common Primes & Mathematical Constants
4651     -    2683 +1252     -    312 +
4652     -    2684 +1253     -    313 +### Primes to Know
4653     -    2685 +1254     -    314 +
4654     -    2686 +1255     -    315 +```cpp
4655     -    2687 +1256     -    316 +// For modular arithmetic
4656     -    2688 +1257     -    317 +10‚Åπ + 7 = 1,000,000,007  // Most common modulo (prime)
4657     -    2689 +1258     -    318 +10‚Åπ + 9 = 1,000,000,009  // Alternative (prime)
4658     -    2690 +1259     -    319 +998244353                 // NTT prime (2¬≤¬≥ √ó 7 √ó 17 + 1)
4659     -    2691 +1260     -    320 +
4660     -    2692 +1261     -    321 +// Small primes for hashing
4661     -    2693 +1262     -    322 +31, 37, 53, 97, 131, 1009, 10007
4662     -    2694 +1263     -    323 +
4663     -    2695 +1264     -    324 +// For string hashing (rolling hash)
4664     -    2696 +1265     -    325 +base = 31 or 37 (for lowercase letters)
4665     -    2697 +1266     -    326 +base = 53 (for mixed case)
4666     -    2698 +1267     -    327 +mod = 10‚Åπ + 7 or 10‚Åπ + 9
4667     -    2699 +1268     -    328 +
4668     -    2700 +1269     -    329 +// Largest prime ‚â§ n
4669     -    2701 +1270     -    330 +// Under 100: 97
4670     -    2702 +1271     -    331 +// Under 1000: 997
4671     -    2703 +1272     -    332 +// Under 10000: 9973
4672     -    2704 +1273     -    333 +// Under 10‚Åµ: 99991
4673     -    2705 +1274     -    334 +// Under 10‚Å∂: 999983
4674     -    2706 +1275     -    335 +// Under 10‚Åπ: 999999937
4675     -    2707 +1276     -    336 +```
4676     -    2708 +1277     -    337 +
4677     -    2709 +1278     -    338 +### Mathematical Constants
4678     -    2710 +1279     -    339 +
4679     -    2711 +1280     -    340 +```cpp
4680     -    2712 +1281     -    341 +// For geometry and floating point
4681     -    2713 +1282     -    342 +const double PI = acos(-1);        // 3.14159265358979...
4682     -    2714 +1283     -    343 +const double PI = 3.14159265358979323846;
4683     -    2715 +1284     -    344 +const double E = exp(1);           // 2.71828...
4684     -    2716 +1285     -    345 +
4685     -    2717 +1286     -    346 +// For comparison (floating point tolerance)
4686     -    2718 +1287     -    347 +const double EPS = 1e-9;
4687     -    2719 +1288     -    348 +if (abs(a - b) < EPS) // a == b
4688     -    2720 +1289     -    349 +
4689     -    2721 +1290     -    350 +// For "infinity" in algorithms
4690     -    2722 +1291     -    351 +const int INF = 1e9;           // For int (won't overflow on add)
4691     -    2723 +1292     -    352 +const int INF = INT_MAX / 2;   // Safe for addition
4692     -    2724 +1293     -    353 +const long long INF = 1e18;    // For long long
4693     -    2725 +1294     -    354 +const long long INF = LLONG_MAX / 2;
4694     -    2726 +1295     -    355 +```
4695     -    2727 +1296     -    356 +
4696     -    2728 +1297     -    357 +### Useful Mathematical Facts
4697     -    2729 +1298     -    358 +
4698     -    2730 +1299     -    359 +```cpp
4699     -    2731 +1300     -    360 +// Factorials
4700     -    2732 +1301     -    361 +10! = 3,628,800             // Fits in int
4701     -    2733 +1302     -    362 +12! = 479,001,600           // Last to fit in int
4702     -    2734 +1303     -    363 +13! = 6,227,020,800         // Needs long long
4703     -    2735 +1304     -    364 +20! ‚âà 2.4 √ó 10¬π‚Å∏            // Last to fit in long long
4704     -    2736 +1305     -    365 +21! overflows long long!
4705     -    2737 +1306     -    366 +
4706     -    2738 +1307     -    367 +// Powers of 2
4707     -    2739 +1308     -    368 +2¬π‚Å∞ = 1,024 ‚âà 10¬≥
4708     -    2740 +1309     -    369 +2¬≤‚Å∞ = 1,048,576 ‚âà 10‚Å∂
4709     -    2741 +1310     -    370 +2¬≥‚Å∞ = 1,073,741,824 ‚âà 10‚Åπ
4710     -    2742 +1311     -    371 +2¬≥¬≤ = 4,294,967,296 ‚âà 4 √ó 10‚Åπ (unsigned int max + 1)
4711     -    2743 +1312     -    372 +2‚Å∂‚Å¥ ‚âà 1.8 √ó 10¬π‚Åπ
4712     -    2744 +1313     -    373 +
4713     -    2745 +1314     -    374 +// Fibonacci
4714     -    2746 +1315     -    375 +F(45) = 1,134,903,170       // Last to fit in int
4715     -    2747 +1316     -    376 +F(92) = 7,540,113,804,746,346,429  // Last to fit in long long
4716     -    2748 +1317     -    377 +
4717     -    2749 +1318     -    378 +// Catalan numbers (combinatorics)
4718     -    2750 +1319     -    379 +C(17) = 129,644,790         // Fits in int
4719     -    2751 +1320     -    380 +C(35) = 3,116,285,494,907,301,262  // Fits in long long
4720     -    2752 +1321     -    381 +```
4721     -    2753 +1322     -    382 +
4722     -    2754 +1323     -    383 +---
4723     -    2755 +1324     -    384 +
4724     -    2756 +1325     -    385 +## ‚úÖ Edge Cases Checklist
4725     -    2757 +1326     -    386 +
4726     -    2758 +1327     -    387 +### Array/Vector Edge Cases
4727     -    2759 +1328     -    388 +
4728     -    2760 +1329     -    389 +```cpp
4729     -    2761 +1330     -    390 +// Always test:
4730     -    2762 +1331     -    391 +‚ñ° Empty array (n = 0)
4731     -    2763 +1332     -    392 +‚ñ° Single element (n = 1)
4732     -    2764 +1333     -    393 +‚ñ° Two elements (n = 2)
4733     -    2765 +1334     -    394 +‚ñ° All same elements
4734     -    2766 +1335     -    395 +‚ñ° Already sorted (ascending)
4735     -    2767 +1336     -    396 +‚ñ° Reverse sorted (descending)
4736     -    2768 +1337     -    397 +‚ñ° Maximum size (n = max constraint)
4737     -    2769 +1338     -    398 +‚ñ° Negative numbers
4738     -    2770 +1339     -    399 +‚ñ° Zero values
4739     -    2771 +1340     -    400 +‚ñ° INT_MAX / INT_MIN values
4740     -    2772 +1341     -    401 +‚ñ° Duplicates at boundaries
4741     -    2773 +1342     -    402 +```
4742     -    2774 +1343     -    403 +
4743     -    2775 +1344     -    404 +### String Edge Cases
4744     -    2776 +1345     -    405 +
4745     -    2777 +1346     -    406 +```cpp
4746     -    2778 +1347     -    407 +// Always test:
4747     -    2779 +1348     -    408 +‚ñ° Empty string (s = "")
4748     -    2780 +1349     -    409 +‚ñ° Single character (s = "a")
4749     -    2781 +1350     -    410 +‚ñ° All same character (s = "aaa")
4750     -    2782 +1351     -    411 +‚ñ° Palindrome
4751     -    2783 +1352     -    412 +‚ñ° All unique characters
4752     -    2784 +1353     -    413 +‚ñ° Maximum length
4753     -    2785 +1354     -    414 +‚ñ° Spaces/special characters (if allowed)
4754     -    2786 +1355     -    415 +‚ñ° Case sensitivity (if relevant)
4755     -    2787 +1356     -    416 +```
4756     -    2788 +1357     -    417 +
4757     -    2789 +1358     -    418 +### Graph Edge Cases
4758     -    2790 +1359     -    419 +
4759     -    2791 +1360     -    420 +```cpp
4760     -    2792 +1361     -    421 +// Always test:
4761     -    2793 +1362     -    422 +‚ñ° Empty graph (no edges)
4762     -    2794 +1363     -    423 +‚ñ° Single node
4763     -    2795 +1364     -    424 +‚ñ° Disconnected graph
4764     -    2796 +1365     -    425 +‚ñ° Complete graph
4765     -    2797 +1366     -    426 +‚ñ° Tree (n-1 edges)
4766     -    2798 +1367     -    427 +‚ñ° Cycle
4767     -    2799 +1368     -    428 +‚ñ° Self-loop (if allowed)
4768     -    2800 +1369     -    429 +‚ñ° Multiple edges between same nodes
4769     -    2801 +1370     -    430 +‚ñ° Negative edge weights (if allowed)
4770     -    2802 +1371     -    431 +‚ñ° All edges same weight
4771     -    2803 +1372     -    432 +```
4772     -    2804 +1373     -    433 +
4773     -    2805 +1374     -    434 +### Tree Edge Cases
4774     -    2806 +1375     -    435 +
4775     -    2807 +1376     -    436 +```cpp
4776     -    2808 +1377     -    437 +// Always test:
4777     -    2809 +1378     -    438 +‚ñ° Empty tree (null root)
4778     -    2810 +1379     -    439 +‚ñ° Single node
4779     -    2811 +1380     -    440 +‚ñ° Skewed tree (all left or all right)
4780     -    2812 +1381     -    441 +‚ñ° Perfect/complete binary tree
4781     -    2813 +1382     -    442 +‚ñ° Maximum depth
4782     -    2814 +1383     -    443 +‚ñ° All same values
4783     -    2815 +1384     -    444 +‚ñ° Negative values (if allowed)
4784     -    2816 +1385     -    445 +```
4785     -    2817 +1386     -    446 +
4786     -    2818 +1387     -    447 +### Number Edge Cases
4787     -    2819 +1388     -    448 +
4788     -    2820 +1389     -    449 +```cpp
4789     -    2821 +1390     -    450 +// Always test:
4790     -    2822 +1391     -    451 +‚ñ° Zero (0)
4791     -    2823 +1392     -    452 +‚ñ° Negative zero (-0 for floating point)
4792     -    2824 +1393     -    453 +‚ñ° INT_MAX (2,147,483,647)
4793     -    2825 +1394     -    454 +‚ñ° INT_MIN (-2,147,483,648)
4794     -    2826 +1395     -    455 +‚ñ° Powers of 2
4795     -    2827 +1396     -    456 +‚ñ° One less than power of 2
4796     -    2828 +1397     -    457 +‚ñ° Prime numbers
4797     -    2829 +1398     -    458 +‚ñ° Perfect squares
4798     -    2830 +1399     -    459 +‚ñ° Negative numbers
4799     -    2831 +1400     -    460 +‚ñ° Very small positive (1)
4800     -    2832 +1401     -    461 +‚ñ° Very large (max constraint)
4801     -    2833 +1402     -    462 +```
4802     -    2834 +1403     -    463 +
4803     -    2835 +1404     -    464 +### Binary Search Edge Cases
4804     -    2836 +1405     -    465 +
4805     -    2837 +1406     -    466 +```cpp
4806     -    2838 +1407     -    467 +// Always test:
4807     -    2839 +1408     -    468 +‚ñ° Target at index 0
4808     -    2840 +1409     -    469 +‚ñ° Target at last index
4809     -    2841 +1410     -    470 +‚ñ° Target not in array
4810     -    2842 +1411     -    471 +‚ñ° Target smaller than all elements
4811     -    2843 +1412     -    472 +‚ñ° Target larger than all elements
4812     -    2844 +1413     -    473 +‚ñ° All elements are target
4813     -    2845 +1414     -    474 +‚ñ° Single element equals target
4814     -    2846 +1415     -    475 +‚ñ° Single element doesn't equal target
4815     -    2847 +1416     -    476 +‚ñ° Two elements
4816     -    2848 +1417     -    477 +```
4817     -    2849 +1418     -    478 +
4818     -    2850 +1419     -    479 +---
4819     -    2851 +1420     -    480 +
4820     -    2852 +1421     -    481 +## üñ•Ô∏è Platform-Specific Constraints
4821     -    2853 +1422     -    482 +
4822     -    2854 +1423     -    483 +### LeetCode
4823     -    2855 +1424     -    484 +
4824     -    2856 +1425     -    485 +```cpp
4825     -    2857 +1426     -    486 +// Typical constraints
4826     -    2858 +1427     -    487 +n ‚â§ 10‚Åµ (most problems)
4827     -    2859 +1428     -    488 +n ‚â§ 10¬≥ (allows O(n¬≤))
4828     -    2860 +1429     -    489 +n ‚â§ 10‚Å¥ (O(n¬≤) risky)
4829     -    2861 +1430     -    490 +Values: -10‚Åπ to 10‚Åπ (fits in int)
4830     -    2862 +1431     -    491 +
4831     -    2863 +1432     -    492 +// Time limit: Usually generous
4832     -    2864 +1433     -    493 +// Memory: 256 MB typical
4833     -    2865 +1434     -    494 +
4834     -    2866 +1435     -    495 +// Fast I/O not needed (uses function calls)
4835     -    2867 +1436     -    496 +```
4836     -    2868 +1437     -    497 +
4837     -    2869 +1438     -    498 +### Codeforces
4838     -    2870 +1439     -    499 +
4839     -    2871 +1440     -    500 +```cpp
4840     -    2872 +1441     -    501 +// Typical constraints
4841     -    2873 +1442     -    502 +n ‚â§ 2 √ó 10‚Åµ (common)
4842     -    2874 +1443     -    503 +n ‚â§ 10‚Å∂ (harder problems)
4843     -    2875 +1444     -    504 +Time: 1-2 seconds
4844     -    2876 +1445     -    505 +Memory: 256 MB (standard)
4845     -    2877 +1446     -    506 +
4846     -    2878 +1447     -    507 +// Fast I/O REQUIRED for large input
4847     -    2879 +1448     -    508 +ios::sync_with_stdio(false);
4848     -    2880 +1449     -    509 +cin.tie(nullptr);
4849     -    2881 +1450     -    510 +```
4850     -    2882 +1451     -    511 +
4851     -    2883 +1452     -    512 +### HackerRank
4852     -    2884 +1453     -    513 +
4853     -    2885 +1454     -    514 +```cpp
4854     -    2886 +1455     -    515 +// Varies by problem
4855     -    2887 +1456     -    516 +// Often has multiple test cases
4856     -    2888 +1457     -    517 +// Time limits can be strict
4857     -    2889 +1458     -    518 +// Fast I/O recommended
4858     -    2890 +1459     -    519 +
4859     -    2891 +1460     -    520 +// Multiple test cases pattern
4860     -    2892 +1461     -    521 +int t;
4861     -    2893 +1462     -    522 +cin >> t;
4862     -    2894 +1463     -    523 +while (t--) {
4863     -    2895 +1464     -    524 +    // solve
4864     -    2896 +1465     -    525 +}
4865     -    2897 +1466     -    526 +```
4866     -    2898 +1467     -    527 +
4867     -    2899 +1468     -    528 +### Google/FAANG Interviews
4868     -    2900 +1469     -    529 +
4869     -    2901 +1470     -    530 +```cpp
4870     -    2902 +1471     -    531 +// Focus on:
4871     -    2903 +1472     -    532 +- Optimal time complexity
4872     -    2904 +1473     -    533 +- Clean, readable code
4873     -    2905 +1474     -    534 +- Handle all edge cases
4874     -    2906 +1475     -    535 +- Discuss trade-offs
4875     -    2907 +1476     -    536 +
4876     -    2908 +1477     -    537 +// Typical expectations:
4877     -    2909 +1478     -    538 +n ‚â§ 10‚Åµ to 10‚Å∂
4878     -    2910 +1479     -    539 +Time: O(n) or O(n log n)
4879     -    2911 +1480     -    540 +Space: O(1) to O(n)
4880     -    2912 +1481     -    541 +```
4881     -    2913 +1482     -    542 +
4882     -    2914 +1483     -    543 +---
4883     -    2915 +1484     -    544 +
4884     -    2916 +1485     -    545 +## üìã Quick Reference Cheatsheet
4885     -    2917 +1486     -    546 +
4886     -    2918 +1487     -    547 +### Numbers to Memorize
4887     -    2919 +1488     -    548 +
4888     -    2920 +1489     -    549 +| Value | Meaning | Use Case |
4889     -    2921 +1490     -    550 +|-------|---------|----------|
4890     -    2922 +1491     -    551 +| 10‚Åπ | ~INT_MAX / 2 | Safe int limit |
4891     -    2923 +1492     -    552 +| 2 √ó 10‚Åπ | ~INT_MAX | Max positive int |
4892     -    2924 +1493     -    553 +| 10¬π‚Å∏ | ~LLONG_MAX / 9 | Safe long long |
4893     -    2925 +1494     -    554 +| 10‚Åπ + 7 | Common modulo | Modular arithmetic |
4894     -    2926 +1495     -    555 +| 10‚Åµ | Typical n limit | O(n log n) problems |
4895     -    2927 +1496     -    556 +| 10‚Å¥ | O(n¬≤) threshold | When O(n¬≤) is OK |
4896     -    2928 +1497     -    557 +| 20-25 | 2‚Åø threshold | Bitmask/subset problems |
4897     -    2929 +1498     -    558 +| 10 | n! threshold | Permutation problems |
4898     -    2930 +1499     -    559 +
4899     -    2931 +1500     -    560 +### Quick Type Selection
4900     -    2932 +1501     -    561 +
4901     -    2933 +1502     -    562 +```cpp
4902     -    2934 +1503     -    563 +// Default
4903     -    2935 +1504     -    564 +int x;                  // Values ‚â§ 10‚Åπ
4904     -    2936 +1505     -    565 +
4905     -    2937 +1506     -    566 +// Large values
4906     -    2938 +1507     -    567 +long long x;           // Values > 2√ó10‚Åπ
4907     -    2939 +1508     -    568 +
4908     -    2940 +1509     -    569 +// Large sums
4909     -    2941 +1510     -    570 +long long sum = 0;     // Sum of many ints
4910     -    2942 +1511     -    571 +
4911     -    2943 +1512     -    572 +// Products
4912     -    2944 +1513     -    573 +long long prod = 1LL * a * b;  // Multiply ints
4913     -    2945 +1514     -    574 +
4914     -    2946 +1515     -    575 +// Modular
4915     -    2947 +1516     -    576 +const int MOD = 1e9 + 7;
4916     -    2948 +1517     -    577 +((1LL * a * b) % MOD)
4917     -    2949 +1518     -    578 +```
4918     -    2950 +1519     -    579 +
4919     -    2951 +1520     -    580 +### Fast I/O Template
4920     -    2952 +1521     -    581 +
4921     -    2953 +1522     -    582 +```cpp
4922     -    2954 +1523     -    583 +#include <bits/stdc++.h>
4923     -    2955 +1524     -    584 +using namespace std;
4924     -    2956 +1525     -    585 +
4925     -    2957 +1526     -    586 +int main() {
4926     -    2958 +1527     -    587 +    ios::sync_with_stdio(false);
4927     -    2959 +1528     -    588 +    cin.tie(nullptr);
4928     -    2960 +1529     -    589 +
4929     -    2961 +1530     -    590 +    // Your code here
4930     -    2962 +1531     -    591 +
4931     -    2963 +1532     -    592 +    return 0;
4932     -    2964 +1533     -    593 +}
4933     -    2965 +1534     -    594 +```
4934     -    2966 +1535     -    595 +
4935     -    2967 +1536     -    596 +### Infinity Values
4936     -    2968 +1537     -    597 +
4937     -    2969 +1538     -    598 +```cpp
4938     -    2970 +1539     -    599 +// For shortest path, DP
4939     -    2971 +1540     -    600 +const int INF = 1e9;           // int infinity
4940     -    2972 +1541     -    601 +const long long INF = 1e18;    // long long infinity
4941     -    2973 +1542     -    602 +
4942     -    2974 +1543     -    603 +// For comparisons (safe for addition)
4943     -    2975 +1544     -    604 +const int INF = INT_MAX / 2;
4944     -    2976 +1545     -    605 +const long long INF = LLONG_MAX / 2;
4945     -    2977 +1546     -    606 +```
4946     -    2978 +1547     -    607 +
4947     -    2979 +1548     -    608 +---
4948     -    2980 +1549     -    609 +
4949     -    2981 +1550     -    610 +## üéØ Interview Tips
4950     -    2982 +1551     -    611 +
4951     -    2983 +1552     -    612 +1. **Always ask for constraints first** - Determines algorithm choice
4952     -    2984 +1553     -    613 +2. **State assumptions explicitly** - "I'm assuming n ‚â§ 10‚Åµ"
4953     -    2985 +1554     -    614 +3. **Check for overflow** - Especially with multiplication and sums
4954     -    2986 +1555     -    615 +4. **Use appropriate data types** - `long long` when in doubt
4955     -    2987 +1556     -    616 +5. **Test edge cases mentally** - Before coding, walk through edge cases
4956     -    2988 +1557     -    617 +6. **Know your constants** - INT_MAX, 10‚Åπ+7, complexity thresholds
4957     -    2989 +1558     -    618 +
4958     -    2990 +1559     -    619 +---
4959     -    2991 +1560     -    620 +
4960     -    2992 +1561     -    621 +*Last Updated: December 19, 2025*
4961     -    2993 +1562     -    622  
4962     -    2994 +    1456 +    117 +*   **Why?** It is technically robust, legally safest (clean separation of domestic vs international funds), and offers the best user experience.
4963     -    2995 +    1457 +    118 +*   **Cost:** $0.
4964     -    2996 +    1458 +    119 +*   **Effort:** ~1 hour to write the HTML/JS for the landing page.
4965     -    2997 +    1459 +    120 +
4966     -    2998 +    1460 +    121 +### Sample Code Snippet (Concept)
4967     -    2999 +    1461 +    122 +```javascript
4968     -    3000 +    1462 +    123 +async function renderDonationOptions() {
4969     -    3001 +    1463 +    124 +  const response = await fetch('https://ipapi.co/json/');
4970     -    3002 +    1464 +    125 +  const data = await response.json();
4971     -    3003 +    1465 +    126 +
4972     -    3004 +    1466 +    127 +  if (data.country_code === 'IN') {
4973     -    3005 +    1467 +    128 +    // Show Razorpay UI
4974     -    3006 +    1468 +    129 +    document.getElementById('currency').innerText = 'INR';
4975     -    3007 +    1469 +    130 +    document.getElementById('presets').innerHTML =
4976     -    3008 +    1470 +    131 +      '<button>‚Çπ50</button><button>‚Çπ100</button>';
4977     -    3009 +    1471 +    132 +    document.getElementById('payment-link').href = 'https://rzp.io/l/your-link';
4978     -    3010 +    1472 +    133 +  } else {
4979     -    3011 +    1473 +    134 +    // Show PayPal/Ko-fi UI
4980     -    3012 +    1474 +    135 +    document.getElementById('currency').innerText = 'USD';
4981     -    3013 +    1475 +    136 +    document.getElementById('presets').innerHTML =
4982     -    3014 +    1476 +    137 +      '<button>$1</button><button>$5</button>';
4983     -    3015 +    1477 +    138 +    document.getElementById('payment-link').href = 'https://ko-fi.com/your-id';
4984     -    3016 +    1478 +    139 +  }
4985     -    3017 +    1479 +    140 +}
4986     -    3018 +    1480 +    141 +```
4987     -    3019 +    1481 +    142  
4988     -    3020 +    1482 +
4989     -    3021 +    1483 +```
4990     -    3022 +    1484 +
4991     -    3023 +    1485 +
4992     -    3024 +    1486 +### ‚ú® `docs/01-requirements/donation_technical_feasibility_review.md` **[ADDED]**
4993     -    3025 +    1487 +
4994     -    3026 +    1488 +**Status:** ‚úÖ **NEW FILE** - This file has been newly created
4995     -    3027 +    1489 +
4996     -    3028 +    1490 +**Type:** Documentation üìñ
4997     -    3029 +    1491 +
4998     -    3030 +    1492 +```diff
4999     -    3031 +    1493 +@@ -0,0 +1,87 @@
5000     -    3032 +    1494 +      1 +# Technical & Feasibility Review: Donation Feature Plan v2.0
5001     -    3033 +    1495 +      2 +
5002     -    3034 +    1496 +      3 +**Reviewer:** Senior Principal SDE, Platform Engineering
5003     -    3035 +    1497 +      4 +**Date:** 2025-12-19
5004     -    3036 +    1498 +      5 +**Scope:** Strict Technical, Scalability, and Feasibility Audit
5005     -    3037 +    1499 +      6 +**Target Document:** `docs/01-requirements/donation-feature-plan.md`
5006     -    3038 +    1500 +      7 +
5007     -    3039 +    1501 +      8 +---
5008     -    3040 +    1502 +      9 +
5009     -    3041 +    1503 +     10 +## 1. Executive Summary
5010     -    3042 +    1504 +     11 +
5011     -    3043 +    1505 +     12 +The proposed "Static Badge Approach" (Phase 2) is **Technically Sound** and **Highly Scalable**. However, the optional "IP-based Smart Routing" (Phase 3) introduces significant **Hidden Technical Debt** and **Failure Modes** that are not adequately addressed in the current plan.
5012     -    3044 +    1506 +     13 +
5013     -    3045 +    1507 +     14 +**Verdict:**
5014     -    3046 +    1508 +     15 +*   **Static Badges (README):** ‚úÖ **APPROVED**. (Rating: Low Risk, High Value)
5015     -    3047 +    1509 +     16 +*   **Smart Routing (Web App):** ‚ö†Ô∏è **CONDITIONAL APPROVAL**. (Rating: Medium Risk, Maintenance Burden)
5016     -    3048 +    1510 +     17 +
5017     -    3049 +    1511 +     18 +---
5018     -    3050 +    1512 +     19 +
5019     -    3051 +    1513 +     20 +## 2. Critical Technical Concerns (Bugs & Scalability)
5020     -    3052 +    1514 +     21 +
5021     -    3053 +    1515 +     22 +### 2.1 The "Free API" Trap (Scalability Risk)
5022     -    3054 +    1516 +     23 +*   **Concern:** The design suggests using `ipapi.co` (Free Tier).
5023     -    3055 +    1517 +     24 +*   **Risk:** Free tiers have rate limits (e.g., 1000 requests/day). If the app (or even the GitHub page if JS is used) goes viral or gets crawled by bots, the API will return `429 Too Many Requests`.
5024     -    3056 +    1518 +     25 +*   **Failure Mode:** The "Donate" button logic fails; users might see *nothing* or a broken spinner.
5025     -    3057 +    1519 +     26 +*   **Mitigation:** Must implement a **Fail-Open Strategy**. If the API fails/timeouts, DEFAULT to the Global (USD/PayPal) view immediately. Do not block rendering.
5026     -    3058 +    1520 +     27 +
5027     -    3059 +    1521 +     28 +### 2.2 Razorpay International Friction (UX Bug)
5028     -    3060 +    1522 +     29 +*   **Concern:** Routing *all* Indian IPs to Razorpay assumes Razorpay accepts *all* payments smoothly.
5029     -    3061 +    1523 +     30 +*   **Bug:** While Razorpay handles domestic UPI perfectly, international cards (e.g., an NRI relative visiting India, or a user on a corporate VPN routing through Bangalore) often face high failure rates on Razorpay unless "International Payments" is explicitly enabled and KYC'd (which is harder for individuals).
5030     -    3062 +    1524 +     31 +*   **Impact:** A user willing to pay $50 via Amex might bounce because Razorpay declines non-Indian issued cards on personal accounts.
5031     -    3063 +    1525 +     32 +
5032     -    3064 +    1526 +     33 +### 2.3 The "VPN Paradox" (Edge Case)
5033     -    3065 +    1527 +     34 +*   **Scenario:** A user in the US uses a VPN to India (to watch Hotstar, etc.) and visits your repo.
5034     -    3066 +    1528 +     35 +*   **Result:** They see "UPI/‚Çπ". They don't have UPI. They leave.
5035     -    3067 +    1529 +     36 +*   **Fix:** The UI **MUST** provide a "Not in India?" toggle or "Show International Options" link even if IP detection says India. **Never soft-lock a user into a geographically assumed payment method.**
5036     -    3068 +    1530 +     37 +
5037     -    3069 +    1531 +     38 +---
5038     -    3070 +    1532 +     39 +
5039     -    3071 +    1533 +     40 +## 3. Maintenance & Long-term Viability Analysis
5040     -    3072 +    1534 +     41 +
5041     -    3073 +    1535 +     42 +### 3.1 Link Rot & Platform Decay
5042     -    3074 +    1536 +     43 +*   **Observation:** Startups (like Ko-fi or BMAC) change terms or get acquired.
5043     -    3075 +    1537 +     44 +*   **Recommendation:** Use a **Redirect Service** or reliable URL shortener (e.g., `yoursite.com/go/donate-inr`) instead of hardcoding `razorpay.me/...` directly in 100 source files. This allows you to switch from Razorpay to LemonSqueezy tomorrow without a PR.
5044     -    3076 +    1538 +     45 +
5045     -    3077 +    1539 +     46 +### 3.2 GitHub Sponsors Approval Latency
5046     -    3078 +    1540 +     47 +*   **Reality Check:** GitHub Sponsors is not instant. It can take 2-4 weeks for approval.
5047     -    3079 +    1541 +     48 +*   **Blocker:** If you deploy the badge before approval, users see a "404" or "Not Enabled" page.
5048     -    3080 +    1542 +     49 +*   **Correction:** Phase 2 must explicitly state: "Deploy GitHub Sponsors badge *only after* approval email is received."
5049     -    3081 +    1543 +     50 +
5050     -    3082 +    1544 +     51 +---
5051     -    3083 +    1545 +     52 +
5052     -    3084 +    1546 +     53 +## 4. Strict "Principle SDE" Recommendations
5053     -    3085 +    1547 +     54 +
5054     -    3086 +    1548 +     55 +To elevate this plan to Enterprise Grade:
5055     -    3087 +    1549 +     56 +
5056     -    3088 +    1550 +     57 +1.  **Enforce "Fail-Safe" Default:**
5057     -    3089 +    1551 +     58 +    - The code structure for Phase 3 must be:
5058     -    3090 +    1552 +     59 +      ```javascript
5059     -    3091 +    1553 +     60 +      // DEFAULT: Global
5060     -    3092 +    1554 +     61 +      let showInd = false;
5061     -    3093 +    1555 +     62 +      try {
5062     -    3094 +    1556 +     63 +         // Race condition: Timeout after 300ms. Don't let a slow IP API slow down the footer.
5063     -    3095 +    1557 +     64 +         const data = await Promise.race([fetchIP(), timeout(300)]);
5064     -    3096 +    1558 +     65 +         if (data.country === 'IN') showInd = true;
5065     -    3097 +    1559 +     66 +      } catch (e) {
5066     -    3098 +    1560 +     67 +         // Silently fail to Global
5067     -    3099 +    1561 +     68 +      }
5068     -    3100 +    1562 +     69 +      ```
5069     -    3101 +    1563 +     70 +
5070     -    3102 +    1564 +     71 +2.  **Taxonomy cleanup:**
5071     -    3103 +    1565 +     72 +    - Stop using the word "Donation" anywhere visible if you are not an 80G registered Non-Profit.
5072     -    3104 +    1566 +     73 +    - Use **"Sponsorship"** or **"Support"** exclusively. This is a legal safeguards against "Misleading Claims" (Consumer Protection Act).
5073     -    3105 +    1567 +     74 +
5074     -    3106 +    1568 +     75 +3.  **Data Minimization:**
5075     -    3107 +    1569 +     76 +    - Ensure the IP Geo-lookup is *client-side only* (browser calls API directly). Do not proxy this through your own backend unless you want to deal with GDPR/CCPA compliance for logging user IPs.
5076     -    3108 +    1570 +     77 +
5077     -    3109 +    1571 +     78 +---
5078     -    3110 +    1572 +     79 +
5079     -    3111 +    1573 +     80 +## 5. Revised Implementation Roadmap
5080     -    3112 +    1574 +     81 +
5081     -    3113 +    1575 +     82 +**Step 1:** Add **Static Badges** (Ko-fi & Razorpay) to `README.md` immediately.
5082     -    3114 +    1576 +     83 +**Step 2:** Apply for GitHub Sponsors (Wait list).
5083     -    3115 +    1577 +     84 +**Step 3:** (Low Priority) Add Smart Routing to Web App **only if** you can guarantee <300ms latency and fail-safe defaults.
5084     -    3116 +    1578 +     85 +
5085     -    3117 +    1579 +     86 +**Signed-off with Conditions.**
5086     -    3118 +    1580 +     87 +*Sr. Principal SDE, Infrastructure*
5087     -    3119 +    1581 +     88  
5088     -    3120 +    1582 +
5089     -    3121 +    1583 +```
5090     -    3122 +    1584 +
5091     -    3123 +    1585 +
5092     -    3124 +    1586 +### üìÑ `index.html`
5093     -    3125 +    1587 +
5094     -    3126 +    1588 +**Type:** HTML Template üåê
5095     -    3127 +    1589 +
5096     -    3128 +    1590 +```diff
5097     -    3129 +    1591 +@@ -337,12 +337,22 @@
5098     -    3130 +    1592 +337 337  
5099     -    3131 +    1593 +338 338      <!-- Footer -->
5100     -    3132 +    1594 +339 339      <footer class="app-footer">
5101     -    3133 +    1595 +340     -      Made with ‚ù§Ô∏è by Prax Lannister | Follow me on
5102     -    3134 +    1596 +341     -      <a href="https://github.com/PrakharMNNIT" target="_blank" rel="noopener noreferrer">GitHub</a>
5103     -    3135 +    1597 +342     -      &
5104     -    3136 +    1598 +343     -      <a href="https://x.com/ByteByByteSrSDE" target="_blank" rel="noopener noreferrer"
5105     -    3137 +    1599 +344     -        >X (Twitter)</a
5106     -    3138 +    1600 +345     -      >
5107     -    3139 +    1601 +    340 +      <div class="footer-content">
5108     -    3140 +    1602 +    341 +        <span>Made with ‚ù§Ô∏è by Prax Lannister</span>
5109     -    3141 +    1603 +    342 +        <span class="footer-separator">|</span>
5110     -    3142 +    1604 +    343 +        <span>Follow me on
5111     -    3143 +    1605 +    344 +          <a href="https://github.com/PrakharMNNIT" target="_blank" rel="noopener noreferrer">GitHub</a>
5112     -    3144 +    1606 +    345 +          &amp;
5113     -    3145 +    1607 +    346 +          <a href="https://x.com/ByteByByteSrSDE" target="_blank" rel="noopener noreferrer">X (Twitter)</a>
5114     -    3146 +    1608 +    347 +        </span>
5115     -    3147 +    1609 +    348 +        <span class="footer-separator">|</span>
5116     -    3148 +    1610 +    349 +        <div class="support-widget-container" id="support-widget">
5117     -    3149 +    1611 +    350 +          <!-- Skeleton loader - will be replaced by JS -->
5118     -    3150 +    1612 +    351 +          <a href="https://ko-fi.com/praxlannister?ref=webapp_footer" target="_blank" rel="noopener noreferrer" class="support-button support-button--loading">
5119     -    3151 +    1613 +    352 +            ‚òï Support
5120     -    3152 +    1614 +    353 +          </a>
5121     -    3153 +    1615 +    354 +        </div>
5122     -    3154 +    1616 +    355 +      </div>
5123     -    3155 +    1617 +346 356      </footer>
5124     -    3156 +    1618 +347 357  
5125     -    3157 +    1619 +348 358      <!-- PDF Preview Modal -->
5126     -    3158 +    1620 +349 359  
5127     -    3159 +1563 1621  
5128     -    3160 +1564 1622  ```
5129     -    3161 +1565 1623  
5130     -    3162 +@@ -1569,290 +1627,128 @@
5131     -    3163 +1569 1627  **Type:** JavaScript Source File üü®
5132     -    3164 +1570 1628  
5133     -    3165 +1571 1629  ```diff
5134     -    3166 +1572     -@@ -29,6 +29,242 @@ window.katex = katex;
5135     -    3167 +1573     - 29  29  window.html2pdf = html2pdf;
5136     -    3168 +1574     - 30  30  window.markedFootnote = markedFootnote;
5137     -    3169 +1575     - 31  31  
5138     -    3170 +1576     -     32 +// ==================== ANCHOR NAVIGATION ====================
5139     -    3171 +1577     -     33 +// Heading slug tracking (module-level singleton for marked.js singleton)
5140     -    3172 +1578     -     34 +const headingSlugMap = new Map();
5141     -    3173 +1579     -     35 +
5142     -    3174 +1580     -     36 +// Pre-compiled slug replacements (zero GC pressure per render)
5143     -    3175 +1581     -     37 +const SLUG_REPLACEMENTS = [
5144     -    3176 +1582     -     38 +  [/c\+\+/gi, 'cpp'],
5145     -    3177 +1583     -     39 +  [/c#/gi, 'csharp'],
5146     -    3178 +1584     -     40 +  [/f#/gi, 'fsharp'],
5147     -    3179 +1585     -     41 +  [/\.net/gi, 'dotnet'],
5148     -    3180 +1586     -     42 +];
5149     -    3181 +1587     -     43 +
5150     -    3182 +1588     -     44 +/**
5151     -    3183 +1589     -     45 + * Reset slug map (call before each parse)
5152     -    3184 +1590     -     46 + */
5153     -    3185 +1591     -     47 +function resetSlugMap() {
5154     -    3186 +1592     -     48 +  headingSlugMap.clear();
5155     -    3187 +1593     -     49 +}
5156     -    3188 +1594     -     50 +
5157     -    3189 +1595     -     51 +/**
5158     -    3190 +1596     -     52 + * Generate URL-safe slug from heading text
5159     -    3191 +1597     -     53 + * @param {string} text - Raw heading text (may include HTML)
5160     -    3192 +1598     -     54 + * @param {Map<string, number>} seen - Duplicate tracking map
5161     -    3193 +1599     -     55 + * @returns {string} URL-safe slug
5162     -    3194 +1600     -     56 + */
5163     -    3195 +1601     -     57 +function generateSlug(text, seen = headingSlugMap) {
5164     -    3196 +1602     -     58 +  // Strip HTML tags
5165     -    3197 +1603     -     59 +  let slug = text.replace(/<[^>]*>/g, '');
5166     -    3198 +1604     -     60 +
5167     -    3199 +1605     -     61 +  // Normalize Unicode
5168     -    3200 +1606     -     62 +  slug = slug.normalize('NFC').toLowerCase();
5169     -    3201 +1607     -     63 +
5170     -    3202 +1608     -     64 +  // Replace programming terms (pre-compiled patterns)
5171     -    3203 +1609     -     65 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
5172     -    3204 +1610     -     66 +    slug = slug.replace(pattern, replacement);
5173     -    3205 +1611     -     67 +  }
5174     -    3206 +1612     -     68 +
5175     -    3207 +1613     -     69 +  // Clean up: remove non-word chars, spaces to hyphens, collapse hyphens
5176     -    3208 +1614     -     70 +  slug = slug
5177     -    3209 +1615     -     71 +    .replace(/[^\w\s-]/g, '')
5178     -    3210 +1616     -     72 +    .replace(/\s+/g, '-')
5179     -    3211 +1617     -     73 +    .replace(/-+/g, '-')
5180     -    3212 +1618     -     74 +    .replace(/^-+|-+$/g, '');
5181     -    3213 +1619     -     75 +
5182     -    3214 +1620     -     76 +  // Fallback for empty result
5183     -    3215 +1621     -     77 +  if (!slug) slug = 'section';
5184     -    3216 +1622     -     78 +
5185     -    3217 +1623     -     79 +  // Handle duplicates (header, header-1, header-2)
5186     -    3218 +1624     -     80 +  const baseSlug = slug;
5187     -    3219 +1625     -     81 +  const count = seen.get(baseSlug) || 0;
5188     -    3220 +1626     -     82 +  if (count > 0) slug = `${baseSlug}-${count}`;
5189     -    3221 +1627     -     83 +  seen.set(baseSlug, count + 1);
5190     -    3222 +1628     -     84 +
5191     -    3223 +1629     -     85 +  return slug;
5192     -    3224 +1630     -     86 +}
5193     -    3225 +1631     -     87 +
5194     -    3226 +1632     -     88 +/**
5195     -    3227 +1633     -     89 + * Anchor Navigation Module
5196     -    3228 +1634     -     90 + * Handles in-document anchor navigation with scoped selection
5197     -    3229 +1635     -     91 + */
5198     -    3230 +1636     -     92 +const AnchorNavigation = {
5199     -    3231 +1637     -     93 +  container: null,
5200     -    3232 +1638     -     94 +  pendingScroll: null,
5201     -    3233 +1639     -     95 +
5202     -    3234 +1640     -     96 +  /**
5203     -    3235 +1641     -     97 +   * Initialize anchor navigation
5204     -    3236 +1642     -     98 +   * @param {HTMLElement} previewContainer - Scrollable preview container
5205     -    3237 +1643     -     99 +   */
5206     -    3238 +1644     -    100 +  init(previewContainer) {
5207     -    3239 +1645     -    101 +    this.container = previewContainer;
5208     -    3240 +1646     -    102 +
5209     -    3241 +1647     -    103 +    // Event delegation for anchor clicks
5210     -    3242 +1648     -    104 +    this.container.addEventListener('click', this.handleClick.bind(this));
5211     -    3243 +1649     -    105 +
5212     -    3244 +1650     -    106 +    // Browser back/forward navigation
5213     -    3245 +1651     -    107 +    window.addEventListener('hashchange', this.handleHashChange.bind(this));
5214     -    3246 +1652     -    108 +
5215     -    3247 +1653     -    109 +    // Initial page load with hash
5216     -    3248 +1654     -    110 +    if (window.location.hash) {
5217     -    3249 +1655     -    111 +      requestAnimationFrame(() => {
5218     -    3250 +1656     -    112 +        this.scrollToHash(window.location.hash.slice(1), false);
5219     -    3251 +1657     -    113 +      });
5220     -    3252 +1658     -    114 +    }
5221     -    3253 +1659     -    115 +
5222     -    3254 +1660     -    116 +    console.log('‚úÖ Anchor navigation initialized');
5223     -    3255 +1661     -    117 +  },
5224     -    3256 +1662     -    118 +
5225     -    3257 +1663     -    119 +  /**
5226     -    3258 +1664     -    120 +   * Handle click events (delegated)
5227     -    3259 +1665     -    121 +   */
5228     -    3260 +1666     -    122 +  handleClick(event) {
5229     -    3261 +1667     -    123 +    const link = event.target.closest('a[href^="#"]');
5230     -    3262 +1668     -    124 +    if (!link) return;
5231     -    3263 +1669     -    125 +
5232     -    3264 +1670     -    126 +    // Ignore external links
5233     -    3265 +1671     -    127 +    if (link.hostname && link.hostname !== window.location.hostname) return;
5234     -    3266 +1672     -    128 +
5235     -    3267 +1673     -    129 +    event.preventDefault();
5236     -    3268 +1674     -    130 +
5237     -    3269 +1675     -    131 +    const hash = link.getAttribute('href').slice(1);
5238     -    3270 +1676     -    132 +    this.scrollToHash(hash, true);
5239     -    3271 +1677     -    133 +
5240     -    3272 +1678     -    134 +    // Update URL without triggering hashchange
5241     -    3273 +1679     -    135 +    history.pushState(null, '', `#${hash}`);
5242     -    3274 +1680     -    136 +  },
5243     -    3275 +1681     -    137 +
5244     -    3276 +1682     -    138 +  /**
5245     -    3277 +1683     -    139 +   * Handle hashchange (browser back/forward)
5246     -    3278 +1684     -    140 +   */
5247     -    3279 +1685     -    141 +  handleHashChange() {
5248     -    3280 +1686     -    142 +    const hash = window.location.hash.slice(1);
5249     -    3281 +1687     -    143 +    if (hash) {
5250     -    3282 +1688     -    144 +      this.scrollToHash(hash, true);
5251     -    3283 +1689     -    145 +    } else {
5252     -    3284 +1690     -    146 +      this.scrollToTop(true);
5253     -    3285 +1691     -    147 +    }
5254     -    3286 +1692     -    148 +  },
5255     -    3287 +1693     -    149 +
5256     -    3288 +1694     -    150 +  /**
5257     -    3289 +1695     -    151 +   * Scroll to element by hash
5258     -    3290 +1696     -    152 +   * @param {string} hash - URL hash (without #)
5259     -    3291 +1697     -    153 +   * @param {boolean} smooth - Use smooth scrolling
5260     -    3292 +1698     -    154 +   */
5261     -    3293 +1699     -    155 +  scrollToHash(hash, smooth = true) {
5262     -    3294 +1700     -    156 +    // Cancel pending scroll (handle concurrent clicks)
5263     -    3295 +1701     -    157 +    if (this.pendingScroll) {
5264     -    3296 +1702     -    158 +      clearTimeout(this.pendingScroll);
5265     -    3297 +1703     -    159 +      this.pendingScroll = null;
5266     -    3298 +1704     -    160 +    }
5267     -    3299 +1705     -    161 +
5268     -    3300 +1706     -    162 +    if (!hash) {
5269     -    3301 +1707     -    163 +      this.scrollToTop(smooth);
5270     -    3302 +1708     -    164 +      return;
5271     -    3303 +1709     -    165 +    }
5272     -    3304 +1710     -    166 +
5273     -    3305 +1711     -    167 +    const target = this.resolveTarget(hash);
5274     -    3306 +1712     -    168 +    if (!target) return;
5275     -    3307 +1713     -    169 +
5276     -    3308 +1714     -    170 +    target.scrollIntoView({
5277     -    3309 +1715     -    171 +      behavior: smooth ? 'smooth' : 'instant',
5278     -    3310 +1716     -    172 +      block: 'start',
5279     -    3311 +1717     -    173 +    });
5280     -    3312 +1718     -    174 +
5281     -    3313 +1719     -    175 +    this.manageFocus(target, smooth);
5282     -    3314 +1720     -    176 +  },
5283     -    3315 +1721     -    177 +
5284     -    3316 +1722     -    178 +  /**
5285     -    3317 +1723     -    179 +   * Scroll to top of container
5286     -    3318 +1724     -    180 +   */
5287     -    3319 +1725     -    181 +  scrollToTop(smooth = true) {
5288     -    3320 +1726     -    182 +    this.container.scrollTo({
5289     -    3321 +1727     -    183 +      top: 0,
5290     -    3322 +1728     -    184 +      behavior: smooth ? 'smooth' : 'instant',
5291     -    3323 +1729     -    185 +    });
5292     -    3324 +1730     -    186 +  },
5293     -    3325 +1731     -    187 +
5294     -    3326 +1732     -    188 +  /**
5295     -    3327 +1733     -    189 +   * Resolve target element - SCOPED to container (prevents app shell collision)
5296     -    3328 +1734     -    190 +   * @param {string} hash - URL hash
5297     -    3329 +1735     -    191 +   * @returns {Element|null} Target element or null
5298     -    3330 +1736     -    192 +   */
5299     -    3331 +1737     -    193 +  resolveTarget(hash) {
5300     -    3332 +1738     -    194 +    if (!hash) return null;
5301     -    3333 +1739     -    195 +
5302     -    3334 +1740     -    196 +    // Decode URI components safely
5303     -    3335 +1741     -    197 +    let decodedHash;
5304     -    3336 +1742     -    198 +    try {
5305     -    3337 +1743     -    199 +      decodedHash = decodeURIComponent(hash);
5306     -    3338 +1744     -    200 +    } catch {
5307     -    3339 +1745     -    201 +      decodedHash = hash;
5308     -    3340 +1746     -    202 +    }
5309     -    3341 +1747     -    203 +
5310     -    3342 +1748     -    204 +    // Priority 1: Exact ID (SCOPED to container)
5311     -    3343 +1749     -    205 +    let target = this.container.querySelector(`#${CSS.escape(decodedHash)}`);
5312     -    3344 +1750     -    206 +    if (target) return target;
5313     -    3345 +1751     -    207 +
5314     -    3346 +1752     -    208 +    // Priority 2: Normalized ID (handles legacy links with emoji, special chars)
5315     -    3347 +1753     -    209 +    const normalized = this.normalizeHash(decodedHash);
5316     -    3348 +1754     -    210 +    target = this.container.querySelector(`#${CSS.escape(normalized)}`);
5317     -    3349 +1755     -    211 +    if (target) return target;
5318     -    3350 +1756     -    212 +
5319     -    3351 +1757     -    213 +    console.warn(`[AnchorNav] Target not found: "${hash}"`);
5320     -    3352 +1758     -    214 +    return null;
5321     -    3353 +1759     -    215 +  },
5322     -    3354 +1760     -    216 +
5323     -    3355 +1761     -    217 +  /**
5324     -    3356 +1762     -    218 +   * Normalize hash for legacy link matching
5325     -    3357 +1763     -    219 +   * @param {string} hash - Raw hash string
5326     -    3358 +1764     -    220 +   * @returns {string} Normalized hash
5327     -    3359 +1765     -    221 +   */
5328     -    3360 +1766     -    222 +  normalizeHash(hash) {
5329     -    3361 +1767     -    223 +    let slug = hash.normalize('NFC').toLowerCase();
5330     -    3362 +1768     -    224 +
5331     -    3363 +1769     -    225 +    // Apply same transformations as generateSlug
5332     -    3364 +1770     -    226 +    for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
5333     -    3365 +1771     -    227 +      slug = slug.replace(pattern, replacement);
5334     -    3366 +1772     -    228 +    }
5335     -    3367 +1773     -    229 +
5336     -    3368 +1774     -    230 +    return slug
5337     -    3369 +1775     -    231 +      .replace(/[^\w\s-]/g, '')
5338     -    3370 +1776     -    232 +      .replace(/\s+/g, '-')
5339     -    3371 +1777     -    233 +      .replace(/-+/g, '-')
5340     -    3372 +1778     -    234 +      .replace(/^-+|-+$/g, '') || 'section';
5341     -    3373 +1779     -    235 +  },
5342     -    3374 +1780     -    236 +
5343     -    3375 +1781     -    237 +  /**
5344     -    3376 +1782     -    238 +   * Manage focus after scroll (accessibility)
5345     -    3377 +1783     -    239 +   * @param {Element} target - Target element
5346     -    3378 +1784     -    240 +   * @param {boolean} smooth - Was smooth scroll used
5347     -    3379 +1785     -    241 +   */
5348     -    3380 +1786     -    242 +  manageFocus(target, smooth) {
5349     -    3381 +1787     -    243 +    const focusTarget = () => {
5350     -    3382 +1788     -    244 +      // Make heading focusable if not already
5351     -    3383 +1789     -    245 +      if (!target.hasAttribute('tabindex')) {
5352     -    3384 +1790     -    246 +        target.setAttribute('tabindex', '-1');
5353     -    3385 +1791     -    247 +      }
5354     -    3386 +1792     -    248 +      target.focus({ preventScroll: true });
5355     -    3387 +1793     -    249 +    };
5356     -    3388 +1794     -    250 +
5357     -    3389 +1795     -    251 +    if (!smooth) {
5358     -    3390 +1796     -    252 +      focusTarget();
5359     -    3391 +1797     -    253 +      return;
5360     -    3392 +1798     -    254 +    }
5361     -    3393 +1799     -    255 +
5362     -    3394 +1800     -    256 +    // Modern browsers: use scrollend event
5363     -    3395 +1801     -    257 +    if ('onscrollend' in this.container) {
5364     -    3396 +1802     -    258 +      this.container.addEventListener('scrollend', focusTarget, { once: true });
5365     -    3397 +1803     -    259 +    } else {
5366     -    3398 +1804     -    260 +      // Fallback: estimate scroll duration (max 1000ms for safety)
5367     -    3399 +1805     -    261 +      const distance = Math.abs(target.getBoundingClientRect().top);
5368     -    3400 +1806     -    262 +      const duration = Math.min(Math.max(distance / 2, 300), 1000);
5369     -    3401 +1807     -    263 +      this.pendingScroll = setTimeout(focusTarget, duration + 50);
5370     -    3402 +1808     -    264 +    }
5371     -    3403 +1809     -    265 +  },
5372     -    3404 +1810     -    266 +};
5373     -    3405 +1811     -    267 +
5374     -    3406 +1812     - 32 268  // Initialize services and managers
5375     -    3407 +1813     - 33 269  const storageManager = new StorageManager();
5376     -    3408 +1814     - 34 270  const themeManager = new ThemeManager(storageManager);
5377     -    3409 +1815     -@@ -360,6 +596,19 @@ function configureMarkedExtensions() {
5378     -    3410 +1816     -360 596    });
5379     -    3411 +1817     -361 597  
5380     -    3412 +1818     -362 598    console.log('‚úÖ Marked.js configured with all extensions (LaTeX, subscript, superscript)');
5381     -    3413 +1819     -    599 +
5382     -    3414 +1820     -    600 +  // Custom heading renderer with ID generation for anchor navigation
5383     -    3415 +1821     -    601 +  marked.use({
5384     -    3416 +1822     -    602 +    renderer: {
5385     -    3417 +1823     -    603 +      heading(token) {
5386     -    3418 +1824     -    604 +        const text = this.parser.parseInline(token.tokens);
5387     -    3419 +1825     -    605 +        const level = token.depth;
5388     -    3420 +1826     -    606 +        const slug = generateSlug(text, headingSlugMap);
5389     -    3421 +1827     -    607 +        return `<h${level} id="${slug}">${text}</h${level}>\n`;
5390     -    3422 +1828     -    608 +      }
5391     -    3423 +1829     -    609 +    }
5392     -    3424 +1830     -    610 +  });
5393     -    3425 +1831     -    611 +  console.log('‚úÖ Custom heading renderer enabled (anchor navigation IDs)');
5394     -    3426 +1832     -363 612  }
5395     -    3427 +1833     -364 613  
5396     -    3428 +1834     -365 614  // Initialize Mermaid using MermaidService (prefixed to indicate future use)
5397     -    3429 +1835     -@@ -550,6 +799,9 @@ graph TD
5398     -    3430 +1836     -550 799    // Render markdown (expose globally for theme changes)
5399     -    3431 +1837     -551 800    function renderMarkdown() {
5400     -    3432 +1838     -552 801      try {
5401     -    3433 +1839     -    802 +      // Reset slug map before parsing (singleton-safe pattern)
5402     -    3434 +1840     -    803 +      resetSlugMap();
5403     -    3435 +1841     -    804 +
5404     -    3436 +1842     -553 805        const markdownText = editor.value;
5405     -    3437 +1843     -554 806  
5406     -    3438 +1844     -555 807        // Parse markdown with all extensions
5407     -    3439 +1845     -@@ -2001,6 +2253,9 @@ Wrap up your thoughts and include a call to action.
5408     -    3440 +1846     -2001 2253    // Initialize expand button visibility on load
5409     -    3441 +1847     -2002 2254    updateExpandButtonVisibility();
5410     -    3442 +1848     -2003 2255  
5411     -    3443 +1849     -    2256 +  // Initialize anchor navigation for TOC links
5412     -    3444 +1850     -    2257 +  AnchorNavigation.init(previewContainer);
5413     -    3445 +1851     -    2258 +
5414     -    3446 +1852     -2004 2259    // DON'T render immediately - wait for theme to load
5415     -    3447 +1853     -2005 2260    // renderMarkdown will be called after theme loads above
5416     -    3448 +1854     -2006 2261  }
5417     -    3449 +1855     -2007 2262  
5418     -    3450 +    1630 +@@ -351,6 +351,120 @@ function initializeApp() {
5419     -    3451 +    1631 +351 351  
5420     -    3452 +    1632 +352 352    // Setup the editor
5421     -    3453 +    1633 +353 353    setupEditor();
5422     -    3454 +    1634 +    354 +
5423     -    3455 +    1635 +    355 +  // Initialize support widget (donation button in footer)
5424     -    3456 +    1636 +    356 +  initSupportWidget();
5425     -    3457 +    1637 +    357 +}
5426     -    3458 +    1638 +    358 +
5427     -    3459 +    1639 +    359 +// ==================== SUPPORT WIDGET (DONATION ROUTER) ====================
5428     -    3460 +    1640 +    360 +/**
5429     -    3461 +    1641 +    361 + * Enterprise-grade geo-based donation routing
5430     -    3462 +    1642 +    362 + * - 300ms timeout with fail-safe to global
5431     -    3463 +    1643 +    363 + * - Session caching to avoid repeated API calls
5432     -    3464 +    1644 +    364 + * - CLS mitigation via skeleton loader
5433     -    3465 +    1645 +    365 + */
5434     -    3466 +    1646 +    366 +const SUPPORT_TIMEOUT_MS = 300;
5435     -    3467 +    1647 +    367 +const SUPPORT_FALLBACK_REGION = 'global';
5436     -    3468 +    1648 +    368 +const SUPPORT_CACHE_KEY = 'support_user_region';
5437     -    3469 +    1649 +    369 +
5438     -    3470 +    1650 +    370 +/**
5439     -    3471 +    1651 +    371 + * Detect user region with fail-safe pattern
5440     -    3472 +    1652 +    372 + * @returns {Promise<string>} 'india' or 'global'
5441     -    3473 +    1653 +    373 + */
5442     -    3474 +    1654 +    374 +async function detectSupportRegion() {
5443     -    3475 +    1655 +    375 +  // 1. Check session cache first (FR-1.4)
5444     -    3476 +    1656 +    376 +  const cached = sessionStorage.getItem(SUPPORT_CACHE_KEY);
5445     -    3477 +    1657 +    377 +  if (cached) {
5446     -    3478 +    1658 +    378 +    console.log(`[SupportWidget] Using cached region: ${cached}`);
5447     -    3479 +    1659 +    379 +    return cached;
5448     -    3480 +    1660 +    380 +  }
5449     -    3481 +    1661 +    381 +
5450     -    3482 +    1662 +    382 +  try {
5451     -    3483 +    1663 +    383 +    // 2. Race: Network vs Timeout (300ms)
5452     -    3484 +    1664 +    384 +    const controller = new AbortController();
5453     -    3485 +    1665 +    385 +    const timeoutId = setTimeout(() => controller.abort(), SUPPORT_TIMEOUT_MS);
5454     -    3486 +    1666 +    386 +
5455     -    3487 +    1667 +    387 +    const response = await fetch('https://ipapi.co/json/', {
5456     -    3488 +    1668 +    388 +      signal: controller.signal,
5457     -    3489 +    1669 +    389 +    });
5458     -    3490 +    1670 +    390 +    clearTimeout(timeoutId);
5459     -    3491 +    1671 +    391 +
5460     -    3492 +    1672 +    392 +    const data = await response.json();
5461     -    3493 +    1673 +    393 +    const region = data.country_code === 'IN' ? 'india' : 'global';
5462     -    3494 +    1674 +    394 +
5463     -    3495 +    1675 +    395 +    // 3. Cache result for session
5464     -    3496 +    1676 +    396 +    sessionStorage.setItem(SUPPORT_CACHE_KEY, region);
5465     -    3497 +    1677 +    397 +    console.log(`[SupportWidget] Detected region: ${region} (${data.country_code})`);
5466     -    3498 +    1678 +    398 +    return region;
5467     -    3499 +    1679 +    399 +  } catch (error) {
5468     -    3500 +    1680 +    400 +    // 4. Fail open - silent fail to global
5469     -    3501 +    1681 +    401 +    console.warn('[SupportWidget] Geo-lookup failed/timed-out, defaulting to Global.', error.message);
5470     -    3502 +    1682 +    402 +    return SUPPORT_FALLBACK_REGION;
5471     -    3503 +    1683 +    403 +  }
5472     -    3504 +    1684 +    404 +}
5473     -    3505 +    1685 +    405 +
5474     -    3506 +    1686 +    406 +/**
5475     -    3507 +    1687 +    407 + * Toggle between India and Global support options
5476     -    3508 +    1688 +    408 + */
5477     -    3509 +    1689 +    409 +function toggleSupportRegion() {
5478     -    3510 +    1690 +    410 +  const currentRegion = sessionStorage.getItem(SUPPORT_CACHE_KEY) || SUPPORT_FALLBACK_REGION;
5479     -    3511 +    1691 +    411 +  const newRegion = currentRegion === 'india' ? 'global' : 'india';
5480     -    3512 +    1692 +    412 +  sessionStorage.setItem(SUPPORT_CACHE_KEY, newRegion);
5481     -    3513 +    1693 +    413 +  renderSupportWidget(newRegion);
5482     -    3514 +    1694 +    414 +  console.log(`[SupportWidget] Toggled region: ${currentRegion} ‚Üí ${newRegion}`);
5483     -    3515 +    1695 +    415 +}
5484     -    3516 +    1696 +    416 +
5485     -    3517 +    1697 +    417 +// Make toggle function globally accessible for onclick
5486     -    3518 +    1698 +    418 +window.toggleSupportRegion = toggleSupportRegion;
5487     -    3519 +    1699 +    419 +
5488     -    3520 +    1700 +    420 +/**
5489     -    3521 +    1701 +    421 + * Render support widget based on region
5490     -    3522 +    1702 +    422 + * @param {string} region - 'india' or 'global'
5491     -    3523 +    1703 +    423 + */
5492     -    3524 +    1704 +    424 +function renderSupportWidget(region) {
5493     -    3525 +    1705 +    425 +  const container = document.getElementById('support-widget');
5494     -    3526 +    1706 +    426 +  if (!container) return;
5495     -    3527 +    1707 +    427 +
5496     -    3528 +    1708 +    428 +  const config = region === 'india'
5497     -    3529 +    1709 +    429 +    ? {
5498     -    3530 +    1710 +    430 +      text: 'üáÆüá≥ Support via UPI',
5499     -    3531 +    1711 +    431 +      url: 'https://razorpay.me/@prakharshekharparthasarthi?notes[source]=webapp_footer',
5500     -    3532 +    1712 +    432 +      className: 'support-button--india',
5501     -    3533 +    1713 +    433 +      toggleText: 'Not in India?',
5502     -    3534 +    1714 +    434 +    }
5503     -    3535 +    1715 +    435 +    : {
5504     -    3536 +    1716 +    436 +      text: '‚òï Support via Ko-fi',
5505     -    3537 +    1717 +    437 +      url: 'https://ko-fi.com/praxlannister?ref=webapp_footer',
5506     -    3538 +    1718 +    438 +      className: 'support-button--global',
5507     -    3539 +    1719 +    439 +      toggleText: 'In India? Use UPI',
5508     -    3540 +    1720 +    440 +    };
5509     -    3541 +    1721 +    441 +
5510     -    3542 +    1722 +    442 +  container.innerHTML = `
5511     -    3543 +    1723 +    443 +    <a href="${config.url}" target="_blank" rel="noopener noreferrer" class="support-button ${config.className}">
5512     -    3544 +    1724 +    444 +      ${config.text}
5513     -    3545 +    1725 +    445 +    </a>
5514     -    3546 +    1726 +    446 +    <button class="support-toggle" onclick="toggleSupportRegion()">${config.toggleText}</button>
5515     -    3547 +    1727 +    447 +  `;
5516     -    3548 +    1728 +    448 +}
5517     -    3549 +    1729 +    449 +
5518     -    3550 +    1730 +    450 +/**
5519     -    3551 +    1731 +    451 + * Initialize support widget with skeleton loader and geo detection
5520     -    3552 +    1732 +    452 + */
5521     -    3553 +    1733 +    453 +async function initSupportWidget() {
5522     -    3554 +    1734 +    454 +  const container = document.getElementById('support-widget');
5523     -    3555 +    1735 +    455 +  if (!container) {
5524     -    3556 +    1736 +    456 +    console.warn('[SupportWidget] Container not found, skipping initialization');
5525     -    3557 +    1737 +    457 +    return;
5526     -    3558 +    1738 +    458 +  }
5527     -    3559 +    1739 +    459 +
5528     -    3560 +    1740 +    460 +  console.log('[SupportWidget] Initializing...');
5529     -    3561 +    1741 +    461 +
5530     -    3562 +    1742 +    462 +  // Skeleton is already in HTML (CLS mitigation)
5531     -    3563 +    1743 +    463 +  // Now detect region and hydrate
5532     -    3564 +    1744 +    464 +  const region = await detectSupportRegion();
5533     -    3565 +    1745 +    465 +  renderSupportWidget(region);
5534     -    3566 +    1746 +    466 +
5535     -    3567 +    1747 +    467 +  console.log(`[SupportWidget] ‚úÖ Initialized with region: ${region}`);
5536     -    3568 +    1748 +354 468  }
5537     -    3569 +    1749 +355 469  
5538     -    3570 +    1750 +356 470  /**
5539     -    3571 +    1751 +357 471  
5540     -    3572 +1856 1752  
5541     -    3573 +1857 1753  ```
5542     -    3574 +1858 1754  
5543     -    3575 +@@ -1862,100 +1758,140 @@
5544     -    3576 +1862 1758  **Type:** Stylesheet üé®
5545     -    3577 +1863 1759  
5546     -    3578 +1864 1760  ```diff
5547     -    3579 +1865     -@@ -224,6 +224,47 @@ body {
5548     -    3580 +1866     -224 224    overflow: auto;
5549     -    3581 +1867     -225 225    /* Single scrollbar for preview container */
5550     -    3582 +1868     -226 226    min-width: 200px;
5551     -    3583 +1869     -    227 +  /* Anchor Navigation - scroll offset for fixed toolbar */
5552     -    3584 +1870     -    228 +  scroll-padding-top: var(--scroll-offset, 80px);
5553     -    3585 +1871     -    229 +}
5554     -    3586 +1872     -    230 +
5555     -    3587 +1873     -    231 +/* ==================== ANCHOR NAVIGATION ==================== */
5556     -    3588 +1874     -    232 +
5557     -    3589 +1875     -    233 +/* Target highlight animation */
5558     -    3590 +1876     -    234 +.preview-container :target {
5559     -    3591 +1877     -    235 +  animation: anchor-highlight 2s ease-out;
5560     -    3592 +1878     -    236 +}
5561     -    3593 +1879     -    237 +
5562     -    3594 +1880     -    238 +@keyframes anchor-highlight {
5563     -    3595 +1881     -    239 +  0% {
5564     -    3596 +1882     -    240 +    background-color: rgba(255, 255, 0, 0.3);
5565     -    3597 +1883     -    241 +  }
5566     -    3598 +1884     -    242 +
5567     -    3599 +1885     -    243 +  100% {
5568     -    3600 +1886     -    244 +    background-color: transparent;
5569     -    3601 +1887     -    245 +  }
5570     -    3602 +1888     -    246 +}
5571     -    3603 +1889     -    247 +
5572     -    3604 +1890     -    248 +/* Focus management - hide outline for mouse clicks */
5573     -    3605 +1891     -    249 +.preview-container h1[id]:focus:not(:focus-visible),
5574     -    3606 +1892     -    250 +.preview-container h2[id]:focus:not(:focus-visible),
5575     -    3607 +1893     -    251 +.preview-container h3[id]:focus:not(:focus-visible),
5576     -    3608 +1894     -    252 +.preview-container h4[id]:focus:not(:focus-visible),
5577     -    3609 +1895     -    253 +.preview-container h5[id]:focus:not(:focus-visible),
5578     -    3610 +1896     -    254 +.preview-container h6[id]:focus:not(:focus-visible) {
5579     -    3611 +1897     -    255 +  outline: none;
5580     -    3612 +1898     -    256 +}
5581     -    3613 +1899     -    257 +
5582     -    3614 +1900     -    258 +/* Keyboard focus gets visible indicator */
5583     -    3615 +1901     -    259 +.preview-container h1[id]:focus-visible,
5584     -    3616 +1902     -    260 +.preview-container h2[id]:focus-visible,
5585     -    3617 +1903     -    261 +.preview-container h3[id]:focus-visible,
5586     -    3618 +1904     -    262 +.preview-container h4[id]:focus-visible,
5587     -    3619 +1905     -    263 +.preview-container h5[id]:focus-visible,
5588     -    3620 +1906     -    264 +.preview-container h6[id]:focus-visible {
5589     -    3621 +1907     -    265 +  outline: 2px solid var(--h1-color, #007bff);
5590     -    3622 +1908     -    266 +  outline-offset: 4px;
5591     -    3623 +1909     -    267 +  border-radius: 2px;
5592     -    3624 +1910     -227 268  }
5593     -    3625 +1911     -228 269  
5594     -    3626 +1912     -229 270  .preview-header {
5595     -    3627 +1913     -230 271  
5596     -    3628 +1914     -
5597     -    3629 +1915     -```
5598     -    3630 +1916     -
5599     -    3631 +1917     -
5600     -    3632 +1918     -### üìÑ `variables.css`
5601     -    3633 +1919     -
5602     -    3634 +1920     -**Type:** Stylesheet üé®
5603     -    3635 +1921     -
5604     -    3636 +1922     -```diff
5605     -    3637 +1923     -@@ -11,13 +11,18 @@
5606     -    3638 +1924     - 11  11    /* ==================== NEBULA DARK (Default) ==================== */
5607     -    3639 +1925     - 12  12  
5608     -    3640 +1926     - 13  13    /* Core Backgrounds */
5609     -    3641 +1927     - 14     -  --bg-universe: #050508;     /* The void */
5610     -    3642 +1928     - 15     -  --bg-element: #0f1123;      /* Solid panels if needed */
5611     -    3643 +1929     -     14 +  --bg-universe: #050508;
5612     -    3644 +1930     -     15 +  /* The void */
5613     -    3645 +1931     -     16 +  --bg-element: #0f1123;
5614     -    3646 +1932     -     17 +  /* Solid panels if needed */
5615     -    3647 +1933     - 16  18  
5616     -    3648 +1934     - 17  19    /* Glass System */
5617     -    3649 +1935     - 18     -  --bg-glass: rgba(15, 17, 35, 0.6);        /* Main panels */
5618     -    3650 +1936     - 19     -  --bg-glass-heavy: rgba(10, 12, 25, 0.85); /* Sidebar/Modals */
5619     -    3651 +1937     - 20     -  --bg-glass-light: rgba(255, 255, 255, 0.05); /* Hover states */
5620     -    3652 +1938     -     20 +  --bg-glass: rgba(15, 17, 35, 0.6);
5621     -    3653 +1939     -     21 +  /* Main panels */
5622     -    3654 +1940     -     22 +  --bg-glass-heavy: rgba(10, 12, 25, 0.85);
5623     -    3655 +1941     -     23 +  /* Sidebar/Modals */
5624     -    3656 +1942     -     24 +  --bg-glass-light: rgba(255, 255, 255, 0.05);
5625     -    3657 +1943     -     25 +  /* Hover states */
5626     -    3658 +1944     - 21  26  
5627     -    3659 +1945     - 22  27    /* Borders */
5628     -    3660 +1946     - 23  28    --border-glass: rgba(255, 255, 255, 0.08);
5629     -    3661 +1947     -@@ -44,6 +49,10 @@
5630     -    3662 +1948     - 44  49    --radius-lg: 16px;
5631     -    3663 +1949     - 45  50    --radius-md: 12px;
5632     -    3664 +1950     - 46  51    --radius-sm: 8px;
5633     -    3665 +1951     -     52 +
5634     -    3666 +1952     -     53 +  /* Anchor Navigation */
5635     -    3667 +1953     -     54 +  --scroll-padding: 20px;
5636     -    3668 +1954     -     55 +  --scroll-offset: calc(var(--header-height) + var(--scroll-padding));
5637     -    3669 +1955     - 47  56  }
5638     -    3670 +1956     - 48  57  
5639     -    3671 +1957     - 49  58  /* ==================== NEBULA LIGHT ==================== */
5640     -    3672 +1958     - 50  59  
5641     -    3673 +    1761 +@@ -789,6 +789,19 @@ body {
5642     -    3674 +    1762 +789 789    box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
5643     -    3675 +    1763 +790 790  }
5644     -    3676 +    1764 +791 791  
5645     -    3677 +    1765 +    792 +.footer-content {
5646     -    3678 +    1766 +    793 +  display: flex;
5647     -    3679 +    1767 +    794 +  align-items: center;
5648     -    3680 +    1768 +    795 +  justify-content: center;
5649     -    3681 +    1769 +    796 +  flex-wrap: wrap;
5650     -    3682 +    1770 +    797 +  gap: 8px;
5651     -    3683 +    1771 +    798 +}
5652     -    3684 +    1772 +    799 +
5653     -    3685 +    1773 +    800 +.footer-separator {
5654     -    3686 +    1774 +    801 +  color: var(--border-color);
5655     -    3687 +    1775 +    802 +  font-weight: 300;
5656     -    3688 +    1776 +    803 +}
5657     -    3689 +    1777 +    804 +
5658     -    3690 +    1778 +792 805  .app-footer a {
5659     -    3691 +    1779 +793 806    color: var(--link-color);
5660     -    3692 +    1780 +794 807    text-decoration: none;
5661     -    3693 +    1781 +@@ -801,6 +814,112 @@ body {
5662     -    3694 +    1782 +801 814    text-decoration: underline;
5663     -    3695 +    1783 +802 815  }
5664     -    3696 +    1784 +803 816  
5665     -    3697 +    1785 +    817 +/* ==================== SUPPORT WIDGET ==================== */
5666     -    3698 +    1786 +    818 +.support-widget-container {
5667     -    3699 +    1787 +    819 +  display: inline-flex;
5668     -    3700 +    1788 +    820 +  align-items: center;
5669     -    3701 +    1789 +    821 +  gap: 8px;
5670     -    3702 +    1790 +    822 +  min-height: 32px;
5671     -    3703 +    1791 +    823 +  /* CLS mitigation - reserve space before JS loads */
5672     -    3704 +    1792 +    824 +}
5673     -    3705 +    1793 +    825 +
5674     -    3706 +    1794 +    826 +.support-button {
5675     -    3707 +    1795 +    827 +  display: inline-flex;
5676     -    3708 +    1796 +    828 +  align-items: center;
5677     -    3709 +    1797 +    829 +  gap: 6px;
5678     -    3710 +    1798 +    830 +  padding: 6px 14px;
5679     -    3711 +    1799 +    831 +  border-radius: 20px;
5680     -    3712 +    1800 +    832 +  font-size: 13px;
5681     -    3713 +    1801 +    833 +  font-weight: 600;
5682     -    3714 +    1802 +    834 +  text-decoration: none;
5683     -    3715 +    1803 +    835 +  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
5684     -    3716 +    1804 +    836 +  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
5685     -    3717 +    1805 +    837 +}
5686     -    3718 +    1806 +    838 +
5687     -    3719 +    1807 +    839 +.support-button:hover {
5688     -    3720 +    1808 +    840 +  transform: translateY(-2px);
5689     -    3721 +    1809 +    841 +  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
5690     -    3722 +    1810 +    842 +  text-decoration: none;
5691     -    3723 +    1811 +    843 +}
5692     -    3724 +    1812 +    844 +
5693     -    3725 +    1813 +    845 +/* Skeleton loader state */
5694     -    3726 +    1814 +    846 +.support-button--loading {
5695     -    3727 +    1815 +    847 +  background: linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%);
5696     -    3728 +    1816 +    848 +  background-size: 200% 100%;
5697     -    3729 +    1817 +    849 +  animation: shimmer 1.5s infinite;
5698     -    3730 +    1818 +    850 +  color: #888;
5699     -    3731 +    1819 +    851 +  border: none;
5700     -    3732 +    1820 +    852 +}
5701     -    3733 +    1821 +    853 +
5702     -    3734 +    1822 +    854 +@keyframes shimmer {
5703     -    3735 +    1823 +    855 +  0% {
5704     -    3736 +    1824 +    856 +    background-position: 200% 0;
5705     -    3737 +    1825 +    857 +  }
5706     -    3738 +    1826 +    858 +
5707     -    3739 +    1827 +    859 +  100% {
5708     -    3740 +    1828 +    860 +    background-position: -200% 0;
5709     -    3741 +    1829 +    861 +  }
5710     -    3742 +    1830 +    862 +}
5711     -    3743 +    1831 +    863 +
5712     -    3744 +    1832 +    864 +/* India UPI style - Orange/Saffron theme */
5713     -    3745 +    1833 +    865 +.support-button--india {
5714     -    3746 +    1834 +    866 +  background: linear-gradient(135deg, #FF9933 0%, #FF6B00 100%);
5715     -    3747 +    1835 +    867 +  color: white;
5716     -    3748 +    1836 +    868 +  border: none;
5717     -    3749 +    1837 +    869 +}
5718     -    3750 +    1838 +    870 +
5719     -    3751 +    1839 +    871 +.support-button--india:hover {
5720     -    3752 +    1840 +    872 +  background: linear-gradient(135deg, #FFB366 0%, #FF8533 100%);
5721     -    3753 +    1841 +    873 +  color: white;
5722     -    3754 +    1842 +    874 +}
5723     -    3755 +    1843 +    875 +
5724     -    3756 +    1844 +    876 +/* Global PayPal style - Blue theme */
5725     -    3757 +    1845 +    877 +.support-button--global {
5726     -    3758 +    1846 +    878 +  background: linear-gradient(135deg, #29ABE0 0%, #1E88E5 100%);
5727     -    3759 +    1847 +    879 +  color: white;
5728     -    3760 +    1848 +    880 +  border: none;
5729     -    3761 +    1849 +    881 +}
5730     -    3762 +    1850 +    882 +
5731     -    3763 +    1851 +    883 +.support-button--global:hover {
5732     -    3764 +    1852 +    884 +  background: linear-gradient(135deg, #4FC3F7 0%, #42A5F5 100%);
5733     -    3765 +    1853 +    885 +  color: white;
5734     -    3766 +    1854 +    886 +}
5735     -    3767 +    1855 +    887 +
5736     -    3768 +    1856 +    888 +/* Region toggle button */
5737     -    3769 +    1857 +    889 +.support-toggle {
5738     -    3770 +    1858 +    890 +  background: none;
5739     -    3771 +    1859 +    891 +  border: none;
5740     -    3772 +    1860 +    892 +  color: var(--text-secondary);
5741     -    3773 +    1861 +    893 +  font-size: 11px;
5742     -    3774 +    1862 +    894 +  cursor: pointer;
5743     -    3775 +    1863 +    895 +  text-decoration: underline;
5744     -    3776 +    1864 +    896 +  opacity: 0.7;
5745     -    3777 +    1865 +    897 +  transition: opacity 0.2s;
5746     -    3778 +    1866 +    898 +  padding: 0;
5747     -    3779 +    1867 +    899 +}
5748     -    3780 +    1868 +    900 +
5749     -    3781 +    1869 +    901 +.support-toggle:hover {
5750     -    3782 +    1870 +    902 +  opacity: 1;
5751     -    3783 +    1871 +    903 +  color: var(--link-color);
5752     -    3784 +    1872 +    904 +}
5753     -    3785 +    1873 +    905 +
5754     -    3786 +    1874 +    906 +/* Mobile responsive */
5755     -    3787 +    1875 +    907 +@media (max-width: 768px) {
5756     -    3788 +    1876 +    908 +  .footer-content {
5757     -    3789 +    1877 +    909 +    flex-direction: column;
5758     -    3790 +    1878 +    910 +    gap: 6px;
5759     -    3791 +    1879 +    911 +  }
5760     -    3792 +    1880 +    912 +
5761     -    3793 +    1881 +    913 +  .footer-separator {
5762     -    3794 +    1882 +    914 +    display: none;
5763     -    3795 +    1883 +    915 +  }
5764     -    3796 +    1884 +    916 +
5765     -    3797 +    1885 +    917 +  .support-widget-container {
5766     -    3798 +    1886 +    918 +    flex-direction: column;
5767     -    3799 +    1887 +    919 +    gap: 4px;
5768     -    3800 +    1888 +    920 +  }
5769     -    3801 +    1889 +    921 +}
5770     -    3802 +    1890 +    922 +
5771     -    3803 +    1891 +804 923  /* ==================== MERMAID DIAGRAMS ==================== */
5772     -    3804 +    1892 +805 924  .mermaid-diagram {
5773     -    3805 +    1893 +806 925    margin: 2em 0;
5774     -    3806 +    1894 +807 926  
5775     -    3807 +1959 1895  
5776     -    3808 +1960 1896  ```
5777     -    3809 +1961 1897  
5778     -    3810 +@@ -2001,4 +1937,4 @@ Please provide specific feedback on:
5779     -    3811 +2001 1937  
5780     -    3812 +2002 1938  ---
5781     -    3813 +2003 1939  *Generated by AI Visual Code Review v2.0 - Unified Export Script*
5782     -    3814 +2004     -*Files processed: 5/5 | Errors: 0 | Generated: 2025-12-19T10:49:19.648Z*
5783     -    3815 +    1940 +*Files processed: 9/9 | Errors: 0 | Generated: 2025-12-19T13:56:21.115Z*
5784     -    3816 +2005 1941  
5785     -1959 3817  
5786     -1960 3818  ```
5787     -1961 3819  
5788     -@@ -2001,4 +3859,4 @@ Please provide specific feedback on:
5789     -2001 3859  
5790     -2002 3860  ---
5791     -2003 3861  *Generated by AI Visual Code Review v2.0 - Unified Export Script*
5792     -2004     -*Files processed: 5/5 | Errors: 0 | Generated: 2025-12-19T10:49:19.648Z*
5793     -    3862 +*Files processed: 1/1 | Errors: 0 | Generated: 2025-12-19T14:00:46.783Z*
5794     -2005 3863  
5795     -
5796     -```
5797     -
5798     -
5799     -### üìÑ `docs/01-requirements/donation-feature-plan.md`
5800     -
5801     -**Type:** Documentation üìñ
5802     -
5803     -```diff
5804     -@@ -77,12 +77,57 @@ Implement a donation/support system that:
5805     - 77  77  
5806     - 78  78  | Location | Type | Priority |
5807     - 79  79  |----------|------|----------|
5808     - 80     -| Web App Footer | "Support" button | **P0 (PRIMARY)** |
5809     -     80 +| Web App Footer | "Support" button with smart routing | **P0 (PRIMARY)** |
5810     -     81 +| Web App Header | GitHub Sponsors button | **P0 (PRIMARY)** |
5811     - 81  82  | GitHub Repository | Sponsor button | P1 |
5812     - 82  83  | README.md | Badge/button with link | P2 (SECONDARY) |
5813     - 83  84  | RELEASE.md | Acknowledgment section | P3 |
5814     - 84  85  
5815     - 85     -> **Priority Update (Per Sr. Principal SDE Review):** Web App integration is PRIMARY, README is SECONDARY
5816     -     86 +> **Priority Update (Per User Feedback):** Web App integration (Header + Footer) is PRIMARY, README is SECONDARY
5817     -     87 +
5818     -     88 +### FR-4.1: Web App UI Integration
5819     -     89 +
5820     -     90 +| Component | Content | Behavior |
5821     -     91 +|-----------|---------|----------|
5822     -     92 +| **Header** | GitHub Sponsors button | Static link to `github.com/sponsors/PrakharMNNIT` |
5823     -     93 +| **Footer** | "‚òï Support via Ko-fi" OR "üáÆüá≥ Support via UPI" | IP-based smart routing with fallback |
5824     -     94 +| **Footer** | "In India? Use UPI" toggle | Manual override for VPN users |
5825     -     95 +| **Modal Popup** | All 3 options (GitHub Sponsors, Ko-fi, Razorpay) | One-time popup after 5 seconds |
5826     -     96 +
5827     -     97 +### FR-4.2: Support Modal Popup (NEW)
5828     -     98 +
5829     -     99 +| Requirement | Specification |
5830     -    100 +|-------------|---------------|
5831     -    101 +| **Trigger** | 5 seconds after page load |
5832     -    102 +| **Frequency** | One-time only (use localStorage flag) |
5833     -    103 +| **Content** | All 3 donation options |
5834     -    104 +| **Dismissal** | Close button (X) or click outside |
5835     -    105 +| **Persistence** | Remember dismissal in localStorage |
5836     -    106 +
5837     -    107 +**Modal Layout:**
5838     -    108 +```
5839     -    109 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
5840     -    110 +‚îÇ  ‚òï Support Markdown Viewer Pro        [X]  ‚îÇ
5841     -    111 +‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
5842     -    112 +‚îÇ                                             ‚îÇ
5843     -    113 +‚îÇ  If you find this tool useful, consider     ‚îÇ
5844     -    114 +‚îÇ  supporting its development:                ‚îÇ
5845     -    115 +‚îÇ                                             ‚îÇ
5846     -    116 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
5847     -    117 +‚îÇ  ‚îÇ ‚ù§Ô∏è GitHub   ‚îÇ ‚îÇ ‚òï Ko-fi    ‚îÇ           ‚îÇ
5848     -    118 +‚îÇ  ‚îÇ  Sponsors   ‚îÇ ‚îÇ  (Global)   ‚îÇ           ‚îÇ
5849     -    119 +‚îÇ  ‚îÇ   (0% fee)  ‚îÇ ‚îÇ  (PayPal)   ‚îÇ           ‚îÇ
5850     -    120 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
5851     -    121 +‚îÇ                                             ‚îÇ
5852     -    122 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
5853     -    123 +‚îÇ  ‚îÇ üáÆüá≥ Razorpay (UPI/Cards)    ‚îÇ           ‚îÇ
5854     -    124 +‚îÇ  ‚îÇ    For Indian supporters    ‚îÇ           ‚îÇ
5855     -    125 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
5856     -    126 +‚îÇ                                             ‚îÇ
5857     -    127 +‚îÇ  [ ] Don't show this again                  ‚îÇ
5858     -    128 +‚îÇ                                             ‚îÇ
5859     -    129 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
5860     -    130 +```
5861     - 86 131  
5862     - 87 132  ### FR-5: Multi-Platform Support
5863     - 88 133  
5864     -@@ -712,7 +757,8 @@ async function renderSupportButton(container) {
5865     -712 757  |----------|--------|--------|-------|
5866     -713 758  | **P0** | Create Ko-fi account | ‚è≥ Pending | Immediate |
5867     -714 759  | **P0** | Create Razorpay account (KYC) | ‚è≥ Pending | PAN/Aadhaar required |
5868     -715     -| **P0** | Add support button to Web App footer | ‚è≥ Pending | **PRIMARY** |
5869     -    760 +| **P0** | Add GitHub Sponsors button to Web App header | ‚úÖ Complete | **PRIMARY** |
5870     -    761 +| **P0** | Add support button to Web App footer | ‚úÖ Complete | **PRIMARY** |
5871     -716 762  | **P1** | Apply for GitHub Sponsors | ‚è≥ Pending | 2-4 week wait |
5872     -717 763  | **P2** | Add static badges to README.md | ‚è≥ Pending | **SECONDARY** (after GH approval) |
5873     -718 764  | **P3** | IP-based smart routing in web app | ‚è≥ Future | Only with fail-safe pattern |
5874     -@@ -761,14 +807,16 @@ async function renderSupportButton(container) {
5875     -761 807  ‚îÇ                                                                  ‚îÇ
5876     -762 808  ‚îÇ  PHASE 1: WEB APP (PRIMARY) - Immediate                          ‚îÇ
5877     -763 809  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
5878     -764     -‚îÇ  ‚îÇ  Footer Button: "‚òï Support This Project"                  ‚îÇ  ‚îÇ
5879     -    810 +‚îÇ  ‚îÇ  HEADER:                                                   ‚îÇ  ‚îÇ
5880     -    811 +‚îÇ  ‚îÇ  ‚îî‚îÄ GitHub Sponsors button (static link)                  ‚îÇ  ‚îÇ
5881     -765 812  ‚îÇ  ‚îÇ                                                            ‚îÇ  ‚îÇ
5882     -766     -‚îÇ  ‚îÇ  IP Detection (Fail-Safe):                                 ‚îÇ  ‚îÇ
5883     -767     -‚îÇ  ‚îÇ  ‚îú‚îÄ India ‚Üí "üáÆüá≥ Support via UPI" ‚Üí Razorpay              ‚îÇ  ‚îÇ
5884     -768     -‚îÇ  ‚îÇ  ‚îú‚îÄ Others ‚Üí "üåè Support via PayPal" ‚Üí Ko-fi              ‚îÇ  ‚îÇ
5885     -769     -‚îÇ  ‚îÇ  ‚îî‚îÄ Fallback (API fail/timeout) ‚Üí Ko-fi (Global)          ‚îÇ  ‚îÇ
5886     -770     -‚îÇ  ‚îÇ                                                            ‚îÇ  ‚îÇ
5887     -771     -‚îÇ  ‚îÇ  MANDATORY: "Not in India? Click here" toggle              ‚îÇ  ‚îÇ
5888     -    813 +‚îÇ  ‚îÇ  FOOTER:                                                   ‚îÇ  ‚îÇ
5889     -    814 +‚îÇ  ‚îÇ  ‚îú‚îÄ Smart Routing Button: "‚òï Support This Project"        ‚îÇ  ‚îÇ
5890     -    815 +‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ India ‚Üí "üáÆüá≥ Support via UPI" ‚Üí Razorpay          ‚îÇ  ‚îÇ
5891     -    816 +‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Others ‚Üí "üåè Support via Ko-fi" ‚Üí Ko-fi            ‚îÇ  ‚îÇ
5892     -    817 +‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ Fallback (API fail/timeout) ‚Üí Ko-fi (Global)       ‚îÇ  ‚îÇ
5893     -    818 +‚îÇ  ‚îÇ  ‚îÇ                                                         ‚îÇ  ‚îÇ
5894     -    819 +‚îÇ  ‚îÇ  ‚îî‚îÄ Toggle: "In India? Use UPI" (manual override)         ‚îÇ  ‚îÇ
5895     -772 820  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
5896     -773 821  ‚îÇ                                                                  ‚îÇ
5897     -774 822  ‚îÇ  PHASE 2: README (SECONDARY) - After GH Sponsors Approval        ‚îÇ
5898     -775 823  
5899     -
5900     -```
5901     -
5902     -
5903     -### üìÑ `index.html`
5904     -
5905     -**Type:** HTML Template üåê
5906     -
5907     -```diff
5908     -@@ -702,6 +702,42 @@
5909     -702 702        </div>
5910     -703 703      </div>
5911     -704 704  
5912     -    705 +    <!-- Support Modal (One-time popup with all 3 options) -->
5913     -    706 +    <div id="support-modal" class="modal support-modal" role="dialog" aria-modal="true" aria-labelledby="support-modal-title">
5914     -    707 +      <div class="modal-content support-modal-content">
5915     -    708 +        <button class="close-btn" id="close-support-modal" aria-label="Close">&times;</button>
5916     -    709 +        <h2 id="support-modal-title">‚òï Support Markdown Viewer Pro</h2>
5917     -    710 +        <p class="support-modal-desc">If you find this tool useful, consider supporting its development:</p>
5918     -    711 +
5919     -    712 +        <div class="support-options">
5920     -    713 +          <a href="https://github.com/sponsors/PrakharMNNIT?ref=webapp_modal" target="_blank" rel="noopener noreferrer" class="support-option support-option--github">
5921     -    714 +            <span class="support-option-icon">‚ù§Ô∏è</span>
5922     -    715 +            <span class="support-option-title">GitHub Sponsors</span>
5923     -    716 +            <span class="support-option-desc">0% fee ‚Ä¢ For developers</span>
5924     -    717 +          </a>
5925     -    718 +
5926     -    719 +          <a href="https://ko-fi.com/praxlannister?ref=webapp_modal" target="_blank" rel="noopener noreferrer" class="support-option support-option--kofi">
5927     -    720 +            <span class="support-option-icon">‚òï</span>
5928     -    721 +            <span class="support-option-title">Ko-fi</span>
5929     -    722 +            <span class="support-option-desc">PayPal ‚Ä¢ Global</span>
5930     -    723 +          </a>
5931     -    724 +
5932     -    725 +          <a href="https://razorpay.me/@prakharshekharparthasarthi?notes[source]=webapp_modal" target="_blank" rel="noopener noreferrer" class="support-option support-option--razorpay">
5933     -    726 +            <span class="support-option-icon">üáÆüá≥</span>
5934     -    727 +            <span class="support-option-title">Razorpay</span>
5935     -    728 +            <span class="support-option-desc">UPI/Cards ‚Ä¢ India</span>
5936     -    729 +          </a>
5937     -    730 +        </div>
5938     -    731 +
5939     -    732 +        <div class="support-modal-footer">
5940     -    733 +          <label class="dont-show-again">
5941     -    734 +            <input type="checkbox" id="support-dont-show-again" />
5942     -    735 +            <span>Don't show this again</span>
5943     -    736 +          </label>
5944     -    737 +        </div>
5945     -    738 +      </div>
5946     -    739 +    </div>
5947     -    740 +
5948     -705 741      <!-- Main Script -->
5949     -706 742      <script type="module" src="script.js"></script>
5950     -707 743    </body>
5951     -708 744  
5952     -
5953     -```
     15 +## üìù Files Changed (3/3 selected)
5954  16  
5955  17  
5956  18  ### üìÑ `script.js`
@@ -5958,228 +20,916 @@ AI_REVIEW.md                                  | 5746 ++++++++++++++++---------
5958  20  **Type:** JavaScript Source File üü®
5959  21  
5960  22  ```diff
5961     -@@ -354,6 +354,81 @@ function initializeApp() {
5962     -354 354  
5963     -355 355    // Initialize support widget (donation button in footer)
5964     -356 356    initSupportWidget();
5965     -    357 +
5966     -    358 +  // Initialize support modal (one-time popup)
5967     -    359 +  initSupportModal();
5968     -    360 +}
5969     -    361 +
5970     -    362 +// ==================== SUPPORT MODAL (ONE-TIME POPUP) ====================
5971     -    363 +const SUPPORT_MODAL_SHOWN_KEY = 'support_modal_shown';
5972     -    364 +const SUPPORT_MODAL_DELAY_MS = 5000; // 5 seconds
5973     -    365 +
5974     -    366 +/**
5975     -    367 + * Initialize support modal - shows once after 5 seconds
5976     -    368 + */
5977     -    369 +function initSupportModal() {
5978     -    370 +  const modal = document.getElementById('support-modal');
5979     -    371 +  const closeBtn = document.getElementById('close-support-modal');
5980     -    372 +  const dontShowAgainCheckbox = document.getElementById('support-dont-show-again');
5981     -    373 +
5982     -    374 +  if (!modal || !closeBtn) {
5983     -    375 +    console.warn('[SupportModal] Modal elements not found');
5984     -    376 +    return;
5985     -    377 +  }
5986     -    378 +
5987     -    379 +  // Check if already shown before
5988     -    380 +  const alreadyShown = localStorage.getItem(SUPPORT_MODAL_SHOWN_KEY);
5989     -    381 +  if (alreadyShown === 'true') {
5990     -    382 +    console.log('[SupportModal] Already shown before, skipping');
5991     -    383 +    return;
5992     -    384 +  }
5993     -    385 +
5994     -    386 +  // Show modal after delay
5995     -    387 +  setTimeout(() => {
5996     -    388 +    modal.classList.add('active');
5997     -    389 +    console.log('[SupportModal] Showing support modal');
5998     -    390 +  }, SUPPORT_MODAL_DELAY_MS);
5999     -    391 +
6000     -    392 +  // Close button handler
6001     -    393 +  closeBtn.addEventListener('click', () => {
6002     -    394 +    closeSupportModal(modal, dontShowAgainCheckbox);
6003     -    395 +  });
6004     -    396 +
6005     -    397 +  // Click outside to close
6006     -    398 +  modal.addEventListener('click', (e) => {
6007     -    399 +    if (e.target === modal) {
6008     -    400 +      closeSupportModal(modal, dontShowAgainCheckbox);
6009     -    401 +    }
6010     -    402 +  });
6011     -    403 +
6012     -    404 +  // Escape key to close
6013     -    405 +  document.addEventListener('keydown', (e) => {
6014     -    406 +    if (e.key === 'Escape' && modal.classList.contains('active')) {
6015     -    407 +      closeSupportModal(modal, dontShowAgainCheckbox);
6016     -    408 +    }
6017     -    409 +  });
6018     -    410 +
6019     -    411 +  // Track clicks on support options
6020     -    412 +  modal.querySelectorAll('.support-option').forEach(option => {
6021     -    413 +    option.addEventListener('click', () => {
6022     -    414 +      // Mark as shown when user clicks a support option
6023     -    415 +      localStorage.setItem(SUPPORT_MODAL_SHOWN_KEY, 'true');
6024     -    416 +      console.log('[SupportModal] User clicked support option, marking as shown');
6025     -    417 +    });
6026     -    418 +  });
6027     -    419 +}
6028     -    420 +
6029     -    421 +/**
6030     -    422 + * Close the support modal
6031     -    423 + */
6032     -    424 +function closeSupportModal(modal, checkbox) {
6033     -    425 +  modal.classList.remove('active');
6034     -    426 +
6035     -    427 +  // If "Don't show again" is checked, remember it
6036     -    428 +  if (checkbox && checkbox.checked) {
6037     -    429 +    localStorage.setItem(SUPPORT_MODAL_SHOWN_KEY, 'true');
6038     -    430 +    console.log('[SupportModal] User opted out of future modals');
6039     -    431 +  }
6040     -357 432  }
6041     -358 433  
6042     -359 434  // ==================== SUPPORT WIDGET (DONATION ROUTER) ====================
6043     -360 435  
     23 +@@ -17,6 +17,7 @@ import { StorageManager } from './src/js/core/StorageManager.js';
     24 + 17  17  import { ThemeManager } from './src/js/core/ThemeManager.js';
     25 + 18  18  import { FolderBrowserService } from './src/js/services/FolderBrowserService.js';
     26 + 19  19  import { HTMLService } from './src/js/services/HTMLService.js';
     27 +     20 +import { LinkNavigationService } from './src/js/services/LinkNavigationService.js';
     28 + 20  21  import { MermaidService } from './src/js/services/MermaidService.js';
     29 + 21  22  import { PDFService } from './src/js/services/PDFService.js';
     30 + 22  23  import { PrismService } from './src/js/services/PrismService.js';
     31 +@@ -236,11 +237,13 @@ const AnchorNavigation = {
     32 +236 237        slug = slug.replace(pattern, replacement);
     33 +237 238      }
     34 +238 239  
     35 +239     -    return slug
     36 +240     -      .replace(/[^\w\s-]/g, '')
     37 +241     -      .replace(/\s+/g, '-')
     38 +242     -      .replace(/-+/g, '-')
     39 +243     -      .replace(/^-+|-+$/g, '') || 'section';
     40 +    240 +    return (
     41 +    241 +      slug
     42 +    242 +        .replace(/[^\w\s-]/g, '')
     43 +    243 +        .replace(/\s+/g, '-')
     44 +    244 +        .replace(/-+/g, '-')
     45 +    245 +        .replace(/^-+|-+$/g, '') || 'section'
     46 +    246 +    );
     47 +244 247    },
     48 +245 248  
     49 +246 249    /**
     50 +@@ -251,12 +254,14 @@ const AnchorNavigation = {
     51 +251 254    normalizeHashGitHub(hash) {
     52 +252 255      // GitHub algorithm: lowercase, remove non-alphanumeric except hyphens
     53 +253 256      // Does NOT collapse multiple hyphens, does NOT replace C++ with cpp
     54 +254     -    return hash
     55 +255     -      .normalize('NFC')
     56 +256     -      .toLowerCase()
     57 +257     -      .replace(/[^\w\s-]/g, '')
     58 +258     -      .replace(/\s+/g, '-')
     59 +259     -      .replace(/^-+|-+$/g, '') || 'section';
     60 +    257 +    return (
     61 +    258 +      hash
     62 +    259 +        .normalize('NFC')
     63 +    260 +        .toLowerCase()
     64 +    261 +        .replace(/[^\w\s-]/g, '')
     65 +    262 +        .replace(/\s+/g, '-')
     66 +    263 +        .replace(/^-+|-+$/g, '') || 'section'
     67 +    264 +    );
     68 +260 265    },
     69 +261 266  
     70 +262 267    /**
     71 +@@ -265,7 +270,9 @@ const AnchorNavigation = {
     72 +265 270     * @returns {Element|null} Matching heading or null
     73 +266 271     */
     74 +267 272    fuzzyMatchHeading(hash) {
     75 +268     -    const headings = this.container.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]');
     76 +    273 +    const headings = this.container.querySelectorAll(
     77 +    274 +      'h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]'
     78 +    275 +    );
     79 +269 276      const normalizedSearch = hash.toLowerCase().replace(/[^\w]/g, '');
     80 +270 277  
     81 +271 278      for (const heading of headings) {
     82 +@@ -319,6 +326,9 @@ const pdfService = new PDFService();
     83 +319 326  const htmlService = new HTMLService();
     84 +320 327  const folderBrowserService = new FolderBrowserService(storageManager);
     85 +321 328  
     86 +    329 +// Link navigation service (callback will be wired in setupEditor)
     87 +    330 +let linkNavigationService = null;
     88 +    331 +
     89 +322 332  // Folder browser state (these are managed within setupEditor scope)
     90 +323 333  const _currentFolderFiles = [];
     91 +324 334  const _currentFileHandle = null;
     92 +@@ -395,14 +405,14 @@ function initSupportModal() {
     93 +395 405    });
     94 +396 406  
     95 +397 407    // Click outside to close
     96 +398     -  modal.addEventListener('click', (e) => {
     97 +    408 +  modal.addEventListener('click', e => {
     98 +399 409      if (e.target === modal) {
     99 +400 410        closeSupportModal(modal, dontShowAgainCheckbox);
    100 +401 411      }
    101 +402 412    });
    102 +403 413  
    103 +404 414    // Escape key to close
    104 +405     -  document.addEventListener('keydown', (e) => {
    105 +    415 +  document.addEventListener('keydown', e => {
    106 +406 416      if (e.key === 'Escape' && modal.classList.contains('active')) {
    107 +407 417        closeSupportModal(modal, dontShowAgainCheckbox);
    108 +408 418      }
    109 +@@ -473,7 +483,10 @@ async function detectSupportRegion() {
    110 +473 483      return region;
    111 +474 484    } catch (error) {
    112 +475 485      // 4. Fail open - silent fail to global
    113 +476     -    console.warn('[SupportWidget] Geo-lookup failed/timed-out, defaulting to Global.', error.message);
    114 +    486 +    console.warn(
    115 +    487 +      '[SupportWidget] Geo-lookup failed/timed-out, defaulting to Global.',
    116 +    488 +      error.message
    117 +    489 +    );
    118 +477 490      return SUPPORT_FALLBACK_REGION;
    119 +478 491    }
    120 +479 492  }
    121 +@@ -500,19 +513,20 @@ function renderSupportWidget(region) {
    122 +500 513    const container = document.getElementById('support-widget');
    123 +501 514    if (!container) return;
    124 +502 515  
    125 +503     -  const config = region === 'india'
    126 +504     -    ? {
    127 +505     -      text: 'üáÆüá≥ Support via UPI',
    128 +506     -      url: 'https://razorpay.me/@prakharshekharparthasarthi?notes[source]=webapp_footer',
    129 +507     -      className: 'support-button--india',
    130 +508     -      toggleText: 'Not in India?',
    131 +509     -    }
    132 +510     -    : {
    133 +511     -      text: '‚òï Support via Ko-fi',
    134 +512     -      url: 'https://ko-fi.com/praxlannister?ref=webapp_footer',
    135 +513     -      className: 'support-button--global',
    136 +514     -      toggleText: 'In India? Use UPI',
    137 +515     -    };
    138 +    516 +  const config =
    139 +    517 +    region === 'india'
    140 +    518 +      ? {
    141 +    519 +        text: 'üáÆüá≥ Support via UPI',
    142 +    520 +        url: 'https://razorpay.me/@prakharshekharparthasarthi?notes[source]=webapp_footer',
    143 +    521 +        className: 'support-button--india',
    144 +    522 +        toggleText: 'Not in India?',
    145 +    523 +      }
    146 +    524 +      : {
    147 +    525 +        text: '‚òï Support via Ko-fi',
    148 +    526 +        url: 'https://ko-fi.com/praxlannister?ref=webapp_footer',
    149 +    527 +        className: 'support-button--global',
    150 +    528 +        toggleText: 'In India? Use UPI',
    151 +    529 +      };
    152 +516 530  
    153 +517 531    container.innerHTML = `
    154 +518 532      <a href="${config.url}" target="_blank" rel="noopener noreferrer" class="support-button ${config.className}">
    155 +@@ -575,7 +589,7 @@ function configureMarkedExtensions() {
    156 +575 589          },
    157 +576 590          tokenizer(src) {
    158 +577 591            const match = src.match(
    159 +578     -            /^> \[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\s*\n((?:> .*\n?)*)/,
    160 +    592 +            /^> \[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\s*\n((?:> .*\n?)*)/
    161 +579 593            );
    162 +580 594            if (match) {
    163 +581 595              const type = match[1];
    164 +@@ -645,18 +659,15 @@ function configureMarkedExtensions() {
    165 +645 659          },
    166 +646 660          renderer(token) {
    167 +647 661            try {
    168 +648     -            return (
    169 +649     -              `<div style="margin: 1.5em 0;">${katex.renderToString(token.text, {
    170 +650     -                displayMode: true,
    171 +651     -                throwOnError: false,
    172 +652     -                output: 'html',
    173 +653     -                trust: true, // Allow custom styling
    174 +654     -                macros: {
    175 +655     -                  '\\label': '\\phantom', // Hide \label
    176 +656     -                },
    177 +657     -              })
    178 +658     -              }</div>`
    179 +659     -            );
    180 +    662 +            return `<div style="margin: 1.5em 0;">${katex.renderToString(token.text, {
    181 +    663 +              displayMode: true,
    182 +    664 +              throwOnError: false,
    183 +    665 +              output: 'html',
    184 +    666 +              trust: true, // Allow custom styling
    185 +    667 +              macros: {
    186 +    668 +                '\\label': '\\phantom', // Hide \label
    187 +    669 +              },
    188 +    670 +            })}</div>`;
    189 +660 671            } catch (e) {
    190 +661 672              console.warn('KaTeX display math error:', e);
    191 +662 673              return `<div style="color: red; padding: 10px;">Math Error: ${e.message}</div>`;
    192 +@@ -692,21 +703,18 @@ function configureMarkedExtensions() {
    193 +692 703          },
    194 +693 704          renderer(token) {
    195 +694 705            try {
    196 +695     -            return (
    197 +696     -              `<div style="margin: 1.5em 0;">${katex.renderToString(token.text, {
    198 +697     -                displayMode: true,
    199 +698     -                throwOnError: false,
    200 +699     -                output: 'html',
    201 +700     -                trust: true,
    202 +701     -                macros: {
    203 +702     -                  '\\label': '\\phantom', // Hide \label
    204 +703     -                  '\\eqref': '\\text', // Plain text for refs (or link if needed)
    205 +704     -                  '\\cite': '\\text',
    206 +705     -                  '\\ref': '\\text',
    207 +706     -                },
    208 +707     -              })
    209 +708     -              }</div>`
    210 +709     -            );
    211 +    706 +            return `<div style="margin: 1.5em 0;">${katex.renderToString(token.text, {
    212 +    707 +              displayMode: true,
    213 +    708 +              throwOnError: false,
    214 +    709 +              output: 'html',
    215 +    710 +              trust: true,
    216 +    711 +              macros: {
    217 +    712 +                '\\label': '\\phantom', // Hide \label
    218 +    713 +                '\\eqref': '\\text', // Plain text for refs (or link if needed)
    219 +    714 +                '\\cite': '\\text',
    220 +    715 +                '\\ref': '\\text',
    221 +    716 +              },
    222 +    717 +            })}</div>`;
    223 +710 718            } catch (e) {
    224 +711 719              console.warn('KaTeX environment error:', e);
    225 +712 720              return `<div style="color: red;">LaTeX Error: ${e.message}</div>`;
    226 +@@ -839,10 +847,40 @@ function configureMarkedExtensions() {
    227 +839 847          const level = token.depth;
    228 +840 848          const slug = generateSlug(text, headingSlugMap);
    229 +841 849          return `<h${level} id="${slug}">${text}</h${level}>\n`;
    230 +842     -      }
    231 +843     -    }
    232 +    850 +      },
    233 +    851 +      link(token) {
    234 +    852 +        // Extract properties from token object (marked.js v12+ API)
    235 +    853 +        const href = token.href;
    236 +    854 +        const title = token.title;
    237 +    855 +        const text = token.text;
    238 +    856 +
    239 +    857 +        // Defensive: only catch truly broken cases (null/undefined)
    240 +    858 +        if (href == null) {
    241 +    859 +          return `<a>${text}</a>`;
    242 +    860 +        }
    243 +    861 +
    244 +    862 +        // Anchor links - unchanged
    245 +    863 +        if (href.startsWith('#')) {
    246 +    864 +          return `<a href="${href}" title="${title || ''}">${text}</a>`;
    247 +    865 +        }
    248 +    866 +
    249 +    867 +        // External links - open in new tab
    250 +    868 +        if (/^https?:\/\//.test(href) || /^\/\//.test(href)) {
    251 +    869 +          return `<a href="${href}" target="_blank" rel="noopener noreferrer" title="${title || ''}">${text}</a>`;
    252 +    870 +        }
    253 +    871 +
    254 +    872 +        // Relative markdown file links - add class and data attribute for router
    255 +    873 +        if (href.endsWith('.md')) {
    256 +    874 +          return `<a href="${href}" class="md-link" data-md-path="${href}" title="${title || ''}">${text}</a>`;
    257 +    875 +        }
    258 +    876 +
    259 +    877 +        // Default - regular link
    260 +    878 +        return `<a href="${href}" title="${title || ''}">${text}</a>`;
    261 +    879 +      },
    262 +    880 +    },
    263 +844 881    });
    264 +845 882    console.log('‚úÖ Custom heading renderer enabled (anchor navigation IDs)');
    265 +    883 +  console.log('‚úÖ Custom link renderer enabled (markdown file navigation)');
    266 +846 884  }
    267 +847 885  
    268 +848 886  // Initialize Mermaid using MermaidService (prefixed to indicate future use)
    269 +@@ -1051,7 +1089,7 @@ graph TD
    270 +1051 1089            const id = `mermaid-${Math.random().toString(36).substr(2, 9)}`;
    271 +1052 1090            // Return placeholder div
    272 +1053 1091            return `<div class="mermaid-diagram" id="${id}" data-code="${encodeURIComponent(decodedCode)}">${code}</div>`;
    273 +1054     -        },
    274 +    1092 +        }
    275 +1055 1093        );
    276 +1056 1094  
    277 +1057 1095        // Sanitize HTML using DOMPurify
    278 +@@ -1101,8 +1139,7 @@ graph TD
    279 +1101 1139        storageManager.set('markdownContent', markdownText);
    280 +1102 1140      } catch (error) {
    281 +1103 1141        console.error('Render error:', error);
    282 +1104     -      preview.innerHTML =
    283 +1105     -        `<p style="color: red;">Error rendering markdown: ${error.message}</p>`;
    284 +    1142 +      preview.innerHTML = `<p style="color: red;">Error rendering markdown: ${error.message}</p>`;
    285 +1106 1143      }
    286 +1107 1144    }
    287 +1108 1145  
    288 +@@ -1361,7 +1398,9 @@ graph TD
    289 +1361 1398  
    290 +1362 1399    // Apply split ratio to containers
    291 +1363 1400    function applySplitRatio() {
    292 +1364     -    if (!mainContent.classList.contains('split-view-active')) { return; }
    293 +    1401 +    if (!mainContent.classList.contains('split-view-active')) {
    294 +    1402 +      return;
    295 +    1403 +    }
    296 +1365 1404  
    297 +1366 1405      const mainContentWidth = mainContent.offsetWidth;
    298 +1367 1406      const sidebarWidth = document.getElementById('file-browser').offsetWidth || 0;
    299 +@@ -1386,8 +1425,10 @@ graph TD
    300 +1386 1425  
    301 +1387 1426    // Split resizer drag handlers
    302 +1388 1427    if (splitResizer) {
    303 +1389     -    splitResizer.addEventListener('mousedown', (e) => {
    304 +1390     -      if (!mainContent.classList.contains('split-view-active')) { return; }
    305 +    1428 +    splitResizer.addEventListener('mousedown', e => {
    306 +    1429 +      if (!mainContent.classList.contains('split-view-active')) {
    307 +    1430 +        return;
    308 +    1431 +      }
    309 +1391 1432  
    310 +1392 1433        isSplitResizing = true;
    311 +1393 1434        splitResizer.classList.add('dragging');
    312 +@@ -1397,8 +1438,10 @@ graph TD
    313 +1397 1438      });
    314 +1398 1439    }
    315 +1399 1440  
    316 +1400     -  document.addEventListener('mousemove', (e) => {
    317 +1401     -    if (!isSplitResizing) { return; }
    318 +    1441 +  document.addEventListener('mousemove', e => {
    319 +    1442 +    if (!isSplitResizing) {
    320 +    1443 +      return;
    321 +    1444 +    }
    322 +1402 1445  
    323 +1403 1446      const mainContentRect = mainContent.getBoundingClientRect();
    324 +1404 1447      const sidebarWidth = document.getElementById('file-browser').offsetWidth || 0;
    325 +@@ -1516,7 +1559,9 @@ graph TD
    326 +1516 1559  
    327 +1517 1560    // Editor scroll handler with smooth sync
    328 +1518 1561    editor.addEventListener('scroll', () => {
    329 +1519     -    if (!syncScrollEnabled || syncScrolling) { return; }
    330 +    1562 +    if (!syncScrollEnabled || syncScrolling) {
    331 +    1563 +      return;
    332 +    1564 +    }
    333 +1520 1565  
    334 +1521 1566      syncScrolling = true;
    335 +1522 1567  
    336 +@@ -1545,7 +1590,9 @@ graph TD
    337 +1545 1590  
    338 +1546 1591    // Preview container scroll handler with smooth sync
    339 +1547 1592    previewContainer.addEventListener('scroll', () => {
    340 +1548     -    if (!syncScrollEnabled || syncScrolling) { return; }
    341 +    1593 +    if (!syncScrollEnabled || syncScrolling) {
    342 +    1594 +      return;
    343 +    1595 +    }
    344 +1549 1596  
    345 +1550 1597      syncScrolling = true;
    346 +1551 1598  
    347 +@@ -1653,11 +1700,14 @@ graph TD
    348 +1653 1700    initializeMobileView();
    349 +1654 1701  
    350 +1655 1702    // Re-initialize on window resize
    351 +1656     -  window.addEventListener('resize', debounce(() => {
    352 +1657     -    if (isMobileView()) {
    353 +1658     -      initializeMobileView();
    354 +1659     -    }
    355 +1660     -  }, 250));
    356 +    1703 +  window.addEventListener(
    357 +    1704 +    'resize',
    358 +    1705 +    debounce(() => {
    359 +    1706 +      if (isMobileView()) {
    360 +    1707 +        initializeMobileView();
    361 +    1708 +      }
    362 +    1709 +    }, 250)
    363 +    1710 +  );
    364 +1661 1711  
    365 +1662 1712    // Initialize visibility
    366 +1663 1713  
    367 +@@ -1814,7 +1864,7 @@ graph TD
    368 +1814 1864    }
    369 +1815 1865  
    370 +1816 1866    // Escape key to exit Zen Mode
    371 +1817     -  document.addEventListener('keydown', (e) => {
    372 +    1867 +  document.addEventListener('keydown', e => {
    373 +1818 1868      if (e.key === 'Escape' && document.body.classList.contains('zen-mode')) {
    374 +1819 1869        toggleZenMode();
    375 +1820 1870      }
    376 +@@ -1851,7 +1901,9 @@ graph TD
    377 +1851 1901    });
    378 +1852 1902  
    379 +1853 1903    document.addEventListener('mousemove', e => {
    380 +1854     -    if (!isResizing) { return; }
    381 +    1904 +    if (!isResizing) {
    382 +    1905 +      return;
    383 +    1906 +    }
    384 +1855 1907  
    385 +1856 1908      const newWidth = e.clientX;
    386 +1857 1909  
    387 +@@ -1913,7 +1965,7 @@ graph TD
    388 +1913 1965        alert(
    389 +1914 1966          'Folder browsing requires File System Access API.\n\n' +
    390 +1915 1967          'Please use Chrome 86+ or Edge 86+.\n\n' +
    391 +1916     -        'Firefox and Safari are not currently supported.',
    392 +    1968 +        'Firefox and Safari are not currently supported.'
    393 +1917 1969        );
    394 +1918 1970        return;
    395 +1919 1971      }
    396 +@@ -1943,6 +1995,11 @@ graph TD
    397 +1943 1995      // Render tree
    398 +1944 1996      renderFileTree(result.files);
    399 +1945 1997  
    400 +    1998 +    // Build file cache for link navigation
    401 +    1999 +    if (linkNavigationService && folderBrowserService.currentDirectoryHandle) {
    402 +    2000 +      await linkNavigationService.buildFileCache(folderBrowserService.currentDirectoryHandle);
    403 +    2001 +    }
    404 +    2002 +
    405 +1946 2003      // Update expand button visibility
    406 +1947 2004      updateExpandButtonVisibility();
    407 +1948 2005  
    408 +@@ -2152,14 +2209,14 @@ Wrap up your thoughts and include a call to action.
    409 +2152 2209      createFileModal.classList.remove('active');
    410 +2153 2210    });
    411 +2154 2211  
    412 +2155     -  createFileModal.addEventListener('click', (e) => {
    413 +    2212 +  createFileModal.addEventListener('click', e => {
    414 +2156 2213      if (e.target === createFileModal) {
    415 +2157 2214        createFileModal.classList.remove('active');
    416 +2158 2215      }
    417 +2159 2216    });
    418 +2160 2217  
    419 +2161 2218    // Handle Enter key in filename input
    420 +2162     -  newFileNameInput.addEventListener('keydown', (e) => {
    421 +    2219 +  newFileNameInput.addEventListener('keydown', e => {
    422 +2163 2220      if (e.key === 'Enter') {
    423 +2164 2221        e.preventDefault();
    424 +2165 2222        confirmCreateFileBtn.click();
    425 +@@ -2472,6 +2529,11 @@ Wrap up your thoughts and include a call to action.
    426 +2472 2529      // Mark as active file
    427 +2473 2530      activeFileHandle = fileItem.handle;
    428 +2474 2531  
    429 +    2532 +    // Update link navigation context with current file path
    430 +    2533 +    if (linkNavigationService && fileItem.path) {
    431 +    2534 +      linkNavigationService.setCurrentFile(fileItem.path);
    432 +    2535 +    }
    433 +    2536 +
    434 +2475 2537      // Re-render tree to update active state
    435 +2476 2538      renderFileTree(folderFiles);
    436 +2477 2539  
    437 +@@ -2490,6 +2552,29 @@ Wrap up your thoughts and include a call to action.
    438 +2490 2552    // Initialize anchor navigation for TOC links
    439 +2491 2553    AnchorNavigation.init(previewContainer);
    440 +2492 2554  
    441 +    2555 +  // Initialize Link Navigation Service
    442 +    2556 +  linkNavigationService = new LinkNavigationService(folderBrowserService, fileData => {
    443 +    2557 +    // Callback when file should be loaded from link navigation
    444 +    2558 +    editor.value = fileData.content;
    445 +    2559 +    renderMarkdown();
    446 +    2560 +
    447 +    2561 +    // Highlight file in tree if possible
    448 +    2562 +    const fileItems = document.querySelectorAll('.file-item');
    449 +    2563 +    fileItems.forEach(item => {
    450 +    2564 +      if (item.dataset.name === fileData.name) {
    451 +    2565 +        item.classList.add('active');
    452 +    2566 +      } else {
    453 +    2567 +        item.classList.remove('active');
    454 +    2568 +      }
    455 +    2569 +    });
    456 +    2570 +
    457 +    2571 +    console.log(`[App] Loaded from link: ${fileData.path}`);
    458 +    2572 +  });
    459 +    2573 +
    460 +    2574 +  // Initialize link interceptor on preview container
    461 +    2575 +  const markdownPreview = document.getElementById('markdown-preview');
    462 +    2576 +  linkNavigationService.initialize(markdownPreview);
    463 +    2577 +
    464 +2493 2578    // DON'T render immediately - wait for theme to load
    465 +2494 2579    // renderMarkdown will be called after theme loads above
    466 +2495 2580  }
    467 +2496 2581  
6044 468  
6045 469  ```
6046 470  
6047 471  
6048     -### üìÑ `style.css`
    472 +### ‚ú® `src/js/services/LinkNavigationService.js` **[ADDED]**
6049 473  
6050     -**Type:** Stylesheet üé®
    474 +**Status:** ‚úÖ **NEW FILE** - This file has been newly created
    475 +
    476 +**Type:** JavaScript Source File üü®
6051 477  
6052 478  ```diff
6053     -@@ -2045,6 +2045,128 @@ body {
6054     -2045 2045    color: white;
6055     -2046 2046  }
6056     -2047 2047  
6057     -    2048 +/* ==================== SUPPORT MODAL ==================== */
6058     -    2049 +.support-modal .modal-content {
6059     -    2050 +  max-width: 420px;
6060     -    2051 +  text-align: center;
6061     -    2052 +  padding: 32px 24px;
6062     -    2053 +}
6063     -    2054 +
6064     -    2055 +.support-modal h2 {
6065     -    2056 +  margin: 0 0 8px 0;
6066     -    2057 +  font-size: 24px;
6067     -    2058 +  color: var(--h1-color);
6068     -    2059 +}
6069     -    2060 +
6070     -    2061 +.support-modal-desc {
6071     -    2062 +  color: var(--text-secondary);
6072     -    2063 +  font-size: 14px;
6073     -    2064 +  margin: 0 0 24px 0;
6074     -    2065 +  line-height: 1.5;
6075     -    2066 +}
6076     -    2067 +
6077     -    2068 +.support-options {
6078     -    2069 +  display: flex;
6079     -    2070 +  flex-direction: column;
6080     -    2071 +  gap: 12px;
6081     -    2072 +  margin-bottom: 20px;
6082     -    2073 +}
6083     -    2074 +
6084     -    2075 +.support-option {
6085     -    2076 +  display: flex;
6086     -    2077 +  align-items: center;
6087     -    2078 +  gap: 12px;
6088     -    2079 +  padding: 14px 18px;
6089     -    2080 +  border-radius: 12px;
6090     -    2081 +  text-decoration: none;
6091     -    2082 +  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
6092     -    2083 +  border: 2px solid transparent;
6093     -    2084 +}
6094     -    2085 +
6095     -    2086 +.support-option:hover {
6096     -    2087 +  transform: translateY(-2px);
6097     -    2088 +  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
6098     -    2089 +  text-decoration: none;
6099     -    2090 +}
6100     -    2091 +
6101     -    2092 +.support-option-icon {
6102     -    2093 +  font-size: 24px;
6103     -    2094 +  flex-shrink: 0;
6104     -    2095 +}
6105     -    2096 +
6106     -    2097 +.support-option-title {
6107     -    2098 +  font-weight: 600;
6108     -    2099 +  font-size: 15px;
6109     -    2100 +  display: block;
6110     -    2101 +}
6111     -    2102 +
6112     -    2103 +.support-option-desc {
6113     -    2104 +  font-size: 12px;
6114     -    2105 +  opacity: 0.8;
6115     -    2106 +  display: block;
6116     -    2107 +}
6117     -    2108 +
6118     -    2109 +/* GitHub Sponsors option */
6119     -    2110 +.support-option--github {
6120     -    2111 +  background: linear-gradient(135deg, #ea4aaa 0%, #db61a2 100%);
6121     -    2112 +  color: white;
6122     -    2113 +}
6123     -    2114 +
6124     -    2115 +.support-option--github:hover {
6125     -    2116 +  background: linear-gradient(135deg, #f472b6 0%, #ec4899 100%);
6126     -    2117 +  border-color: rgba(255, 255, 255, 0.3);
6127     -    2118 +  color: white;
6128     -    2119 +}
6129     -    2120 +
6130     -    2121 +/* Ko-fi option */
6131     -    2122 +.support-option--kofi {
6132     -    2123 +  background: linear-gradient(135deg, #29ABE0 0%, #1E88E5 100%);
6133     -    2124 +  color: white;
6134     -    2125 +}
6135     -    2126 +
6136     -    2127 +.support-option--kofi:hover {
6137     -    2128 +  background: linear-gradient(135deg, #4FC3F7 0%, #42A5F5 100%);
6138     -    2129 +  border-color: rgba(255, 255, 255, 0.3);
6139     -    2130 +  color: white;
6140     -    2131 +}
6141     -    2132 +
6142     -    2133 +/* Razorpay option */
6143     -    2134 +.support-option--razorpay {
6144     -    2135 +  background: linear-gradient(135deg, #FF9933 0%, #FF6B00 100%);
6145     -    2136 +  color: white;
6146     -    2137 +}
6147     -    2138 +
6148     -    2139 +.support-option--razorpay:hover {
6149     -    2140 +  background: linear-gradient(135deg, #FFB366 0%, #FF8533 100%);
6150     -    2141 +  border-color: rgba(255, 255, 255, 0.3);
6151     -    2142 +  color: white;
6152     -    2143 +}
6153     -    2144 +
6154     -    2145 +.support-modal-footer {
6155     -    2146 +  padding-top: 16px;
6156     -    2147 +  border-top: 1px solid var(--border-color);
6157     -    2148 +}
6158     -    2149 +
6159     -    2150 +.dont-show-again {
6160     -    2151 +  display: inline-flex;
6161     -    2152 +  align-items: center;
6162     -    2153 +  gap: 8px;
6163     -    2154 +  cursor: pointer;
6164     -    2155 +  font-size: 13px;
6165     -    2156 +  color: var(--text-secondary);
6166     -    2157 +  user-select: none;
6167     -    2158 +}
6168     -    2159 +
6169     -    2160 +.dont-show-again input[type="checkbox"] {
6170     -    2161 +  width: 16px;
6171     -    2162 +  height: 16px;
6172     -    2163 +  cursor: pointer;
6173     -    2164 +}
6174     -    2165 +
6175     -    2166 +.dont-show-again:hover {
6176     -    2167 +  color: var(--text-primary);
6177     -    2168 +}
6178     -    2169 +
6179     -2048 2170  /* ==================== ZEN MODE ==================== */
6180     -2049 2171  /* Zen Mode: Focused reading mode showing ONLY the preview */
6181     -2050 2172  body.zen-mode {
6182     -2051 2173  
    479 +@@ -0,0 +1,300 @@
    480 +      1 +/**
    481 +      2 + * @file LinkNavigationService.js
    482 +      3 + * @description Intelligent markdown link navigation with File System Access API integration
    483 +      4 + * @module services/LinkNavigationService
    484 +      5 + */
    485 +      6 +
    486 +      7 +import {
    487 +      8 +  isAnchorLink,
    488 +      9 +  isExternalUrl,
    489 +     10 +  isMarkdownFile,
    490 +     11 +  normalizePath,
    491 +     12 +  resolveRelativePath
    492 +     13 +} from '../utils/pathHelpers.js';
    493 +     14 +
    494 +     15 +/**
    495 +     16 + * @class LinkNavigationService
    496 +     17 + * @description Handles intelligent routing of markdown links within folder browser context
    497 +     18 + */
    498 +     19 +export class LinkNavigationService {
    499 +     20 +  /**
    500 +     21 +   * @constructor
    501 +     22 +   * @param {Object} folderBrowserService - FolderBrowserService instance
    502 +     23 +   * @param {Function} onNavigate - Callback when file should be loaded
    503 +     24 +   */
    504 +     25 +  constructor(folderBrowserService, onNavigate) {
    505 +     26 +    this.folderService = folderBrowserService;
    506 +     27 +    this.onNavigate = onNavigate;
    507 +     28 +
    508 +     29 +    // File handle cache: normalized_path -> FileSystemFileHandle
    509 +     30 +    this.fileHandleCache = new Map();
    510 +     31 +
    511 +     32 +    // Current file context
    512 +     33 +    this.currentFilePath = '';
    513 +     34 +    this.currentFolderHandle = null;
    514 +     35 +
    515 +     36 +    // Breadcrumb navigation stack
    516 +     37 +    this.navigationHistory = [];
    517 +     38 +  }
    518 +     39 +
    519 +     40 +  /**
    520 +     41 +   * Initialize link interceptor on preview container
    521 +     42 +   * @param {HTMLElement} previewContainer - Preview container element
    522 +     43 +   */
    523 +     44 +  initialize(previewContainer) {
    524 +     45 +    if (!previewContainer) {
    525 +     46 +      console.error('[LinkNav] Preview container not found');
    526 +     47 +      return;
    527 +     48 +    }
    528 +     49 +
    529 +     50 +    // Event delegation for link clicks
    530 +     51 +    previewContainer.addEventListener('click', this.handleLinkClick.bind(this));
    531 +     52 +
    532 +     53 +    console.log('‚úÖ Link navigation initialized');
    533 +     54 +  }
    534 +     55 +
    535 +     56 +  /**
    536 +     57 +   * Build file handle cache from folder structure
    537 +     58 +   * @param {FileSystemDirectoryHandle} dirHandle - Root directory handle
    538 +     59 +   * @param {string} basePath - Base path for recursion
    539 +     60 +   */
    540 +     61 +  async buildFileCache(dirHandle, basePath = '') {
    541 +     62 +    if (!dirHandle) return;
    542 +     63 +
    543 +     64 +    this.currentFolderHandle = dirHandle;
    544 +     65 +    this.fileHandleCache.clear();
    545 +     66 +
    546 +     67 +    try {
    547 +     68 +      await this._recursiveCacheBuild(dirHandle, basePath);
    548 +     69 +      console.log(`[LinkNav] Cached ${this.fileHandleCache.size} markdown files`);
    549 +     70 +    } catch (error) {
    550 +     71 +      console.error('[LinkNav] Cache build failed:', error);
    551 +     72 +    }
    552 +     73 +  }
    553 +     74 +
    554 +     75 +  /**
    555 +     76 +   * Recursive cache building
    556 +     77 +   * @private
    557 +     78 +   */
    558 +     79 +  async _recursiveCacheBuild(dirHandle, basePath) {
    559 +     80 +    for await (const entry of dirHandle.values()) {
    560 +     81 +      const fullPath = basePath ? `${basePath}/${entry.name}` : entry.name;
    561 +     82 +      const normalized = normalizePath(fullPath);
    562 +     83 +
    563 +     84 +      if (entry.kind === 'file' && isMarkdownFile(entry.name)) {
    564 +     85 +        this.fileHandleCache.set(normalized, entry);
    565 +     86 +      } else if (entry.kind === 'directory') {
    566 +     87 +        await this._recursiveCacheBuild(entry, fullPath);
    567 +     88 +      }
    568 +     89 +    }
    569 +     90 +  }
    570 +     91 +
    571 +     92 +  /**
    572 +     93 +   * Set current file context (call when file is opened)
    573 +     94 +   * @param {string} filePath - Current file path
    574 +     95 +   */
    575 +     96 +  setCurrentFile(filePath) {
    576 +     97 +    this.currentFilePath = normalizePath(filePath);
    577 +     98 +
    578 +     99 +    // Add to navigation history
    579 +    100 +    if (
    580 +    101 +      this.navigationHistory.length === 0 ||
    581 +    102 +      this.navigationHistory[this.navigationHistory.length - 1] !== this.currentFilePath
    582 +    103 +    ) {
    583 +    104 +      this.navigationHistory.push(this.currentFilePath);
    584 +    105 +    }
    585 +    106 +  }
    586 +    107 +
    587 +    108 +  /**
    588 +    109 +   * Handle link click events
    589 +    110 +   * @param {Event} event - Click event
    590 +    111 +   */
    591 +    112 +  async handleLinkClick(event) {
    592 +    113 +    const link = event.target.closest('a');
    593 +    114 +    if (!link) return;
    594 +    115 +
    595 +    116 +    const href = link.getAttribute('href');
    596 +    117 +    if (!href) return;
    597 +    118 +
    598 +    119 +    // Anchor links - let default handler scroll
    599 +    120 +    if (isAnchorLink(href)) {
    600 +    121 +      return;
    601 +    122 +    }
    602 +    123 +
    603 +    124 +    // External links - open in new tab (default behavior)
    604 +    125 +    if (isExternalUrl(href)) {
    605 +    126 +      return;
    606 +    127 +    }
    607 +    128 +
    608 +    129 +    // Markdown file links - intercept and handle
    609 +    130 +    if (isMarkdownFile(href)) {
    610 +    131 +      event.preventDefault();
    611 +    132 +      await this.navigateToMarkdownFile(href);
    612 +    133 +    }
    613 +    134 +  }
    614 +    135 +
    615 +    136 +  /**
    616 +    137 +   * Navigate to relative markdown file
    617 +    138 +   * @param {string} relativePath - Relative path from current file
    618 +    139 +   */
    619 +    140 +  async navigateToMarkdownFile(relativePath) {
    620 +    141 +    if (!this.currentFilePath) {
    621 +    142 +      this.showWarning(
    622 +    143 +        'No file currently open',
    623 +    144 +        'Please open a file from the folder browser first.'
    624 +    145 +      );
    625 +    146 +      return;
    626 +    147 +    }
    627 +    148 +
    628 +    149 +    // Resolve absolute path
    629 +    150 +    const targetPath = this.resolveTargetPath(relativePath);
    630 +    151 +    console.log(`[LinkNav] Navigating: ${this.currentFilePath} ‚Üí ${targetPath}`);
    631 +    152 +
    632 +    153 +    // Check cache
    633 +    154 +    if (this.fileHandleCache.has(targetPath)) {
    634 +    155 +      const fileHandle = this.fileHandleCache.get(targetPath);
    635 +    156 +      await this.loadFile(fileHandle, targetPath);
    636 +    157 +      return;
    637 +    158 +    }
    638 +    159 +
    639 +    160 +    // File not found in cache
    640 +    161 +    this.showFileNotFoundModal(targetPath);
    641 +    162 +  }
    642 +    163 +
    643 +    164 +  /**
    644 +    165 +   * Resolve target path from relative link
    645 +    166 +   * @param {string} relativePath - Relative path
    646 +    167 +   * @returns {string} Absolute normalized path
    647 +    168 +   */
    648 +    169 +  resolveTargetPath(relativePath) {
    649 +    170 +    // If already absolute (starts with /), use as-is
    650 +    171 +    if (relativePath.startsWith('/')) {
    651 +    172 +      return normalizePath(relativePath.slice(1));
    652 +    173 +    }
    653 +    174 +
    654 +    175 +    // Resolve relative to current file
    655 +    176 +    return normalizePath(resolveRelativePath(this.currentFilePath, relativePath));
    656 +    177 +  }
    657 +    178 +
    658 +    179 +  /**
    659 +    180 +   * Load file from handle
    660 +    181 +   * @param {FileSystemFileHandle} fileHandle - File handle
    661 +    182 +   * @param {string} filePath - File path for context
    662 +    183 +   */
    663 +    184 +  async loadFile(fileHandle, filePath) {
    664 +    185 +    try {
    665 +    186 +      const file = await fileHandle.getFile();
    666 +    187 +      const content = await file.text();
    667 +    188 +
    668 +    189 +      // Update current context
    669 +    190 +      this.setCurrentFile(filePath);
    670 +    191 +
    671 +    192 +      // Trigger callback to load in editor
    672 +    193 +      if (this.onNavigate) {
    673 +    194 +        this.onNavigate({
    674 +    195 +          content,
    675 +    196 +          name: file.name,
    676 +    197 +          path: filePath,
    677 +    198 +          handle: fileHandle,
    678 +    199 +        });
    679 +    200 +      }
    680 +    201 +
    681 +    202 +      console.log(`[LinkNav] ‚úÖ Loaded: ${filePath}`);
    682 +    203 +    } catch (error) {
    683 +    204 +      console.error('[LinkNav] File load error:', error);
    684 +    205 +      this.showWarning('Failed to load file', `Could not read file: ${error.message}`);
    685 +    206 +    }
    686 +    207 +  }
    687 +    208 +
    688 +    209 +  /**
    689 +    210 +   * Show file not found modal
    690 +    211 +   * @param {string} filePath - Missing file path
    691 +    212 +   */
    692 +    213 +  showFileNotFoundModal(filePath) {
    693 +    214 +    // Check if modal exists, create if not
    694 +    215 +    let modal = document.getElementById('file-not-found-modal');
    695 +    216 +
    696 +    217 +    if (!modal) {
    697 +    218 +      modal = this.createFileNotFoundModal();
    698 +    219 +      document.body.appendChild(modal);
    699 +    220 +    }
    700 +    221 +
    701 +    222 +    // Update modal content
    702 +    223 +    const pathElement = modal.querySelector('#missing-file-path');
    703 +    224 +    if (pathElement) {
    704 +    225 +      pathElement.textContent = filePath;
    705 +    226 +    }
    706 +    227 +
    707 +    228 +    // Show modal
    708 +    229 +    modal.classList.add('active');
    709 +    230 +
    710 +    231 +    console.warn(`[LinkNav] File not found: ${filePath}`);
    711 +    232 +  }
    712 +    233 +
    713 +    234 +  /**
    714 +    235 +   * Create file not found modal element
    715 +    236 +   * @private
    716 +    237 +   * @returns {HTMLElement} Modal element
    717 +    238 +   */
    718 +    239 +  createFileNotFoundModal() {
    719 +    240 +    const modal = document.createElement('div');
    720 +    241 +    modal.id = 'file-not-found-modal';
    721 +    242 +    modal.className = 'modal';
    722 +    243 +    modal.innerHTML = `
    723 +    244 +      <div class="modal-content">
    724 +    245 +        <div class="modal-header">
    725 +    246 +          <h2>üìÇ File Not Found</h2>
    726 +    247 +          <button class="close-btn" id="close-file-not-found-modal">&times;</button>
    727 +    248 +        </div>
    728 +    249 +        <p>The linked file <code id="missing-file-path"></code> was not found in the current folder.</p>
    729 +    250 +        <p class="hint">This file may be in a different folder or may not exist.</p>
    730 +    251 +        <div class="modal-actions">
    731 +    252 +          <button class="btn" id="close-modal-btn">Close</button>
    732 +    253 +        </div>
    733 +    254 +      </div>
    734 +    255 +    `;
    735 +    256 +
    736 +    257 +    // Event listeners
    737 +    258 +    const closeBtn = modal.querySelector('#close-file-not-found-modal');
    738 +    259 +    const closeModalBtn = modal.querySelector('#close-modal-btn');
    739 +    260 +
    740 +    261 +    const closeHandler = () => modal.classList.remove('active');
    741 +    262 +
    742 +    263 +    closeBtn?.addEventListener('click', closeHandler);
    743 +    264 +    closeModalBtn?.addEventListener('click', closeHandler);
    744 +    265 +
    745 +    266 +    modal.addEventListener('click', e => {
    746 +    267 +      if (e.target === modal) closeHandler();
    747 +    268 +    });
    748 +    269 +
    749 +    270 +    return modal;
    750 +    271 +  }
    751 +    272 +
    752 +    273 +  /**
    753 +    274 +   * Show warning message
    754 +    275 +   * @param {string} title - Warning title
    755 +    276 +   * @param {string} message - Warning message
    756 +    277 +   */
    757 +    278 +  showWarning(title, message) {
    758 +    279 +    alert(`${title}\n\n${message}`);
    759 +    280 +  }
    760 +    281 +
    761 +    282 +  /**
    762 +    283 +   * Clear cache and reset state
    763 +    284 +   */
    764 +    285 +  reset() {
    765 +    286 +    this.fileHandleCache.clear();
    766 +    287 +    this.currentFilePath = '';
    767 +    288 +    this.currentFolderHandle = null;
    768 +    289 +    this.navigationHistory = [];
    769 +    290 +    console.log('[LinkNav] Reset complete');
    770 +    291 +  }
    771 +    292 +
    772 +    293 +  /**
    773 +    294 +   * Get current navigation breadcrumb
    774 +    295 +   * @returns {string[]} Navigation history
    775 +    296 +   */
    776 +    297 +  getBreadcrumb() {
    777 +    298 +    return [...this.navigationHistory];
    778 +    299 +  }
    779 +    300 +}
    780 +    301  
    781 +
    782 +```
    783 +
    784 +
    785 +### ‚ú® `src/js/utils/pathHelpers.js` **[ADDED]**
    786 +
    787 +**Status:** ‚úÖ **NEW FILE** - This file has been newly created
    788 +
    789 +**Type:** JavaScript Source File üü®
    790 +
    791 +```diff
    792 +@@ -0,0 +1,139 @@
    793 +      1 +/**
    794 +      2 + * @file pathHelpers.js
    795 +      3 + * @description Path resolution utilities for markdown link navigation
    796 +      4 + * @module utils/pathHelpers
    797 +      5 + */
    798 +      6 +
    799 +      7 +/**
    800 +      8 + * Resolve relative path against base path
    801 +      9 + * @param {string} basePath - Current file path (e.g., "docs/folder/current.md")
    802 +     10 + * @param {string} relativePath - Relative target path (e.g., "../other/file.md")
    803 +     11 + * @returns {string} Resolved absolute path
    804 +     12 + * @example
    805 +     13 + * resolveRelativePath('docs/folder/current.md', '../other/file.md')
    806 +     14 + * // Returns: 'docs/other/file.md'
    807 +     15 + */
    808 +     16 +export function resolveRelativePath(basePath, relativePath) {
    809 +     17 +  // Normalize paths to use forward slashes
    810 +     18 +  basePath = basePath.replace(/\\/g, '/');
    811 +     19 +  relativePath = relativePath.replace(/\\/g, '/');
    812 +     20 +
    813 +     21 +  // Split into segments
    814 +     22 +  const baseSegments = basePath.split('/').filter(Boolean);
    815 +     23 +  const relativeSegments = relativePath.split('/').filter(Boolean);
    816 +     24 +
    817 +     25 +  // Remove current filename from base (keep only directory path)
    818 +     26 +  if (baseSegments.length > 0) {
    819 +     27 +    baseSegments.pop();
    820 +     28 +  }
    821 +     29 +
    822 +     30 +  // Process relative segments
    823 +     31 +  for (const segment of relativeSegments) {
    824 +     32 +    if (segment === '..') {
    825 +     33 +      // Go up one directory
    826 +     34 +      if (baseSegments.length > 0) {
    827 +     35 +        baseSegments.pop();
    828 +     36 +      }
    829 +     37 +    } else if (segment !== '.') {
    830 +     38 +      // Add segment (skip '.' as it means current directory)
    831 +     39 +      baseSegments.push(segment);
    832 +     40 +    }
    833 +     41 +  }
    834 +     42 +
    835 +     43 +  // Join and return
    836 +     44 +  return baseSegments.join('/');
    837 +     45 +}
    838 +     46 +
    839 +     47 +/**
    840 +     48 + * Normalize path for consistent cache lookup
    841 +     49 + * @param {string} path - File path to normalize
    842 +     50 + * @returns {string} Normalized path (forward slashes, no leading/trailing slashes)
    843 +     51 + * @example
    844 +     52 + * normalizePath('\\folder\\file.md')
    845 +     53 + * // Returns: 'folder/file.md'
    846 +     54 + */
    847 +     55 +export function normalizePath(path) {
    848 +     56 +  if (!path) return '';
    849 +     57 +
    850 +     58 +  return path
    851 +     59 +    .replace(/\\/g, '/') // Convert backslashes to forward slashes
    852 +     60 +    .replace(/\/+/g, '/') // Collapse multiple slashes
    853 +     61 +    .replace(/^\/|\/$/g, ''); // Remove leading/trailing slashes
    854 +     62 +}
    855 +     63 +
    856 +     64 +/**
    857 +     65 + * Check if path is external URL
    858 +     66 + * @param {string} path - Path to check
    859 +     67 + * @returns {boolean} True if external URL
    860 +     68 + */
    861 +     69 +export function isExternalUrl(path) {
    862 +     70 +  if (!path) return false;
    863 +     71 +  return /^https?:\/\//.test(path) || /^\/\//.test(path);
    864 +     72 +}
    865 +     73 +
    866 +     74 +/**
    867 +     75 + * Check if path is markdown file
    868 +     76 + * @param {string} path - Path to check
    869 +     77 + * @returns {boolean} True if markdown file
    870 +     78 + */
    871 +     79 +export function isMarkdownFile(path) {
    872 +     80 +  if (!path) return false;
    873 +     81 +  return /\.md$/i.test(path);
    874 +     82 +}
    875 +     83 +
    876 +     84 +/**
    877 +     85 + * Check if path is anchor link
    878 +     86 + * @param {string} path - Path to check
    879 +     87 + * @returns {boolean} True if anchor link
    880 +     88 + */
    881 +     89 +export function isAnchorLink(path) {
    882 +     90 +  if (!path) return false;
    883 +     91 +  return path.startsWith('#');
    884 +     92 +}
    885 +     93 +
    886 +     94 +/**
    887 +     95 + * Extract directory path from file path
    888 +     96 + * @param {string} filePath - Full file path
    889 +     97 + * @returns {string} Directory path
    890 +     98 + * @example
    891 +     99 + * getDirectory('docs/folder/file.md')
    892 +    100 + * // Returns: 'docs/folder'
    893 +    101 + */
    894 +    102 +export function getDirectory(filePath) {
    895 +    103 +  const normalized = normalizePath(filePath);
    896 +    104 +  const segments = normalized.split('/');
    897 +    105 +  segments.pop(); // Remove filename
    898 +    106 +  return segments.join('/');
    899 +    107 +}
    900 +    108 +
    901 +    109 +/**
    902 +    110 + * Extract filename from path
    903 +    111 + * @param {string} filePath - Full file path
    904 +    112 + * @returns {string} Filename
    905 +    113 + * @example
    906 +    114 + * getFilename('docs/folder/file.md')
    907 +    115 + * // Returns: 'file.md'
    908 +    116 + */
    909 +    117 +export function getFilename(filePath) {
    910 +    118 +  const normalized = normalizePath(filePath);
    911 +    119 +  const segments = normalized.split('/');
    912 +    120 +  return segments[segments.length - 1] || '';
    913 +    121 +}
    914 +    122 +
    915 +    123 +/**
    916 +    124 + * Check if path is within allowed root (prevents path traversal attacks)
    917 +    125 + * @param {string} path - Path to validate
    918 +    126 + * @param {string} rootPath - Root directory path
    919 +    127 + * @returns {boolean} True if path is within root
    920 +    128 + */
    921 +    129 +export function isWithinRoot(path, rootPath) {
    922 +    130 +  const normalizedPath = normalizePath(path);
    923 +    131 +  const normalizedRoot = normalizePath(rootPath);
    924 +    132 +
    925 +    133 +  // Empty path or trying to escape root
    926 +    134 +  if (!normalizedPath) return false;
    927 +    135 +  if (normalizedPath.startsWith('..')) return false;
    928 +    136 +
    929 +    137 +  // Check if path starts with root
    930 +    138 +  return normalizedPath === normalizedRoot || normalizedPath.startsWith(`${normalizedRoot}/`);
    931 +    139 +}
    932 +    140  
6183 933  
6184 934  ```
6185 935  
@@ -6225,4 +975,4 @@ Please provide specific feedback on:
6225 975  
6226 976  ---
6227 977  *Generated by AI Visual Code Review v2.0 - Unified Export Script*
6228     -*Files processed: 5/5 | Errors: 0 | Generated: 2025-12-19T14:13:35.832Z*
    978 +*Files processed: 3/3 | Errors: 0 | Generated: 2026-01-19T14:03:18.358Z*
6229 979  

```


### üìÑ `script.js`

**Type:** JavaScript Source File üü®

```diff
@@ -17,6 +17,7 @@ import { StorageManager } from './src/js/core/StorageManager.js';
 17  17  import { ThemeManager } from './src/js/core/ThemeManager.js';
 18  18  import { FolderBrowserService } from './src/js/services/FolderBrowserService.js';
 19  19  import { HTMLService } from './src/js/services/HTMLService.js';
     20 +import { LinkNavigationService } from './src/js/services/LinkNavigationService.js';
 20  21  import { MermaidService } from './src/js/services/MermaidService.js';
 21  22  import { PDFService } from './src/js/services/PDFService.js';
 22  23  import { PrismService } from './src/js/services/PrismService.js';
@@ -236,11 +237,13 @@ const AnchorNavigation = {
236 237        slug = slug.replace(pattern, replacement);
237 238      }
238 239  
239     -    return slug
240     -      .replace(/[^\w\s-]/g, '')
241     -      .replace(/\s+/g, '-')
242     -      .replace(/-+/g, '-')
243     -      .replace(/^-+|-+$/g, '') || 'section';
    240 +    return (
    241 +      slug
    242 +        .replace(/[^\w\s-]/g, '')
    243 +        .replace(/\s+/g, '-')
    244 +        .replace(/-+/g, '-')
    245 +        .replace(/^-+|-+$/g, '') || 'section'
    246 +    );
244 247    },
245 248  
246 249    /**
@@ -251,12 +254,14 @@ const AnchorNavigation = {
251 254    normalizeHashGitHub(hash) {
252 255      // GitHub algorithm: lowercase, remove non-alphanumeric except hyphens
253 256      // Does NOT collapse multiple hyphens, does NOT replace C++ with cpp
254     -    return hash
255     -      .normalize('NFC')
256     -      .toLowerCase()
257     -      .replace(/[^\w\s-]/g, '')
258     -      .replace(/\s+/g, '-')
259     -      .replace(/^-+|-+$/g, '') || 'section';
    257 +    return (
    258 +      hash
    259 +        .normalize('NFC')
    260 +        .toLowerCase()
    261 +        .replace(/[^\w\s-]/g, '')
    262 +        .replace(/\s+/g, '-')
    263 +        .replace(/^-+|-+$/g, '') || 'section'
    264 +    );
260 265    },
261 266  
262 267    /**
@@ -265,7 +270,9 @@ const AnchorNavigation = {
265 270     * @returns {Element|null} Matching heading or null
266 271     */
267 272    fuzzyMatchHeading(hash) {
268     -    const headings = this.container.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]');
    273 +    const headings = this.container.querySelectorAll(
    274 +      'h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]'
    275 +    );
269 276      const normalizedSearch = hash.toLowerCase().replace(/[^\w]/g, '');
270 277  
271 278      for (const heading of headings) {
@@ -319,6 +326,9 @@ const pdfService = new PDFService();
319 326  const htmlService = new HTMLService();
320 327  const folderBrowserService = new FolderBrowserService(storageManager);
321 328  
    329 +// Link navigation service (callback will be wired in setupEditor)
    330 +let linkNavigationService = null;
    331 +
322 332  // Folder browser state (these are managed within setupEditor scope)
323 333  const _currentFolderFiles = [];
324 334  const _currentFileHandle = null;
@@ -395,14 +405,14 @@ function initSupportModal() {
395 405    });
396 406  
397 407    // Click outside to close
398     -  modal.addEventListener('click', (e) => {
    408 +  modal.addEventListener('click', e => {
399 409      if (e.target === modal) {
400 410        closeSupportModal(modal, dontShowAgainCheckbox);
401 411      }
402 412    });
403 413  
404 414    // Escape key to close
405     -  document.addEventListener('keydown', (e) => {
    415 +  document.addEventListener('keydown', e => {
406 416      if (e.key === 'Escape' && modal.classList.contains('active')) {
407 417        closeSupportModal(modal, dontShowAgainCheckbox);
408 418      }
@@ -473,7 +483,10 @@ async function detectSupportRegion() {
473 483      return region;
474 484    } catch (error) {
475 485      // 4. Fail open - silent fail to global
476     -    console.warn('[SupportWidget] Geo-lookup failed/timed-out, defaulting to Global.', error.message);
    486 +    console.warn(
    487 +      '[SupportWidget] Geo-lookup failed/timed-out, defaulting to Global.',
    488 +      error.message
    489 +    );
477 490      return SUPPORT_FALLBACK_REGION;
478 491    }
479 492  }
@@ -500,19 +513,20 @@ function renderSupportWidget(region) {
500 513    const container = document.getElementById('support-widget');
501 514    if (!container) return;
502 515  
503     -  const config = region === 'india'
504     -    ? {
505     -      text: 'üáÆüá≥ Support via UPI',
506     -      url: 'https://razorpay.me/@prakharshekharparthasarthi?notes[source]=webapp_footer',
507     -      className: 'support-button--india',
508     -      toggleText: 'Not in India?',
509     -    }
510     -    : {
511     -      text: '‚òï Support via Ko-fi',
512     -      url: 'https://ko-fi.com/praxlannister?ref=webapp_footer',
513     -      className: 'support-button--global',
514     -      toggleText: 'In India? Use UPI',
515     -    };
    516 +  const config =
    517 +    region === 'india'
    518 +      ? {
    519 +        text: 'üáÆüá≥ Support via UPI',
    520 +        url: 'https://razorpay.me/@prakharshekharparthasarthi?notes[source]=webapp_footer',
    521 +        className: 'support-button--india',
    522 +        toggleText: 'Not in India?',
    523 +      }
    524 +      : {
    525 +        text: '‚òï Support via Ko-fi',
    526 +        url: 'https://ko-fi.com/praxlannister?ref=webapp_footer',
    527 +        className: 'support-button--global',
    528 +        toggleText: 'In India? Use UPI',
    529 +      };
516 530  
517 531    container.innerHTML = `
518 532      <a href="${config.url}" target="_blank" rel="noopener noreferrer" class="support-button ${config.className}">
@@ -575,7 +589,7 @@ function configureMarkedExtensions() {
575 589          },
576 590          tokenizer(src) {
577 591            const match = src.match(
578     -            /^> \[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\s*\n((?:> .*\n?)*)/,
    592 +            /^> \[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\s*\n((?:> .*\n?)*)/
579 593            );
580 594            if (match) {
581 595              const type = match[1];
@@ -645,18 +659,15 @@ function configureMarkedExtensions() {
645 659          },
646 660          renderer(token) {
647 661            try {
648     -            return (
649     -              `<div style="margin: 1.5em 0;">${katex.renderToString(token.text, {
650     -                displayMode: true,
651     -                throwOnError: false,
652     -                output: 'html',
653     -                trust: true, // Allow custom styling
654     -                macros: {
655     -                  '\\label': '\\phantom', // Hide \label
656     -                },
657     -              })
658     -              }</div>`
659     -            );
    662 +            return `<div style="margin: 1.5em 0;">${katex.renderToString(token.text, {
    663 +              displayMode: true,
    664 +              throwOnError: false,
    665 +              output: 'html',
    666 +              trust: true, // Allow custom styling
    667 +              macros: {
    668 +                '\\label': '\\phantom', // Hide \label
    669 +              },
    670 +            })}</div>`;
660 671            } catch (e) {
661 672              console.warn('KaTeX display math error:', e);
662 673              return `<div style="color: red; padding: 10px;">Math Error: ${e.message}</div>`;
@@ -692,21 +703,18 @@ function configureMarkedExtensions() {
692 703          },
693 704          renderer(token) {
694 705            try {
695     -            return (
696     -              `<div style="margin: 1.5em 0;">${katex.renderToString(token.text, {
697     -                displayMode: true,
698     -                throwOnError: false,
699     -                output: 'html',
700     -                trust: true,
701     -                macros: {
702     -                  '\\label': '\\phantom', // Hide \label
703     -                  '\\eqref': '\\text', // Plain text for refs (or link if needed)
704     -                  '\\cite': '\\text',
705     -                  '\\ref': '\\text',
706     -                },
707     -              })
708     -              }</div>`
709     -            );
    706 +            return `<div style="margin: 1.5em 0;">${katex.renderToString(token.text, {
    707 +              displayMode: true,
    708 +              throwOnError: false,
    709 +              output: 'html',
    710 +              trust: true,
    711 +              macros: {
    712 +                '\\label': '\\phantom', // Hide \label
    713 +                '\\eqref': '\\text', // Plain text for refs (or link if needed)
    714 +                '\\cite': '\\text',
    715 +                '\\ref': '\\text',
    716 +              },
    717 +            })}</div>`;
710 718            } catch (e) {
711 719              console.warn('KaTeX environment error:', e);
712 720              return `<div style="color: red;">LaTeX Error: ${e.message}</div>`;
@@ -839,10 +847,43 @@ function configureMarkedExtensions() {
839 847          const level = token.depth;
840 848          const slug = generateSlug(text, headingSlugMap);
841 849          return `<h${level} id="${slug}">${text}</h${level}>\n`;
842     -      }
843     -    }
    850 +      },
    851 +      link(token) {
    852 +        // Extract properties from token object (marked.js v12+ API)
    853 +        const href = token.href;
    854 +        const title = token.title;
    855 +
    856 +        // CRITICAL: Parse nested tokens (e.g., images inside links)
    857 +        // This handles [![img](url)](link) syntax correctly
    858 +        const text = token.tokens ? this.parser.parseInline(token.tokens) : token.text;
    859 +
    860 +        // Defensive: only catch truly broken cases (null/undefined)
    861 +        if (href == null) {
    862 +          return `<a>${text}</a>`;
    863 +        }
    864 +
    865 +        // Anchor links - unchanged
    866 +        if (href.startsWith('#')) {
    867 +          return `<a href="${href}" title="${title || ''}">${text}</a>`;
    868 +        }
    869 +
    870 +        // External links - open in new tab
    871 +        if (/^https?:\/\//.test(href) || /^\/\//.test(href)) {
    872 +          return `<a href="${href}" target="_blank" rel="noopener noreferrer" title="${title || ''}">${text}</a>`;
    873 +        }
    874 +
    875 +        // Relative markdown file links - add class and data attribute for router
    876 +        if (href.endsWith('.md')) {
    877 +          return `<a href="${href}" class="md-link" data-md-path="${href}" title="${title || ''}">${text}</a>`;
    878 +        }
    879 +
    880 +        // Default - regular link
    881 +        return `<a href="${href}" title="${title || ''}">${text}</a>`;
    882 +      },
    883 +    },
844 884    });
845 885    console.log('‚úÖ Custom heading renderer enabled (anchor navigation IDs)');
    886 +  console.log('‚úÖ Custom link renderer enabled (markdown file navigation)');
846 887  }
847 888  
848 889  // Initialize Mermaid using MermaidService (prefixed to indicate future use)
@@ -1051,13 +1092,26 @@ graph TD
1051 1092            const id = `mermaid-${Math.random().toString(36).substr(2, 9)}`;
1052 1093            // Return placeholder div
1053 1094            return `<div class="mermaid-diagram" id="${id}" data-code="${encodeURIComponent(decodedCode)}">${code}</div>`;
1054     -        },
    1095 +        }
1055 1096        );
1056 1097  
1057 1098        // Sanitize HTML using DOMPurify
1058 1099        const cleanHtml = DOMPurify.sanitize(html, {
1059     -        ADD_TAGS: ['iframe'],
1060     -        ADD_ATTR: ['allow', 'allowfullscreen', 'frameborder', 'scrolling', 'target', 'data-code'], // Add data-code
    1100 +        ADD_TAGS: ['iframe', 'img'], // Allow iframe and img tags
    1101 +        ADD_ATTR: [
    1102 +          'allow',
    1103 +          'allowfullscreen',
    1104 +          'frameborder',
    1105 +          'scrolling',
    1106 +          'target',
    1107 +          'data-code', // Mermaid diagrams
    1108 +          'src',
    1109 +          'alt',
    1110 +          'title',
    1111 +          'width',
    1112 +          'height',
    1113 +          'loading', // Image attributes
    1114 +        ],
1061 1115          USE_PROFILES: { html: true, svg: true, mathml: true },
1062 1116        });
1063 1117  
@@ -1101,8 +1155,7 @@ graph TD
1101 1155        storageManager.set('markdownContent', markdownText);
1102 1156      } catch (error) {
1103 1157        console.error('Render error:', error);
1104     -      preview.innerHTML =
1105     -        `<p style="color: red;">Error rendering markdown: ${error.message}</p>`;
    1158 +      preview.innerHTML = `<p style="color: red;">Error rendering markdown: ${error.message}</p>`;
1106 1159      }
1107 1160    }
1108 1161  
@@ -1361,7 +1414,9 @@ graph TD
1361 1414  
1362 1415    // Apply split ratio to containers
1363 1416    function applySplitRatio() {
1364     -    if (!mainContent.classList.contains('split-view-active')) { return; }
    1417 +    if (!mainContent.classList.contains('split-view-active')) {
    1418 +      return;
    1419 +    }
1365 1420  
1366 1421      const mainContentWidth = mainContent.offsetWidth;
1367 1422      const sidebarWidth = document.getElementById('file-browser').offsetWidth || 0;
@@ -1386,8 +1441,10 @@ graph TD
1386 1441  
1387 1442    // Split resizer drag handlers
1388 1443    if (splitResizer) {
1389     -    splitResizer.addEventListener('mousedown', (e) => {
1390     -      if (!mainContent.classList.contains('split-view-active')) { return; }
    1444 +    splitResizer.addEventListener('mousedown', e => {
    1445 +      if (!mainContent.classList.contains('split-view-active')) {
    1446 +        return;
    1447 +      }
1391 1448  
1392 1449        isSplitResizing = true;
1393 1450        splitResizer.classList.add('dragging');
@@ -1397,8 +1454,10 @@ graph TD
1397 1454      });
1398 1455    }
1399 1456  
1400     -  document.addEventListener('mousemove', (e) => {
1401     -    if (!isSplitResizing) { return; }
    1457 +  document.addEventListener('mousemove', e => {
    1458 +    if (!isSplitResizing) {
    1459 +      return;
    1460 +    }
1402 1461  
1403 1462      const mainContentRect = mainContent.getBoundingClientRect();
1404 1463      const sidebarWidth = document.getElementById('file-browser').offsetWidth || 0;
@@ -1516,7 +1575,9 @@ graph TD
1516 1575  
1517 1576    // Editor scroll handler with smooth sync
1518 1577    editor.addEventListener('scroll', () => {
1519     -    if (!syncScrollEnabled || syncScrolling) { return; }
    1578 +    if (!syncScrollEnabled || syncScrolling) {
    1579 +      return;
    1580 +    }
1520 1581  
1521 1582      syncScrolling = true;
1522 1583  
@@ -1545,7 +1606,9 @@ graph TD
1545 1606  
1546 1607    // Preview container scroll handler with smooth sync
1547 1608    previewContainer.addEventListener('scroll', () => {
1548     -    if (!syncScrollEnabled || syncScrolling) { return; }
    1609 +    if (!syncScrollEnabled || syncScrolling) {
    1610 +      return;
    1611 +    }
1549 1612  
1550 1613      syncScrolling = true;
1551 1614  
@@ -1653,11 +1716,14 @@ graph TD
1653 1716    initializeMobileView();
1654 1717  
1655 1718    // Re-initialize on window resize
1656     -  window.addEventListener('resize', debounce(() => {
1657     -    if (isMobileView()) {
1658     -      initializeMobileView();
1659     -    }
1660     -  }, 250));
    1719 +  window.addEventListener(
    1720 +    'resize',
    1721 +    debounce(() => {
    1722 +      if (isMobileView()) {
    1723 +        initializeMobileView();
    1724 +      }
    1725 +    }, 250)
    1726 +  );
1661 1727  
1662 1728    // Initialize visibility
1663 1729  
@@ -1814,7 +1880,7 @@ graph TD
1814 1880    }
1815 1881  
1816 1882    // Escape key to exit Zen Mode
1817     -  document.addEventListener('keydown', (e) => {
    1883 +  document.addEventListener('keydown', e => {
1818 1884      if (e.key === 'Escape' && document.body.classList.contains('zen-mode')) {
1819 1885        toggleZenMode();
1820 1886      }
@@ -1851,7 +1917,9 @@ graph TD
1851 1917    });
1852 1918  
1853 1919    document.addEventListener('mousemove', e => {
1854     -    if (!isResizing) { return; }
    1920 +    if (!isResizing) {
    1921 +      return;
    1922 +    }
1855 1923  
1856 1924      const newWidth = e.clientX;
1857 1925  
@@ -1913,7 +1981,7 @@ graph TD
1913 1981        alert(
1914 1982          'Folder browsing requires File System Access API.\n\n' +
1915 1983          'Please use Chrome 86+ or Edge 86+.\n\n' +
1916     -        'Firefox and Safari are not currently supported.',
    1984 +        'Firefox and Safari are not currently supported.'
1917 1985        );
1918 1986        return;
1919 1987      }
@@ -1943,6 +2011,11 @@ graph TD
1943 2011      // Render tree
1944 2012      renderFileTree(result.files);
1945 2013  
    2014 +    // Build file cache for link navigation
    2015 +    if (linkNavigationService && folderBrowserService.currentDirectoryHandle) {
    2016 +      await linkNavigationService.buildFileCache(folderBrowserService.currentDirectoryHandle);
    2017 +    }
    2018 +
1946 2019      // Update expand button visibility
1947 2020      updateExpandButtonVisibility();
1948 2021  
@@ -2152,14 +2225,14 @@ Wrap up your thoughts and include a call to action.
2152 2225      createFileModal.classList.remove('active');
2153 2226    });
2154 2227  
2155     -  createFileModal.addEventListener('click', (e) => {
    2228 +  createFileModal.addEventListener('click', e => {
2156 2229      if (e.target === createFileModal) {
2157 2230        createFileModal.classList.remove('active');
2158 2231      }
2159 2232    });
2160 2233  
2161 2234    // Handle Enter key in filename input
2162     -  newFileNameInput.addEventListener('keydown', (e) => {
    2235 +  newFileNameInput.addEventListener('keydown', e => {
2163 2236      if (e.key === 'Enter') {
2164 2237        e.preventDefault();
2165 2238        confirmCreateFileBtn.click();
@@ -2472,6 +2545,11 @@ Wrap up your thoughts and include a call to action.
2472 2545      // Mark as active file
2473 2546      activeFileHandle = fileItem.handle;
2474 2547  
    2548 +    // Update link navigation context with current file path
    2549 +    if (linkNavigationService && fileItem.path) {
    2550 +      linkNavigationService.setCurrentFile(fileItem.path);
    2551 +    }
    2552 +
2475 2553      // Re-render tree to update active state
2476 2554      renderFileTree(folderFiles);
2477 2555  
@@ -2490,6 +2568,29 @@ Wrap up your thoughts and include a call to action.
2490 2568    // Initialize anchor navigation for TOC links
2491 2569    AnchorNavigation.init(previewContainer);
2492 2570  
    2571 +  // Initialize Link Navigation Service
    2572 +  linkNavigationService = new LinkNavigationService(folderBrowserService, fileData => {
    2573 +    // Callback when file should be loaded from link navigation
    2574 +    editor.value = fileData.content;
    2575 +    renderMarkdown();
    2576 +
    2577 +    // Highlight file in tree if possible
    2578 +    const fileItems = document.querySelectorAll('.file-item');
    2579 +    fileItems.forEach(item => {
    2580 +      if (item.dataset.name === fileData.name) {
    2581 +        item.classList.add('active');
    2582 +      } else {
    2583 +        item.classList.remove('active');
    2584 +      }
    2585 +    });
    2586 +
    2587 +    console.log(`[App] Loaded from link: ${fileData.path}`);
    2588 +  });
    2589 +
    2590 +  // Initialize link interceptor on preview container
    2591 +  const markdownPreview = document.getElementById('markdown-preview');
    2592 +  linkNavigationService.initialize(markdownPreview);
    2593 +
2493 2594    // DON'T render immediately - wait for theme to load
2494 2595    // renderMarkdown will be called after theme loads above
2495 2596  }
2496 2597  

```


### ‚ú® `src/js/services/LinkNavigationService.js` **[ADDED]**

**Status:** ‚úÖ **NEW FILE** - This file has been newly created

**Type:** JavaScript Source File üü®

```diff
@@ -0,0 +1,300 @@
      1 +/**
      2 + * @file LinkNavigationService.js
      3 + * @description Intelligent markdown link navigation with File System Access API integration
      4 + * @module services/LinkNavigationService
      5 + */
      6 +
      7 +import {
      8 +  isAnchorLink,
      9 +  isExternalUrl,
     10 +  isMarkdownFile,
     11 +  normalizePath,
     12 +  resolveRelativePath
     13 +} from '../utils/pathHelpers.js';
     14 +
     15 +/**
     16 + * @class LinkNavigationService
     17 + * @description Handles intelligent routing of markdown links within folder browser context
     18 + */
     19 +export class LinkNavigationService {
     20 +  /**
     21 +   * @constructor
     22 +   * @param {Object} folderBrowserService - FolderBrowserService instance
     23 +   * @param {Function} onNavigate - Callback when file should be loaded
     24 +   */
     25 +  constructor(folderBrowserService, onNavigate) {
     26 +    this.folderService = folderBrowserService;
     27 +    this.onNavigate = onNavigate;
     28 +
     29 +    // File handle cache: normalized_path -> FileSystemFileHandle
     30 +    this.fileHandleCache = new Map();
     31 +
     32 +    // Current file context
     33 +    this.currentFilePath = '';
     34 +    this.currentFolderHandle = null;
     35 +
     36 +    // Breadcrumb navigation stack
     37 +    this.navigationHistory = [];
     38 +  }
     39 +
     40 +  /**
     41 +   * Initialize link interceptor on preview container
     42 +   * @param {HTMLElement} previewContainer - Preview container element
     43 +   */
     44 +  initialize(previewContainer) {
     45 +    if (!previewContainer) {
     46 +      console.error('[LinkNav] Preview container not found');
     47 +      return;
     48 +    }
     49 +
     50 +    // Event delegation for link clicks
     51 +    previewContainer.addEventListener('click', this.handleLinkClick.bind(this));
     52 +
     53 +    console.log('‚úÖ Link navigation initialized');
     54 +  }
     55 +
     56 +  /**
     57 +   * Build file handle cache from folder structure
     58 +   * @param {FileSystemDirectoryHandle} dirHandle - Root directory handle
     59 +   * @param {string} basePath - Base path for recursion
     60 +   */
     61 +  async buildFileCache(dirHandle, basePath = '') {
     62 +    if (!dirHandle) return;
     63 +
     64 +    this.currentFolderHandle = dirHandle;
     65 +    this.fileHandleCache.clear();
     66 +
     67 +    try {
     68 +      await this._recursiveCacheBuild(dirHandle, basePath);
     69 +      console.log(`[LinkNav] Cached ${this.fileHandleCache.size} markdown files`);
     70 +    } catch (error) {
     71 +      console.error('[LinkNav] Cache build failed:', error);
     72 +    }
     73 +  }
     74 +
     75 +  /**
     76 +   * Recursive cache building
     77 +   * @private
     78 +   */
     79 +  async _recursiveCacheBuild(dirHandle, basePath) {
     80 +    for await (const entry of dirHandle.values()) {
     81 +      const fullPath = basePath ? `${basePath}/${entry.name}` : entry.name;
     82 +      const normalized = normalizePath(fullPath);
     83 +
     84 +      if (entry.kind === 'file' && isMarkdownFile(entry.name)) {
     85 +        this.fileHandleCache.set(normalized, entry);
     86 +      } else if (entry.kind === 'directory') {
     87 +        await this._recursiveCacheBuild(entry, fullPath);
     88 +      }
     89 +    }
     90 +  }
     91 +
     92 +  /**
     93 +   * Set current file context (call when file is opened)
     94 +   * @param {string} filePath - Current file path
     95 +   */
     96 +  setCurrentFile(filePath) {
     97 +    this.currentFilePath = normalizePath(filePath);
     98 +
     99 +    // Add to navigation history
    100 +    if (
    101 +      this.navigationHistory.length === 0 ||
    102 +      this.navigationHistory[this.navigationHistory.length - 1] !== this.currentFilePath
    103 +    ) {
    104 +      this.navigationHistory.push(this.currentFilePath);
    105 +    }
    106 +  }
    107 +
    108 +  /**
    109 +   * Handle link click events
    110 +   * @param {Event} event - Click event
    111 +   */
    112 +  async handleLinkClick(event) {
    113 +    const link = event.target.closest('a');
    114 +    if (!link) return;
    115 +
    116 +    const href = link.getAttribute('href');
    117 +    if (!href) return;
    118 +
    119 +    // Anchor links - let default handler scroll
    120 +    if (isAnchorLink(href)) {
    121 +      return;
    122 +    }
    123 +
    124 +    // External links - open in new tab (default behavior)
    125 +    if (isExternalUrl(href)) {
    126 +      return;
    127 +    }
    128 +
    129 +    // Markdown file links - intercept and handle
    130 +    if (isMarkdownFile(href)) {
    131 +      event.preventDefault();
    132 +      await this.navigateToMarkdownFile(href);
    133 +    }
    134 +  }
    135 +
    136 +  /**
    137 +   * Navigate to relative markdown file
    138 +   * @param {string} relativePath - Relative path from current file
    139 +   */
    140 +  async navigateToMarkdownFile(relativePath) {
    141 +    if (!this.currentFilePath) {
    142 +      this.showWarning(
    143 +        'No file currently open',
    144 +        'Please open a file from the folder browser first.'
    145 +      );
    146 +      return;
    147 +    }
    148 +
    149 +    // Resolve absolute path
    150 +    const targetPath = this.resolveTargetPath(relativePath);
    151 +    console.log(`[LinkNav] Navigating: ${this.currentFilePath} ‚Üí ${targetPath}`);
    152 +
    153 +    // Check cache
    154 +    if (this.fileHandleCache.has(targetPath)) {
    155 +      const fileHandle = this.fileHandleCache.get(targetPath);
    156 +      await this.loadFile(fileHandle, targetPath);
    157 +      return;
    158 +    }
    159 +
    160 +    // File not found in cache
    161 +    this.showFileNotFoundModal(targetPath);
    162 +  }
    163 +
    164 +  /**
    165 +   * Resolve target path from relative link
    166 +   * @param {string} relativePath - Relative path
    167 +   * @returns {string} Absolute normalized path
    168 +   */
    169 +  resolveTargetPath(relativePath) {
    170 +    // If already absolute (starts with /), use as-is
    171 +    if (relativePath.startsWith('/')) {
    172 +      return normalizePath(relativePath.slice(1));
    173 +    }
    174 +
    175 +    // Resolve relative to current file
    176 +    return normalizePath(resolveRelativePath(this.currentFilePath, relativePath));
    177 +  }
    178 +
    179 +  /**
    180 +   * Load file from handle
    181 +   * @param {FileSystemFileHandle} fileHandle - File handle
    182 +   * @param {string} filePath - File path for context
    183 +   */
    184 +  async loadFile(fileHandle, filePath) {
    185 +    try {
    186 +      const file = await fileHandle.getFile();
    187 +      const content = await file.text();
    188 +
    189 +      // Update current context
    190 +      this.setCurrentFile(filePath);
    191 +
    192 +      // Trigger callback to load in editor
    193 +      if (this.onNavigate) {
    194 +        this.onNavigate({
    195 +          content,
    196 +          name: file.name,
    197 +          path: filePath,
    198 +          handle: fileHandle,
    199 +        });
    200 +      }
    201 +
    202 +      console.log(`[LinkNav] ‚úÖ Loaded: ${filePath}`);
    203 +    } catch (error) {
    204 +      console.error('[LinkNav] File load error:', error);
    205 +      this.showWarning('Failed to load file', `Could not read file: ${error.message}`);
    206 +    }
    207 +  }
    208 +
    209 +  /**
    210 +   * Show file not found modal
    211 +   * @param {string} filePath - Missing file path
    212 +   */
    213 +  showFileNotFoundModal(filePath) {
    214 +    // Check if modal exists, create if not
    215 +    let modal = document.getElementById('file-not-found-modal');
    216 +
    217 +    if (!modal) {
    218 +      modal = this.createFileNotFoundModal();
    219 +      document.body.appendChild(modal);
    220 +    }
    221 +
    222 +    // Update modal content
    223 +    const pathElement = modal.querySelector('#missing-file-path');
    224 +    if (pathElement) {
    225 +      pathElement.textContent = filePath;
    226 +    }
    227 +
    228 +    // Show modal
    229 +    modal.classList.add('active');
    230 +
    231 +    console.warn(`[LinkNav] File not found: ${filePath}`);
    232 +  }
    233 +
    234 +  /**
    235 +   * Create file not found modal element
    236 +   * @private
    237 +   * @returns {HTMLElement} Modal element
    238 +   */
    239 +  createFileNotFoundModal() {
    240 +    const modal = document.createElement('div');
    241 +    modal.id = 'file-not-found-modal';
    242 +    modal.className = 'modal';
    243 +    modal.innerHTML = `
    244 +      <div class="modal-content">
    245 +        <div class="modal-header">
    246 +          <h2>üìÇ File Not Found</h2>
    247 +          <button class="close-btn" id="close-file-not-found-modal">&times;</button>
    248 +        </div>
    249 +        <p>The linked file <code id="missing-file-path"></code> was not found in the current folder.</p>
    250 +        <p class="hint">This file may be in a different folder or may not exist.</p>
    251 +        <div class="modal-actions">
    252 +          <button class="btn" id="close-modal-btn">Close</button>
    253 +        </div>
    254 +      </div>
    255 +    `;
    256 +
    257 +    // Event listeners
    258 +    const closeBtn = modal.querySelector('#close-file-not-found-modal');
    259 +    const closeModalBtn = modal.querySelector('#close-modal-btn');
    260 +
    261 +    const closeHandler = () => modal.classList.remove('active');
    262 +
    263 +    closeBtn?.addEventListener('click', closeHandler);
    264 +    closeModalBtn?.addEventListener('click', closeHandler);
    265 +
    266 +    modal.addEventListener('click', e => {
    267 +      if (e.target === modal) closeHandler();
    268 +    });
    269 +
    270 +    return modal;
    271 +  }
    272 +
    273 +  /**
    274 +   * Show warning message
    275 +   * @param {string} title - Warning title
    276 +   * @param {string} message - Warning message
    277 +   */
    278 +  showWarning(title, message) {
    279 +    alert(`${title}\n\n${message}`);
    280 +  }
    281 +
    282 +  /**
    283 +   * Clear cache and reset state
    284 +   */
    285 +  reset() {
    286 +    this.fileHandleCache.clear();
    287 +    this.currentFilePath = '';
    288 +    this.currentFolderHandle = null;
    289 +    this.navigationHistory = [];
    290 +    console.log('[LinkNav] Reset complete');
    291 +  }
    292 +
    293 +  /**
    294 +   * Get current navigation breadcrumb
    295 +   * @returns {string[]} Navigation history
    296 +   */
    297 +  getBreadcrumb() {
    298 +    return [...this.navigationHistory];
    299 +  }
    300 +}
    301  

```


### ‚ú® `src/js/utils/pathHelpers.js` **[ADDED]**

**Status:** ‚úÖ **NEW FILE** - This file has been newly created

**Type:** JavaScript Source File üü®

```diff
@@ -0,0 +1,139 @@
      1 +/**
      2 + * @file pathHelpers.js
      3 + * @description Path resolution utilities for markdown link navigation
      4 + * @module utils/pathHelpers
      5 + */
      6 +
      7 +/**
      8 + * Resolve relative path against base path
      9 + * @param {string} basePath - Current file path (e.g., "docs/folder/current.md")
     10 + * @param {string} relativePath - Relative target path (e.g., "../other/file.md")
     11 + * @returns {string} Resolved absolute path
     12 + * @example
     13 + * resolveRelativePath('docs/folder/current.md', '../other/file.md')
     14 + * // Returns: 'docs/other/file.md'
     15 + */
     16 +export function resolveRelativePath(basePath, relativePath) {
     17 +  // Normalize paths to use forward slashes
     18 +  basePath = basePath.replace(/\\/g, '/');
     19 +  relativePath = relativePath.replace(/\\/g, '/');
     20 +
     21 +  // Split into segments
     22 +  const baseSegments = basePath.split('/').filter(Boolean);
     23 +  const relativeSegments = relativePath.split('/').filter(Boolean);
     24 +
     25 +  // Remove current filename from base (keep only directory path)
     26 +  if (baseSegments.length > 0) {
     27 +    baseSegments.pop();
     28 +  }
     29 +
     30 +  // Process relative segments
     31 +  for (const segment of relativeSegments) {
     32 +    if (segment === '..') {
     33 +      // Go up one directory
     34 +      if (baseSegments.length > 0) {
     35 +        baseSegments.pop();
     36 +      }
     37 +    } else if (segment !== '.') {
     38 +      // Add segment (skip '.' as it means current directory)
     39 +      baseSegments.push(segment);
     40 +    }
     41 +  }
     42 +
     43 +  // Join and return
     44 +  return baseSegments.join('/');
     45 +}
     46 +
     47 +/**
     48 + * Normalize path for consistent cache lookup
     49 + * @param {string} path - File path to normalize
     50 + * @returns {string} Normalized path (forward slashes, no leading/trailing slashes)
     51 + * @example
     52 + * normalizePath('\\folder\\file.md')
     53 + * // Returns: 'folder/file.md'
     54 + */
     55 +export function normalizePath(path) {
     56 +  if (!path) return '';
     57 +
     58 +  return path
     59 +    .replace(/\\/g, '/') // Convert backslashes to forward slashes
     60 +    .replace(/\/+/g, '/') // Collapse multiple slashes
     61 +    .replace(/^\/|\/$/g, ''); // Remove leading/trailing slashes
     62 +}
     63 +
     64 +/**
     65 + * Check if path is external URL
     66 + * @param {string} path - Path to check
     67 + * @returns {boolean} True if external URL
     68 + */
     69 +export function isExternalUrl(path) {
     70 +  if (!path) return false;
     71 +  return /^https?:\/\//.test(path) || /^\/\//.test(path);
     72 +}
     73 +
     74 +/**
     75 + * Check if path is markdown file
     76 + * @param {string} path - Path to check
     77 + * @returns {boolean} True if markdown file
     78 + */
     79 +export function isMarkdownFile(path) {
     80 +  if (!path) return false;
     81 +  return /\.md$/i.test(path);
     82 +}
     83 +
     84 +/**
     85 + * Check if path is anchor link
     86 + * @param {string} path - Path to check
     87 + * @returns {boolean} True if anchor link
     88 + */
     89 +export function isAnchorLink(path) {
     90 +  if (!path) return false;
     91 +  return path.startsWith('#');
     92 +}
     93 +
     94 +/**
     95 + * Extract directory path from file path
     96 + * @param {string} filePath - Full file path
     97 + * @returns {string} Directory path
     98 + * @example
     99 + * getDirectory('docs/folder/file.md')
    100 + * // Returns: 'docs/folder'
    101 + */
    102 +export function getDirectory(filePath) {
    103 +  const normalized = normalizePath(filePath);
    104 +  const segments = normalized.split('/');
    105 +  segments.pop(); // Remove filename
    106 +  return segments.join('/');
    107 +}
    108 +
    109 +/**
    110 + * Extract filename from path
    111 + * @param {string} filePath - Full file path
    112 + * @returns {string} Filename
    113 + * @example
    114 + * getFilename('docs/folder/file.md')
    115 + * // Returns: 'file.md'
    116 + */
    117 +export function getFilename(filePath) {
    118 +  const normalized = normalizePath(filePath);
    119 +  const segments = normalized.split('/');
    120 +  return segments[segments.length - 1] || '';
    121 +}
    122 +
    123 +/**
    124 + * Check if path is within allowed root (prevents path traversal attacks)
    125 + * @param {string} path - Path to validate
    126 + * @param {string} rootPath - Root directory path
    127 + * @returns {boolean} True if path is within root
    128 + */
    129 +export function isWithinRoot(path, rootPath) {
    130 +  const normalizedPath = normalizePath(path);
    131 +  const normalizedRoot = normalizePath(rootPath);
    132 +
    133 +  // Empty path or trying to escape root
    134 +  if (!normalizedPath) return false;
    135 +  if (normalizedPath.startsWith('..')) return false;
    136 +
    137 +  // Check if path starts with root
    138 +  return normalizedPath === normalizedRoot || normalizedPath.startsWith(`${normalizedRoot}/`);
    139 +}
    140  

```

---

## ü§ñ AI Review Checklist

Please review these changes for:

### üîç Code Quality
- [ ] **Linting Compliance**: No unused imports/variables, proper formatting
- [ ] **Type Safety**: Proper typing throughout (TypeScript/Python type hints)
- [ ] **Best Practices**: Framework-specific conventions and patterns
- [ ] **Performance**: Efficient algorithms, proper memoization
- [ ] **Documentation**: Clear comments and function descriptions

### üêõ Potential Issues
- [ ] **Runtime Errors**: Type mismatches, null/undefined handling
- [ ] **Logic Bugs**: Incorrect calculations, edge cases
- [ ] **Memory Leaks**: Cleanup in lifecycle methods, event listeners
- [ ] **Error Handling**: Proper try-catch blocks, user feedback
- [ ] **Accessibility**: ARIA labels, keyboard navigation, screen readers

### üîí Security & Data
- [ ] **Input Validation**: Sanitization, XSS prevention, SQL injection
- [ ] **Authentication**: Proper access controls and permissions
- [ ] **Privacy**: No sensitive data exposure in logs/client
- [ ] **Dependencies**: Updated packages, vulnerability checks

### üì± UX/UI
- [ ] **Responsive Design**: Mobile/desktop/tablet compatibility
- [ ] **Loading States**: Proper feedback during async operations
- [ ] **Error Messages**: User-friendly error handling and recovery
- [ ] **Performance**: Fast loading, smooth animations

### üí° Suggestions & Improvements
Please provide specific feedback on:
1. Code organization and structure improvements
2. Performance optimization opportunities
3. Security considerations and hardening
4. Testing coverage and strategies
5. Documentation and maintainability

---
*Generated by AI Visual Code Review v2.0 - Unified Export Script*
*Files processed: 4/4 | Errors: 0 | Generated: 2026-01-19T14:08:48.872Z*
