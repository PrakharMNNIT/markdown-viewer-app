# üîç Code Review - 12/19/2025, 4:19:18 PM

**Project:** AI Visual Code Review
**Generated by:** AI Visual Code Review v2.0

## üìä Change Summary

```
.../toc-anchor-navigation-design-v5.md             | 900 +++++++++++++++++++++
 docs/competitive_programming_constraints.md        | 621 ++++++++++++++
 script.js                                          | 255 ++++++
 style.css                                          |  41 +
 variables.css                                      |  19 +-
 5 files changed, 1831 insertions(+), 5 deletions(-)
```

## üìù Files Changed (5/5 selected)


### ‚ú® `docs/01-requirements/toc-anchor-navigation-design-v5.md` **[ADDED]**

**Status:** ‚úÖ **NEW FILE** - This file has been newly created

**Type:** Documentation üìñ

```diff
@@ -0,0 +1,900 @@
      1 +# Design Document: Table of Contents Anchor Navigation
      2 +
      3 +## Version 5.0 (Production Ready - Final)
      4 +
      5 +---
      6 +
      7 +**Document ID:** DD-2025-002-TOC-NAV
      8 +**Author:** Principal SDE
      9 +**Created:** December 19, 2025
     10 +**Last Updated:** December 19, 2025
     11 +**Status:** ‚úÖ **APPROVED FOR IMPLEMENTATION**
     12 +**Review Cycles:** 8 (v1.0 ‚Üí v2.0 ‚Üí v3.0 ‚Üí v4.0 ‚Üí v4.1 ‚Üí v4.2 ‚Üí v4.3 ‚Üí v5.0)
     13 +
     14 +---
     15 +
     16 +## Table of Contents
     17 +
     18 +1. [Executive Summary](#1-executive-summary)
     19 +2. [Problem Statement](#2-problem-statement)
     20 +3. [Requirements](#3-requirements)
     21 +4. [Technical Design](#4-technical-design)
     22 +5. [Implementation Details](#5-implementation-details)
     23 +6. [Browser Compatibility](#6-browser-compatibility)
     24 +7. [Testing Strategy](#7-testing-strategy)
     25 +8. [Performance Budget](#8-performance-budget)
     26 +9. [Security Considerations](#9-security-considerations)
     27 +10. [Rollback Plan](#10-rollback-plan)
     28 +11. [FAQ](#11-faq)
     29 +12. [Approval](#12-approval)
     30 +13. [Change Log](#13-change-log)
     31 +
     32 +---
     33 +
     34 +## 1. Executive Summary
     35 +
     36 +This document specifies the implementation of in-document anchor navigation for Markdown Viewer Pro. The feature enables clicking Table of Contents links to scroll the preview container to the target heading, with full accessibility support and legacy link compatibility.
     37 +
     38 +**Key Features:**
     39 +- Smooth scroll to headings on TOC link click
     40 +- Support for emoji and special character headings
     41 +- Legacy link compatibility (non-standard ID formats)
     42 +- Accessibility-compliant focus management
     43 +- Deep linking (URL hash on page load)
     44 +- Browser history support (back/forward)
     45 +
     46 +---
     47 +
     48 +## 2. Problem Statement
     49 +
     50 +### 2.1 Root Cause
     51 +
     52 +The application uses a **non-scrollable document body** (`overflow: hidden`) with content rendered inside a scrollable child container (`.preview-container`). When users click anchor links (`href="#section"`), the browser's native scroll algorithm targets the document viewport‚Äîwhich is non-scrollable‚Äîresulting in **silent failure**.
     53 +
     54 +### 2.2 Sticky Toolbar Occlusion
     55 +
     56 +The application has a fixed toolbar (height: `60px`). A naive scroll-to-element positions content at `top: 0`, causing it to be **obscured by the toolbar**.
     57 +
     58 +### 2.3 Legacy Link Compatibility
     59 +
     60 +Existing markdown documents contain manually-created links using non-standard ID formats (e.g., `#üìã-table-of-contents` or `#-standard-assumptions`). These must resolve correctly.
     61 +
     62 +### 2.4 App Shell ID Collision
     63 +
     64 +The application shell has elements with IDs like `sidebar`, `preview`, `editor`. User-authored headings with the same names must NOT collide with app shell elements.
     65 +
     66 +### 2.5 marked.js Singleton Constraint
     67 +
     68 +`marked` is imported as a global singleton. Calling `marked.use()` inside `renderMarkdown()` (which runs on every keystroke) would stack infinite extensions, causing:
     69 +- **Memory leak:** `marked.defaults.extensions` grows infinitely
     70 +- **Performance degradation:** After 100 keystrokes, marked runs 100 identical renderers
     71 +
     72 +---
     73 +
     74 +## 3. Requirements
     75 +
     76 +### 3.1 Functional Requirements
     77 +
     78 +| ID | Requirement | Priority | Acceptance Criteria |
     79 +|----|-------------|----------|---------------------|
     80 +| FR-1 | Internal anchor clicks scroll preview to target | P0 | Target heading visible within 800ms |
     81 +| FR-2 | Scrolled content not occluded by toolbar | P0 | 20px gap between toolbar and heading |
     82 +| FR-3 | URL hash updates on navigation | P0 | URL reflects current section |
     83 +| FR-4 | Deep linking works on page load | P0 | `URL#section` scrolls on load |
     84 +| FR-5 | Browser back/forward navigates history | P1 | Hash changes scroll correctly |
     85 +| FR-6 | Legacy links work (emoji, special chars) | P0 | See compatibility matrix |
     86 +| FR-7 | Focus moves to target for screen readers | P0 | Screen reader announces heading |
     87 +| FR-8 | Empty hash (`#`) scrolls to top | P1 | Container scrollTop = 0 |
     88 +| FR-9 | No collision with app shell IDs | P0 | User `## Sidebar` != app `#sidebar` |
     89 +| FR-10 | Duplicate headings get unique IDs | P0 | `header`, `header-1`, `header-2` |
     90 +
     91 +### 3.2 Non-Functional Requirements
     92 +
     93 +| ID | Requirement | Target |
     94 +|----|-------------|--------|
     95 +| NFR-1 | Click-to-scroll latency | < 16ms (1 frame) |
     96 +| NFR-2 | Scroll animation duration | 300-800ms (distance-based) |
     97 +| NFR-3 | No layout thrashing | 0 forced reflows |
     98 +| NFR-4 | Memory overhead | < 1KB per session |
     99 +| NFR-5 | No memory leaks | Zero extension stacking |
    100 +| NFR-6 | Stateless rendering | Module-level map with reset |
    101 +
    102 +### 3.3 Edge Cases
    103 +
    104 +| Case | Input | Expected Behavior |
    105 +|------|-------|-------------------|
    106 +| Empty hash | `href="#"` | Scroll to top (scrollTop = 0) |
    107 +| Non-existent target | `href="#nonexistent"` | Console warning, no action |
    108 +| External link | `href="https://..."` | Browser default behavior |
    109 +| Duplicate headers | Two `## Header` | IDs: `header`, `header-1` |
    110 +| App shell collision | `## Sidebar` | Resolves to user content, not `#sidebar` |
    111 +| Special chars | `## C++` | ID: `cpp` |
    112 +| Emoji | `## üéØ Goal` | ID: `goal` |
    113 +| Concurrent clicks | Click A, then B rapidly | Cancel A, execute B |
    114 +| Already visible | Target in viewport | Smooth scroll anyway |
    115 +
    116 +---
    117 +
    118 +## 4. Technical Design
    119 +
    120 +### 4.1 Architecture Overview
    121 +
    122 +```
    123 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    124 +‚îÇ                     User Interaction                          ‚îÇ
    125 +‚îÇ  [Click] ‚îÄ‚îÄ‚ñ∫ [hashchange] ‚îÄ‚îÄ‚ñ∫ [Page Load with Hash]          ‚îÇ
    126 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    127 +                       ‚îÇ
    128 +                       ‚ñº
    129 +‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    130 +‚îÇ                 AnchorNavigation Module                       ‚îÇ
    131 +‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
    132 +‚îÇ  ‚îÇ handleClick()  ‚îÇ  ‚îÇhandleHashChange‚îÇ  ‚îÇhandleInitLoad()‚îÇ  ‚îÇ
    133 +‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
    134 +‚îÇ          ‚îÇ                   ‚îÇ                   ‚îÇ            ‚îÇ
    135 +‚îÇ          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
    136 +‚îÇ                              ‚ñº                                ‚îÇ
    137 +‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
    138 +‚îÇ                   ‚îÇ  scrollToTarget()   ‚îÇ                     ‚îÇ
    139 +‚îÇ                   ‚îÇ  ‚îî‚îÄ resolveTarget() ‚îÇ  ‚óÑ‚îÄ‚îÄ SCOPED to      ‚îÇ
    140 +‚îÇ                   ‚îÇ  ‚îî‚îÄ scrollIntoView  ‚îÇ      container      ‚îÇ
    141 +‚îÇ                   ‚îÇ  ‚îî‚îÄ manageFocus()   ‚îÇ                     ‚îÇ
    142 +‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
    143 +‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    144 +```
    145 +
    146 +### 4.2 Slug Generation Algorithm
    147 +
    148 +**Purpose:** Generate consistent, collision-free IDs for headings.
    149 +
    150 +**Algorithm (GitHub-compatible with programming term support):**
    151 +
    152 +```javascript
    153 +// Pre-compiled regex patterns (module level - zero GC pressure)
    154 +const SLUG_REPLACEMENTS = [
    155 +  [/c\+\+/gi, 'cpp'],
    156 +  [/c#/gi, 'csharp'],
    157 +  [/f#/gi, 'fsharp'],
    158 +  [/\.net/gi, 'dotnet'],
    159 +];
    160 +
    161 +/**
    162 + * Generate URL-safe slug from heading text
    163 + * @param {string} text - Raw heading text (may include HTML)
    164 + * @param {Map<string, number>} seen - Duplicate tracking map
    165 + * @returns {string} URL-safe slug
    166 + */
    167 +function generateSlug(text, seen = new Map()) {
    168 +  // Step 0: Strip HTML tags
    169 +  let slug = text.replace(/<[^>]*>/g, '');
    170 +
    171 +  // Step 1: Normalize Unicode (handle caf√© vs caf√©)
    172 +  slug = slug.normalize('NFC');
    173 +
    174 +  // Step 2: Lowercase
    175 +  slug = slug.toLowerCase();
    176 +
    177 +  // Step 3: Replace programming terms (pre-compiled patterns)
    178 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
    179 +    slug = slug.replace(pattern, replacement);
    180 +  }
    181 +
    182 +  // Step 4: Remove non-word chars (keep spaces, hyphens, underscores)
    183 +  slug = slug.replace(/[^\w\s-]/g, '');
    184 +
    185 +  // Step 5: Spaces to hyphens
    186 +  slug = slug.replace(/\s+/g, '-');
    187 +
    188 +  // Step 6: Collapse multiple hyphens
    189 +  slug = slug.replace(/-+/g, '-');
    190 +
    191 +  // Step 7: Trim hyphens
    192 +  slug = slug.replace(/^-+|-+$/g, '');
    193 +
    194 +  // Step 8: Fallback for empty result
    195 +  if (!slug) slug = 'section';
    196 +
    197 +  // Step 9: Handle duplicates (header, header-1, header-2)
    198 +  const baseSlug = slug;
    199 +  const count = seen.get(baseSlug) || 0;
    200 +  if (count > 0) {
    201 +    slug = `${baseSlug}-${count}`;
    202 +  }
    203 +  seen.set(baseSlug, count + 1);
    204 +
    205 +  return slug;
    206 +}
    207 +```
    208 +
    209 +**Transformation Examples:**
    210 +
    211 +| Input | Output | Reason |
    212 +|-------|--------|--------|
    213 +| `Hello World` | `hello-world` | Standard |
    214 +| `üéØ Standard Assumptions` | `standard-assumptions` | Emoji stripped |
    215 +| `C++` | `cpp` | Special replacement |
    216 +| `C#` | `csharp` | Special replacement |
    217 +| `.NET Framework` | `dotnet-framework` | Special replacement |
    218 +| `F#` | `fsharp` | Special replacement |
    219 +| `API v2.0` | `api-v20` | Period stripped |
    220 +| `1. Introduction` | `1-introduction` | Numbers preserved |
    221 +| `hello_world` | `hello_world` | Underscores preserved |
    222 +| `Header` (1st) | `header` | First occurrence |
    223 +| `Header` (2nd) | `header-1` | Duplicate handling |
    224 +| `Header` (3rd) | `header-2` | Duplicate handling |
    225 +| `üòÄüòÄüòÄ` | `section` | Fallback for empty |
    226 +| `--test--` | `test` | Trimmed |
    227 +
    228 +### 4.3 State Management (Singleton-Safe)
    229 +
    230 +**Critical:** `marked` is a global singleton. Extension registration happens ONCE at startup.
    231 +
    232 +```javascript
    233 +// Module level (script.js, near top)
    234 +const headingSlugMap = new Map();
    235 +
    236 +function resetSlugMap() {
    237 +  headingSlugMap.clear();
    238 +}
    239 +
    240 +// In configureMarkedExtensions() - called ONCE at app init
    241 +marked.use({
    242 +  renderer: {
    243 +    heading(token) {
    244 +      const text = this.parser.parseInline(token.tokens);
    245 +      const level = token.depth;
    246 +      const slug = generateSlug(text, headingSlugMap);
    247 +      return `<h${level} id="${slug}">${text}</h${level}>\n`;
    248 +    }
    249 +  }
    250 +});
    251 +
    252 +// In renderMarkdown() - called on every keystroke
    253 +function renderMarkdown() {
    254 +  resetSlugMap();  // Clear state, NOT re-register extension
    255 +  const html = marked.parse(text);
    256 +  // ...
    257 +}
    258 +```
    259 +
    260 +### 4.4 Link Resolution (Scoped Selection)
    261 +
    262 +**Purpose:** Match clicked links to generated IDs, preventing app shell collision.
    263 +
    264 +```javascript
    265 +/**
    266 + * Resolve target element from hash - SCOPED to container
    267 + * @param {string} hash - URL hash (without #)
    268 + * @param {HTMLElement} container - Scrollable container
    269 + * @returns {Element|null} Target element or null
    270 + */
    271 +function resolveTarget(hash, container) {
    272 +  if (!hash) return null;
    273 +
    274 +  // Decode URI components
    275 +  let decodedHash;
    276 +  try {
    277 +    decodedHash = decodeURIComponent(hash);
    278 +  } catch {
    279 +    decodedHash = hash;
    280 +  }
    281 +
    282 +  // Priority 1: Exact ID (SCOPED to container - prevents app shell collision)
    283 +  let target = container.querySelector(`#${CSS.escape(decodedHash)}`);
    284 +  if (target) return target;
    285 +
    286 +  // Priority 2: Normalized ID (handles legacy links)
    287 +  const normalizedHash = normalizeHash(decodedHash);
    288 +  target = container.querySelector(`#${CSS.escape(normalizedHash)}`);
    289 +  if (target) return target;
    290 +
    291 +  console.warn(`[AnchorNav] Target not found: "${hash}"`);
    292 +  return null;
    293 +}
    294 +
    295 +/**
    296 + * Normalize hash for legacy link matching
    297 + */
    298 +function normalizeHash(hash) {
    299 +  let slug = hash.normalize('NFC').toLowerCase();
    300 +
    301 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
    302 +    slug = slug.replace(pattern, replacement);
    303 +  }
    304 +
    305 +  return slug
    306 +    .replace(/[^\w\s-]/g, '')
    307 +    .replace(/\s+/g, '-')
    308 +    .replace(/-+/g, '-')
    309 +    .replace(/^-+|-+$/g, '') || 'section';
    310 +}
    311 +```
    312 +
    313 +---
    314 +
    315 +## 5. Implementation Details
    316 +
    317 +### 5.1 CSS Configuration
    318 +
    319 +**File: `variables.css`** (add to existing `:root`)
    320 +```css
    321 +:root {
    322 +  /* Existing variables... */
    323 +
    324 +  /* Anchor Navigation */
    325 +  --toolbar-height: 60px;
    326 +  --scroll-padding: 20px;
    327 +  --scroll-offset: calc(var(--toolbar-height) + var(--scroll-padding));
    328 +}
    329 +```
    330 +
    331 +**File: `style.css`** (add new section)
    332 +```css
    333 +/* ==================== ANCHOR NAVIGATION ==================== */
    334 +
    335 +/* Scroll padding - SINGLE SOURCE of offset */
    336 +.preview-container {
    337 +  scroll-padding-top: var(--scroll-offset, 80px);
    338 +}
    339 +
    340 +/* Target highlight animation */
    341 +.preview-container :target {
    342 +  animation: anchor-highlight 2s ease-out;
    343 +}
    344 +
    345 +@keyframes anchor-highlight {
    346 +  0% { background-color: rgba(255, 255, 0, 0.3); }
    347 +  100% { background-color: transparent; }
    348 +}
    349 +
    350 +/* Focus management - conditional outline */
    351 +.preview-container h1[id]:focus:not(:focus-visible),
    352 +.preview-container h2[id]:focus:not(:focus-visible),
    353 +.preview-container h3[id]:focus:not(:focus-visible),
    354 +.preview-container h4[id]:focus:not(:focus-visible),
    355 +.preview-container h5[id]:focus:not(:focus-visible),
    356 +.preview-container h6[id]:focus:not(:focus-visible) {
    357 +  outline: none;
    358 +}
    359 +
    360 +/* Keyboard focus gets visible indicator */
    361 +.preview-container h1[id]:focus-visible,
    362 +.preview-container h2[id]:focus-visible,
    363 +.preview-container h3[id]:focus-visible,
    364 +.preview-container h4[id]:focus-visible,
    365 +.preview-container h5[id]:focus-visible,
    366 +.preview-container h6[id]:focus-visible {
    367 +  outline: 2px solid var(--primary-color, #007bff);
    368 +  outline-offset: 4px;
    369 +  border-radius: 2px;
    370 +}
    371 +```
    372 +
    373 +### 5.2 JavaScript Implementation
    374 +
    375 +**File: `script.js`** (modifications)
    376 +
    377 +```javascript
    378 +// ==================== ANCHOR NAVIGATION ====================
    379 +// Add near top of file, after imports
    380 +
    381 +// Heading slug tracking (module-level singleton)
    382 +const headingSlugMap = new Map();
    383 +
    384 +// Pre-compiled slug replacements (zero GC pressure)
    385 +const SLUG_REPLACEMENTS = [
    386 +  [/c\+\+/gi, 'cpp'],
    387 +  [/c#/gi, 'csharp'],
    388 +  [/f#/gi, 'fsharp'],
    389 +  [/\.net/gi, 'dotnet'],
    390 +];
    391 +
    392 +/**
    393 + * Reset slug map (call before each parse)
    394 + */
    395 +function resetSlugMap() {
    396 +  headingSlugMap.clear();
    397 +}
    398 +
    399 +/**
    400 + * Generate URL-safe slug from heading text
    401 + */
    402 +function generateSlug(text, seen = headingSlugMap) {
    403 +  // Strip HTML tags
    404 +  let slug = text.replace(/<[^>]*>/g, '');
    405 +
    406 +  // Normalize Unicode
    407 +  slug = slug.normalize('NFC').toLowerCase();
    408 +
    409 +  // Replace programming terms
    410 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
    411 +    slug = slug.replace(pattern, replacement);
    412 +  }
    413 +
    414 +  // Clean up
    415 +  slug = slug
    416 +    .replace(/[^\w\s-]/g, '')
    417 +    .replace(/\s+/g, '-')
    418 +    .replace(/-+/g, '-')
    419 +    .replace(/^-+|-+$/g, '');
    420 +
    421 +  if (!slug) slug = 'section';
    422 +
    423 +  // Handle duplicates
    424 +  const baseSlug = slug;
    425 +  const count = seen.get(baseSlug) || 0;
    426 +  if (count > 0) slug = `${baseSlug}-${count}`;
    427 +  seen.set(baseSlug, count + 1);
    428 +
    429 +  return slug;
    430 +}
    431 +
    432 +/**
    433 + * Anchor Navigation Module
    434 + */
    435 +const AnchorNavigation = {
    436 +  container: null,
    437 +  pendingScroll: null,
    438 +
    439 +  /**
    440 +   * Initialize anchor navigation
    441 +   */
    442 +  init(previewContainer) {
    443 +    this.container = previewContainer;
    444 +
    445 +    // Event delegation for clicks
    446 +    this.container.addEventListener('click', this.handleClick.bind(this));
    447 +
    448 +    // Browser back/forward
    449 +    window.addEventListener('hashchange', this.handleHashChange.bind(this));
    450 +
    451 +    // Initial page load with hash
    452 +    if (window.location.hash) {
    453 +      requestAnimationFrame(() => {
    454 +        this.scrollToHash(window.location.hash.slice(1), false);
    455 +      });
    456 +    }
    457 +  },
    458 +
    459 +  /**
    460 +   * Handle click events (delegated)
    461 +   */
    462 +  handleClick(event) {
    463 +    const link = event.target.closest('a[href^="#"]');
    464 +    if (!link) return;
    465 +
    466 +    // Ignore external links
    467 +    if (link.hostname && link.hostname !== window.location.hostname) return;
    468 +
    469 +    event.preventDefault();
    470 +
    471 +    const hash = link.getAttribute('href').slice(1);
    472 +    this.scrollToHash(hash, true);
    473 +
    474 +    // Update URL
    475 +    history.pushState(null, '', `#${hash}`);
    476 +  },
    477 +
    478 +  /**
    479 +   * Handle hashchange (back/forward)
    480 +   */
    481 +  handleHashChange() {
    482 +    const hash = window.location.hash.slice(1);
    483 +    if (hash) {
    484 +      this.scrollToHash(hash, true);
    485 +    } else {
    486 +      this.scrollToTop(true);
    487 +    }
    488 +  },
    489 +
    490 +  /**
    491 +   * Scroll to element by hash
    492 +   */
    493 +  scrollToHash(hash, smooth = true) {
    494 +    // Cancel pending scroll (handle concurrent clicks)
    495 +    if (this.pendingScroll) {
    496 +      clearTimeout(this.pendingScroll);
    497 +      this.pendingScroll = null;
    498 +    }
    499 +
    500 +    if (!hash) {
    501 +      this.scrollToTop(smooth);
    502 +      return;
    503 +    }
    504 +
    505 +    const target = this.resolveTarget(hash);
    506 +    if (!target) return;
    507 +
    508 +    target.scrollIntoView({
    509 +      behavior: smooth ? 'smooth' : 'instant',
    510 +      block: 'start',
    511 +    });
    512 +
    513 +    this.manageFocus(target, smooth);
    514 +  },
    515 +
    516 +  /**
    517 +   * Scroll to top
    518 +   */
    519 +  scrollToTop(smooth = true) {
    520 +    this.container.scrollTo({
    521 +      top: 0,
    522 +      behavior: smooth ? 'smooth' : 'instant',
    523 +    });
    524 +  },
    525 +
    526 +  /**
    527 +   * Resolve target - SCOPED to container
    528 +   */
    529 +  resolveTarget(hash) {
    530 +    if (!hash) return null;
    531 +
    532 +    let decodedHash;
    533 +    try {
    534 +      decodedHash = decodeURIComponent(hash);
    535 +    } catch {
    536 +      decodedHash = hash;
    537 +    }
    538 +
    539 +    // Priority 1: Exact ID (scoped)
    540 +    let target = this.container.querySelector(`#${CSS.escape(decodedHash)}`);
    541 +    if (target) return target;
    542 +
    543 +    // Priority 2: Normalized ID (scoped)
    544 +    const normalized = this.normalizeHash(decodedHash);
    545 +    target = this.container.querySelector(`#${CSS.escape(normalized)}`);
    546 +    if (target) return target;
    547 +
    548 +    console.warn(`[AnchorNav] Target not found: "${hash}"`);
    549 +    return null;
    550 +  },
    551 +
    552 +  /**
    553 +   * Normalize hash for legacy link matching
    554 +   */
    555 +  normalizeHash(hash) {
    556 +    let slug = hash.normalize('NFC').toLowerCase();
    557 +
    558 +    for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
    559 +      slug = slug.replace(pattern, replacement);
    560 +    }
    561 +
    562 +    return slug
    563 +      .replace(/[^\w\s-]/g, '')
    564 +      .replace(/\s+/g, '-')
    565 +      .replace(/-+/g, '-')
    566 +      .replace(/^-+|-+$/g, '') || 'section';
    567 +  },
    568 +
    569 +  /**
    570 +   * Manage focus after scroll
    571 +   */
    572 +  manageFocus(target, smooth) {
    573 +    const focusTarget = () => {
    574 +      if (!target.hasAttribute('tabindex')) {
    575 +        target.setAttribute('tabindex', '-1');
    576 +      }
    577 +      target.focus({ preventScroll: true });
    578 +    };
    579 +
    580 +    if (!smooth) {
    581 +      focusTarget();
    582 +      return;
    583 +    }
    584 +
    585 +    // Modern: scrollend event
    586 +    if ('onscrollend' in this.container) {
    587 +      this.container.addEventListener('scrollend', focusTarget, { once: true });
    588 +    } else {
    589 +      // Fallback: estimate duration (max 1000ms for safety)
    590 +      const distance = Math.abs(target.getBoundingClientRect().top);
    591 +      const duration = Math.min(Math.max(distance / 2, 300), 1000);
    592 +      this.pendingScroll = setTimeout(focusTarget, duration + 50);
    593 +    }
    594 +  },
    595 +};
    596 +```
    597 +
    598 +### 5.3 Integration Points
    599 +
    600 +**In `configureMarkedExtensions()`:**
    601 +```javascript
    602 +function configureMarkedExtensions() {
    603 +  // ... existing extensions ...
    604 +
    605 +  // Custom heading renderer with ID generation
    606 +  marked.use({
    607 +    renderer: {
    608 +      heading(token) {
    609 +        const text = this.parser.parseInline(token.tokens);
    610 +        const level = token.depth;
    611 +        const slug = generateSlug(text, headingSlugMap);
    612 +        return `<h${level} id="${slug}">${text}</h${level}>\n`;
    613 +      }
    614 +    }
    615 +  });
    616 +  console.log('‚úÖ Custom heading renderer enabled (ID generation)');
    617 +}
    618 +```
    619 +
    620 +**In `renderMarkdown()`:**
    621 +```javascript
    622 +function renderMarkdown() {
    623 +  try {
    624 +    resetSlugMap();  // Clear slug tracking before parse
    625 +
    626 +    const markdownText = editor.value;
    627 +    let html = marked.parse(markdownText);
    628 +    // ... rest of existing logic ...
    629 +  }
    630 +}
    631 +```
    632 +
    633 +**In `setupEditor()` (at end):**
    634 +```javascript
    635 +// Initialize anchor navigation
    636 +AnchorNavigation.init(previewContainer);
    637 +```
    638 +
    639 +---
    640 +
    641 +## 6. Browser Compatibility
    642 +
    643 +| Feature | Chrome | Firefox | Safari | Edge | Fallback |
    644 +|---------|--------|---------|--------|------|----------|
    645 +| `scrollIntoView({ behavior })` | 61+ | 36+ | 15.4+ | 79+ | Instant scroll |
    646 +| `scrollend` event | 114+ | 109+ | 17+ | 114+ | setTimeout (1000ms max) |
    647 +| `scroll-padding-top` | 69+ | 68+ | 14.1+ | 79+ | None needed |
    648 +| `CSS.escape()` | 46+ | 31+ | 10+ | 79+ | None needed |
    649 +| `:focus-visible` | 86+ | 85+ | 15.4+ | 86+ | Always show outline |
    650 +
    651 +**Minimum Supported:** Chrome 86, Firefox 85, Safari 15.4, Edge 86
    652 +
    653 +---
    654 +
    655 +## 7. Testing Strategy
    656 +
    657 +### 7.1 Unit Tests
    658 +
    659 +**File: `tests/unit/utils/anchorNavigation.test.js`**
    660 +
    661 +```javascript
    662 +import { describe, it, expect, beforeEach } from 'vitest';
    663 +
    664 +describe('generateSlug', () => {
    665 +  let seen;
    666 +
    667 +  beforeEach(() => {
    668 +    seen = new Map();
    669 +  });
    670 +
    671 +  describe('basic transformations', () => {
    672 +    it('converts to lowercase', () => {
    673 +      expect(generateSlug('HELLO', seen)).toBe('hello');
    674 +    });
    675 +
    676 +    it('replaces spaces with hyphens', () => {
    677 +      expect(generateSlug('hello world', seen)).toBe('hello-world');
    678 +    });
    679 +
    680 +    it('preserves numbers', () => {
    681 +      expect(generateSlug('Section 1', seen)).toBe('section-1');
    682 +    });
    683 +
    684 +    it('preserves underscores', () => {
    685 +      expect(generateSlug('hello_world', seen)).toBe('hello_world');
    686 +    });
    687 +  });
    688 +
    689 +  describe('special characters', () => {
    690 +    it('removes emoji', () => {
    691 +      expect(generateSlug('üéØ Goal', seen)).toBe('goal');
    692 +    });
    693 +
    694 +    it('handles C++', () => {
    695 +      expect(generateSlug('C++', seen)).toBe('cpp');
    696 +    });
    697 +
    698 +    it('handles C#', () => {
    699 +      expect(generateSlug('C#', seen)).toBe('csharp');
    700 +    });
    701 +
    702 +    it('handles F#', () => {
    703 +      expect(generateSlug('F#', seen)).toBe('fsharp');
    704 +    });
    705 +
    706 +    it('handles .NET', () => {
    707 +      expect(generateSlug('.NET Framework', seen)).toBe('dotnet-framework');
    708 +    });
    709 +
    710 +    it('strips periods', () => {
    711 +      expect(generateSlug('API v2.0', seen)).toBe('api-v20');
    712 +    });
    713 +  });
    714 +
    715 +  describe('edge cases', () => {
    716 +    it('collapses multiple hyphens', () => {
    717 +      expect(generateSlug('hello--world', seen)).toBe('hello-world');
    718 +    });
    719 +
    720 +    it('trims leading hyphens', () => {
    721 +      expect(generateSlug('--hello', seen)).toBe('hello');
    722 +    });
    723 +
    724 +    it('trims trailing hyphens', () => {
    725 +      expect(generateSlug('hello--', seen)).toBe('hello');
    726 +    });
    727 +
    728 +    it('returns "section" for empty result', () => {
    729 +      expect(generateSlug('!!!', seen)).toBe('section');
    730 +      expect(generateSlug('üòÄüòÄüòÄ', seen)).toBe('section');
    731 +    });
    732 +
    733 +    it('handles unicode normalization', () => {
    734 +      expect(generateSlug('caf√©', seen)).toBe('caf');
    735 +    });
    736 +
    737 +    it('strips HTML tags', () => {
    738 +      expect(generateSlug('<strong>Bold</strong> text', seen)).toBe('bold-text');
    739 +    });
    740 +  });
    741 +
    742 +  describe('duplicate handling', () => {
    743 +    it('adds suffix for duplicates', () => {
    744 +      expect(generateSlug('Header', seen)).toBe('header');
    745 +      expect(generateSlug('Header', seen)).toBe('header-1');
    746 +      expect(generateSlug('Header', seen)).toBe('header-2');
    747 +    });
    748 +
    749 +    it('tracks different bases separately', () => {
    750 +      expect(generateSlug('Header', seen)).toBe('header');
    751 +      expect(generateSlug('Footer', seen)).toBe('footer');
    752 +      expect(generateSlug('Header', seen)).toBe('header-1');
    753 +    });
    754 +  });
    755 +});
    756 +
    757 +describe('normalizeHash', () => {
    758 +  it('normalizes legacy emoji links', () => {
    759 +    expect(normalizeHash('üéØ-standard-assumptions')).toBe('standard-assumptions');
    760 +  });
    761 +
    762 +  it('normalizes leading hyphens', () => {
    763 +    expect(normalizeHash('-hello-world-')).toBe('hello-world');
    764 +  });
    765 +
    766 +  it('handles programming terms', () => {
    767 +    expect(normalizeHash('c++')).toBe('cpp');
    768 +  });
    769 +});
    770 +```
    771 +
    772 +### 7.2 Manual Test Cases
    773 +
    774 +| # | Scenario | Steps | Expected Result |
    775 +|---|----------|-------|-----------------|
    776 +| 1 | Standard TOC click | Click TOC link `#introduction` | Scrolls to heading, visible below toolbar |
    777 +| 2 | Emoji header | Click `#üéØ-goal` | Resolves to `#goal`, scrolls correctly |
    778 +| 3 | C++ header | Click `#c++` | Resolves to `#cpp`, scrolls correctly |
    779 +| 4 | Deep link | Load `URL#section-1` | Page scrolls to section on load |
    780 +| 5 | Browser back | Click link, then browser back | Returns to previous scroll position |
    781 +| 6 | Empty hash | Click `href="#"` | Scrolls to top of container |
    782 +| 7 | Invalid target | Click `#nonexistent` | Console warning, no crash |
    783 +| 8 | Duplicate headers | Two `## Header` | First is `#header`, second is `#header-1` |
    784 +| 9 | App shell collision | `## Sidebar` heading | Scrolls to user heading, not app `#sidebar` |
    785 +| 10 | Accessibility | Tab to link, press Enter | Focus moves to heading, screen reader announces |
    786 +| 11 | Concurrent clicks | Click A, immediately click B | Only B executes |
    787 +
    788 +---
    789 +
    790 +## 8. Performance Budget
    791 +
    792 +| Metric | Budget | Measurement Method |
    793 +|--------|--------|-------------------|
    794 +| Click-to-scroll latency | < 16ms | `performance.now()` delta |
    795 +| Slug generation per heading | < 1ms | Profile in DevTools |
    796 +| DOM queries per click | ‚â§ 2 | Code review |
    797 +| Memory per session | < 1KB | DevTools heap snapshot |
    798 +| Extension stack size | 1 (no growth) | `marked.defaults.extensions.length` |
    799 +
    800 +---
    801 +
    802 +## 9. Security Considerations
    803 +
    804 +| Concern | Risk | Mitigation |
    805 +|---------|------|------------|
    806 +| XSS via hash | Low | Hash is never inserted into innerHTML |
    807 +| Open redirect | Low | Only same-origin hashes processed |
    808 +| DoS (rapid clicks) | Low | Pending scroll cancellation |
    809 +| Invalid ID injection | Low | `CSS.escape()` for selectors |
    810 +| HTML in headings | Medium | Tags stripped before slug generation |
    811 +
    812 +---
    813 +
    814 +## 10. Rollback Plan
    815 +
    816 +### 10.1 Affected Files
    817 +
    818 +| File | Changes |
    819 +|------|---------|
    820 +| `script.js` | Add AnchorNavigation module, generateSlug, heading renderer |
    821 +| `style.css` | Add scroll-padding, focus-visible styles |
    822 +| `variables.css` | Add --scroll-offset variable |
    823 +
    824 +### 10.2 Rollback Command
    825 +
    826 +```bash
    827 +git checkout HEAD~1 -- script.js style.css variables.css
    828 +```
    829 +
    830 +### 10.3 Rollback Criteria
    831 +
    832 +- Any markdown rendering regression
    833 +- JavaScript console errors
    834 +- Theme switching broken
    835 +- Memory leak detected (extension stacking)
    836 +
    837 +### 10.4 Verification Steps
    838 +
    839 +1. Reload application
    840 +2. Verify no console errors
    841 +3. Type in editor, verify preview updates
    842 +4. Switch themes, verify no errors
    843 +5. Check `marked.defaults` has stable extension count
    844 +
    845 +---
    846 +
    847 +## 11. FAQ
    848 +
    849 +**Q1: Will this break existing functionality?**
    850 +> No. This is an additive feature. Existing markdown rendering is unchanged.
    851 +
    852 +**Q2: What if a heading contains only emoji?**
    853 +> The slug becomes `section` (fallback for empty result).
    854 +
    855 +**Q3: Will this affect HTML export?**
    856 +> Exported HTML will include the generated IDs. Navigation will work if opened in a browser.
    857 +
    858 +**Q4: What about very long headings?**
    859 +> No length limit. The full heading becomes the slug (performance tested up to 1000 chars).
    860 +
    861 +**Q5: Can users manually specify IDs?**
    862 +> Not currently. This would require parsing `{#custom-id}` syntax, which is a future enhancement.
    863 +
    864 +**Q6: What if `marked.use()` is accidentally called in `renderMarkdown()`?**
    865 +> This would cause extension stacking (memory leak). The design explicitly prevents this by registering ONCE in `configureMarkedExtensions()` and only calling `resetSlugMap()` per render.
    866 +
    867 +**Q7: Why use `CSS.escape()` instead of simple string matching?**
    868 +> IDs can contain special CSS selector characters (`.`, `#`, `:`). `CSS.escape()` ensures the querySelector doesn't break.
    869 +
    870 +**Q8: What's the maximum scroll duration?**
    871 +> Capped at 1000ms for the `scrollend` fallback timeout. Smooth scroll itself is browser-controlled.
    872 +
    873 +---
    874 +
    875 +## 12. Approval
    876 +
    877 +| Role | Name | Date | Status |
    878 +|------|------|------|--------|
    879 +| Author | Principal SDE | 2025-12-19 | ‚úÖ Complete |
    880 +| Reviewer | Gemini | 2025-12-19 | ‚úÖ Approved |
    881 +| Implementation | Pending | - | ‚è≥ Ready |
    882 +
    883 +---
    884 +
    885 +## 13. Change Log
    886 +
    887 +| Version | Date | Author | Changes |
    888 +|---------|------|--------|---------|
    889 +| 1.0 | 2025-12-19 | Principal SDE | Initial draft |
    890 +| 2.0 | 2025-12-19 | Principal SDE | Added requirements, edge cases |
    891 +| 3.0 | 2025-12-19 | Gemini | Strict compliance version |
    892 +| 4.0 | 2025-12-19 | Principal SDE | Production-ready with full implementation |
    893 +| 4.1 | 2025-12-19 | Principal SDE | Fixed double offset, pre-compiled regex |
    894 +| 4.2 | 2025-12-19 | Principal SDE | Scoped selection, focus-visible |
    895 +| 4.3 | 2025-12-19 | Gemini | Identified singleton bug |
    896 +| 5.0 | 2025-12-19 | Principal SDE | **FINAL** - Module-level map, reset pattern, singleton-safe |
    897 +
    898 +---
    899 +
    900 +**End of Document**
    901  

```


### ‚ú® `docs/competitive_programming_constraints.md` **[ADDED]**

**Status:** ‚úÖ **NEW FILE** - This file has been newly created

**Type:** Documentation üìñ

```diff
@@ -0,0 +1,621 @@
      1 +# üéØ Coding Interview & Competitive Programming Constraints Guide
      2 +
      3 +### üìù 2025-12-19
      4 +**Category**: `interview prep` | **Level**: `Essential` | **Time**: `15 min read`
      5 +
      6 +> **Master the numbers** that every competitive programmer and interviewee should know by heart!
      7 +
      8 +---
      9 +
     10 +## üìã Table of Contents
     11 +
     12 +1. [Standard Assumptions](#-standard-assumptions)
     13 +2. [Integer Limits & Data Types](#-integer-limits--data-types)
     14 +3. [Array & Container Constraints](#-array--container-constraints)
     15 +4. [String Constraints](#-string-constraints)
     16 +5. [Time Complexity Limits](#-time-complexity-limits)
     17 +6. [Space Complexity Limits](#-space-complexity-limits)
     18 +7. [Common Primes & Mathematical Constants](#-common-primes--mathematical-constants)
     19 +8. [Edge Cases Checklist](#-edge-cases-checklist)
     20 +9. [Platform-Specific Constraints](#-platform-specific-constraints)
     21 +10. [Quick Reference Cheatsheet](#-quick-reference-cheatsheet)
     22 +
     23 +---
     24 +
     25 +## üéØ Standard Assumptions
     26 +
     27 +### The Golden Rules
     28 +
     29 +| Assumption | Typical Value | Reasoning |
     30 +|------------|---------------|-----------|
     31 +| **Time Limit** | 1-2 seconds | ~10‚Å∏ simple operations/second |
     32 +| **Memory Limit** | 256 MB | Standard competitive programming |
     33 +| **Max Input Size (n)** | 10‚Åµ to 10‚Å∂ | Fits in memory, allows O(n log n) |
     34 +| **Max Integer Value** | 10‚Åπ | Fits in `int` |
     35 +| **Large Integer Value** | 10¬π‚Å∏ | Requires `long long` |
     36 +
     37 +### What to Ask in Interviews
     38 +
     39 +1. **Input size constraints?** (n ‚â§ ?)
     40 +2. **Value range?** (values ‚â§ ?)
     41 +3. **Can values be negative?**
     42 +4. **Are there duplicates?**
     43 +5. **Is input sorted?**
     44 +6. **Can input be empty?**
     45 +
     46 +---
     47 +
     48 +## üî¢ Integer Limits & Data Types
     49 +
     50 +### Standard Integer Ranges
     51 +
     52 +| Type | Bytes | Range | Max (~) | Use When |
     53 +|------|-------|-------|---------|----------|
     54 +| `int` | 4 | -2¬≥¬π to 2¬≥¬π-1 | ¬±2.1√ó10‚Åπ | Default choice |
     55 +| `unsigned int` | 4 | 0 to 2¬≥¬≤-1 | 4.3√ó10‚Åπ | Non-negative only |
     56 +| `long long` | 8 | -2‚Å∂¬≥ to 2‚Å∂¬≥-1 | ¬±9.2√ó10¬π‚Å∏ | Large values |
     57 +| `unsigned long long` | 8 | 0 to 2‚Å∂‚Å¥-1 | 1.8√ó10¬π‚Åπ | Very large non-negative |
     58 +
     59 +### Critical Constants (MEMORIZE!)
     60 +
     61 +```cpp
     62 +#include <climits>
     63 +
     64 +INT_MAX    =  2,147,483,647      // ‚âà 2.1 √ó 10‚Åπ
     65 +INT_MIN    = -2,147,483,648      // ‚âà -2.1 √ó 10‚Åπ
     66 +LLONG_MAX  =  9,223,372,036,854,775,807  // ‚âà 9.2 √ó 10¬π‚Å∏
     67 +LLONG_MIN  = -9,223,372,036,854,775,808  // ‚âà -9.2 √ó 10¬π‚Å∏
     68 +
     69 +// Quick mental math
     70 +INT_MAX   ‚âà 2 √ó 10‚Åπ    (2 billion)
     71 +LLONG_MAX ‚âà 9 √ó 10¬π‚Å∏   (9 quintillion)
     72 +```
     73 +
     74 +### When to Use Which Type
     75 +
     76 +| Problem Constraint | Type to Use | Example |
     77 +|-------------------|-------------|---------|
     78 +| n ‚â§ 10‚Åµ, values ‚â§ 10‚Åπ | `int` | Most problems |
     79 +| Values > 2√ó10‚Åπ | `long long` | Large sums, products |
     80 +| Sum of n elements, n ‚â§ 10‚Åµ | `long long` | 10‚Åµ √ó 10‚Åπ = 10¬π‚Å¥ |
     81 +| Product of elements | `long long` or modulo | Overflow danger! |
     82 +| n √ó n where n ‚â§ 10‚Åµ | `long long` | 10¬π‚Å∞ > INT_MAX |
     83 +
     84 +### ‚ö†Ô∏è Overflow Danger Zones
     85 +
     86 +```cpp
     87 +// ‚ùå OVERFLOW! (10‚Åµ √ó 10‚Åµ = 10¬π‚Å∞ > INT_MAX)
     88 +int n = 100000;
     89 +int result = n * n;  // WRONG!
     90 +
     91 +// ‚úÖ SAFE
     92 +long long result = (long long)n * n;
     93 +long long result = 1LL * n * n;
     94 +
     95 +// ‚ùå OVERFLOW! (sum of 10‚Åµ elements each up to 10‚Åπ)
     96 +int sum = 0;
     97 +for (int x : arr) sum += x;  // WRONG if arr is large!
     98 +
     99 +// ‚úÖ SAFE
    100 +long long sum = 0;
    101 +for (int x : arr) sum += x;
    102 +```
    103 +
    104 +### Modular Arithmetic
    105 +
    106 +When problem says "answer modulo 10‚Åπ+7":
    107 +
    108 +```cpp
    109 +const int MOD = 1e9 + 7;  // 1,000,000,007 (prime)
    110 +
    111 +// Addition
    112 +(a + b) % MOD
    113 +
    114 +// Subtraction (add MOD to avoid negative)
    115 +((a - b) % MOD + MOD) % MOD
    116 +
    117 +// Multiplication
    118 +(1LL * a * b) % MOD  // Cast to long long first!
    119 +
    120 +// Common modulo values
    121 +10‚Åπ + 7  = 1,000,000,007  // Most common (prime)
    122 +10‚Åπ + 9  = 1,000,000,009  // Also prime
    123 +998244353                  // FFT-friendly prime (2¬≤¬≥ √ó 7 √ó 17 + 1)
    124 +```
    125 +
    126 +---
    127 +
    128 +## üìä Array & Container Constraints
    129 +
    130 +### Maximum Array Sizes
    131 +
    132 +| Memory | Max Elements (`int`) | Max Elements (`long long`) |
    133 +|--------|---------------------|---------------------------|
    134 +| 256 MB | ~64 million | ~32 million |
    135 +| 512 MB | ~128 million | ~64 million |
    136 +| 1 GB | ~256 million | ~128 million |
    137 +
    138 +**Formula:** Max elements = Memory / sizeof(type)
    139 +- 256 MB = 256 √ó 10‚Å∂ bytes
    140 +- int array: 256 √ó 10‚Å∂ / 4 = 64 √ó 10‚Å∂
    141 +
    142 +### Typical Constraints by Problem Type
    143 +
    144 +| Problem Type | Typical n | Expected Complexity |
    145 +|--------------|-----------|-------------------|
    146 +| Easy | ‚â§ 10¬≥ | O(n¬≤) acceptable |
    147 +| Medium | ‚â§ 10‚Åµ | O(n log n) expected |
    148 +| Hard | ‚â§ 10‚Å∂ | O(n) or O(n log n) |
    149 +| Very Hard | ‚â§ 10‚Å∑ | O(n) only |
    150 +
    151 +### 2D Array Limits
    152 +
    153 +```cpp
    154 +// Max 2D array with 256MB memory
    155 +// n √ó m √ó sizeof(int) ‚â§ 256 √ó 10‚Å∂
    156 +
    157 +// Safe limits:
    158 +int arr[1000][1000];     // 4 MB - ‚úÖ Safe
    159 +int arr[5000][5000];     // 100 MB - ‚úÖ Usually safe
    160 +int arr[10000][10000];   // 400 MB - ‚ùå Too large!
    161 +
    162 +// For larger grids, use vector (dynamic allocation)
    163 +vector<vector<int>> grid(n, vector<int>(m));
    164 +```
    165 +
    166 +### Container Memory Usage
    167 +
    168 +| Container | Memory per Element | Notes |
    169 +|-----------|-------------------|-------|
    170 +| `vector<int>` | 4 bytes | Most efficient |
    171 +| `deque<int>` | 4 bytes + overhead | Block allocation |
    172 +| `list<int>` | 4 + 16 bytes | Node pointers |
    173 +| `set<int>` | 4 + 32 bytes | Red-black tree |
    174 +| `unordered_set<int>` | 4 + ~8 bytes | Hash table |
    175 +| `map<int,int>` | 8 + 32 bytes | Red-black tree |
    176 +| `unordered_map<int,int>` | 8 + ~16 bytes | Hash table |
    177 +
    178 +---
    179 +
    180 +## üìù String Constraints
    181 +
    182 +### String Length Limits
    183 +
    184 +| Constraint | Typical Value | Common Problems |
    185 +|------------|---------------|-----------------|
    186 +| Short strings | ‚â§ 100 | Brute force OK |
    187 +| Medium strings | ‚â§ 10‚Åµ | O(n) required |
    188 +| Long strings | ‚â§ 10‚Å∂ | O(n) only |
    189 +| Multiple strings | Total length ‚â§ 10‚Å∂ | Sum constraint |
    190 +
    191 +### Character Set Assumptions
    192 +
    193 +```cpp
    194 +// Lowercase letters only: 'a' to 'z' (26 chars)
    195 +int freq[26] = {0};
    196 +freq[ch - 'a']++;
    197 +
    198 +// All letters: 'A'-'Z', 'a'-'z' (52 chars)
    199 +// Usually case-insensitive or convert to one case
    200 +
    201 +// Digits: '0' to '9' (10 chars)
    202 +int digit = ch - '0';
    203 +
    204 +// ASCII printable: 32 to 126 (95 chars)
    205 +int freq[128] = {0};  // Safe for all ASCII
    206 +
    207 +// Unicode: Use std::string with UTF-8
    208 +// Careful: string[i] may not be a full character!
    209 +```
    210 +
    211 +### String Comparison Complexity
    212 +
    213 +```cpp
    214 +// Comparing two strings of length n and m
    215 +s1 == s2;           // O(min(n, m))
    216 +s1.compare(s2);     // O(min(n, m))
    217 +s1 < s2;            // O(min(n, m))
    218 +
    219 +// For multiple comparisons, use hashing
    220 +hash<string> hasher;
    221 +size_t h = hasher(s);
    222 +```
    223 +
    224 +---
    225 +
    226 +## ‚è±Ô∏è Time Complexity Limits
    227 +
    228 +### Operations per Second
    229 +
    230 +| Operation Type | Operations/Second |
    231 +|---------------|-------------------|
    232 +| Simple arithmetic | ~10‚Åπ |
    233 +| Array access | ~10‚Å∏ - 10‚Åπ |
    234 +| Vector operations | ~10‚Å∏ |
    235 +| Set/Map operations | ~10‚Å∑ |
    236 +| String operations | ~10‚Å∑ |
    237 +| I/O (cin/cout) | ~10‚Å∂ (without fast I/O) |
    238 +| I/O (fast I/O) | ~10‚Å∑ |
    239 +
    240 +### Maximum n for Time Limits
    241 +
    242 +| Time Limit | O(n) | O(n log n) | O(n¬≤) | O(n¬≥) | O(2‚Åø) |
    243 +|------------|------|------------|-------|-------|-------|
    244 +| 1 second | 10‚Å∏ | 10‚Å∂-10‚Å∑ | 10‚Å¥ | 500 | 25 |
    245 +| 2 seconds | 2√ó10‚Å∏ | 2√ó10‚Å∑ | 1.4√ó10‚Å¥ | 600 | 26 |
    246 +| 5 seconds | 5√ó10‚Å∏ | 5√ó10‚Å∑ | 2√ó10‚Å¥ | 800 | 28 |
    247 +
    248 +### Quick Complexity Check
    249 +
    250 +```cpp
    251 +// Given n, what's the max acceptable complexity?
    252 +n ‚â§ 10     ‚Üí O(n!) or O(2‚Åø) OK
    253 +n ‚â§ 20     ‚Üí O(2‚Åø) OK, O(n!) too slow
    254 +n ‚â§ 100    ‚Üí O(n¬≥) OK
    255 +n ‚â§ 1000   ‚Üí O(n¬≤) OK
    256 +n ‚â§ 10‚Åµ    ‚Üí O(n log n) or better
    257 +n ‚â§ 10‚Å∂    ‚Üí O(n log n) risky, O(n) preferred
    258 +n ‚â§ 10‚Å∏    ‚Üí O(n) only
    259 +```
    260 +
    261 +### Reverse: Given Complexity, Max n
    262 +
    263 +| Complexity | Max n (1 sec) |
    264 +|------------|---------------|
    265 +| O(n!) | n ‚â§ 10 |
    266 +| O(2‚Åø) | n ‚â§ 20-25 |
    267 +| O(n¬≥) | n ‚â§ 500 |
    268 +| O(n¬≤ log n) | n ‚â§ 1000 |
    269 +| O(n¬≤) | n ‚â§ 5000-10000 |
    270 +| O(n‚àön) | n ‚â§ 10‚Åµ |
    271 +| O(n log n) | n ‚â§ 10‚Å∂-10‚Å∑ |
    272 +| O(n) | n ‚â§ 10‚Å∏ |
    273 +| O(log n) | n ‚â§ 10¬π‚Å∏ |
    274 +| O(1) | n = anything |
    275 +
    276 +---
    277 +
    278 +## üíæ Space Complexity Limits
    279 +
    280 +### Memory Calculation
    281 +
    282 +```cpp
    283 +// Typical memory limits
    284 +256 MB = 256 √ó 10‚Å∂ bytes = 64 √ó 10‚Å∂ ints
    285 +512 MB = 512 √ó 10‚Å∂ bytes = 128 √ó 10‚Å∂ ints
    286 +
    287 +// Stack vs Heap
    288 +// Stack: Limited (~1-8 MB) - local variables, recursion
    289 +// Heap: Limited by problem constraint - new, vector
    290 +
    291 +// Recursion depth limit (stack)
    292 +// ~10‚Å¥ - 10‚Åµ calls typically safe
    293 +// Deep recursion may cause stack overflow!
    294 +
    295 +// Tail recursion or iteration preferred for deep recursion
    296 +```
    297 +
    298 +### Data Structure Space
    299 +
    300 +| Structure | Space | Example |
    301 +|-----------|-------|---------|
    302 +| Array of n ints | 4n bytes | n = 10‚Å∂ ‚Üí 4 MB |
    303 +| n √ó n int matrix | 4n¬≤ bytes | n = 5000 ‚Üí 100 MB |
    304 +| Adjacency list | O(V + E) | |
    305 +| Adjacency matrix | O(V¬≤) | |
    306 +| Binary tree (n nodes) | ~32n bytes | Node + 2 pointers |
    307 +| Graph (V vertices, E edges) | V + E | Adjacency list |
    308 +
    309 +---
    310 +
    311 +## üî¢ Common Primes & Mathematical Constants
    312 +
    313 +### Primes to Know
    314 +
    315 +```cpp
    316 +// For modular arithmetic
    317 +10‚Åπ + 7 = 1,000,000,007  // Most common modulo (prime)
    318 +10‚Åπ + 9 = 1,000,000,009  // Alternative (prime)
    319 +998244353                 // NTT prime (2¬≤¬≥ √ó 7 √ó 17 + 1)
    320 +
    321 +// Small primes for hashing
    322 +31, 37, 53, 97, 131, 1009, 10007
    323 +
    324 +// For string hashing (rolling hash)
    325 +base = 31 or 37 (for lowercase letters)
    326 +base = 53 (for mixed case)
    327 +mod = 10‚Åπ + 7 or 10‚Åπ + 9
    328 +
    329 +// Largest prime ‚â§ n
    330 +// Under 100: 97
    331 +// Under 1000: 997
    332 +// Under 10000: 9973
    333 +// Under 10‚Åµ: 99991
    334 +// Under 10‚Å∂: 999983
    335 +// Under 10‚Åπ: 999999937
    336 +```
    337 +
    338 +### Mathematical Constants
    339 +
    340 +```cpp
    341 +// For geometry and floating point
    342 +const double PI = acos(-1);        // 3.14159265358979...
    343 +const double PI = 3.14159265358979323846;
    344 +const double E = exp(1);           // 2.71828...
    345 +
    346 +// For comparison (floating point tolerance)
    347 +const double EPS = 1e-9;
    348 +if (abs(a - b) < EPS) // a == b
    349 +
    350 +// For "infinity" in algorithms
    351 +const int INF = 1e9;           // For int (won't overflow on add)
    352 +const int INF = INT_MAX / 2;   // Safe for addition
    353 +const long long INF = 1e18;    // For long long
    354 +const long long INF = LLONG_MAX / 2;
    355 +```
    356 +
    357 +### Useful Mathematical Facts
    358 +
    359 +```cpp
    360 +// Factorials
    361 +10! = 3,628,800             // Fits in int
    362 +12! = 479,001,600           // Last to fit in int
    363 +13! = 6,227,020,800         // Needs long long
    364 +20! ‚âà 2.4 √ó 10¬π‚Å∏            // Last to fit in long long
    365 +21! overflows long long!
    366 +
    367 +// Powers of 2
    368 +2¬π‚Å∞ = 1,024 ‚âà 10¬≥
    369 +2¬≤‚Å∞ = 1,048,576 ‚âà 10‚Å∂
    370 +2¬≥‚Å∞ = 1,073,741,824 ‚âà 10‚Åπ
    371 +2¬≥¬≤ = 4,294,967,296 ‚âà 4 √ó 10‚Åπ (unsigned int max + 1)
    372 +2‚Å∂‚Å¥ ‚âà 1.8 √ó 10¬π‚Åπ
    373 +
    374 +// Fibonacci
    375 +F(45) = 1,134,903,170       // Last to fit in int
    376 +F(92) = 7,540,113,804,746,346,429  // Last to fit in long long
    377 +
    378 +// Catalan numbers (combinatorics)
    379 +C(17) = 129,644,790         // Fits in int
    380 +C(35) = 3,116,285,494,907,301,262  // Fits in long long
    381 +```
    382 +
    383 +---
    384 +
    385 +## ‚úÖ Edge Cases Checklist
    386 +
    387 +### Array/Vector Edge Cases
    388 +
    389 +```cpp
    390 +// Always test:
    391 +‚ñ° Empty array (n = 0)
    392 +‚ñ° Single element (n = 1)
    393 +‚ñ° Two elements (n = 2)
    394 +‚ñ° All same elements
    395 +‚ñ° Already sorted (ascending)
    396 +‚ñ° Reverse sorted (descending)
    397 +‚ñ° Maximum size (n = max constraint)
    398 +‚ñ° Negative numbers
    399 +‚ñ° Zero values
    400 +‚ñ° INT_MAX / INT_MIN values
    401 +‚ñ° Duplicates at boundaries
    402 +```
    403 +
    404 +### String Edge Cases
    405 +
    406 +```cpp
    407 +// Always test:
    408 +‚ñ° Empty string (s = "")
    409 +‚ñ° Single character (s = "a")
    410 +‚ñ° All same character (s = "aaa")
    411 +‚ñ° Palindrome
    412 +‚ñ° All unique characters
    413 +‚ñ° Maximum length
    414 +‚ñ° Spaces/special characters (if allowed)
    415 +‚ñ° Case sensitivity (if relevant)
    416 +```
    417 +
    418 +### Graph Edge Cases
    419 +
    420 +```cpp
    421 +// Always test:
    422 +‚ñ° Empty graph (no edges)
    423 +‚ñ° Single node
    424 +‚ñ° Disconnected graph
    425 +‚ñ° Complete graph
    426 +‚ñ° Tree (n-1 edges)
    427 +‚ñ° Cycle
    428 +‚ñ° Self-loop (if allowed)
    429 +‚ñ° Multiple edges between same nodes
    430 +‚ñ° Negative edge weights (if allowed)
    431 +‚ñ° All edges same weight
    432 +```
    433 +
    434 +### Tree Edge Cases
    435 +
    436 +```cpp
    437 +// Always test:
    438 +‚ñ° Empty tree (null root)
    439 +‚ñ° Single node
    440 +‚ñ° Skewed tree (all left or all right)
    441 +‚ñ° Perfect/complete binary tree
    442 +‚ñ° Maximum depth
    443 +‚ñ° All same values
    444 +‚ñ° Negative values (if allowed)
    445 +```
    446 +
    447 +### Number Edge Cases
    448 +
    449 +```cpp
    450 +// Always test:
    451 +‚ñ° Zero (0)
    452 +‚ñ° Negative zero (-0 for floating point)
    453 +‚ñ° INT_MAX (2,147,483,647)
    454 +‚ñ° INT_MIN (-2,147,483,648)
    455 +‚ñ° Powers of 2
    456 +‚ñ° One less than power of 2
    457 +‚ñ° Prime numbers
    458 +‚ñ° Perfect squares
    459 +‚ñ° Negative numbers
    460 +‚ñ° Very small positive (1)
    461 +‚ñ° Very large (max constraint)
    462 +```
    463 +
    464 +### Binary Search Edge Cases
    465 +
    466 +```cpp
    467 +// Always test:
    468 +‚ñ° Target at index 0
    469 +‚ñ° Target at last index
    470 +‚ñ° Target not in array
    471 +‚ñ° Target smaller than all elements
    472 +‚ñ° Target larger than all elements
    473 +‚ñ° All elements are target
    474 +‚ñ° Single element equals target
    475 +‚ñ° Single element doesn't equal target
    476 +‚ñ° Two elements
    477 +```
    478 +
    479 +---
    480 +
    481 +## üñ•Ô∏è Platform-Specific Constraints
    482 +
    483 +### LeetCode
    484 +
    485 +```cpp
    486 +// Typical constraints
    487 +n ‚â§ 10‚Åµ (most problems)
    488 +n ‚â§ 10¬≥ (allows O(n¬≤))
    489 +n ‚â§ 10‚Å¥ (O(n¬≤) risky)
    490 +Values: -10‚Åπ to 10‚Åπ (fits in int)
    491 +
    492 +// Time limit: Usually generous
    493 +// Memory: 256 MB typical
    494 +
    495 +// Fast I/O not needed (uses function calls)
    496 +```
    497 +
    498 +### Codeforces
    499 +
    500 +```cpp
    501 +// Typical constraints
    502 +n ‚â§ 2 √ó 10‚Åµ (common)
    503 +n ‚â§ 10‚Å∂ (harder problems)
    504 +Time: 1-2 seconds
    505 +Memory: 256 MB (standard)
    506 +
    507 +// Fast I/O REQUIRED for large input
    508 +ios::sync_with_stdio(false);
    509 +cin.tie(nullptr);
    510 +```
    511 +
    512 +### HackerRank
    513 +
    514 +```cpp
    515 +// Varies by problem
    516 +// Often has multiple test cases
    517 +// Time limits can be strict
    518 +// Fast I/O recommended
    519 +
    520 +// Multiple test cases pattern
    521 +int t;
    522 +cin >> t;
    523 +while (t--) {
    524 +    // solve
    525 +}
    526 +```
    527 +
    528 +### Google/FAANG Interviews
    529 +
    530 +```cpp
    531 +// Focus on:
    532 +- Optimal time complexity
    533 +- Clean, readable code
    534 +- Handle all edge cases
    535 +- Discuss trade-offs
    536 +
    537 +// Typical expectations:
    538 +n ‚â§ 10‚Åµ to 10‚Å∂
    539 +Time: O(n) or O(n log n)
    540 +Space: O(1) to O(n)
    541 +```
    542 +
    543 +---
    544 +
    545 +## üìã Quick Reference Cheatsheet
    546 +
    547 +### Numbers to Memorize
    548 +
    549 +| Value | Meaning | Use Case |
    550 +|-------|---------|----------|
    551 +| 10‚Åπ | ~INT_MAX / 2 | Safe int limit |
    552 +| 2 √ó 10‚Åπ | ~INT_MAX | Max positive int |
    553 +| 10¬π‚Å∏ | ~LLONG_MAX / 9 | Safe long long |
    554 +| 10‚Åπ + 7 | Common modulo | Modular arithmetic |
    555 +| 10‚Åµ | Typical n limit | O(n log n) problems |
    556 +| 10‚Å¥ | O(n¬≤) threshold | When O(n¬≤) is OK |
    557 +| 20-25 | 2‚Åø threshold | Bitmask/subset problems |
    558 +| 10 | n! threshold | Permutation problems |
    559 +
    560 +### Quick Type Selection
    561 +
    562 +```cpp
    563 +// Default
    564 +int x;                  // Values ‚â§ 10‚Åπ
    565 +
    566 +// Large values
    567 +long long x;           // Values > 2√ó10‚Åπ
    568 +
    569 +// Large sums
    570 +long long sum = 0;     // Sum of many ints
    571 +
    572 +// Products
    573 +long long prod = 1LL * a * b;  // Multiply ints
    574 +
    575 +// Modular
    576 +const int MOD = 1e9 + 7;
    577 +((1LL * a * b) % MOD)
    578 +```
    579 +
    580 +### Fast I/O Template
    581 +
    582 +```cpp
    583 +#include <bits/stdc++.h>
    584 +using namespace std;
    585 +
    586 +int main() {
    587 +    ios::sync_with_stdio(false);
    588 +    cin.tie(nullptr);
    589 +
    590 +    // Your code here
    591 +
    592 +    return 0;
    593 +}
    594 +```
    595 +
    596 +### Infinity Values
    597 +
    598 +```cpp
    599 +// For shortest path, DP
    600 +const int INF = 1e9;           // int infinity
    601 +const long long INF = 1e18;    // long long infinity
    602 +
    603 +// For comparisons (safe for addition)
    604 +const int INF = INT_MAX / 2;
    605 +const long long INF = LLONG_MAX / 2;
    606 +```
    607 +
    608 +---
    609 +
    610 +## üéØ Interview Tips
    611 +
    612 +1. **Always ask for constraints first** - Determines algorithm choice
    613 +2. **State assumptions explicitly** - "I'm assuming n ‚â§ 10‚Åµ"
    614 +3. **Check for overflow** - Especially with multiplication and sums
    615 +4. **Use appropriate data types** - `long long` when in doubt
    616 +5. **Test edge cases mentally** - Before coding, walk through edge cases
    617 +6. **Know your constants** - INT_MAX, 10‚Åπ+7, complexity thresholds
    618 +
    619 +---
    620 +
    621 +*Last Updated: December 19, 2025*
    622  

```


### üìÑ `script.js`

**Type:** JavaScript Source File üü®

```diff
@@ -29,6 +29,242 @@ window.katex = katex;
 29  29  window.html2pdf = html2pdf;
 30  30  window.markedFootnote = markedFootnote;
 31  31  
     32 +// ==================== ANCHOR NAVIGATION ====================
     33 +// Heading slug tracking (module-level singleton for marked.js singleton)
     34 +const headingSlugMap = new Map();
     35 +
     36 +// Pre-compiled slug replacements (zero GC pressure per render)
     37 +const SLUG_REPLACEMENTS = [
     38 +  [/c\+\+/gi, 'cpp'],
     39 +  [/c#/gi, 'csharp'],
     40 +  [/f#/gi, 'fsharp'],
     41 +  [/\.net/gi, 'dotnet'],
     42 +];
     43 +
     44 +/**
     45 + * Reset slug map (call before each parse)
     46 + */
     47 +function resetSlugMap() {
     48 +  headingSlugMap.clear();
     49 +}
     50 +
     51 +/**
     52 + * Generate URL-safe slug from heading text
     53 + * @param {string} text - Raw heading text (may include HTML)
     54 + * @param {Map<string, number>} seen - Duplicate tracking map
     55 + * @returns {string} URL-safe slug
     56 + */
     57 +function generateSlug(text, seen = headingSlugMap) {
     58 +  // Strip HTML tags
     59 +  let slug = text.replace(/<[^>]*>/g, '');
     60 +
     61 +  // Normalize Unicode
     62 +  slug = slug.normalize('NFC').toLowerCase();
     63 +
     64 +  // Replace programming terms (pre-compiled patterns)
     65 +  for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
     66 +    slug = slug.replace(pattern, replacement);
     67 +  }
     68 +
     69 +  // Clean up: remove non-word chars, spaces to hyphens, collapse hyphens
     70 +  slug = slug
     71 +    .replace(/[^\w\s-]/g, '')
     72 +    .replace(/\s+/g, '-')
     73 +    .replace(/-+/g, '-')
     74 +    .replace(/^-+|-+$/g, '');
     75 +
     76 +  // Fallback for empty result
     77 +  if (!slug) slug = 'section';
     78 +
     79 +  // Handle duplicates (header, header-1, header-2)
     80 +  const baseSlug = slug;
     81 +  const count = seen.get(baseSlug) || 0;
     82 +  if (count > 0) slug = `${baseSlug}-${count}`;
     83 +  seen.set(baseSlug, count + 1);
     84 +
     85 +  return slug;
     86 +}
     87 +
     88 +/**
     89 + * Anchor Navigation Module
     90 + * Handles in-document anchor navigation with scoped selection
     91 + */
     92 +const AnchorNavigation = {
     93 +  container: null,
     94 +  pendingScroll: null,
     95 +
     96 +  /**
     97 +   * Initialize anchor navigation
     98 +   * @param {HTMLElement} previewContainer - Scrollable preview container
     99 +   */
    100 +  init(previewContainer) {
    101 +    this.container = previewContainer;
    102 +
    103 +    // Event delegation for anchor clicks
    104 +    this.container.addEventListener('click', this.handleClick.bind(this));
    105 +
    106 +    // Browser back/forward navigation
    107 +    window.addEventListener('hashchange', this.handleHashChange.bind(this));
    108 +
    109 +    // Initial page load with hash
    110 +    if (window.location.hash) {
    111 +      requestAnimationFrame(() => {
    112 +        this.scrollToHash(window.location.hash.slice(1), false);
    113 +      });
    114 +    }
    115 +
    116 +    console.log('‚úÖ Anchor navigation initialized');
    117 +  },
    118 +
    119 +  /**
    120 +   * Handle click events (delegated)
    121 +   */
    122 +  handleClick(event) {
    123 +    const link = event.target.closest('a[href^="#"]');
    124 +    if (!link) return;
    125 +
    126 +    // Ignore external links
    127 +    if (link.hostname && link.hostname !== window.location.hostname) return;
    128 +
    129 +    event.preventDefault();
    130 +
    131 +    const hash = link.getAttribute('href').slice(1);
    132 +    this.scrollToHash(hash, true);
    133 +
    134 +    // Update URL without triggering hashchange
    135 +    history.pushState(null, '', `#${hash}`);
    136 +  },
    137 +
    138 +  /**
    139 +   * Handle hashchange (browser back/forward)
    140 +   */
    141 +  handleHashChange() {
    142 +    const hash = window.location.hash.slice(1);
    143 +    if (hash) {
    144 +      this.scrollToHash(hash, true);
    145 +    } else {
    146 +      this.scrollToTop(true);
    147 +    }
    148 +  },
    149 +
    150 +  /**
    151 +   * Scroll to element by hash
    152 +   * @param {string} hash - URL hash (without #)
    153 +   * @param {boolean} smooth - Use smooth scrolling
    154 +   */
    155 +  scrollToHash(hash, smooth = true) {
    156 +    // Cancel pending scroll (handle concurrent clicks)
    157 +    if (this.pendingScroll) {
    158 +      clearTimeout(this.pendingScroll);
    159 +      this.pendingScroll = null;
    160 +    }
    161 +
    162 +    if (!hash) {
    163 +      this.scrollToTop(smooth);
    164 +      return;
    165 +    }
    166 +
    167 +    const target = this.resolveTarget(hash);
    168 +    if (!target) return;
    169 +
    170 +    target.scrollIntoView({
    171 +      behavior: smooth ? 'smooth' : 'instant',
    172 +      block: 'start',
    173 +    });
    174 +
    175 +    this.manageFocus(target, smooth);
    176 +  },
    177 +
    178 +  /**
    179 +   * Scroll to top of container
    180 +   */
    181 +  scrollToTop(smooth = true) {
    182 +    this.container.scrollTo({
    183 +      top: 0,
    184 +      behavior: smooth ? 'smooth' : 'instant',
    185 +    });
    186 +  },
    187 +
    188 +  /**
    189 +   * Resolve target element - SCOPED to container (prevents app shell collision)
    190 +   * @param {string} hash - URL hash
    191 +   * @returns {Element|null} Target element or null
    192 +   */
    193 +  resolveTarget(hash) {
    194 +    if (!hash) return null;
    195 +
    196 +    // Decode URI components safely
    197 +    let decodedHash;
    198 +    try {
    199 +      decodedHash = decodeURIComponent(hash);
    200 +    } catch {
    201 +      decodedHash = hash;
    202 +    }
    203 +
    204 +    // Priority 1: Exact ID (SCOPED to container)
    205 +    let target = this.container.querySelector(`#${CSS.escape(decodedHash)}`);
    206 +    if (target) return target;
    207 +
    208 +    // Priority 2: Normalized ID (handles legacy links with emoji, special chars)
    209 +    const normalized = this.normalizeHash(decodedHash);
    210 +    target = this.container.querySelector(`#${CSS.escape(normalized)}`);
    211 +    if (target) return target;
    212 +
    213 +    console.warn(`[AnchorNav] Target not found: "${hash}"`);
    214 +    return null;
    215 +  },
    216 +
    217 +  /**
    218 +   * Normalize hash for legacy link matching
    219 +   * @param {string} hash - Raw hash string
    220 +   * @returns {string} Normalized hash
    221 +   */
    222 +  normalizeHash(hash) {
    223 +    let slug = hash.normalize('NFC').toLowerCase();
    224 +
    225 +    // Apply same transformations as generateSlug
    226 +    for (const [pattern, replacement] of SLUG_REPLACEMENTS) {
    227 +      slug = slug.replace(pattern, replacement);
    228 +    }
    229 +
    230 +    return slug
    231 +      .replace(/[^\w\s-]/g, '')
    232 +      .replace(/\s+/g, '-')
    233 +      .replace(/-+/g, '-')
    234 +      .replace(/^-+|-+$/g, '') || 'section';
    235 +  },
    236 +
    237 +  /**
    238 +   * Manage focus after scroll (accessibility)
    239 +   * @param {Element} target - Target element
    240 +   * @param {boolean} smooth - Was smooth scroll used
    241 +   */
    242 +  manageFocus(target, smooth) {
    243 +    const focusTarget = () => {
    244 +      // Make heading focusable if not already
    245 +      if (!target.hasAttribute('tabindex')) {
    246 +        target.setAttribute('tabindex', '-1');
    247 +      }
    248 +      target.focus({ preventScroll: true });
    249 +    };
    250 +
    251 +    if (!smooth) {
    252 +      focusTarget();
    253 +      return;
    254 +    }
    255 +
    256 +    // Modern browsers: use scrollend event
    257 +    if ('onscrollend' in this.container) {
    258 +      this.container.addEventListener('scrollend', focusTarget, { once: true });
    259 +    } else {
    260 +      // Fallback: estimate scroll duration (max 1000ms for safety)
    261 +      const distance = Math.abs(target.getBoundingClientRect().top);
    262 +      const duration = Math.min(Math.max(distance / 2, 300), 1000);
    263 +      this.pendingScroll = setTimeout(focusTarget, duration + 50);
    264 +    }
    265 +  },
    266 +};
    267 +
 32 268  // Initialize services and managers
 33 269  const storageManager = new StorageManager();
 34 270  const themeManager = new ThemeManager(storageManager);
@@ -360,6 +596,19 @@ function configureMarkedExtensions() {
360 596    });
361 597  
362 598    console.log('‚úÖ Marked.js configured with all extensions (LaTeX, subscript, superscript)');
    599 +
    600 +  // Custom heading renderer with ID generation for anchor navigation
    601 +  marked.use({
    602 +    renderer: {
    603 +      heading(token) {
    604 +        const text = this.parser.parseInline(token.tokens);
    605 +        const level = token.depth;
    606 +        const slug = generateSlug(text, headingSlugMap);
    607 +        return `<h${level} id="${slug}">${text}</h${level}>\n`;
    608 +      }
    609 +    }
    610 +  });
    611 +  console.log('‚úÖ Custom heading renderer enabled (anchor navigation IDs)');
363 612  }
364 613  
365 614  // Initialize Mermaid using MermaidService (prefixed to indicate future use)
@@ -550,6 +799,9 @@ graph TD
550 799    // Render markdown (expose globally for theme changes)
551 800    function renderMarkdown() {
552 801      try {
    802 +      // Reset slug map before parsing (singleton-safe pattern)
    803 +      resetSlugMap();
    804 +
553 805        const markdownText = editor.value;
554 806  
555 807        // Parse markdown with all extensions
@@ -2001,6 +2253,9 @@ Wrap up your thoughts and include a call to action.
2001 2253    // Initialize expand button visibility on load
2002 2254    updateExpandButtonVisibility();
2003 2255  
    2256 +  // Initialize anchor navigation for TOC links
    2257 +  AnchorNavigation.init(previewContainer);
    2258 +
2004 2259    // DON'T render immediately - wait for theme to load
2005 2260    // renderMarkdown will be called after theme loads above
2006 2261  }
2007 2262  

```


### üìÑ `style.css`

**Type:** Stylesheet üé®

```diff
@@ -224,6 +224,47 @@ body {
224 224    overflow: auto;
225 225    /* Single scrollbar for preview container */
226 226    min-width: 200px;
    227 +  /* Anchor Navigation - scroll offset for fixed toolbar */
    228 +  scroll-padding-top: var(--scroll-offset, 80px);
    229 +}
    230 +
    231 +/* ==================== ANCHOR NAVIGATION ==================== */
    232 +
    233 +/* Target highlight animation */
    234 +.preview-container :target {
    235 +  animation: anchor-highlight 2s ease-out;
    236 +}
    237 +
    238 +@keyframes anchor-highlight {
    239 +  0% {
    240 +    background-color: rgba(255, 255, 0, 0.3);
    241 +  }
    242 +
    243 +  100% {
    244 +    background-color: transparent;
    245 +  }
    246 +}
    247 +
    248 +/* Focus management - hide outline for mouse clicks */
    249 +.preview-container h1[id]:focus:not(:focus-visible),
    250 +.preview-container h2[id]:focus:not(:focus-visible),
    251 +.preview-container h3[id]:focus:not(:focus-visible),
    252 +.preview-container h4[id]:focus:not(:focus-visible),
    253 +.preview-container h5[id]:focus:not(:focus-visible),
    254 +.preview-container h6[id]:focus:not(:focus-visible) {
    255 +  outline: none;
    256 +}
    257 +
    258 +/* Keyboard focus gets visible indicator */
    259 +.preview-container h1[id]:focus-visible,
    260 +.preview-container h2[id]:focus-visible,
    261 +.preview-container h3[id]:focus-visible,
    262 +.preview-container h4[id]:focus-visible,
    263 +.preview-container h5[id]:focus-visible,
    264 +.preview-container h6[id]:focus-visible {
    265 +  outline: 2px solid var(--h1-color, #007bff);
    266 +  outline-offset: 4px;
    267 +  border-radius: 2px;
227 268  }
228 269  
229 270  .preview-header {
230 271  

```


### üìÑ `variables.css`

**Type:** Stylesheet üé®

```diff
@@ -11,13 +11,18 @@
 11  11    /* ==================== NEBULA DARK (Default) ==================== */
 12  12  
 13  13    /* Core Backgrounds */
 14     -  --bg-universe: #050508;     /* The void */
 15     -  --bg-element: #0f1123;      /* Solid panels if needed */
     14 +  --bg-universe: #050508;
     15 +  /* The void */
     16 +  --bg-element: #0f1123;
     17 +  /* Solid panels if needed */
 16  18  
 17  19    /* Glass System */
 18     -  --bg-glass: rgba(15, 17, 35, 0.6);        /* Main panels */
 19     -  --bg-glass-heavy: rgba(10, 12, 25, 0.85); /* Sidebar/Modals */
 20     -  --bg-glass-light: rgba(255, 255, 255, 0.05); /* Hover states */
     20 +  --bg-glass: rgba(15, 17, 35, 0.6);
     21 +  /* Main panels */
     22 +  --bg-glass-heavy: rgba(10, 12, 25, 0.85);
     23 +  /* Sidebar/Modals */
     24 +  --bg-glass-light: rgba(255, 255, 255, 0.05);
     25 +  /* Hover states */
 21  26  
 22  27    /* Borders */
 23  28    --border-glass: rgba(255, 255, 255, 0.08);
@@ -44,6 +49,10 @@
 44  49    --radius-lg: 16px;
 45  50    --radius-md: 12px;
 46  51    --radius-sm: 8px;
     52 +
     53 +  /* Anchor Navigation */
     54 +  --scroll-padding: 20px;
     55 +  --scroll-offset: calc(var(--header-height) + var(--scroll-padding));
 47  56  }
 48  57  
 49  58  /* ==================== NEBULA LIGHT ==================== */
 50  59  

```

---

## ü§ñ AI Review Checklist

Please review these changes for:

### üîç Code Quality
- [ ] **Linting Compliance**: No unused imports/variables, proper formatting
- [ ] **Type Safety**: Proper typing throughout (TypeScript/Python type hints)
- [ ] **Best Practices**: Framework-specific conventions and patterns
- [ ] **Performance**: Efficient algorithms, proper memoization
- [ ] **Documentation**: Clear comments and function descriptions

### üêõ Potential Issues
- [ ] **Runtime Errors**: Type mismatches, null/undefined handling
- [ ] **Logic Bugs**: Incorrect calculations, edge cases
- [ ] **Memory Leaks**: Cleanup in lifecycle methods, event listeners
- [ ] **Error Handling**: Proper try-catch blocks, user feedback
- [ ] **Accessibility**: ARIA labels, keyboard navigation, screen readers

### üîí Security & Data
- [ ] **Input Validation**: Sanitization, XSS prevention, SQL injection
- [ ] **Authentication**: Proper access controls and permissions
- [ ] **Privacy**: No sensitive data exposure in logs/client
- [ ] **Dependencies**: Updated packages, vulnerability checks

### üì± UX/UI
- [ ] **Responsive Design**: Mobile/desktop/tablet compatibility
- [ ] **Loading States**: Proper feedback during async operations
- [ ] **Error Messages**: User-friendly error handling and recovery
- [ ] **Performance**: Fast loading, smooth animations

### üí° Suggestions & Improvements
Please provide specific feedback on:
1. Code organization and structure improvements
2. Performance optimization opportunities
3. Security considerations and hardening
4. Testing coverage and strategies
5. Documentation and maintainability

---
*Generated by AI Visual Code Review v2.0 - Unified Export Script*
*Files processed: 5/5 | Errors: 0 | Generated: 2025-12-19T10:49:19.648Z*
